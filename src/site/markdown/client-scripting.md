# Client-side scripting

TODO intro

Here's a list of the other predefined functions that can be used:

* `page(id)`: navigates to a page with the specifed id Ex.: `page("page:homepage")`
* `event(id, value)`: sends an event with the specified id and value to the server Ex.: `event("myEvent", "7")` which produces an event with id `ui.myEvent`
* `command(command, callback)`: sends a command to the server. A callback function can be specified, detailed in _index.js_.
    Example:
    ```
    command("node.myCommand(7)", myCallback);
    ```
    in _index.js_:
    ```
    function myCallback(command, result) {
        alert("command's result:" + result);
    }
    ```     
* `logout()`: logs the user out
* `login(username, password)`: logs the user in
* `setAttribute(id, name, value)`: set a component's attribute

## Sending events

The interface can communicate with the server in various ways, one of which is generating and sending events. These events are called UI events.    

Here's the previous example modifed to send an event to the server:

_/webapp/interfaces/example2/index.xml_

    <interface skin="default" title="Example 2" width="420" height="270" >
        <page id="page:homepage" title="Homepage">
            <button x="130" y="40" width="160" height="60" label="Hello" on-click="event('myevent','myvalue')" />
        </page>
    </interface>

This time pressing button will generate an event with id `ui.myevent` and value `myvalue`.    
`ui` is the prefix used for every event generated by a user interface.    
This will be captured by the server that can react accordingly.

## Setting attributes
In this example we have a slider and two buttons.    
Each button uses the `setAttribute()` funciton to set the slider's value. When a change is detected in the slider's value a "ui.slider_1" event is generated and sent to the server.

_/webapp/interfaces/example4/index.xml_

    <interface skin="default" title="Example 4" width="420" height="270" >
        <page id="page:homepage" title="Homepage">
            <slider id="myslider" x="70" y="30" width="40" height="210" bar-color="#5550f0" />
            <button x="190" y="50" width="160" height="60" label="max" on-click="setAttribute('slider_1','value','100')" />
            <button x="190" y="150" width="160" height="60" label="min" on-click="setAttribute('myslider','value','0')" />
        </page>
    </interface>
    
![scripting-set-attributes](images/scripting-set-attributes.png)

The slider component is used to input a value within a range (for example to control a volume, a light's intensity, etc.).

## Custom functions

Writing javascript directly in the event attributes of components is OK for a minimum amount of code. For longer scripts a custom javascript file can be created.     
This script is in the same scope so any function or variable declared in it can be accessed from the inline script of components.    
Simply add a script.js file in the interface's directory. Here's an example:

_/webapp/interfaces/example5/index.xml_

    <interface skin="default" title="Example 5" width="420" height="270" >
        <page id="page:homepage" title="Homepage">
            <button x="130" y="80" width="160" height="60" label="one" on-click="myFunction(1)" />
            <button x="130" y="180" width="160" height="60" label="two" on-click="myFunction(2)" />
            <label id="mylabel" x="60" y="10" width="300" height="60" text-align="center" />
        </page>
    </interface>
    
_/webapp/interfaces/example5/script.js_

    function myFunction(value) { 
        switch (value) {
        case 1:
            setAttribute("mylabel","text","first option");
            break;
        case 2:
            setAttribute("mylabel","text","second option")
            break;
        }
    }

## Callbacks

It's possible to declare the following functions that will be called on the corresponding events:

* `function onStartup()`: called when the interface is ready
* `function onEvent(id, json)`: called when a UI event is received. If the return value is false, the event is canceled
* `function onPage(name)`: called when a page is shown. If the return value is false, the page is not shown.

Here's an example that opens an alert popup on each event:
    
_/webapp/interfaces/example6/script.js_

    function onStartup(value) {
        alert(“startup event”);
    }
    
    function onPage(name) {
        alert("page event: " + name);
    }
    
    function onEvent(node, json) {
		alert("event received. Node: " + node + ", JSON: " + JSON.stringify(json));
    }
