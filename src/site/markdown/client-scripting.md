# Client-side scripting

Client-side scripting defines the interface's logic.
Scripting is done in javascript directly on component's events (for example an _onclick_ event on a button component) or, for more complex scripts, in one or more javascript files located under the interface's directory.

To ease development there are some predefined functions for the most common :

* `page(id)`: navigates to a page with the specifed id Ex.: `page("home")`
* `event(id, value)`: sends an event with the specified id and value to the server Ex.: `event("myEvent", "7")` which produces an event with id `ui.myEvent`
* `command(command, callback)`: sends a command to the server. A callback function can be specified.
    Example:
    ```
    command("node.myCommand(7)", myCallback);
    ```
    in _index.js_:
    ```
    function myCallback(command, result) {
        alert("command's result:" + result);
    }
    ```     
* `logout()`: logs the user out
* `login(username, password)`: logs the user in
* `setAttribute(id, name, value)`: set a component's attribute

## Sending events

The interface can communicate with the server in various ways, one of which is generating and sending events. These events are called UI events.    

Here's an example that sends an event to the server:

_/webapp/interfaces/ex\_events/index.xml_

    <interface skin="default" title="Sending Events" width="420" height="270" >
        <page id="page:home" title="Homepage">
            <button x="130" y="40" width="160" height="60" label="Hello" on-click="event('myevent','myvalue')" />
        </page>
    </interface>

Pressing the button will generate an event with id `ui.myevent` and value `myvalue`.    
`ui` is the prefix used for every event generated by a user interface.    
This will be captured by the server that can react accordingly.

## Sending commands

While sending events allows the server to capture them and react accordingly, commands also allow a reply.
This reply can contain a set of attribute values, or any other custom value.

Here's an example that sends a command to the server, and manages the reply.

_/webapp/interfaces/ex\_commands/index.xml_

    <interface skin="default" title="Sending Commands" width="420" height="270" >
        <page id="page:home" title="Homepage">
            <button x="130" y="40" width="160" height="60" label="Hello" on-click="command('mycommand',myCallback)" />
        </page>
    </interface>

_/webapp/interfaces/ex\_commands/script.js_

    function myCallback(command, result) {
		alert("Command "+command+" received, with result: "+result);
	}

Pressing the button will generate a command with id `myCommand`, associated to the custom function `myCallback`.
When the reply is received, the javascript function will generate an alert popup.

## Setting attributes
In this example we have a slider and two buttons.    
Each button uses the `setAttribute()` function to set the slider's value. When a change is detected in the slider's value a "ui.slider_1" event is generated and sent to the server.

_/webapp/interfaces/ex\_attributes/index.xml_

    <interface skin="default" title="Setting Attributes" width="420" height="270" >
        <page id="page:home" title="Homepage">
            <slider id="myslider" x="70" y="30" width="40" height="210" bar-color="#5550f0" />
            <button x="190" y="50" width="160" height="60" label="max" on-click="setAttribute('slider_1','value','100')" />
            <button x="190" y="150" width="160" height="60" label="min" on-click="setAttribute('myslider','value','0')" />
        </page>
    </interface>
    
![setting attributes](images/client-scripting/ex_attributes.png)

The slider component is used to input a value within a range (for example to control a volume, a light's intensity, etc.).

## Custom functions

Writing javascript directly in the event attributes of components is acceptable for short amounts of code. For longer scripts custom javascript files can be created.     
These script are all in the same scope so any function or variable declared in it can be accessed from the inline script of components.    
Simply add a script.js file in the interface's directory. Here's an example:

_/webapp/interfaces/ex\_functions/index.xml_

    <interface skin="default" title="Custom functions" width="420" height="270" >
        <page id="page:home" title="Homepage">
            <button x="130" y="80" width="160" height="60" label="one" on-click="myFunction(1)" />
            <button x="130" y="180" width="160" height="60" label="two" on-click="myFunction(2)" />
            <label id="mylabel" x="60" y="10" width="300" height="60" text-align="center" />
        </page>
    </interface>
    
_/webapp/interfaces/ex\_functions/script.js_

    function myFunction(value) { 
        switch (value) {
        case 1:
            setAttribute("mylabel","text","first option");
            break;
        case 2:
            setAttribute("mylabel","text","second option")
            break;
        }
    }

![custom functions](images/client-scripting/ex_functions.png)

## Callbacks

It's possible to declare the following functions that will be called on the corresponding events:

* `function onReady()`: called when the interface is ready
* `function onEvent(id, value)`: called when a UI event is received. If the return value is false, the event is canceled (as if it wasn't received at all). This is useful for example to filter a ui.set event.
* `function onPage(id)`: called when a page is about to be shown. If the return value is false, the page won't be shown.

Here's an example that opens an alert popup on each event:
    
_/webapp/interfaces/ex\_callbacks/script.js_

    function onReady() {
        alert(“ready event”);
    }
    
    function onPage(id) {
        alert("page shown: " + id);
    }
    
    function onEvent(id, value) {
		alert("event received. Node: " + node + ", value: " + value);
    }
