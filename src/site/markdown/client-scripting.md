# Client-side scripting

Client-side scripting defines the interface's logic.
Scripting is done in javascript directly on component's events (for example an _onclick_ event on a button component) or, for more complex scripts, in one or more javascript files located under the interface's directory.

To ease development there are some predefined functions for the most common:

### page
Navigates to a page with the specifed id.

```js
page(<id>)
```

>Example: show the home page.

>```js
page("home")
```

### event
Sends an event with the specified id and value to the server.

```js
event(<id>, <value>)
```

>Example: generate a ui event with id _ui.myEvent_


>```js
event("myEvent", "7")
```


### command
Sends a command to the server. A callback function can be specified.

```js
command(command, callback)
```

>Example: call the _myCommand_ of _myNode_, specifying _myCallback_ function as a callback.

	
>```js
command("myNode.myCommand(7)", myCallback);
```

>in _script.js_:

>```js
function myCallback(command, result) {
	alert("command's result:" + result);
}
```

	
### logout
Logs the user out.

```js
logout()
```

### login
Logs the user in with the specified username and password.

```js
login(username, password)
```

### setAttribute
Sets a component's attribute value, given the component's id, the attribute's name and the new value.

```js
setAttribute(id, name, value)
```

## Sending events

The interface can communicate with the server in various ways, one of which is generating and sending events. These events are called UI events.

Here's an example that sends an event to the server:

_/webapp/interfaces/ex\_events/index.xml_

    <interface skin="default" title="Sending Events" width="420" height="270" >
        <page id="page:home" title="Homepage">
            <button x="130" y="40" width="160" height="60" label="Hello" on-click="event('myevent','myvalue')" />
        </page>
    </interface>

Pressing the button will generate an event with id _ui.myevent_ and value _myvalue_.
_ui_ is the prefix used for every event generated by a user interface.    
This will be captured by the server that can react accordingly.

## Sending commands

While sending events allows the server to capture them and react accordingly, commands also allow a reply.
This reply can contain a set of attribute values, or any other custom value.

Here's an example that sends a command to the server, and manages the reply.

_/webapp/interfaces/ex\_commands/index.xml_

    <interface skin="default" title="Sending Commands" width="420" height="270" >
        <page id="page:home" title="Homepage">
            <button x="130" y="40" width="160" height="60" label="Hello" on-click="command('mycommand',myCallback)" />
        </page>
    </interface>

_/webapp/interfaces/ex\_commands/script.js_

    function myCallback(command, result) {
		alert("Command "+command+" received, with result: "+result);
	}

Pressing the button will generate a command with id _myCommand_, associated to the custom function _myCallback_.
When the reply is received, the javascript function will generate an alert popup.

## Setting attributes
In this example we have a slider and two buttons.    
Each button uses the `setAttribute()` function to set the slider's value. When a change is detected in the slider's value a "ui.slider_1" event is generated and sent to the server.

_/webapp/interfaces/ex\_attributes/index.xml_

    <interface skin="default" title="Setting Attributes" width="420" height="270" >
        <page id="page:home" title="Homepage">
            <slider id="myslider" x="70" y="30" width="40" height="210" bar-color="#5550f0" />
            <button x="190" y="50" width="160" height="60" label="max" on-click="setAttribute('slider_1','value','100')" />
            <button x="190" y="150" width="160" height="60" label="min" on-click="setAttribute('myslider','value','0')" />
        </page>
    </interface>
    
![setting attributes](images/client-scripting/ex_attributes.png)

The slider component is used to input a value within a range (for example to control a volume, a light's intensity, etc.).

## Custom functions

Writing javascript directly in the event attributes of components is acceptable for short amounts of code. For longer scripts custom javascript files can be created.     
These script are all in the same scope so any function or variable declared in it can be accessed from the inline script of components.    
Simply add a script.js file in the interface's directory. Here's an example:

_/webapp/interfaces/ex\_functions/index.xml_

    <interface skin="default" title="Custom functions" width="420" height="270" >
        <page id="page:home" title="Homepage">
            <button x="130" y="80" width="160" height="60" label="one" on-click="myFunction(1)" />
            <button x="130" y="180" width="160" height="60" label="two" on-click="myFunction(2)" />
            <label id="mylabel" x="60" y="10" width="300" height="60" text-align="center" />
        </page>
    </interface>
    
_/webapp/interfaces/ex\_functions/script.js_

    function myFunction(value) { 
        switch (value) {
        case 1:
            setAttribute("mylabel","text","first option");
            break;
        case 2:
            setAttribute("mylabel","text","second option")
            break;
        }
    }

![custom functions](images/client-scripting/ex_functions.png)

## Callbacks

It's possible to declare the following functions that will be called on the corresponding events:

### onReady

Called when the interface is available, after loading is finished.

```js
function onReady()
```

>Example: show an alert popup when the interface is ready.

>```js
function onReady() {
	alert(“ready event”);
}
```

### onPage
Called when a page is about to be shown. If the return value is false, the page won't be shown.

```js
function onPage(id)
```

>Example: show an alert popup when a page is shown.

>```js
function onPage(id) {
	alert("page shown: " + id);
}
```

### onEvent
called when a UI event is received. If the return value is false, the event is canceled (as if it wasn't received at all). This is useful for example to filter a ui.set event.

```js
function onEvent(id, value)
```

>Example: show an alert popup on each event.

>```js
function onEvent(id, value) {
	alert("event received. Node: " + id + ", value: " + value);
}
```