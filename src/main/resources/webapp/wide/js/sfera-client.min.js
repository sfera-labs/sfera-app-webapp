/*! sfera-webapp - v0.0.2 */

(function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,
this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}if("GET"==j.method)g.send();else{Math.random().toString().substr(2);g.send(j.formData)}j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}).call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),
b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){
var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){
var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"));
}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");
var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];
if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d);
},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;
var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a);
},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],
f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){
case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group);
},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){
var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],
u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){
i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){
B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){
if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(c){a.idleTimeout=parseInt(c.idleTimeout),b.Login.resetIdleTimeout(),v.state.firstEventReceived=!1,v.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){v.isLogin||v.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=v.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":w[a.tag]&&(w[a.tag].callback&&w[a.tag].callback(w[a.tag].cmd,a.result),delete w[a.tag]);break;case"event":x[a.tag]&&(x[a.tag].callback&&x[a.tag].callback(x[a.tag].id,x[a.tag].value,a.result),delete x[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);y.sfera.appendChild(c.element),v.cInterface=v.components.getByType("Interface")[0],v.cInterface.setAttribute("visible","false"),v.state.indexUpdated=!0,v.state.started||!v.state.firstEventReceived&&!v.isLogin||v.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=v.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==v.name&&"update"==e[3]&&(u=c.nodes[d],u!=a.timestamp&&v.reload())}A[d]=c.nodes[d],B[d]&&B[d].dispatch()}v.state.firstEventReceived=!0,!v.state.started&&v.state.indexUpdated?v.start():v.showLoading(!1)}function i(){if(v.cInterface){var a,b,c=parseInt(v.cInterface.getAttribute("width")),d=parseInt(v.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;v.cInterface.element.style.display="none",v.cInterface.element.style.left=e+"px",v.cInterface.element.style.top=f+"px",v.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyDown){if(!C.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return v.cPage.children.length&&n(v.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyPress&&!C.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return v.ctrlKey=c.ctrlKey,v.shiftKey=c.shiftKey,C&&C.onKeyUp&&C.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function n(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return n(d,b)}return o(d)}function o(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=o(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=n(e[c],b)))return d;if(m(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function p(a){if(null!=a)try{totalFiles=Number(a.total),z+=1;var b=Math.round(z/totalFiles*100);v.showCachePercentage(b)}catch(a){}}function q(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(s);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}v.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=u,t=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&r()}function r(){clearInterval(s),t=!1,v.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var s,t,u=0,v=this,w={},x={},y={},z=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(u=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)y[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.addEvent("keydown",window,j),window.addEvent("keyup",window,l),window.addEvent("keypress",window,k),y.loading.onmousedown=y.loading.onmouseup=y.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return w[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){if(!a)return void b.Debug.logError("sending event: id not valid");var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return x[f]=f,b.Net.sendEvent(f),e};var A={};this.getNodeValue=function(a){return A[a]?A[a]:""};var B={};this.bindAttrObserver=function(a,c){B[a]||(B[a]=new b.Signal),B[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){B[a].remove(b.compile,b)};var C,D;this.setFocused=function(a){C&&C!=a&&C.blur(),C=a,D&&clearTimeout(D),a.noBlurTimeout||(D=setTimeout(this.focus,3e4))},this.clearFocused=function(a){C==a&&(C=null),D&&clearTimeout(D)},this.focus=function(){C&&C.blur()},this.focusNext=function(a){return o(C,a)},this.showLoading=function(a){y.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){y.cacheStatus.style.display=a?"inline":"none",y.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){t||(t=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?q():(s=setInterval(q,500),window.addEvent("updateready",window.applicationCache,q,!1),window.addEvent("error",window.applicationCache,r,!1),window.addEvent("progress",applicationCache,p,!1),z=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=u,t=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){j=new b.Net.Request,j.onLoaded=function(a){if(clearTimeout(k),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(m){case"login":o.gotoInterface();break;case"logout":o.gotoLogin()}},j.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(k),k=setTimeout(c,l)}function e(){h(!0),clearInterval(n)}function f(){var a=localStorage.getItem("idleTimestamp"),b=(new Date).getTime();b-a>=1e3*parseInt(config.idleTimeout)&&g()}function g(){e(),b.Login.logout()}function h(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",window,i),window[c](d?"touchend":"mouseup",window,i),window[c]("keydown",window,i)}function i(a){o.resetIdleTimeout()}var j,k=null,l=500,m="",n=null,o=this;this.login=function(c,e){j||a(),m="login",d(),c=c||b.client.getAttribute("username","value"),e=e||b.client.getAttribute("password","value"),j.open("/api/login?user="+c+"&password="+e+"&",100)},this.logout=function(){j||a(),m="logout",j.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()},this.resetIdleTimeout=function(){e(),config.idleTimeout&&parseInt(config.idleTimeout)&&!o.isLogin&&(h(),n=setInterval(f,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d);
},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),a.onmove&&(this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout)),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else{switch(b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(json.idleTimeout=3e3,clearTimeout(p),q=null,s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0,s.onConnection.dispatch(json));break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}s.onMessage.dispatch(a.data)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.rotatePoint=function(a,b,c,d,e){var f=Math.PI/180*e,g=Math.cos(f),h=Math.sin(f),i=g*(c-a)+h*(d-b)+a,j=g*(d-b)-h*(c-a)+b;return[i,j]},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),
e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}},this.attrDefs.opacity={type:"integer",update:function(){this.component.element.style.opacity=this.value,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(){B.state.firstEventReceived=!1,B.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){B.isLogin||B.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=B.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":C[a.tag]&&(C[a.tag].callback&&C[a.tag].callback(C[a.tag].cmd,a.result),delete C[a.tag]);break;case"event":D[a.tag]&&(D[a.tag].callback&&D[a.tag].callback(D[a.tag].id,D[a.tag].value,a.result),delete D[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);F.sfera.appendChild(c.element),B.cInterface=B.components.getByType("Interface")[0],B.cInterface.setAttribute("visible","false"),B.state.indexUpdated=!0,B.state.started||!B.state.firstEventReceived&&!B.isLogin||B.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=B.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==B.name&&"update"==e[3]&&(A=c.nodes[d],A!=a.timestamp&&B.reload())}H[d]=c.nodes[d],I[d]&&I[d].dispatch()}B.state.firstEventReceived=!0,!B.state.started&&B.state.indexUpdated?B.start():B.showLoading(!1)}function i(){if(B.cInterface){var a,b,c=parseInt(B.cInterface.getAttribute("width")),d=parseInt(B.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;B.cInterface.element.style.display="none",B.cInterface.element.style.left=e+"px",B.cInterface.element.style.top=f+"px",B.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyDown){if(!J.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return B.cPage.children.length&&t(B.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyPress&&!J.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyUp&&J.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(){q(!0),clearInterval(E)}function n(){m(),a.idleTimeout&&parseInt(a.idleTimeout)&&!B.isLogin&&(q(),E=setInterval(o,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}function o(){var b=localStorage.getItem("idleTimestamp"),c=(new Date).getTime();c-b>=1e3*parseInt(a.idleTimeout)&&p()}function p(){m(),b.Login.logout()}function q(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",document.body,r),window[c](d?"touchend":"mouseup",document.body,r),window[c]("onkeydown",document.body,r)}function r(a){n()}function s(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function t(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return t(d,b)}return u(d)}function u(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=t(e[c],b)))return d;if(s(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function v(a){if(null!=a)try{totalFiles=Number(a.total),G+=1;var b=Math.round(G/totalFiles*100);B.showCachePercentage(b)}catch(a){}}function w(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(y);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}B.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=A,z=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&x()}function x(){clearInterval(y),z=!1,B.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var y,z,A=0,B=this,C={},D={},E=null,F={},G=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(A=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)F[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.onkeydown=j,window.onkeyup=l,window.onkeypress=k,F.loading.onmousedown=F.loading.onmouseup=F.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),n(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return C[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return D[f]=f,b.Net.sendEvent(f),e};var H={};this.getNodeValue=function(a){return H[a]?H[a]:""};var I={};this.bindAttrObserver=function(a,c){I[a]||(I[a]=new b.Signal),I[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){I[a].remove(b.compile,b)};var J,K;this.setFocused=function(a){J&&J!=a&&J.blur(),J=a,K&&clearTimeout(K),a.noBlurTimeout||(K=setTimeout(this.focus,3e4))},this.clearFocused=function(a){J==a&&(J=null),K&&clearTimeout(K)},this.focus=function(){J&&J.blur()},this.focusNext=function(a){return u(J,a)},this.showLoading=function(a){F.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){F.cacheStatus.style.display=a?"inline":"none",F.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){z||(z=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?w():(y=setInterval(w,500),window.addEvent("updateready",window.applicationCache,w,!1),window.addEvent("error",window.applicationCache,x,!1),window.addEvent("progress",applicationCache,v,!1),G=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=A,z=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){e=new b.Net.Request,e.onLoaded=function(a){if(clearTimeout(f),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(h){case"login":i.gotoInterface();break;case"logout":i.gotoLogin()}},e.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(f),f=setTimeout(c,g)}var e,f=null,g=500,h="",i=this;this.login=function(c,f){e||a(),h="login",d(),c=c||b.client.getAttribute("username","value"),f=f||b.client.getAttribute("password","value"),e.open("/api/login?user="+c+"&password="+f+"&",100)},this.logout=function(){e||a(),h="logout",e.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);
for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else switch(s.onMessage.dispatch(a.data),b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.onConnection.dispatch(json),s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0);break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){
case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(){B.state.firstEventReceived=!1,B.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){B.isLogin||B.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=B.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":C[a.tag]&&(C[a.tag].callback&&C[a.tag].callback(C[a.tag].cmd,a.result),delete C[a.tag]);break;case"event":D[a.tag]&&(D[a.tag].callback&&D[a.tag].callback(D[a.tag].id,D[a.tag].value,a.result),delete D[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);F.sfera.appendChild(c.element),B.cInterface=B.components.getByType("Interface")[0],B.cInterface.setAttribute("visible","false"),B.state.indexUpdated=!0,B.state.started||!B.state.firstEventReceived&&!B.isLogin||B.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=B.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==B.name&&"update"==e[3]&&(A=c.nodes[d],A!=a.timestamp&&B.reload())}H[d]=c.nodes[d],I[d]&&I[d].dispatch()}B.state.firstEventReceived=!0,!B.state.started&&B.state.indexUpdated?B.start():B.showLoading(!1)}function i(){if(B.cInterface){var a,b,c=parseInt(B.cInterface.getAttribute("width")),d=parseInt(B.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;B.cInterface.element.style.display="none",B.cInterface.element.style.left=e+"px",B.cInterface.element.style.top=f+"px",B.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyDown){if(!J.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return B.cPage.children.length&&t(B.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyPress&&!J.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyUp&&J.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(){q(!0),clearInterval(E)}function n(){m(),a.idleTimeout&&parseInt(a.idleTimeout)&&!B.isLogin&&(q(),E=setInterval(o,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}function o(){var b=localStorage.getItem("idleTimestamp"),c=(new Date).getTime();c-b>=1e3*parseInt(a.idleTimeout)&&p()}function p(){m(),b.Login.logout()}function q(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",document.body,r),window[c](d?"touchend":"mouseup",document.body,r),window[c]("onkeydown",document.body,r)}function r(a){n()}function s(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function t(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return t(d,b)}return u(d)}function u(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=t(e[c],b)))return d;if(s(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function v(a){if(null!=a)try{totalFiles=Number(a.total),G+=1;var b=Math.round(G/totalFiles*100);B.showCachePercentage(b)}catch(a){}}function w(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(y);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}B.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=A,z=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&x()}function x(){clearInterval(y),z=!1,B.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var y,z,A=0,B=this,C={},D={},E=null,F={},G=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(A=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)F[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.onkeydown=j,window.onkeyup=l,window.onkeypress=k,F.loading.onmousedown=F.loading.onmouseup=F.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),n(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return C[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return D[f]=f,b.Net.sendEvent(f),e};var H={};this.getNodeValue=function(a){return H[a]?H[a]:""};var I={};this.bindAttrObserver=function(a,c){I[a]||(I[a]=new b.Signal),I[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){I[a].remove(b.compile,b)};var J,K;this.setFocused=function(a){J&&J!=a&&J.blur(),J=a,K&&clearTimeout(K),a.noBlurTimeout||(K=setTimeout(this.focus,3e4))},this.clearFocused=function(a){J==a&&(J=null),K&&clearTimeout(K)},this.focus=function(){J&&J.blur()},this.focusNext=function(a){return u(J,a)},this.showLoading=function(a){F.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){F.cacheStatus.style.display=a?"inline":"none",F.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){z||(z=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?w():(y=setInterval(w,500),window.addEvent("updateready",window.applicationCache,w,!1),window.addEvent("error",window.applicationCache,x,!1),window.addEvent("progress",applicationCache,v,!1),G=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=A,z=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){e=new b.Net.Request,e.onLoaded=function(a){if(clearTimeout(f),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(h){case"login":i.gotoInterface();break;case"logout":i.gotoLogin()}},e.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(f),f=setTimeout(c,g)}var e,f=null,g=500,h="",i=this;this.login=function(c,f){e||a(),h="login",d(),c=c||b.client.getAttribute("username","value"),f=f||b.client.getAttribute("password","value"),e.open("/api/login?user="+c+"&password="+f+"&",100)},this.logout=function(){e||a(),h="logout",e.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else switch(s.onMessage.dispatch(a.data),b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.onConnection.dispatch(json),s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0);break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),
l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){
for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(){B.state.firstEventReceived=!1,B.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){B.isLogin||B.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=B.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":C[a.tag]&&(C[a.tag].callback&&C[a.tag].callback(C[a.tag].cmd,a.result),delete C[a.tag]);break;case"event":D[a.tag]&&(D[a.tag].callback&&D[a.tag].callback(D[a.tag].id,D[a.tag].value,a.result),delete D[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);F.sfera.appendChild(c.element),B.cInterface=B.components.getByType("Interface")[0],B.cInterface.setAttribute("visible","false"),B.state.indexUpdated=!0,B.state.started||!B.state.firstEventReceived&&!B.isLogin||B.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=B.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==B.name&&"update"==e[3]&&(A=c.nodes[d],A!=a.timestamp&&B.reload())}H[d]=c.nodes[d],I[d]&&I[d].dispatch()}B.state.firstEventReceived=!0,!B.state.started&&B.state.indexUpdated?B.start():B.showLoading(!1)}function i(){if(B.cInterface){var a,b,c=parseInt(B.cInterface.getAttribute("width")),d=parseInt(B.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;B.cInterface.element.style.display="none",B.cInterface.element.style.left=e+"px",B.cInterface.element.style.top=f+"px",B.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyDown){if(!J.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return B.cPage.children.length&&t(B.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyPress&&!J.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyUp&&J.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(){q(!0),clearInterval(E)}function n(){m(),a.idleTimeout&&parseInt(a.idleTimeout)&&!B.isLogin&&(q(),E=setInterval(o,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}function o(){var b=localStorage.getItem("idleTimestamp"),c=(new Date).getTime();c-b>=1e3*parseInt(a.idleTimeout)&&p()}function p(){m(),b.Login.logout()}function q(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",document.body,r),window[c](d?"touchend":"mouseup",document.body,r),window[c]("onkeydown",document.body,r)}function r(a){n()}function s(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function t(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return t(d,b)}return u(d)}function u(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=t(e[c],b)))return d;if(s(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function v(a){if(null!=a)try{totalFiles=Number(a.total),G+=1;var b=Math.round(G/totalFiles*100);B.showCachePercentage(b)}catch(a){}}function w(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(y);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}B.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=A,z=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&x()}function x(){clearInterval(y),z=!1,B.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var y,z,A=0,B=this,C={},D={},E=null,F={},G=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(A=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)F[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.onkeydown=j,window.onkeyup=l,window.onkeypress=k,F.loading.onmousedown=F.loading.onmouseup=F.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),n(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return C[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return D[f]=f,b.Net.sendEvent(f),e};var H={};this.getNodeValue=function(a){return H[a]?H[a]:""};var I={};this.bindAttrObserver=function(a,c){I[a]||(I[a]=new b.Signal),I[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){I[a].remove(b.compile,b)};var J,K;this.setFocused=function(a){J&&J!=a&&J.blur(),J=a,K&&clearTimeout(K),a.noBlurTimeout||(K=setTimeout(this.focus,3e4))},this.clearFocused=function(a){J==a&&(J=null),K&&clearTimeout(K)},this.focus=function(){J&&J.blur()},this.focusNext=function(a){return u(J,a)},this.showLoading=function(a){F.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){F.cacheStatus.style.display=a?"inline":"none",F.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){z||(z=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?w():(y=setInterval(w,500),window.addEvent("updateready",window.applicationCache,w,!1),window.addEvent("error",window.applicationCache,x,!1),window.addEvent("progress",applicationCache,v,!1),G=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=A,z=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){e=new b.Net.Request,e.onLoaded=function(a){if(clearTimeout(f),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(h){case"login":i.gotoInterface();break;case"logout":i.gotoLogin()}},e.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(f),f=setTimeout(c,g)}var e,f=null,g=500,h="",i=this;this.login=function(c,f){e||a(),h="login",d(),c=c||b.client.getAttribute("username","value"),f=f||b.client.getAttribute("password","value"),e.open("/api/login?user="+c+"&password="+f+"&",100)},this.logout=function(){e||a(),h="logout",e.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else switch(s.onMessage.dispatch(a.data),b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.onConnection.dispatch(json),s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0);break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,
this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(){B.state.firstEventReceived=!1,B.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){B.isLogin||B.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=B.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":C[a.tag]&&(C[a.tag].callback&&C[a.tag].callback(C[a.tag].cmd,a.result),delete C[a.tag]);break;case"event":D[a.tag]&&(D[a.tag].callback&&D[a.tag].callback(D[a.tag].id,D[a.tag].value,a.result),delete D[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);F.sfera.appendChild(c.element),B.cInterface=B.components.getByType("Interface")[0],B.cInterface.setAttribute("visible","false"),B.state.indexUpdated=!0,B.state.started||!B.state.firstEventReceived&&!B.isLogin||B.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=B.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==B.name&&"update"==e[3]&&(A=c.nodes[d],A!=a.timestamp&&B.reload())}H[d]=c.nodes[d],I[d]&&I[d].dispatch()}B.state.firstEventReceived=!0,!B.state.started&&B.state.indexUpdated?B.start():B.showLoading(!1)}function i(){if(B.cInterface){var a,b,c=parseInt(B.cInterface.getAttribute("width")),d=parseInt(B.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;B.cInterface.element.style.display="none",B.cInterface.element.style.left=e+"px",B.cInterface.element.style.top=f+"px",B.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyDown){if(!J.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return B.cPage.children.length&&t(B.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyPress&&!J.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyUp&&J.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(){q(!0),clearInterval(E)}function n(){m(),a.idleTimeout&&parseInt(a.idleTimeout)&&!B.isLogin&&(q(),E=setInterval(o,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}function o(){var b=localStorage.getItem("idleTimestamp"),c=(new Date).getTime();
c-b>=1e3*parseInt(a.idleTimeout)&&p()}function p(){m(),b.Login.logout()}function q(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",document.body,r),window[c](d?"touchend":"mouseup",document.body,r),window[c]("onkeydown",document.body,r)}function r(a){n()}function s(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function t(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return t(d,b)}return u(d)}function u(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=t(e[c],b)))return d;if(s(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function v(a){if(null!=a)try{totalFiles=Number(a.total),G+=1;var b=Math.round(G/totalFiles*100);B.showCachePercentage(b)}catch(a){}}function w(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(y);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}B.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=A,z=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&x()}function x(){clearInterval(y),z=!1,B.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var y,z,A=0,B=this,C={},D={},E=null,F={},G=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(A=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)F[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.onkeydown=j,window.onkeyup=l,window.onkeypress=k,F.loading.onmousedown=F.loading.onmouseup=F.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),n(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return C[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return D[f]=f,b.Net.sendEvent(f),e};var H={};this.getNodeValue=function(a){return H[a]?H[a]:""};var I={};this.bindAttrObserver=function(a,c){I[a]||(I[a]=new b.Signal),I[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){I[a].remove(b.compile,b)};var J,K;this.setFocused=function(a){J&&J!=a&&J.blur(),J=a,K&&clearTimeout(K),a.noBlurTimeout||(K=setTimeout(this.focus,3e4))},this.clearFocused=function(a){J==a&&(J=null),K&&clearTimeout(K)},this.focus=function(){J&&J.blur()},this.focusNext=function(a){return u(J,a)},this.showLoading=function(a){F.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){F.cacheStatus.style.display=a?"inline":"none",F.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){z||(z=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?w():(y=setInterval(w,500),window.addEvent("updateready",window.applicationCache,w,!1),window.addEvent("error",window.applicationCache,x,!1),window.addEvent("progress",applicationCache,v,!1),G=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=A,z=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){e=new b.Net.Request,e.onLoaded=function(a){if(clearTimeout(f),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(h){case"login":i.gotoInterface();break;case"logout":i.gotoLogin()}},e.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(f),f=setTimeout(c,g)}var e,f=null,g=500,h="",i=this;this.login=function(c,f){e||a(),h="login",d(),c=c||b.client.getAttribute("username","value"),f=f||b.client.getAttribute("password","value"),e.open("/api/login?user="+c+"&password="+f+"&",100)},this.logout=function(){e||a(),h="logout",e.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else switch(s.onMessage.dispatch(a.data),b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.onConnection.dispatch(json),s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0);break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),
a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(){B.state.firstEventReceived=!1,B.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){B.isLogin||B.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=B.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":C[a.tag]&&(C[a.tag].callback&&C[a.tag].callback(C[a.tag].cmd,a.result),delete C[a.tag]);break;case"event":D[a.tag]&&(D[a.tag].callback&&D[a.tag].callback(D[a.tag].id,D[a.tag].value,a.result),delete D[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);F.sfera.appendChild(c.element),B.cInterface=B.components.getByType("Interface")[0],B.cInterface.setAttribute("visible","false"),B.state.indexUpdated=!0,B.state.started||!B.state.firstEventReceived&&!B.isLogin||B.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=B.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==B.name&&"update"==e[3]&&(A=c.nodes[d],A!=a.timestamp&&B.reload())}H[d]=c.nodes[d],I[d]&&I[d].dispatch()}B.state.firstEventReceived=!0,!B.state.started&&B.state.indexUpdated?B.start():B.showLoading(!1)}function i(){if(B.cInterface){var a,b,c=parseInt(B.cInterface.getAttribute("width")),d=parseInt(B.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;B.cInterface.element.style.display="none",B.cInterface.element.style.left=e+"px",B.cInterface.element.style.top=f+"px",B.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyDown){if(!J.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return B.cPage.children.length&&t(B.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyPress&&!J.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyUp&&J.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(){q(!0),clearInterval(E)}function n(){m(),a.idleTimeout&&parseInt(a.idleTimeout)&&!B.isLogin&&(q(),E=setInterval(o,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}function o(){var b=localStorage.getItem("idleTimestamp"),c=(new Date).getTime();c-b>=1e3*parseInt(a.idleTimeout)&&p()}function p(){m(),b.Login.logout()}function q(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",document.body,r),window[c](d?"touchend":"mouseup",document.body,r),window[c]("onkeydown",document.body,r)}function r(a){n()}function s(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function t(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return t(d,b)}return u(d)}function u(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=t(e[c],b)))return d;if(s(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function v(a){if(null!=a)try{totalFiles=Number(a.total),G+=1;var b=Math.round(G/totalFiles*100);B.showCachePercentage(b)}catch(a){}}function w(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(y);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}B.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=A,z=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&x()}function x(){clearInterval(y),z=!1,B.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var y,z,A=0,B=this,C={},D={},E=null,F={},G=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(A=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)F[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.onkeydown=j,window.onkeyup=l,window.onkeypress=k,F.loading.onmousedown=F.loading.onmouseup=F.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),n(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return C[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return D[f]=f,b.Net.sendEvent(f),e};var H={};this.getNodeValue=function(a){return H[a]?H[a]:""};var I={};this.bindAttrObserver=function(a,c){I[a]||(I[a]=new b.Signal),I[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){I[a].remove(b.compile,b)};var J,K;this.setFocused=function(a){J&&J!=a&&J.blur(),J=a,K&&clearTimeout(K),a.noBlurTimeout||(K=setTimeout(this.focus,3e4))},this.clearFocused=function(a){J==a&&(J=null),K&&clearTimeout(K)},this.focus=function(){J&&J.blur()},this.focusNext=function(a){return u(J,a)},this.showLoading=function(a){F.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){F.cacheStatus.style.display=a?"inline":"none",F.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){z||(z=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?w():(y=setInterval(w,500),window.addEvent("updateready",window.applicationCache,w,!1),window.addEvent("error",window.applicationCache,x,!1),window.addEvent("progress",applicationCache,v,!1),G=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=A,z=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";
if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){e=new b.Net.Request,e.onLoaded=function(a){if(clearTimeout(f),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(h){case"login":i.gotoInterface();break;case"logout":i.gotoLogin()}},e.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(f),f=setTimeout(c,g)}var e,f=null,g=500,h="",i=this;this.login=function(c,f){e||a(),h="login",d(),c=c||b.client.getAttribute("username","value"),f=f||b.client.getAttribute("password","value"),e.open("/api/login?user="+c+"&password="+f+"&",100)},this.logout=function(){e||a(),h="logout",e.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else switch(s.onMessage.dispatch(a.data),b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.onConnection.dispatch(json),s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0);break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,
e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(){B.state.firstEventReceived=!1,B.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){B.isLogin||B.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=B.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":C[a.tag]&&(C[a.tag].callback&&C[a.tag].callback(C[a.tag].cmd,a.result),delete C[a.tag]);break;case"event":D[a.tag]&&(D[a.tag].callback&&D[a.tag].callback(D[a.tag].id,D[a.tag].value,a.result),delete D[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);F.sfera.appendChild(c.element),B.cInterface=B.components.getByType("Interface")[0],B.cInterface.setAttribute("visible","false"),B.state.indexUpdated=!0,B.state.started||!B.state.firstEventReceived&&!B.isLogin||B.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=B.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==B.name&&"update"==e[3]&&(A=c.nodes[d],A!=a.timestamp&&B.reload())}H[d]=c.nodes[d],I[d]&&I[d].dispatch()}B.state.firstEventReceived=!0,!B.state.started&&B.state.indexUpdated?B.start():B.showLoading(!1)}function i(){if(B.cInterface){var a,b,c=parseInt(B.cInterface.getAttribute("width")),d=parseInt(B.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;B.cInterface.element.style.display="none",B.cInterface.element.style.left=e+"px",B.cInterface.element.style.top=f+"px",B.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyDown){if(!J.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return B.cPage.children.length&&t(B.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyPress&&!J.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyUp&&J.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(){q(!0),clearInterval(E)}function n(){m(),a.idleTimeout&&parseInt(a.idleTimeout)&&!B.isLogin&&(q(),E=setInterval(o,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}function o(){var b=localStorage.getItem("idleTimestamp"),c=(new Date).getTime();c-b>=1e3*parseInt(a.idleTimeout)&&p()}function p(){m(),b.Login.logout()}function q(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",document.body,r),window[c](d?"touchend":"mouseup",document.body,r),window[c]("onkeydown",document.body,r)}function r(a){n()}function s(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function t(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return t(d,b)}return u(d)}function u(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=t(e[c],b)))return d;if(s(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function v(a){if(null!=a)try{totalFiles=Number(a.total),G+=1;var b=Math.round(G/totalFiles*100);B.showCachePercentage(b)}catch(a){}}function w(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(y);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}B.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=A,z=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&x()}function x(){clearInterval(y),z=!1,B.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var y,z,A=0,B=this,C={},D={},E=null,F={},G=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(A=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)F[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.onkeydown=j,window.onkeyup=l,window.onkeypress=k,F.loading.onmousedown=F.loading.onmouseup=F.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),n(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return C[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return D[f]=f,b.Net.sendEvent(f),e};var H={};this.getNodeValue=function(a){return H[a]?H[a]:""};var I={};this.bindAttrObserver=function(a,c){I[a]||(I[a]=new b.Signal),I[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){I[a].remove(b.compile,b)};var J,K;this.setFocused=function(a){J&&J!=a&&J.blur(),J=a,K&&clearTimeout(K),a.noBlurTimeout||(K=setTimeout(this.focus,3e4))},this.clearFocused=function(a){J==a&&(J=null),K&&clearTimeout(K)},this.focus=function(){J&&J.blur()},this.focusNext=function(a){return u(J,a)},this.showLoading=function(a){F.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){F.cacheStatus.style.display=a?"inline":"none",F.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){z||(z=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?w():(y=setInterval(w,500),window.addEvent("updateready",window.applicationCache,w,!1),window.addEvent("error",window.applicationCache,x,!1),window.addEvent("progress",applicationCache,v,!1),G=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=A,z=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){e=new b.Net.Request,e.onLoaded=function(a){if(clearTimeout(f),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(h){case"login":i.gotoInterface();break;case"logout":i.gotoLogin()}},e.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(f),f=setTimeout(c,g)}var e,f=null,g=500,h="",i=this;this.login=function(c,f){e||a(),h="login",d(),c=c||b.client.getAttribute("username","value"),f=f||b.client.getAttribute("password","value"),e.open("/api/login?user="+c+"&password="+f+"&",100)},this.logout=function(){e||a(),h="logout",e.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a};
},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else switch(s.onMessage.dispatch(a.data),b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.onConnection.dispatch(json),s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0);break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),
b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(){B.state.firstEventReceived=!1,B.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){B.isLogin||B.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=B.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":C[a.tag]&&(C[a.tag].callback&&C[a.tag].callback(C[a.tag].cmd,a.result),delete C[a.tag]);break;case"event":D[a.tag]&&(D[a.tag].callback&&D[a.tag].callback(D[a.tag].id,D[a.tag].value,a.result),delete D[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);F.sfera.appendChild(c.element),B.cInterface=B.components.getByType("Interface")[0],B.cInterface.setAttribute("visible","false"),B.state.indexUpdated=!0,B.state.started||!B.state.firstEventReceived&&!B.isLogin||B.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=B.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==B.name&&"update"==e[3]&&(A=c.nodes[d],A!=a.timestamp&&B.reload())}H[d]=c.nodes[d],I[d]&&I[d].dispatch()}B.state.firstEventReceived=!0,!B.state.started&&B.state.indexUpdated?B.start():B.showLoading(!1)}function i(){if(B.cInterface){var a,b,c=parseInt(B.cInterface.getAttribute("width")),d=parseInt(B.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;B.cInterface.element.style.display="none",B.cInterface.element.style.left=e+"px",B.cInterface.element.style.top=f+"px",B.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyDown){if(!J.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return B.cPage.children.length&&t(B.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyPress&&!J.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyUp&&J.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(){q(!0),clearInterval(E)}function n(){m(),a.idleTimeout&&parseInt(a.idleTimeout)&&!B.isLogin&&(q(),E=setInterval(o,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}function o(){var b=localStorage.getItem("idleTimestamp"),c=(new Date).getTime();c-b>=1e3*parseInt(a.idleTimeout)&&p()}function p(){m(),b.Login.logout()}function q(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",document.body,r),window[c](d?"touchend":"mouseup",document.body,r),window[c]("onkeydown",document.body,r)}function r(a){n()}function s(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function t(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return t(d,b)}return u(d)}function u(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=t(e[c],b)))return d;if(s(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function v(a){if(null!=a)try{totalFiles=Number(a.total),G+=1;var b=Math.round(G/totalFiles*100);B.showCachePercentage(b)}catch(a){}}function w(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(y);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}B.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=A,z=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&x()}function x(){clearInterval(y),z=!1,B.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var y,z,A=0,B=this,C={},D={},E=null,F={},G=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(A=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)F[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.onkeydown=j,window.onkeyup=l,window.onkeypress=k,F.loading.onmousedown=F.loading.onmouseup=F.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),n(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return C[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return D[f]=f,b.Net.sendEvent(f),e};var H={};this.getNodeValue=function(a){return H[a]?H[a]:""};var I={};this.bindAttrObserver=function(a,c){I[a]||(I[a]=new b.Signal),I[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){I[a].remove(b.compile,b)};var J,K;this.setFocused=function(a){J&&J!=a&&J.blur(),J=a,K&&clearTimeout(K),a.noBlurTimeout||(K=setTimeout(this.focus,3e4))},this.clearFocused=function(a){J==a&&(J=null),K&&clearTimeout(K)},this.focus=function(){J&&J.blur()},this.focusNext=function(a){return u(J,a)},this.showLoading=function(a){F.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){F.cacheStatus.style.display=a?"inline":"none",F.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){z||(z=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?w():(y=setInterval(w,500),window.addEvent("updateready",window.applicationCache,w,!1),window.addEvent("error",window.applicationCache,x,!1),window.addEvent("progress",applicationCache,v,!1),G=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=A,z=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){e=new b.Net.Request,e.onLoaded=function(a){if(clearTimeout(f),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(h){case"login":i.gotoInterface();break;case"logout":i.gotoLogin()}},e.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(f),f=setTimeout(c,g)}var e,f=null,g=500,h="",i=this;this.login=function(c,f){e||a(),h="login",d(),c=c||b.client.getAttribute("username","value"),f=f||b.client.getAttribute("password","value"),e.open("/api/login?user="+c+"&password="+f+"&",100)},this.logout=function(){e||a(),h="logout",e.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else switch(s.onMessage.dispatch(a.data),b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.onConnection.dispatch(json),s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0);
break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this),function(){var a=this,b=b||{VERSION:"0.1.0",client:null};b.Compiler=new function(){this.createComponent=function(a,c){return b.Components.createInstance(a,c)},this.compileXMLNode=function(a,c){if(1==a.nodeType){c=c||{},c.index=c.index||!0;var d,e,f={};for(d=0;d<a.attributes.length;d++)e=a.attributes[d],f[b.Utils.dashToCamel(e.name)]=e.value;c.idPrefix&&f.id&&(f.id=c.idPrefix+"."+f.id);var g=this.createComponent(a.nodeName,f);if(g){c.index&&b.client.indexComponent(g);var h,i=a.childNodes;for(d=0;d<i.length;d++)h=this.compileXMLNode(i[d]),h&&g.addChild(h)}return g}return null},this.compileXML=function(a,b){return this.compileXMLNode(a.documentElement,b)},this.compileString=function(a){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(a){var c=a.documentElement;if(c&&1==c.nodeType){var d,e,f,g,h,i=c.childNodes;for(f=0;f<i.length;f++)if(1==i[f].nodeType)switch(i[f].tagName){case"skin":break;case"components":for(d=i[f].childNodes,g=0;g<d.length;g++)if(1==d[g].nodeType)for(e=d[g].childNodes,h=0;h<e.length;h++)switch(e[h].tagName){case"src":b.Components.setSource(d[g].tagName,b.Utils.getCDATA(e[h]));break;case"_lan":b.Components.setLanguage(d[g].tagName,b.Utils.getCDATA(e[h]))}}}},this.compileHTML=function(a){return a=a.replace(/\$interface\;/g,b.client.name)},this.getMustacheData=function(a){if(!b.Utils.isString(a)||-1==a.indexOf("{"))return null;for(var c,d={vars:[]},e=/\{\{([^}]*)\}\}/g;c=e.exec(a);)d.vars.push(c[1]);return d.vars.length?d:null},this.compileAttributeValue=function(a,c){function d(a,c){return b.client.getNodeValue(c)}var e=/\{\{([^}]*)\}\}/g,f=c||a.source;switch(a.mustache&&(f=f.replace(e,d)),a.type){case"integer":f=parseInt(f);break;case"float":f=parseFloat(f);break;case"color":f=f.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"string":case"js":if("string"!=typeof f&&f.toString){var g=f.toString();f="[object Object]"==g?JSON.stringify(f):g}break;case"boolean":f=!("false"===f||f===!1||void 0===f||null===f);break;case"regexp":try{f=new RegExp(f)}catch(h){f=null}break;case"list":f=f.split(",")}return f}},b.Attribute=function(a,c){this.type="string",this.changed=!1,this["default"]=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=a,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var d in c)switch(d){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":
this[d]=c[d];break;case"set":case"get":case"compile":case"update":case"post":this[d]=c[d].bind(this);break;case"values":b.Utils.isFunction(c[d])?this[d]=c[d].bind(this):this[d]=c[d]}},b.Attribute.prototype={set:function(a,c){if(this.source!==a){this.changed=!0,this.source=a;var d=b.Compiler.getMustacheData(a),e=this.mustache&&d&&this.mustache.vars.equals(d.vars);if(this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.removeAttrObserver(this.mustache.vars[f],this);if(this.mustache=d,this.mustache&&!e)for(var f=0;f<this.mustache.vars.length;f++)b.client.bindAttrObserver(this.mustache.vars[f],this);c&&c.manualUpdate||this.compile(c)}},get:function(){return this.value},compile:function(a){var c=b.Compiler.compileAttributeValue(this);this.values&&(b.Utils.isFunction(this.values)?arr=this.values():arr=this.values,b.Utils.isArray(arr)&&-1==arr.indexOf(c))||(this.updateRestore(),c!==this.value&&(this.changed=!1,this.value=c,this.update(a)))},update:function(a){this.post(a)},post:function(a){},updateRestore:function(){function a(){this.set(this["default"])}clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(a.bind(this),this.restoreTimeout))}},b.ComponentManager=function(a){function b(a,b,c){b[c]||(b[c]=[]),b[c].push(a)}function c(a,b,c){for(var d=0;d<b[c].length;d++)if(b[c]==a)return b[c]=null,void delete b[c]}function d(a,b){return a[b]?a[b]:[]}this.client=a;var e=[],f={},g={},h={};this.index=function(a){e.push(a),b(a,h,a.type),a.id&&b(a,f,a.id),a.group&&b(a,g,a.group)},this.addByGroup=function(a,c){b(a,g,c)},this.removeByGroup=function(a,b){c(a,g,b)},this.getFirstById=function(a){return this.getById(a)[0]},this.getById=function(a){return d(f,a)},this.getByType=function(a){return d(h,a)},this.getByGroup=function(a){return d(g,a)},this.getValue=function(a){var b=this.getFirstById(a);return b?b.getAttribute("value"):null}},b.ComponentPresets={},b.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(a,b){var c=this.getClass(a);c.prototype.source=b},this.bakeSource=function(a){var c=this.getClass(a),d=document.createElement("div");d.innerHTML=b.Compiler.compileHTML(c.prototype.source);var e=b.Utils.getFirstChildNodeOfType(d,1);e.setAttribute("data-controller",a),c.prototype.dom=e,c.prototype.source=null},this.getClassName=function(a){return b.Utils.capitalize(b.Utils.dashToCamel(a))},this.getClass=function(a){return b.Components.Classes[this.getClassName(a)]},this.createInstance=function(a,b){var c=this.getClass(a);if(null==c)return null;var d=new c({attributes:b});return d},this.create=function(a,b){this._componentDefs[a]=b},this.boot=function(){for(var a in this._componentDefs)this.createClass(a,this._componentDefs[a]);this._componentDefs={}},this.createClass=function(a,c){if(c["extends"]&&!b.Components.Classes[c["extends"]])return this._createLater[c["extends"]]||(this._createLater[c["extends"]]=[]),void this._createLater[c["extends"]].push({name:a,def:c});b.Components.Classes[a]=function(c){if(this.children=[],c.element)this.element=element;else if(this.source&&b.Components.bakeSource(a),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var d,e=b.Utils.getAllCommentChildNodes(this.element);this.id=c.attributes?c.attributes.id:null;for(var f=0;f<e.length;f++)if("sml"==e[f].nodeValue.substr(0,3)){d=b.Utils.parseXML(e[f].nodeValue.substr(3));var g=b.Compiler.compileXML(d,{index:!!this.id,idPrefix:this.id});g&&g.element&&(e[f].parentNode.replaceChild(g.element,e[f]),this.addSubComponent(g))}}this.attributes={};for(var h in this.attrDefs)this.attributes[h]=new b.Attribute(this,this.attrDefs[h]);if(this["super"]("_Base","init"),!c.doc){this.init();for(var h in this.attributes)c.attributes&&null!=c.attributes[h]?this.setAttribute(h,c.attributes[h]):null!=this.attributes[h]["default"]&&this.setAttribute(h,this.attributes[h]["default"])}};var d=b.Components.Classes[a];d.displayName="Sfera.Component.Classes."+a,c["extends"]||"_Base"==a||(c["extends"]="_Base");var e;c["extends"]?(e=b.Components.Classes[c["extends"]].prototype,d.prototype=Object.create(e),d.prototype.constructor=d,d.prototype.type=a):e={attrDefs:{}};var f;b.Doc&&(f=b.Doc.get.component(a),f&&f.doc&&(d.prototype.doc=f.doc),f&&f.doc||(f={doc:{}}),d.prototype.doc=f.doc),d.prototype.attrDefs={};var g;b.Doc&&(g=b.Doc.get.component(c["extends"]));for(var h in e.attrDefs)d.prototype.attrDefs[h]=e.attrDefs[h],g&&g.attr&&g.attr[h]&&!e.attrDefs[h].doc&&(d.prototype.attrDefs[h].doc=g.attr[h]);if(c.presets)for(var i,j=0;j<c.presets.length;j++)if(i=b.ComponentPresets[c.presets[j]],i.call(d.prototype),b.Doc){var k=b.Doc.get.preset(c.presets[j]);if(k)for(var h in k)d.prototype.attrDefs[h]||(d.prototype.attrDefs[h]={}),d.prototype.attrDefs[h].doc=k[h]}if(c.attributes)for(var l in c.attributes)if(d.prototype.attrDefs[l]){if(d.prototype.attrDefs[l]==e.attrDefs[l]){d.prototype.attrDefs[l]={};for(var j in e.attrDefs[l])d.prototype.attrDefs[l][j]=e.attrDefs[l][j]}for(var j in c.attributes[l])d.prototype.attrDefs[l][j]=c.attributes[l][j]}else d.prototype.attrDefs[l]=c.attributes[l];if(f&&f.attr)for(var h in f.attr)d.prototype.attrDefs[h]&&(d.prototype.attrDefs[h].doc=f.attr[h]);for(var m in c)"presets"!=m&&"attributes"!=m&&(d.prototype[m]=c[m],"function"==typeof d.prototype[m]&&(d.prototype[m].displayName="Sfera.Components.Classes."+a+"."+m));if(this._createLater[a]){for(var j=0;j<this._createLater[a].length;j++){var n=this._createLater[a][j];this.createClass(n.name,n.def)}delete this._createLater[a]}}},b.Client=function(a){function c(){B.state.firstEventReceived=!1,B.isLogin?b.Login.gotoInterface():b.Net.nodeSubscribe("*")}function d(){B.isLogin||B.showLoading(!0)}function e(a){if(a.result&&a.result.uiSet)for(var b in a.result.uiSet)for(var c=b.split("."),d=c.pop(),e=B.components.getById(c.join(".")),f=0;f<e.length;f++)e[f].setAttribute(d,a.result.uiSet[b]);switch(a.action){case"command":C[a.tag]&&(C[a.tag].callback&&C[a.tag].callback(C[a.tag].cmd,a.result),delete C[a.tag]);break;case"event":D[a.tag]&&(D[a.tag].callback&&D[a.tag].callback(D[a.tag].id,D[a.tag].value,a.result),delete D[a.tag])}}function f(a){b.Compiler.compileDictionary(a)}function g(a){var c=b.Compiler.compileXML(a);F.sfera.appendChild(c.element),B.cInterface=B.components.getByType("Interface")[0],B.cInterface.setAttribute("visible","false"),B.state.indexUpdated=!0,B.state.started||!B.state.firstEventReceived&&!B.isLogin||B.start()}function h(c){for(var d in c.nodes)if(!b.Custom.onEvent||b.Custom.onEvent(d,c.nodes[d])!==!1){var e=d.split(".");switch(e[0]){case"ui":if("set"==e[1]){e=e.slice(3);for(var f=e.pop(),g=B.components.getById(e.join(".")),h=0;h<g.length;h++)g[h].setAttribute(f,c.nodes[d])}break;case"webapp":"interface"==e[1]&&e[2]==B.name&&"update"==e[3]&&(A=c.nodes[d],A!=a.timestamp&&B.reload())}H[d]=c.nodes[d],I[d]&&I[d].dispatch()}B.state.firstEventReceived=!0,!B.state.started&&B.state.indexUpdated?B.start():B.showLoading(!1)}function i(){if(B.cInterface){var a,b,c=parseInt(B.cInterface.getAttribute("width")),d=parseInt(B.cInterface.getAttribute("height"));if(window.innerWidth?(a=window.innerWidth,b=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):document.body.clientWidth?(a=document.body.clientWidth,b=document.body.clientHeight):(a=0,b=0),a>0){var e=a>c?(a-c)/2:0,f=b>d?(b-d)/2:0;B.cInterface.element.style.display="none",B.cInterface.element.style.left=e+"px",B.cInterface.element.style.top=f+"px",B.cInterface.element.style.display="block"}}}function j(a){var c=a||window.event,d=c.charCode||c.keyCode;if(B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyDown){if(!J.onKeyDown(c,d))return b.Browser.preventDefault(c),!1}else if(9==d)return B.cPage.children.length&&t(B.cPage,c.shiftKey),b.Browser.preventDefault(c),!1;return!0}function k(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyPress&&!J.onKeyPress(c,d)?(b.Browser.preventDefault(c),!1):!0}function l(a){var c=a||window.event,d=c.charCode||c.keyCode;return B.ctrlKey=c.ctrlKey,B.shiftKey=c.shiftKey,J&&J.onKeyUp&&J.onKeyUp(c,d)?!0:(b.Browser.preventDefault(c),!1)}function m(){q(!0),clearInterval(E)}function n(){m(),a.idleTimeout&&parseInt(a.idleTimeout)&&!B.isLogin&&(q(),E=setInterval(o,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}function o(){var b=localStorage.getItem("idleTimestamp"),c=(new Date).getTime();c-b>=1e3*parseInt(a.idleTimeout)&&p()}function p(){m(),b.Login.logout()}function q(a){var c=(a?"remove":"add")+"Event",d=b.Device.touch;window[c](d?"touchstart":"mousedown",document.body,r),window[c](d?"touchend":"mouseup",document.body,r),window[c]("onkeydown",document.body,r)}function r(a){n()}function s(a){return a!=this&&a.focus&&a.isVisible()&&a.isEnabled()}function t(a,b){var c=a.children.length,d=a.children[b?c-1:0];if(d.isVisible()){if(d.focus&&d.isEnabled())return d.focus(),d;if(d.children&&d.children.length)return t(d,b)}return u(d)}function u(a,b){var c,d,e=a.parent.children,f=-1;for(c=0;c<e.length;c++)if(e[c]==a){f=c;break}if(-1==f)return null;c=f;do{if(b){if(c--,0>c){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=e.length-1}}else if(c++,c>=e.length){if(a.parent.parent&&(d=u(a.parent,b)))return d;c=0}if(e[c].children&&e[c].children.length&&(d=t(e[c],b)))return d;if(s(e[c]))return e[c].focus(),e[c]}while(e[c]!=a);return null}function v(a){if(null!=a)try{totalFiles=Number(a.total),G+=1;var b=Math.round(G/totalFiles*100);B.showCachePercentage(b)}catch(a){}}function w(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(y);try{window.applicationCache.swapCache()}catch(c){console.log("Error on swapCache "+c.message)}B.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload(!0)):(a.timestamp=A,z=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&x()}function x(){clearInterval(y),z=!1,B.reload()}b.client=this,a||(a={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var y,z,A=0,B=this,C={},D={},E=null,F={},G=0;this.boot=function(m){if(!this.state.booted){var n=b.Browser.getLocation();this.name=n["interface"],this.isLogin=n.login,a.timestamp&&(A=a.timestamp),b.client=this,this.state.booted=!0,b.Components.boot(),this.components=new b.ComponentManager(this),this.name=a["interface"],this.debug=b.Debug,this.debug.boot(),window.focus&&window.focus();for(var o=["sfera","loading","cacheStatus","cachePerc"],p=0;p<o.length;p++)F[o[p]]=document.getElementById(o[p]);b.Debug.showHeader(),b.Net.boot(),b.Net.onReply.add(e),b.Net.onEvent.add(h),b.Net.onUpdateDictionary.add(f),b.Net.onUpdateIndex.add(g),b.Net.onConnection.add(c),b.Net.onClose.add(d),b.Net.connect(),window.onresize=i,window.onkeydown=j,window.onkeyup=l,window.onkeypress=k,F.loading.onmousedown=F.loading.onmouseup=F.loading.onmousemove=function(a){b.Browser.preventDefault(a)},delete a}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,b.CLIENTS[this.id]=null},this.openIndex=function(a,b){},this.openDictionary=function(a,b){},this.start=function(){b.Browser.start(),this.cInterface.setAttribute("visible","true"),i(),n(),this.state.started=!0,this.showLoading(!1),b.Custom.onReady&&b.Custom.onReady()},this.stop=function(){},this.indexComponent=function(a){this.components.index(a)},this.setAttribute=function(a,b,c,d){for(var e=this.components.getById(a),f=0;f<e.length;f++)e[f].setAttribute(b,c,d)},this.getAttribute=function(a,b){var c=this.components.getFirstById(a);return c.getAttribute(b)},this.showPage=function(a){if(-1==a.indexOf(":")&&(a="page:"+a),!b.Custom.onPage||b.Custom.onPage(a)!==!1){this.cPage&&this.cPage.setAttribute("visible",!1);var c=this.components.getFirstById(a);if(c){c.setAttribute("visible",!0),this.cPage=c;var d=this.cInterface.getAttribute("title"),e=c.getAttribute("title");b.Browser.updateUrl(a,(d?d:"Sfera")+(e?" - "+e:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+a)}},this.sendCommand=function(a,c){var d=(new Date).getTime(),e={command:a,tag:d,callback:c};return C[d]=e,b.Net.sendCommand(e),d},this.sendEvent=function(a,c,d){var e=(new Date).getTime(),f={id:"webapp.ui."+a,value:c,tag:e,callback:d};return D[f]=f,b.Net.sendEvent(f),e};var H={};this.getNodeValue=function(a){return H[a]?H[a]:""};var I={};this.bindAttrObserver=function(a,c){I[a]||(I[a]=new b.Signal),I[a].addOnce(c.compile,c)},this.removeAttrObserver=function(a,b){I[a].remove(b.compile,b)};var J,K;this.setFocused=function(a){J&&J!=a&&J.blur(),J=a,K&&clearTimeout(K),a.noBlurTimeout||(K=setTimeout(this.focus,3e4))},this.clearFocused=function(a){J==a&&(J=null),K&&clearTimeout(K)},this.focus=function(){J&&J.blur()},this.focusNext=function(a){return u(J,a)},this.showLoading=function(a){F.loading.style.display=a?"inline":"none"},this.showCachePercentage=function(a){F.cacheStatus.style.display=a?"inline":"none",F.cachePerc.innerHTML=a?a+"%":""},this.reload=function(c){z||(z=!0,!c&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?w():(y=setInterval(w,500),window.addEvent("updateready",window.applicationCache,w,!1),window.addEvent("error",window.applicationCache,x,!1),window.addEvent("progress",applicationCache,v,!1),G=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),b.Browser.reload()):(a.timestamp=A,z=!1))}},b.Debug=new function(){function a(a,c,d,e){var f=b.Utils.getDate("hisu")+" - ";if(b.Device.chrome){var g=[""];switch(g[0]+="%c"+f,g.push("color:#999"),g[0]+="%c"+c,a){case"msg":g.push("color:#000");break;case"err":g.push("color:#e11");break;case"not":g.push("color:#e8e")}d&&(g[0]+=" %c"+d,g.push("color:#5a5")),this.verbose&&(g[0]+=" %c"+e,g.push("color:#55a")),console.log.apply(console,g)}else console.log(f+c,d,e)}this.verbose=!1,this.boot=function(){},this.log=function(b,c,d){a("msg",b,c,d)},this.logError=function(b,c,d){a("err",b,c,d)},this.logNotice=function(b,c,d){this.verbose&&a("not",b,c,d)},this.showHeader=function(){var a=b.VERSION,c="https://sferalabs.cc/sfera";if(b.Device.chrome){var d=["%c %c %c Sfera v"+a+"  %c %c %c "+c,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,d)}else window.console&&console.log("Sfera v"+a+" | "+c)}},b.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var a=this.WARN;this.setLevel=function(b){a=b}},b.Login=new function(){function a(){e=new b.Net.Request,e.onLoaded=function(a){if(clearTimeout(f),200!=a)return b.client.setAttribute("username","error","true"),void b.client.setAttribute("password","error","true");switch(h){case"login":i.gotoInterface();break;case"logout":i.gotoLogin()}},e.onError=function(a){b.client.setAttribute("username","error","true"),b.client.setAttribute("password","error","true"),d()}}function c(){}function d(){clearTimeout(f),f=setTimeout(c,g)}var e,f=null,g=500,h="",i=this;this.login=function(c,f){e||a(),h="login",d(),c=c||b.client.getAttribute("username","value"),f=f||b.client.getAttribute("password","value"),e.open("/api/login?user="+c+"&password="+f+"&",100)},this.logout=function(){e||a(),h="logout",e.open("/api/logout",100)},this.gotoLogin=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"]+"/login")},this.gotoInterface=function(){b.Browser.setLocation("/"+b.Browser.getLocation()["interface"])},window.onload=function(){d()}},b.Signal=function(){},b.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(a,b){if("function"!=typeof a)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))},_registerListener:function(a,c,d,e,f){var g,h=this._indexOfListener(a,d);if(-1!==h){if(g=this._bindings[h],g.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else g=new b.SignalBinding(this,a,c,d,e,f),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){this._bindings||(this._bindings=[]);var b=this._bindings.length;do b--;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){if(!this._bindings)return-1;void 0===b&&(b=null);for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,c){this.validateListener(a,"add");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!1,b,c,d)},addOnce:function(a,b,c){this.validateListener(a,"addOnce");var d=[];if(arguments.length>3)for(var e=3;e<arguments.length;e++)d.push(arguments[e]);return this._registerListener(a,!0,b,c,d)},remove:function(a,b){this.validateListener(a,"remove");var c=this._indexOfListener(a,b);return-1!==c&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var b=this._bindings.length;b--;)a?this._bindings[b].context===a&&(this._bindings[b]._destroy(),this._bindings.splice(b,1)):this._bindings[b]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var a,b=Array.prototype.slice.call(arguments),c=this._bindings.length;if(this.memorize&&(this._prevParams=b),c){a=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(a[c]&&this._shouldPropagate&&a[c].execute(b)!==!1)}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(b.Signal.prototype,"boundDispatch",{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments)})}}),b.Signal.prototype.constructor=b.Signal,b.SignalBinding=function(a,b,c,d,e,f){this._listener=b,c&&(this._isOnce=!0),null!=d&&(this.context=d),this._signal=a,e&&(this._priority=e),f&&f.length&&(this._args=f)},b.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,this._args&&(c=c.concat(this._args)),b=this._listener.apply(this.context,c),this.callCount++,this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.SignalBinding.prototype.constructor=b.SignalBinding,b.UI=new function(){var a,b;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(b){a=b},this.getPressedButton=function(){return a},this.updateLastButton=function(){b=a},this.getLastButton=function(){return b},this.liftButton=function(b){return!a||b&&b!=a?!1:(a.lift(),a=null,!0)},this.resetButton=function(a){this.liftButton(a)||(a.data.state="",a.updateClass())},this.destroyButtons=function(a){for(var b=0;b<a.length;b++)a[b].destroy();return a.length=0,a}},b.UI.Button=function(a,b){this.element=a,this.element.btObj=this,this.initData(),b&&this.initEvents(b)},b.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var a=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],b=this.element.className,c="(.*\\s)?([mc][^\\s]*Button)(\\s("+a.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",d=new RegExp(c),e=d.exec(b);if(e&&e[2])var f={pre:e[1]?e[1]:"",bc:e[2],color:e[4]?e[4]:"",attrs:[],state:e[6]?e[6].substr(1):""};else var f={pre:b,bc:"",color:"",attrs:[],state:""};for(var g in this._attributes)f.attrs[this._attributes[g]]=e&&e[5]?-1!=e[5].indexOf(" "+g):!1;this.data=f,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(a){a.onclick&&(a.onup=a.onclick),b.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",a.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",a.onmove,a.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",a.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",a.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",a.onout,null),a.onmove&&(this.element.onmousemove=this.onEvent.bind(this,"mousemove",a.onmove,null)),this.element.onmousedown=this.onEvent.bind(this,"mousedown",a.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",a.onup,null)),a.onlift&&(this.onLift=a.onlift),a.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){b.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var a=b.UI.getPressedButton();a&&a==this.element&&(b.UI.setPressedButton(null),b.UI.updateLastButton()),this.clearEvents()},link:function(a){this._linked||(this._linked=[]),a._linked||(a._linked=[]),this._linked.push(a),a._linked.push(this)},setColor:function(a){this.data.color=a,this.updateClass()},enable:function(a){this.setAttribute("disabled",!a)},select:function(a){this.setAttribute("selected",a)},focus:function(a){this.setAttribute("focused",a)},mini:function(a){this.setAttribute("mini",a)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(a){return this.data||this.initData(),this.data.attrs[this._attributes[a]]},setAttribute:function(a,b){this.getAttribute(a)!=b&&(this.data.attrs[this._attributes[a]]=b,this.updateClass())},updateClass:function(){var a=this.data,c=a.pre+a.bc;a.color&&(c+=" "+a.color);for(var d in this._attributes)a.attrs[this._attributes[d]]&&(c+=" "+d);b.UI.buttonFeedbackEnabled&&a.state&&(c+=" "+a.state),this.element.className=c},setClassName:function(a){this.data.pre=a,this.updateClass()},disableAndroidLongPress:function(a,c){if(b.Device.android){for(var d=c;d;){if(d.getAttribute&&d.getAttribute("data-scrollmode"))return;d=d.parentNode}a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.returnValue=!1}},preventDefault:function(a){a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},onEvent:function(a,c,d,e){if(!b.UI.skipButtonEvents&&!this.getAttribute("disabled")){var f=window.event||e;if("touchstart"==a||"touchend"==a||"touchmove"==a){if(!b.Device.touch)return!1}else if(f&&this.preventDefault(f),b.Device.touch)return!1;this.data||this.initData();var g=this.data.attrs[this._attributes["switch"]],h=g?this.data.attrs[this._attributes.pressed]:!1,i=h,j="";if(!this.data.attrs[this._attributes.disabled])switch(a){case"touchstart":b.UI.setPressedButton(this),lastButton=null,touchStartX=f.touches[0].clientX,touchStartY=f.touches[0].clientY,j="down",g&&(i=!h),this.disableAndroidLongPress(f,this.element);break;case"touchmove":b.UI.getPressedButton()==this&&(j="down",!this.dontLiftOnMove&&(Math.abs(f.touches[0].clientX-touchStartX)>30||Math.abs(f.touches[0].clientY-touchStartY)>30)&&(b.UI.setPressedButton(null),c=d)),this.disableAndroidLongPress(f,this.element);break;case"touchend":b.UI.getPressedButton()!=this?c=null:(b.UI.updateLastButton(),this.preventDefault(f)),b.UI.setPressedButton(null),this.disableAndroidLongPress(f,this.element);break;case"mouseover":var k=b.UI.getPressedButton();k?k==this.element&&(j="down"):b.UI.overEnabled&&(j="over");break;case"mousemove":b.UI.overEnabled&&(j="over");break;case"mouseout":var l;if(f&&(l=f.relatedTarget?f.relatedTarget:f.toElement),l){for(;l&&l!=this.element&&"BODY"!=l.nodeName;)l=l.parentNode;if(l==this.element)return}b.UI.setPressedButton(null);break;case"mousedown":b.UI.setPressedButton(this),lastButton=null,j="down",g&&(i=!h);break;case"mouseup":b.UI.getPressedButton()!=this?c=null:b.UI.updateLastButton(),b.UI.setPressedButton(null),b.UI.overEnabled&&(j="over")}if((j!=this.data.state||i!=h)&&(this.data.state=j,g&&(this.data.attrs[this._attributes.pressed]=i),this.updateClass(),this._linked))for(var m=0;m<this._linked.length;m++)j!=this._linked[m].data.state&&(this._linked[m].data.state=j,this._linked[m].updateClass());if(c&&"null"!=c&&!this.data.attrs[this._attributes.disabled]){var n="string"==typeof c?new Function("event","element",c):c;n(e,this.element)}return!1}}},b.Net=new function(){function a(a){s.onOpen.dispatch(a.data),b.Debug.log("ws open",a.data)}function c(a){if("&"==a.data)b.Debug.logNotice("ws ping"),g(),s.wsSend("&");else switch(s.onMessage.dispatch(a.data),b.Debug.log("ws msg",a.data),json=JSON.parse(a.data),json.type){case"reply":s.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(p),q=null,s.onConnection.dispatch(json),s.connectionId=json.connectionId,m=parseInt(json.pingInterval),n=parseInt(json.responseTimeout),g(),r=!0);break;case"console":s.onConsole.dispatch(json);break;case"event":s.onEvent.dispatch(json)}}function d(a){s.wsOpen(q)}function e(a){r=!1,1e3!=a.code?b.Debug.logError("ws closed",a.reason,a.code):b.Debug.log("ws closed",a.reason,a.code),s.onClose.dispatch(a.code,a.reason),"Unauthorized"==a.reason&&b.Login&&!x.login?(v="check",s.request(t+s.getURL(v))):s.wsOpen(q)}function f(){q?(q*=w.reconnectDecay,q>w.maxReconnectInterval&&(q=w.maxReconnectInterval)):q=w.reconnectInterval}function g(){clearTimeout(o),setTimeout(this.wsClose,m+n)}function h(){return(new Date).getTime()}function i(){b.Debug.log(v+" loaded","",k.getResponseText()),null!=s.localTs[v]&&(s.localTs[v]=h());var a;switch(v){case"dictionary":s.onUpdateDictionary.dispatch(k.getResponseXML());break;case"index":s.onUpdateIndex.dispatch(k.getResponseXML());break;case"connect":s.connectionId=k.getResponseJSON().cid;break;case"subscribe":s.subscribed=!0;case"state":a=JSON.parse(k.getResponseText()),a.timestamp&&(s.stateTs=a.timestamp);break;case"check":b.Login.gotoLogin()}s.sync()}function j(a){b.Debug.logError("request error"),404==a&&k.repeat(100)}var k,l,m,n,o,p,q,r=!1,s=this,t="/",u="api/",v="",s=this,w={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},x={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={dictionary:-1,index:-1},this.remoteTs={dictionary:-1,index:-1},this.onOpen=new b.Signal,this.onClose=new b.Signal,this.onConnection=new b.Signal,this.onMessage=new b.Signal,this.onEvent=new b.Signal,this.onReply=new b.Signal,this.onConsole=new b.Signal,this.onUpdateDictionary=new b.Signal,this.onUpdateIndex=new b.Signal,this.getURL=function(a,c){c||(c={});for(var d in x)null==c[d]&&(c[d]=x[d]);switch(c.connectionId=this.connectionId,c.stateTs=b.client?b.client.stateTs:null,a){case"dictionary":return c["interface"]+(c.login?"/login":"")+"/dictionary.xml";case"index":return c["interface"]+(c.login?"/login":"")+"/index.xml";case"connect":return u+"connect";case"subscribe":return u+"subscribe?cid="+(c.connectionId?c.connectionId:"");case"state":return u+"state/"+c.connectionId+"?ts="+c.stateTs;case"command":return u+"command";case"event":return u+"event";case"websocket":return("https:"==c.protocol?"wss:":"ws:")+"//"+c.host+"/"+u+"websocket";case"check":return c["interface"]+"/login/index.xml"}},this.boot=function(){x=b.Browser?b.Browser.getLocation():{}},this.wsOpen=function(g){if(g)return clearTimeout(p),void(p=setTimeout(this.wsOpen.bind(this),g));var h=s.getURL("websocket");return b.Debug.log("ws opening on "+h),void 0!==l&&l.readyState!==WebSocket.CLOSED?void b.Debug.logError("websocket: is already opened"):(null!=this.connectionId&&(h+="?cid="+this.connectionId),l=new WebSocket(h),l.onopen=a,l.onmessage=c,l.onclose=e,l.onerror=d,void f())},this.wsSend=function(a){"&"==a?b.Debug.logNotice("ws pong"):b.Debug.log("ws send",a),l.send(a)},this.wsClose=function(){l.close()},this.request=function(a){k||(k=new b.Net.Request,k.onLoaded=i,k.onError=j),k.open(a,20)},this.connect=function(a){this.sync()},this.sync=function(){for(var a in this.localTs)if(-1==this.localTs[a])return v=a,void this.request(t+s.getURL(a));return void s.wsOpen()},this.nodeSubscribe=function(a){var b=(new Date).getTime(),c={action:"subscribe",nodes:a,tag:b};this.wsSend(JSON.stringify(c))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(a){var b={action:"command",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendEvent=function(a){var b={action:"event",id:a.id,value:a.value,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))},this.sendConsole=function(a){var b={action:"console",cmd:a.command,tag:a.tag||(new Date).getTime()};this.wsSend(JSON.stringify(b))}},b.Net=b.Net||{},b.Net.Request=function(a){function b(){i&&(clearTimeout(i),i=null),f=-1,g.abort(),e(j.ERROR_MAXWAITTIME),j.init()}function c(){if(null!=g.readyState){switch(g.readyState){case 0:case 1:return;case 2:case 3:return;case 4:}if(i&&(clearTimeout(i),i=null),1==f){if(f=2,200!=g.status)return void e(g.status);j.formData=null;var a="";try{a=g.responseText}catch(b){return void e(j.ERROR_GENERAL)}j.onLoaded&&j.onLoaded.call(j,g.status)}}}function d(a){j.onProgress&&j.onProgress(a)}function e(a){switch(a){case j.ERROR_UNAUTHORIZED:if(j.onUnauthorized)return void j.onUnauthorized()}return a>=400&&j.onConnectionError?void j.onConnectionError():j.retryOnErrorDelay&&(!j.maxRetries||j.retries<j.maxRetries)&&(j.retries++,j.onRetry&&j.onRetry(),j.retryOnErrorDelay)?void j.repeat(j.retryOnErrorDelay):(j.formData=null,void(j.onError&&j.onError(a)))}a=a||{};var f,g=null,h=null;this.url="",this.method=a.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var i=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var j=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){f=0,window.XMLHttpRequest?(g=new XMLHttpRequest,g.onreadystatechange=c,g.upload&&g.upload.addEventListener("progress",d)):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP"),g&&(g.onreadystatechange=c))},this.addData=function(a,b){this.formData||(this.formData=new FormData),this.formData.append(a,b)},this.open=function(a,c){if(1==f&&j.stop(),f=0,a&&(j.url=a,j.retries=0),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),c)return void(h=setTimeout(j.open,c));g||j.init(),f=1,j.onRequest&&j.onRequest();try{g.open(j.method,j.url,!0)}catch(d){return void e(j.ERROR_GENERAL)}"GET"==j.method?g.send():(Math.random().toString().substr(2),g.send(j.formData)),
j.maxWaitingTime&&(i=setTimeout(b,j.maxWaitingTime))},this.stop=function(){(1==f||h)&&this.onStop&&this.onStop(1==f),1==f&&(f=-1,g.abort(),this.init()),h&&(clearTimeout(h),h=null),i&&(clearTimeout(i),i=null),f=0},this.repeat=function(a){this.open(null,a)},this.getResponseJSON=function(){var a=this.getResponseText();return a?JSON.parse(a):null},this.getResponseText=function(){var a="";try{return a=g.responseText}catch(b){return null}},this.getResponseXML=function(){var a="";try{return a=g.responseXML}catch(b){return null}},this.isReady=function(){return 1!=f}},b.Skins=function(a){this.client=a},b.Browser=new function(){var a;this.reload=function(){window.location.reload()},this.setLocation=function(a){window.location.replace(a)},this.preventDefault=function(a){a.stopPropagation&&a.stopPropagation(),a.returnValue&&(a.returnValue=!1),a.preventDefault&&a.preventDefault()},this.changeUrl=function(a,b){if("undefined"!=typeof history.pushState){var c={Title:a,Url:b};return history.pushState(c,c.Title,c.Url),!0}return!1},this.updateUrl=function(a,b){var d=this.getLocation();if(hash="page:home"==a?"":a,document.title=b,d.hash!=hash){c=hash;var e=d.pathname+"#"+a;a&&d.search&&(e+="?"+d.search),this.changeUrl(b,e)}},this.getLocation=function(){var b=window.location.href;if(!a||a.url!=b){var c,d=window.location.hash,e=window.location.search;d&&("#"==d[0]&&(d=d.substr(1)),-1!=d.indexOf("?")&&(c=d.split("?"),d=c[0],e=c[1])),e&&("?"==e[0]&&(e=e.substr(1)),-1!=e.indexOf("#")&&(c=e.split("#"),e=c[0],d=c[1]));var f=window.location.pathname.split("/");a={url:b,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:d,search:e,"interface":f[1],login:"login"==f[2]}}return a};var c=null;this.start=function(){setInterval(function(){var a=b.Browser.getLocation(),d="page:home"==a.hash?"":a.hash;d!==c&&(c=d,b.client.showPage(a.hash?a.hash:"home"))},100)}},b.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},b.Device=new b.Device,b.Device.onInitialized=new b.Signal,b.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d)a.call(b,this);else if(d._monitor||c)d._queue=d._queue||[],d._queue.push([a,b]);else{d._monitor=d.bind(this),d._queue=d._queue||[],d._queue.push([a,b]);var e="undefined"!=typeof window.cordova,f=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(d._monitor,0):e&&!f?document.addEventListener("deviceready",d._monitor,!1):(document.addEventListener("DOMContentLoaded",d._monitor,!1),window.addEventListener("load",d._monitor,!1))}},b.Device._readyCheck=function(){var a=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var b;b=a._queue.shift();){var c=b[0],d=b[1];c.call(d,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(a._monitor,20)},b.Device._initialize=function(){function a(){var a=navigator.userAgent;/Playstation Vita/.test(a)?i.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?i.kindle=!0:/Android/.test(a)?i.android=!0:/CrOS/.test(a)?i.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?i.iOS=!0:/Linux/.test(a)?i.linux=!0:/Mac OS/.test(a)?i.macOS=!0:/Windows/.test(a)&&(i.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(i.android=!1,i.iOS=!1,i.macOS=!1,i.windows=!0,i.windowsPhone=!0);var b=/Silk/.test(a);(i.windows||i.macOS||i.linux&&!b||i.chromeOS)&&(i.desktop=!0),(i.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(i.desktop=!1)}function b(){i.canvas=!!window.CanvasRenderingContext2D||i.cocoonJS;try{i.localStorage=!!localStorage.getItem}catch(a){i.localStorage=!1}i.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),i.fileSystem=!!window.requestFileSystem,i.webGL=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),i.webGL=!!i.webGL,i.worker=!!window.Worker,i.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,i.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,i.getUserMedia=i.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,i.firefox&&i.firefoxVersion<21&&(i.getUserMedia=!1)}function c(){("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(i.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(i.mspointer=!0),i.cocoonJS||("onwheel"in window||i.ie&&"WheelEvent"in window?i.wheelEvent="wheel":"onmousewheel"in window?i.wheelEvent="mousewheel":i.firefox&&"MouseScrollEvent"in window&&(i.wheelEvent="DOMMouseScroll"))}function d(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],b=document.createElement("div"),c=0;c<a.length;c++)if(b[a[c]]){i.fullscreen=!0,i.requestFullscreen=a[c];break}var d=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(i.fullscreen)for(var c=0;c<d.length;c++)if(document[d[c]]){i.cancelFullscreen=d[c];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(i.fullscreenKeyboard=!0)}function e(){var a=navigator.userAgent;if(/Arora/.test(a)?i.arora=!0:/Chrome\/(\d+)/.test(a)&&!i.windowsPhone?(i.chrome=!0,i.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?i.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(i.firefox=!0,i.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&i.iOS?i.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(i.ie=!0,i.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?i.midori=!0:/Opera/.test(a)?i.opera=!0:/Safari/.test(a)&&!i.windowsPhone?i.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(i.ie=!0,i.trident=!0,i.tridentVersion=parseInt(RegExp.$1,10),i.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(i.silk=!0),navigator.standalone&&(i.webApp=!0),"undefined"!=typeof window.cordova&&(i.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(i.node=!0),i.node&&"object"==typeof process.versions&&(i.nodeWebkit=!!process.versions["node-webkit"],i.electron=!!process.versions.electron),navigator.isCocoonJS&&(i.cocoonJS=!0),i.cocoonJS)try{i.cocoonJSApp="undefined"!=typeof CocoonJS}catch(b){i.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(i.ejecta=!0),/Crosswalk/.test(a)&&(i.crosswalk=!0)}function f(){var a=document.createElement("video"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.oggVideo=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264Video=!0,i.mp4Video=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webmVideo=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9Video=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hlsVideo=!0))}catch(c){}}function g(){i.audioData=!!window.Audio,i.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var a=document.createElement("audio"),b=!1;try{(b=!!a.canPlayType)&&(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(i.ogg=!0),(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(i.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(i.mp3=!0),a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(i.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(i.m4a=!0),a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(i.webm=!0))}catch(c){}}function h(){i.pixelRatio=window.devicePixelRatio||1,i.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),i.iPhone4=2==i.pixelRatio&&i.iPhone,i.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(i.vibration=!0)}var i=this;a(),g(),f(),e(),h(),b(),d(),c()},b.Device.canPlayAudio=function(a){return"mp3"===a&&this.mp3?!0:"ogg"===a&&(this.ogg||this.opus)?!0:"m4a"===a&&this.m4a?!0:"opus"===a&&this.opus?!0:"wav"===a&&this.wav?!0:!("webm"!==a||!this.webm)},b.Device.canPlayVideo=function(a){return"webm"===a&&(this.webmVideo||this.vp9Video)?!0:"mp4"===a&&(this.mp4Video||this.h264Video)?!0:"ogg"!==a&&"ogv"!==a||!this.oggVideo?!("mpeg"!==a||!this.hlsVideo):!0},window.man=function(a){var c=b.Utils.capitalize(a),d=b.Components.getClass(c);if(d){var e=new d({doc:!0}),f="* Component "+e.type+" *****************";console.log(f),console.log(e.doc),console.log("***********************************");var g="";for(var h in e.subComponents){for(var i=" - "+h+" ";i.length<20;)i+=" ";i+=e.subComponents[h].type,g+=i+"\n"}i&&(console.log("* SubComponents:"),console.log(g)),console.log("* Attributes:");for(var j in e.attributes){for(var k=e.attributes[j],i=" - "+j;i.length<20;)i+=" ";i+=k.type;var l=e.attributes[j].values;if(l){if(b.Utils.isFunction(l))try{l=l()}catch(m){}if(b.Utils.isArray(l)){for(;i.length<35;)i+=" ";i+="<"+l.join("|")+">"}}if(k.doc){for(;i.length<45;)i+=" ";i+=k.doc}console.log(i)}console.log(f)}},window.help=function(){var a="* Help *************************\n";a+='* man("<component name>")\n',a+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',a+="* Help *************************\n",console.log(a)},b.Utils=function(){function a(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(a,b){},this.extend=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.prototype.ancestor=b.prototype},this.initClass=function(a){a.prototype.constructor=a},this.getAllCommentChildNodes=function(b){for(var c,d=[],e=document.createNodeIterator(b,NodeFilter.SHOW_COMMENT,a,!1);c=e.nextNode();)d.push(c);return d},this.getFirstChildNodeOfType=function(a,b,c){for(var d=0;d<a.childNodes.length;d++){if(a.childNodes[d].nodeType==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes){var e=this.getFirstChildNodeOfType(a.childNodes[d],b,c);if(null!=e)return e}}return null},this.getFirstChildNodeWithName=function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++){if(a.childNodes[d].getAttribute&&a.childNodes[d].getAttribute("name")==b)return a.childNodes[d];if(c&&a.childNodes[d].childNodes&&(e=this.getFirstChildNodeWithName(a.childNodes[d],b,c),null!=e))return e}return null},this.getComponentElements=function(a,b,c){for(var d,e,c=c||{},e=0;e<a.childNodes.length;e++)a.childNodes[e].getAttribute&&(d=a.childNodes[e].getAttribute("name"),d&&(c[d]=a.childNodes[e])),b&&a.childNodes[e].childNodes&&a.childNodes[e].childNodes.length&&!a.childNodes[e].getAttribute("data-controller")&&(c=this.getComponentElements(a.childNodes[e],b,c));return c},this.getCDATA=function(a){var b=this.getFirstChildNodeOfType(a,4);return b?b.nodeValue:""},this.isString=function(a){return"string"==typeof a||a instanceof String},this.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},this.isArray=function(a){return a&&"[object Array]"===Object.prototype.toString.call(a)},this.capitalize=function(a){return a[0].toUpperCase()+a.substr(1)},this.camelToDash=function(a){return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(a){return a.toLowerCase().replace(/\W+(.)/g,function(a,b){return b.toUpperCase()})},this.getKeyFromCode=function(a){switch(a){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var b=String.fromCharCode(a);return b?b.toLowerCase():null}},this.getDate=function(a){function b(a,b){for(a+="",b||(b=2);a.length<b;)a="0"+a;return a}var c=new Date;a||(a="dmyhisu");for(var d={},e=0;e<a.length;e++)d[a[e]]=!0;var f="";return d.d&&(f+=b(c.getDate())),d.m&&(f+=(f?"/":"")+b(c.getMonth()+1)),d.y&&(f+=(f?"/":"")+c.getFullYear()),d.h&&(f+=(f?" ":"")+b(c.getHours())),d.i&&(f+=(f?":":"")+b(c.getMinutes())),d.s&&(f+=(f?":":"")+b(c.getSeconds())),d.u&&(f+=(f?":":"")+b(c.getMilliseconds(),3)),f},this.getMouseRelativePosition=function(a,b){var c=this.getElementAbsolutePosition(b),d=this.getMouseAbsolutePosition(a,b);return{x:d.x-c.x,y:d.y-c.y}},this.getMouseAbsolutePosition=function(a,c){var d,e;if(b.Device.touch&&a.touches&&a.touches[0])d=a.touches[0].pageX,e=a.touches[0].pageY;else if(null!=a.pageX&&null!=a.pageY)d=a.pageX,e=a.pageY;else{d=null!=a.layerX?a.layerX:a.offsetX,e=null!=a.layerY?a.layerY:a.offsetY;var f=c||a.target||a.srcElement,g=this.getElementAbsolutePosition(f);d+=g.x,e+=g.y}return this.scaleDelta&&1!=this.scaleDelta&&(d*=this.scaleDelta,e*=this.scaleDelta),{x:d,y:e}},this.getElementAbsolutePosition=function(a){for(var b=0,c=0;a&&null!=a.offsetLeft&&null!=a.offsetTop;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent||a.parentNode;return{x:b,y:c}},this.initMouseWheelEvent=function(a,c){b.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",a,c)},"undefined"!=typeof window.DOMParser?this.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b})},b.Utils=new b.Utils,Array.prototype.equals=function(a,b){if(!a)return!1;if(1==arguments.length&&(b=!0),this.length!=a.length)return!1;for(var c=0;c<this.length;c++)if(this[c]instanceof Array&&a[c]instanceof Array){if(!this[c].equals(a[c],b))return!1}else{if(b&&this[c]!=a[c])return!1;if(!b)return this.sort().equals(a.sort(),!0)}return!0},window.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a}),Number.prototype.mod=function(a){return(this%a+a)%a},Number.prototype.next=function(a){return(this+1).mod(a)},Number.prototype.previous=function(a){return(this-1).mod(a)},Array.prototype.isArray||(Array.prototype.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.unique=function(){for(var a=[],b=this.length,c=0;b>c;c++){for(var d=c+1;b>d;d++)this[c]===this[d]&&(d=++c);a.push(this[c])}return a},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(a){for(var b=[],c=this.length,d=0;c>d;d++)-1!=a.indexOf(this[d])&&b.push(this[d]);return b},Array.prototype.same=function(a){if(this.length!=a.length)return!1;for(var b=0;b<this.length;b++)if(null!=this[b]&&null!=a[b]&&"object"==typeof this[b]&&"object"==typeof a[b]&&this[b].isArray&&a[b].isArray){if(!this[b].same(a[b]))return!1}else if(this[b]!=a[b])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){"use strict";if(null==this)throw new TypeError;var c=Object(this),d=c.length>>>0;if(0===d)return-1;var e=0;if(arguments.length>1&&(e=Number(arguments[1]),e!=e?e=0:0!=e&&e!=1/0&&e!=-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=d)return-1;for(var f=e>=0?e:Math.max(d-Math.abs(e),0);d>f;f++)if(f in c&&c[f]===a)return f;return-1}),Array.prototype.clean=function(a){for(var b=0;b<this.length;b++)this[b]==a&&(this.splice(b,1),b--);return this},window.addEvent=function(a,b,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent?b.attachEvent("on"+a,c):b["on"+a]=c},window.removeEvent=function(a,b,c){b.removeEventListener?b.removeEventListener(a,c,!1):b.attachEvent?b.detachEvent("on"+a,c):b["on"+a]=null},b.ComponentPresets.Color=function(){this.attrDefs.color={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.colors[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean","default":"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},b.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var a=this.component.element.style,b="rotate("+this.value+"deg)";a.msTransform=a.webkitTransform=a.transform=b,this.post()}}},b.ComponentPresets.Size=function(){this.attrDefs.width={type:"integer",update:function(){this.component.element.style.width="auto"==this.value?"auto":this.value+"px",this.post()}},this.attrDefs.height={type:"integer",update:function(){this.component.element.style.height="auto"==this.value?"auto":this.value+"px",this.post()}}},b.ComponentPresets.Style=function(){this.attrDefs.style={type:"string","default":"default",values:function(){var a;return b.client&&b.client.skin&&(a=b.client.skin.styles[this.component.type]),a?a:["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},b.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var a=!(!this.source||"false"==this.source);a!==this.value&&(this.changed=!1,this.value=a,this.update())},update:function(){function a(b,c,d){if((!d||b.getAttribute("visible"))&&(c&&b.onShow?b.onShow():!c&&b.onHide&&b.onHide(),b.children))for(var e=0;e<b.children.length;e++)a(b.children[e],c)}this.value||a(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&a(this.component,!0),this.post()}}},b.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(a){this.value=a,this.component.id=a,this.component.element.setAttribute("data-id",a)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var a=this.component,b=this.value;a.dom&&a.dom.className&&(b=a.dom.className+" "+b),a.element.className=b}}},init:function(){this.elements={}},getAttribute:function(a){return this.attributes[a]?this.attributes[a].get():void 0},setAttribute:function(a,b,c){this.attributes[a]&&this.attributes[a].set(b,c)},update:function(){},"super":function(a,c){b.Components.Classes[a].prototype[c].call(this)},setSource:function(a){this.processed=!1},addChild:function(a){this.children.push(a),a.parent=this,this.element&&a.element&&this.element.appendChild(a.element)},addSubComponent:function(a){a.id===!1&&(a.id=this.id+".icon");var b=a.id;this.id&&(b=b.substr(this.id.length+1)),this.subComponents[b]=a,a.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),b.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Sfera=b):"undefined"!=typeof define&&define.amd?define("Sfera",function(){return a.Sfera=b}()):a.Sfera=b}.call(this);