/*! sfera-webapp - v0.0.2 */


Sfera.Components.create("Select",{extends:"_Field",attributes:{height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string",default:"",update:function(){var e=this.component;e.subComponents.icon.setAttribute("source",this.value),this.value?e.elements.icon.style.display="":e.elements.icon.style.display="none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},values:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},labels:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},changeDelay:{type:"integer",default:"0"},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},onKeyUp:{type:"js"},onChange:{type:"js",default:"event(id,value)"},onEnterKey:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.redraw()},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var e="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,e=this.elements.field.value,this.elements.field=null);this.getAttribute("type");var t=this.getAttribute("placeHolder");t=t?' placeholder="'+t+'"':"";var n="";n=n?' style="'+n+'"':"";var i=this.getAttribute("values"),s=this.getAttribute("labels"),o='<select class="field" '+n+t+" />";if(i)for(var u=0;u<i.length;u++)v=i[u],l=s&&s[u]||v,o+='<option value="'+v+'">'+l+"</option>";o+="</select>",this.elements.fieldC.innerHTML=o,this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=e,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onchange=this.onChange.bind(this),this.elements.field.controller=this},updateOptions:function(){this.redraw()},updateClass:function(){var e=this.getAttribute("enabled")?"":" disabled";this.element.className="component comp_select"+(this.focused?" focused":"")+e;var t=this.getAttribute("style");this.elements.container.className="container "+(t?" style_"+t:""),this.elements.field&&this.elements.field[(e?"set":"remove")+"Attribute"]("disabled",!0)},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var e=this.getAttribute("onChange"),t=this.getAttribute("value");Sfera.Custom.exec(e,this.id,t)},onSelectStart:function(e){},onKeyDown:function(e){var t=e.keyCode,n=Sfera.Utils.getKeyFromCode(t),i=this.getAttribute("type");return"enter"!=n||this.onEnter()||(n=""),"enter"==n&&"textarea"!=i||"tab"==n?(this.onChangedTimeout(),Sfera.client.focusNext(e.shiftKey),"enter"==n&&"textarea"!=i&&this.blur(),!1):(this.onChange(),!0)},onKeyPress:function(e){var t=e.keyCode,n=Sfera.Utils.getKeyFromCode(t),i=this.elements.field,s=this.getAttribute("value"),o=this.getAttribute("keyRegex"),l=this.getAttribute("maxLength");return!(!n&&s&&l&&s.length>=l&&!function(){var e="";return i.selectionStart!=i.selectionEnd?e=s.substr(i.selectionStart,i.selectionEnd):void 0!==window.getSelection?e=window.getSelection().toString():void 0!==document.selection&&"Text"==document.selection.type&&(e=document.selection.createRange().text),e}())&&(!!(n||!o||e.ctrlKey||e.metaKey||o.test(String.fromCharCode(t)))&&(this.onChange(),!0))},onKeyUp:function(e){var t=e.keyCode,n=Sfera.Utils.getKeyFromCode(t);return"enter"==n||"tab"===n||(this.onChange(),!1)},onChange:function(){var e=this.elements.field.value;if(e!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=e,this.clearChangeTimeout();var t=this.getAttribute("changeDelay"),n=this;t?this.changeTimeout=setTimeout(function(){n.onChangedTimeout()},t):n.onChangedTimeout()}},onEnterKey:function(){var e=this.getAttribute("onEnterKey");return!e||Sfera.Custom.exec(e)},onFocus:function(){var e=this.controller;Sfera.client.setFocused(e),e.focused=!0,e.updateClass()},onBlur:function(){var e=this.controller;e.onChange(),Sfera.client.clearFocused(e),e.focused=!1,e.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}});