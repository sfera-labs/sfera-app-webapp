/*! sfera-webapp - v0.0.2 */

Sfera.Components.create("Slider",{presets:["Visibility","Position","Size","Style","Color"],attributes:{width:{post:function(){this.component.updateDirection()}},height:{post:function(){this.component.updateDirection()}},cursorSize:{type:"integer","default":"30",update:function(){this.component.updateDirection()}},barColor:{type:"color","default":"transparent",update:function(){this.component.elements.fill.style.backgroundColor=this.value}},min:{type:"float","default":"0",update:function(){this.component.updateDecimals(),this.component.updateValue()}},max:{type:"float","default":"100",update:function(){this.component.updateDecimals(),this.component.updateValue()}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},color:{values:function(){var a=Sfera.client.skin.colors.Button;return a?a:["default"]},post:function(){this.component.subComponents.cursor.setAttribute("color",this.value)}},value:{type:"float",update:function(a){this.component.updateValue(),this.post(a)},post:function(a){a&&a.silent||this.component.onChange()}},changeDelay:{type:"integer","default":"0"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnterKey:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.decimals=0,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements);var a={};a.ondown=this.onDown.bind(this),Sfera.Device.touch||(a.onover=this.onOver.bind(this),a.onout=this.onOut.bind(this)),this.button=new Sfera.UI.Button(this.elements.over,a);var b=this.subComponents.cursor;b.button.link(this.button)},onOver:function(){},onOut:function(){},onDown:function(a){this.isDown=!0,this._onUp=this.onUp.bind(this),this._onMove=this.onMove.bind(this),Sfera.Device.touch?(window.addEvent("touchend",document.body,this._onUp),window.addEvent("touchmove",document.body,this._onMove)):(window.addEvent("mouseup",document.body,this._onUp),window.addEvent("mousemove",document.body,this._onMove)),this._bp=Sfera.Utils.getElementAbsolutePosition(this.elements.bar_in),this.onMove(a)},onUp:function(a){this.isDown=!1,Sfera.Device.touch?(window.removeEvent("touchend",document.body,this._onUp),window.removeEvent("touchmove",document.body,this._onMove)):(window.removeEvent("mouseup",document.body,this._onUp),window.removeEvent("mousemove",document.body,this._onMove))},onMove:function(a){var b=Sfera.Utils.getMouseAbsolutePosition(a,this.elements.bar_in);if(this.isDown){var c=this.getAttribute("width"),d=this.getAttribute("height"),e=d>c,f=this.getAttribute("cursorSize"),g=e?(b.y-this._bp.y-f/2)/(d-f):(b.x-this._bp.x-f/2)/(c-f);e&&(g=1-g);var h=this.getAttribute("min"),i=this.getAttribute("max"),g=g*(i-h)+h;g=h>g?h:g>i?i:g,g=g.toFixed(this.decimals),this.setAttribute("value",g)}},focus:function(){this.onFocus()},blur:function(){this.onBlur()},countDecimals:function(a){var b=a.split(".");return b.length<2?0:parseInt(b[1].length)},updateDecimals:function(){var a=this.attributes.min.source,b=this.attributes.max.source;a=null!=a?this.countDecimals(a):0,b=null!=b?this.countDecimals(b):0,this.decimals=Math.max(a,b)},updateValue:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=b>a,d=this.getAttribute("value"),e=this.getAttribute("cursorSize"),f=this.getAttribute("min"),g=this.getAttribute("max");d=f>d?f:d>g?g:d;var h=(d-f)/(g-f),i=1-h;c?(this.elements.fill.style.height=h*b+"px",this.elements.fill.style.width="",this.elements.fill.style.marginTop=i*b+"px",this.elements.fill.style.marginLeft=""):(this.elements.fill.style.width=h*a+"px",this.elements.fill.style.height="",this.elements.fill.style.marginTop=""),this.subComponents.cursor.setAttribute(c?"y":"x",(c?i:h)*(c?b-e:a-e)),this.subComponents.cursor.setAttribute(c?"x":"y","0")},updateDirection:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=this.getAttribute("cursorSize");if(a&&b&&c){var d=b>a;this.vertical=d,this.updateClass(),this.subComponents.cursor.setAttribute("width",d?a:c),this.subComponents.cursor.setAttribute("height",d?c:b),this.updateValue()}},updateClass:function(){this.element.className="component comp_slider "+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(this.vertical?"vertical":"horizontal")+(a?" style_"+a:"")},onChanged:function(){var a=this.getAttribute("value");if(a!=this.sentValue){this.sentValue=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b?this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b):c.onChangedTimeout()}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;Sfera.Utils.getKeyFromCode(b),this.getAttribute("value");return this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnterKey:function(){var a=this.getAttribute("onEnterKey");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}});