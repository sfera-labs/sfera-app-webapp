/*! sfera-webapp - v0.0.2 */


Sfera.Components.create("Slider",{presets:["Visibility","Position","Size","Style","Color","Enable"],attributes:{width:{post:function(){this.component.updateDirection()}},height:{post:function(){this.component.updateDirection()}},cursorSize:{type:"integer",default:"30",update:function(){this.component.updateDirection()}},barColor:{type:"color",default:"transparent",update:function(){this.component.elements.fill.style.backgroundColor=this.value}},min:{type:"float",default:"0",update:function(){this.component.updateDecimals(),this.component.updateValue()}},max:{type:"float",default:"100",update:function(){this.component.updateDecimals(),this.component.updateValue()}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},color:{values:function(){var t=Sfera.client.skin.colors.Slider;return t||["default"]},post:function(){this.component.subComponents.cursor.setAttribute("color",this.value)}},value:{type:"float",update:function(t){this.component.updateValue(),this.post(t)},post:function(t){t&&t.silent||this.component.onChange()}},changeDelay:{type:"integer",default:"0"},onKeyUp:{type:"js"},onChange:{type:"js",default:"event(id,value)"},onEnterKey:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.decimals=0,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements);var t={};t.ondown=this.onDown.bind(this),Sfera.Device.touch||(t.onover=this.onOver.bind(this),t.onout=this.onOut.bind(this)),this.button=new Sfera.UI.Button(this.elements.over,t);this.subComponents.cursor.button.link(this.button)},onOver:function(){},onOut:function(){},onDown:function(t){this.getAttribute("enabled")&&(this.isDown=!0,this._onUp=this.onUp.bind(this),this._onMove=this.onMove.bind(this),Sfera.Device.touch?(window.addEvent("touchend",document.body,this._onUp),window.addEvent("touchmove",document.body,this._onMove)):(window.addEvent("mouseup",document.body,this._onUp),window.addEvent("mousemove",document.body,this._onMove)),this._bp=Sfera.Utils.getElementAbsolutePosition(this.elements.bar_in),this.onMove(t))},onUp:function(t){this.getAttribute("enabled")&&(this.isDown=!1,Sfera.Device.touch?(window.removeEvent("touchend",document.body,this._onUp),window.removeEvent("touchmove",document.body,this._onMove)):(window.removeEvent("mouseup",document.body,this._onUp),window.removeEvent("mousemove",document.body,this._onMove)))},onMove:function(t){if(this.getAttribute("enabled")){var e=Sfera.Utils.getMouseAbsolutePosition(t,this.elements.bar_in);if(this.isDown){var i=this.getAttribute("width"),n=this.getAttribute("height"),o=n>i,s=this.getAttribute("cursorSize"),u=e.x-this._bp.x,h=e.y-this._bp.y,a=this.getAttribute("rotation");a&&(u=(a=Sfera.Utils.rotatePoint(i/2,n/2,u,h,a))[0],h=a[1]);var r=o?(h-s/2)/(n-s):(u-s/2)/(i-s);o&&(r=1-r);var l=this.getAttribute("min"),c=this.getAttribute("max");r=(r=(r=r*(c-l)+l)<l?l:r>c?c:r).toFixed(this.decimals),this.setAttribute("value",r)}}},focus:function(){this.onFocus()},blur:function(){this.onBlur()},countDecimals:function(t){var e=t.split(".");return e.length<2?0:parseInt(e[1].length)},updateDecimals:function(){var t=this.attributes.min.source,e=this.attributes.max.source;t=null!=t?this.countDecimals(t):0,e=null!=e?this.countDecimals(e):0,this.decimals=Math.max(t,e)},updateValue:function(){var t=this.getAttribute("width"),e=this.getAttribute("height"),i=e>t,n=this.getAttribute("value"),o=this.getAttribute("cursorSize"),s=this.getAttribute("min"),u=this.getAttribute("max"),h=((n=n<s?s:n>u?u:n)-s)/(u-s),a=1-h;i?(this.elements.fill.style.height=h*e+"px",this.elements.fill.style.width="",this.elements.fill.style.marginTop=a*e+"px",this.elements.fill.style.marginLeft=""):(this.elements.fill.style.width=h*t+"px",this.elements.fill.style.height="",this.elements.fill.style.marginTop=""),this.subComponents.cursor.setAttribute(i?"y":"x",(i?a:h)*(i?e-o:t-o))},updateDirection:function(){var t=this.getAttribute("width"),e=this.getAttribute("height"),i=this.getAttribute("cursorSize");if(t&&e&&i){var n=e>t;this.vertical=n,this.updateClass(),this.updateStyle(),this.updateValue()}},updateClass:function(){var t=this.focused?" focused":"",e=this.getAttribute("enabled")?"":" disabled";this.element.className="component comp_slider "+e+t;var i=this.getAttribute("style");this.elements.container.className="container "+(this.vertical?"vertical":"horizontal")+(i?" style_"+i:"")},updateStyle:function(){var t=this.getAttribute("width"),e=this.getAttribute("height"),i=this.getAttribute("cursorSize");if(t&&e&&i){var n=e>t;this.subComponents.cursor.setAttribute("width",n?t:i),this.subComponents.cursor.setAttribute("height",n?i:e)}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var t=this.getAttribute("onChange"),e=this.getAttribute("value");Sfera.Custom.exec(t,this.id,e)},onKeyDown:function(t){if(this.getAttribute("enabled")){var e=t.keyCode,i=Sfera.Utils.getKeyFromCode(e);this.getAttribute("type");return"enter"!=i||this.onEnter()||(i=""),"enter"==i||"tab"==i?(this.onChangedTimeout(),Sfera.client.focusNext(t.shiftKey),"enter"==i&&this.blur(),!1):(this.onChange(),!0)}},onKeyPress:function(t){if(this.getAttribute("enabled")){var e=t.keyCode;Sfera.Utils.getKeyFromCode(e),this.getAttribute("value");return this.onChange(),!0}},onKeyUp:function(t){if(this.getAttribute("enabled")){var e=t.keyCode,i=Sfera.Utils.getKeyFromCode(e);return"enter"==i||"tab"===i||(this.onChange(),!1)}},onChange:function(){var t=this.getAttribute("value");if(t!=this.sentValue){this.sentValue=t,this.clearChangeTimeout();var e=this.getAttribute("changeDelay"),i=this;e?this.changeTimeout=setTimeout(function(){i.onChangedTimeout()},e):i.onChangedTimeout()}},onEnterKey:function(){if(this.getAttribute("enabled")){var t=this.getAttribute("onEnterKey");return!t||Sfera.Custom.exec(t)}},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChange(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.onAdjust(),this.getAttribute("focus")&&this.focus()},onHide:function(){},onAdjust:function(){this.updateDirection()}});