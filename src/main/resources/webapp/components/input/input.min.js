/*! sfera-webapp - v0.0.2 */


Sfera.Components.create("Input",{extends:"_Field",attributes:{type:{type:"string",default:"input",values:["input","textarea","color","date","datetime","email","number","password","tel","time","url"],update:function(){this.component.redraw()}},height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string",default:"",update:function(){var e=this.component;e.subComponents.icon.setAttribute("source",this.value),this.value?e.elements.icon.style.display="":e.elements.icon.style.display="none"}},eraseButton:{type:"boolean",default:"false",update:function(){this.component.elements.erase.style.display=this.value?"":"none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},error:{type:"boolean",default:"false",restoreTimeout:3e3,update:function(){this.component.updateClass()}},changeDelay:{type:"integer",default:"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onChange:{type:"js",default:"event(id,value)"},onKeyDown:{type:"js"},onKeyUp:{type:"js"},onEnterKey:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.eraseButton=new Sfera.UI.Button(this.elements.erase,{onclick:this.onErase.bind(this)})},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var e="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,e=this.elements.field.value,this.elements.field=null);var t=this.getAttribute("type"),i=this.getAttribute("placeHolder");i=i?' placeholder="'+i+'"':"";var n="";n=n?' style="'+n+'"':"";var s=this.getAttribute("enabled")?"":" disabled";this.elements.fieldC.innerHTML="textarea"==t?'<textarea class="field" '+n+i+s+" /></textarea>":'<input class="field" type="'+t+'"'+n+i+s+' autocorrect="off" autocapitalize="off" />',this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=e,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onselectstart=this.onSelectStart,this.elements.field.controller=this},updateClass:function(){var e=this.getAttribute("cssClass"),t=this.focused?" focused":"",i=this.getAttribute("enabled")?"":" disabled",n=this.getAttribute("error")?" error":"";this.element.className="component comp_input"+(e?" "+e:"")+t+i;var s=this.getAttribute("style");this.elements.container.className="container"+(s?" style_"+s:"")+n,this.elements.field&&this.elements.field[(i?"set":"remove")+"Attribute"]("disabled",!0)},onErase:function(){this.getAttribute("enabled")&&(this.setAttribute("value",""),this.onChangedTimeout())},onChanged:function(){var e=this.elements.field.value;if(e!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=e,this.clearChangeTimeout();var t=this.getAttribute("changeDelay"),i=this;t&&(this.changeTimeout=setTimeout(function(){i.onChangedTimeout()},t))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var e=this.getAttribute("onChange");if(e){var t=this.getAttribute("value");Sfera.Custom.exec(e,this.id,t)}},onSelectStart:function(e){},onKeyDown:function(e){if(this.getAttribute("enabled")){this.setAttribute("error","false");var t=e.keyCode,i=Sfera.Utils.getKeyFromCode(t),n=this.getAttribute("type");return"enter"!=i||this.onEnterKey()||(i=""),"enter"==i&&"textarea"!=n||"tab"==i?(this.onChangedTimeout(),Sfera.client.focusNext(e.shiftKey),"enter"==i&&"textarea"!=n&&this.blur(),!1):(this.onChanged(),!0)}},onKeyPress:function(e){if(this.getAttribute("enabled")){var t=e.keyCode,i=Sfera.Utils.getKeyFromCode(t),n=this.elements.field,s=this.getAttribute("value"),o=this.getAttribute("keyRegex"),l=this.getAttribute("maxLength");if(1==i.length){if(s&&l&&s.length>=l&&!function(){var e="";return n.selectionStart!=n.selectionEnd?e=s.substr(n.selectionStart,n.selectionEnd):void 0!==window.getSelection?e=window.getSelection().toString():void 0!==document.selection&&"Text"==document.selection.type&&(e=document.selection.createRange().text),e}())return!1;if(o&&!e.ctrlKey&&!e.metaKey&&!o.test(String.fromCharCode(t)))return!1}return this.onChanged(),!0}},onKeyUp:function(e){if(this.getAttribute("enabled")){var t=e.keyCode,i=Sfera.Utils.getKeyFromCode(t);return"enter"==i||"tab"===i||(this.onChanged(),!1)}},onChange:function(){this.onChanged()},onEnterKey:function(){if(this.getAttribute("enabled")){var e=this.getAttribute("onEnterKey");if(e){var t=this.getAttribute("value");return Sfera.Custom.exec(e,this.id,t)}return!0}},onFocus:function(){var e=this.controller;Sfera.client.setFocused(e),e.focused=!0,e.updateClass();var t=this.getAttribute("onFocus");if(t){var i=this.getAttribute("value");return Sfera.Custom.exec(t,this.id,i)}return!0},onBlur:function(){var e=this.controller;e.onChanged(),Sfera.client.clearFocused(e),e.focused=!1,e.updateClass();var t=this.getAttribute("onBlur");if(t){var i=this.getAttribute("value");return Sfera.Custom.exec(t,this.id,i)}return!0},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}});