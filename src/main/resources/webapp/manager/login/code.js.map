{"version":3,"sources":["code/client.js","skins/default/default.js","components/button/button.js","components/input/input.js","components/image/image.js","components/page/page.js","components/label/label.js","components/interface/interface.js","custom.js"],"names":["root","this","Sfera","VERSION","client","Compiler","getComments","context","foundComments","elementPath","length","el","pop","i","childNodes","node","nodeType","push","createComponent","name","attributes","component","Components","createInstance","compileXMLNode","xmlNode","options","index","a","attrs","Utils","dashToCamel","value","idPrefix","id","nodeName","indexComponent","child","c","addChild","compileXML","xmlDoc","documentElement","compileString","xmlStr","parser","DOMParser","parseFromString","txt","compileDictionary","c2","c3","n","t","k","tagName","setSource","getCDATA","setLanguage","compileHTML","source","replace","getMustacheData","isString","indexOf","data","vars","MUSTACHE","m","exec","compileAttributeValue","attr","str","mustache","rep","match","capture","getNodeValue","type","parseInt","parseFloat","toLowerCase","names","toString","v","JSON","stringify","undefined","RegExp","err","split","Attribute","config","changed","default","required","values","bind","isFunction","prototype","set","manualUpdate","eq","equals","removeAttrObserver","bindAttrObserver","compile","get","arr","isArray","update","post","ComponentManager","all","byId","byGroup","byType","addBy","co","removeBy","getBy","group","addByGroup","removeByGroup","getFirstById","getById","getByType","getByGroup","getValue","getAttribute","ComponentPresets","Visibility","attrDefs","visible","trigger","show","onShow","onHide","children","element","style","display","Position","position","x","left","y","top","rotation","s","r","msTransform","webkitTransform","transform","Size","width","height","Label","label","innerHTML","color","fontSize","textAlign","Style","skin","styles","updateClass","Color","colors","_createLater","componentName","cc","getClass","bakeSource","d","document","createElement","dom","getFirstChildNodeOfType","setAttribute","getClassName","capitalize","create","def","extends","Component","cloneNode","controller","subComponents","nodes","getAllCommentChildNodes","xml","nodeValue","substr","parseXML","parentNode","replaceChild","addSubComponent","super","init","comp","displayName","sup","Object","constructor","presets","be","call","f","Client","isLogin","isBooted","isRunning","components","input","debug","paused","cPage","manifestTimestamp","self","interface","interfaceC","boot","url","location","Browser","getLocation","login","timestamp","enableDebug","Debug","window","focus","showHeader","Net","onReply","add","onEvent","onUpdateDictionary","onUpdateIndex","connect","onresize","adjustLayout","onkeydown","onKeyDown","onkeyup","onKeyUp","onkeypress","onKeyPress","destroy","CLIENTS","openIndex","onDone","openDictionary","json","result","uiSet","u","join","getElementById","appendChild","start","showPage","p","updateUrl","console","log","commandQueue","sendCommand","command","callback","tag","Date","getTime","req","eventQueue","sendEvent","nodeValues","e","slice","reload","attrObservers","dispatch","viewportWidth","viewportHeight","innerWidth","innerHeight","clientWidth","clientHeight","body","attribute","Signal","addOnce","remove","event","evt","code","charCode","keyCode","ctrlKey","shiftKey","focusedCo","preventDefault","focusFirst","blurTimeoutId","setFocused","blur","clearTimeout","noBlurTimeout","setTimeout","clearFocused","canFocus","isVisible","isEnabled","container","dir","l","focusNext","cos","parent","oi","logE","debugE","addEventListener","keyDown","toggle","initPane","altKey","String","fromCharCode","logCounter","level","title","ds","getDate","src","Device","chrome","args","apply","minWidth","minHeight","FULLSCREEN_MARGINS","MARGINS","clicked","onRightEdge","onBottomEdge","onLeftEdge","onTopEdge","rightScreenEdge","bottomScreenEdge","preSnapped","b","redraw","pane","paneTitle","ghostpane","setBounds","w","h","hintHide","opacity","onMouseDown","onMove","onUp","onTouchDown","onTouchMove","onTouchEnd","onDown","touches","changedTouches","calc","isResizing","cx","clientX","cy","clientY","isMoving","canMove","getBoundingClientRect","ee","animate","requestAnimationFrame","Math","max","currentWidth","currentHeight","right","bottom","min","cursor","snapped","Log","ALL","DEBUG","INFO","WARN","ERROR","FATAL","OFF","_level","setLevel","Login","checkTimeout","checkMs","action","user","password","initReq","resetCheck","open","logout","Request","onLoaded","onError","checkLogin","onload","_bindings","_prevParams","memorize","_shouldPropagate","active","_boundDispatch","validateListener","listener","fnName","Error","_registerListener","isOnce","listenerContext","priority","prevIndex","_indexOfListener","binding","SignalBinding","_addBinding","execute","_priority","splice","cur","_listener","has","arguments","_destroy","removeAll","getNumListeners","halt","paramsArr","Array","bindings","forget","dispose","defineProperty","_this","signal","_isOnce","_signal","_args","callCount","params","handlerReturn","concat","detach","isBound","getListener","getSignal","mySingleton","instance","privateMethod","consolthis","privateVariable","publicMethod","publicProperty","getInstance","singleA","UI","pressedBt","lastButton","skipButtonEvents","overEnabled","buttonFeedbackEnabled","setPressedButton","bt","getPressedButton","updateLastButton","getLastButton","liftButton","state","onLift","resetButton","Button","events","btObj","initData","initEvents","_attributes","disabled","selected","pressed","checked","focused","error","_linked","cs","className","ss","rx","matches","obj","pre","bc","dontLiftOnMove","onclick","onup","touch","ontouchstart","ondown","ontouchmove","onmove","onout","ontouchend","onmouseover","onover","onmouseout","onmousemove","onmousedown","onmouseup","onlift","clearEvents","link","button","setColor","enable","select","mini","attrName","attrValue","setClassName","disableAndroidLongPress","android","stopPropagation","cancelBubble","returnValue","of","swi","swip","nswip","touchStartX","touchStartY","abs","reltg","relatedTarget","toElement","func","Function","getURL","subscribeId","stateTs","protocol","host","_defaultConfig","automaticOpen","reconnectInterval","maxReconnectInterval","reconnectDecay","timeoutInterval","maxReconnectAttempts","webSocket","wsConnected","httpBaseUrl","connectionId","pingInterval","responseTimeout","connCheckTimeoutId","cSync","subscribed","localTs","dictionary","remoteTs","onMessage","onWsOpen","wsSend","onWsMessage","resetConnCheckTimeout","parse","onWsError","wsOpen","getWsCloseReason","reason","onWsClose","readyState","WebSocket","CLOSED","onopen","onmessage","onclose","onerror","send","wsClose","close","getTimestamp","onReqLoaded","onReqError","sync","urls","getResponseText","getResponseXML","getHostName","hostname","cmd","status","reqTimeout","onStop","onRetry","onRequest","onConnectionError","onUnauthorized","maxWaitingTime","waitTimeout","retryOnErrorDelay","maxRetries","retries","foo","ERROR_GENERAL","ERROR_CONNECTION","ERROR_MAXWAITTIME","ERROR_UNAUTHORIZED","ERROR_FORBIDDEN","ERROR_NOT_FOUND","XMLHttpRequest","onreadystatechange","onReadyStateChange","ActiveXObject","ms","stop","onWaitTimeout","abort","repeat","res","responseText","errCode","getResponseJSON","responseXML","isReady","Skins","changeUrl","history","Title","Url","pushState","pageId","pageTitle","hash","lastHash","pathname","search","href","sp","setInterval","locHash","deviceReadyAt","initialized","desktop","iOS","cocoonJS","cocoonJSApp","cordova","nodeWebkit","electron","ejecta","crosswalk","chromeOS","linux","macOS","windows","windowsPhone","canvas","canvasBitBltShift","webGL","file","fileSystem","localStorage","worker","css3D","pointerLock","typedArray","vibration","getUserMedia","quirksMode","mspointer","wheelEvent","arora","chromeVersion","epiphany","firefox","firefoxVersion","ie","ieVersion","trident","tridentVersion","mobileSafari","midori","opera","safari","webApp","silk","audioData","webAudio","ogg","opus","mp3","wav","m4a","webm","oggVideo","h264Video","mp4Video","webmVideo","vp9Video","hlsVideo","iPhone","iPhone4","iPad","pixelRatio","littleEndian","LITTLE_ENDIAN","support32bit","fullscreen","requestFullscreen","cancelFullscreen","fullscreenKeyboard","onInitialized","whenReady","nonPrimer","readyCheck","_readyCheck","_monitor","_queue","navigator","now","removeEventListener","_initialize","item","shift","device","_checkOS","ua","userAgent","test","vita","kindle","_checkFeatures","getItem","screencanvas","WebGLRenderingContext","getContext","compatMode","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","oGetUserMedia","URL","webkitURL","mozURL","msURL","_checkInput","maxTouchPoints","msPointerEnabled","pointerEnabled","_checkFullScreenSupport","fs","cfs","Element","_checkBrowser","$1","$3","process","require","versions","CocoonJS","_checkVideo","videoElement","canPlayType","_checkAudio","audioElement","_checkDevice","vibrate","webkitVibrate","mozVibrate","msVibrate","canPlayAudio","canPlayVideo","man","what","hstr","sstr","sub","av","help","mixin","extend","ancestor","initClass","filterNone","NodeFilter","FILTER_ACCEPT","rootNode","comments","iterator","createNodeIterator","SHOW_COMMENT","curNode","nextNode","recursive","getFirstChildNodeWithName","getComponentElements","toUpperCase","camelToDash","chr","getKeyFromCode","format","pan","len","date","getMonth","getFullYear","getHours","getMinutes","getSeconds","getMilliseconds","getMouseRelativePosition","target","ep","getElementAbsolutePosition","getMouseAbsolutePosition","pageX","pageY","layerX","offsetX","layerY","offsetY","srcElement","scaleDelta","offsetLeft","offsetTop","offsetParent","initMouseWheelEvent","addEvent","browser","async","loadXML","array","strict","sort","isNumeric","isNaN","isFinite","trim","ws","charAt","startsWith","endsWith","Number","mod","next","previous","vArg","unique","j","last","clone","intersect","same","searchElement","fromIndex","TypeError","Infinity","floor","clean","deleteValue","method","attachEvent","removeEvent","detachEvent","requireUpdate","attributeValues","elements","superClassName","methodName","processed","onFocus","onBlur","exports","module","define","amd","Default","Input","Checkbox","Radio","icon","onClick","col","sty","Custom","field","eraseButton","erase","changeDelay","keyRegex","valueRegex","fontColor","maxLength","onChange","onEnter","changeTimeout","onErase","onfocus","onblur","onselectstart","phText","fieldC","oninput","onUserChange","onSelectStart","onChangedTimeout","onChanged","clearChangeTimeout","fieldE","getSelectedText","text","selectionStart","selectionEnd","getSelection","selection","createRange","metaKey","svg","getElementsByTagName","zoom","bodyE","msTransformOrigin","OTransform","MozTransform","WebkitTransformOrigin","transformOrigin","startupEvent","StartupEvent","commandEvent","uiEvent","pageOpenEvent","pageCloseEvent","pageBackEvent","page","username","eval","SyntaxError","alert","message"],"mappings":"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","sourcesContent":["/*! sfera-webapp - v0.0.2 - 2016-03-22 */\n\n(function(){\n\n    var root = this;\n\n\n/**\n* @namespace Sfera\n*/\nvar Sfera = Sfera || {\n\n    /**\n    * The Sfera version number.\n    * @constant\n    * @type {string}\n    */\n    VERSION: '0.1.0',\n\n    /**\n    * Sfera client instance.\n    * @constant\n    * @type {array}\n    */\n    client: null\n\n};\n\n\n/**\n * Sfera.Compiler compiles components into DOM\n *\n * @class Sfera.Compiler\n * @constructor\n */\nSfera.Compiler = new(function() {\n\n    function getComments(context) {\n        var foundComments = [];\n        var elementPath = [context];\n        while (elementPath.length > 0) {\n            var el = elementPath.pop();\n            for (var i = 0; i < el.childNodes.length; i++) {\n                var node = el.childNodes[i];\n                if (node.nodeType === 8) {\n                    foundComments.push(node);\n                } else {\n                    elementPath.push(node);\n                }\n            }\n        }\n\n        return foundComments;\n    }\n\n    // first time compiling an element.\n    // if it finds <!-- sml, replace it with elements\n    // add on each element main div data-controller=\"Link\" (added automatically when compiling any component?)\n    // set composed = true\n    // SAVE new source and composed\n    //\n    // when assigning the controller, if composed, browse the html to assign controllers\n\n    /**\n     * Create component instance.\n     * @param  {string} name        name of the\n     * @param  {object} attributes  attributes of\n     * @return {object}             thing\n     */\n    this.createComponent = function(name, attributes) {\n        /*\n        if (src.indexOf(\"<!--sml\") != -1) {\n            var comments = getComments(newDiv);\n            if (comments && comments.length) {\n                // replace with components\n            }\n        }\n        */\n\n        var component = Sfera.Components.createInstance(name, attributes);\n        return component;\n    };\n\n    this.compileXMLNode = function(xmlNode, options) {\n        if (xmlNode.nodeType == 1) { // 1 = element\n            options = options || {};\n            options.index = options.index || true; // default is true\n\n            var i, a;\n            var attrs = {};\n            for (i = 0; i < xmlNode.attributes.length; i++) {\n                a = xmlNode.attributes[i];\n                attrs[Sfera.Utils.dashToCamel(a.name)] = a.value;\n            }\n\n            // add prefix?\n            if (options.idPrefix && attrs.id)\n                attrs.id = options.idPrefix + \".\" + attrs.id;\n\n            var component = this.createComponent(xmlNode.nodeName, attrs);\n\n            // add to the index\n            if (component) {\n                if (options.index)\n                    Sfera.client.indexComponent(component);\n\n                var child;\n                var c = xmlNode.childNodes;\n\n                for (i = 0; i < c.length; i++) {\n                    child = this.compileXMLNode(c[i]);\n                    if (child)\n                        component.addChild(child);\n                }\n            }\n\n            return component;\n        }\n        return null;\n    };\n\n    /**\n     *\n     */\n    this.compileXML = function(xmlDoc, options) {\n        return this.compileXMLNode(xmlDoc.documentElement, options);\n    };\n\n    this.compileString = function(xmlStr) {\n        parser = new DOMParser();\n        xmlDoc = parser.parseFromString(txt, \"text/xml\");\n\n        this.compileXML(xmlDoc);\n    };\n\n    /**\n     * [function description]\n     * @param  {string} xmlDoc [description]\n     * @return {string}        [description]\n     */\n    this.compileDictionary = function(xmlDoc) {\n        var xmlNode = xmlDoc.documentElement;\n        if (xmlNode && xmlNode.nodeType == 1) { // 1 = element\n            var c = xmlNode.childNodes,\n                c2, c3, n, i, t, k;\n            for (i = 0; i < c.length; i++) {\n                if (c[i].nodeType == 1) switch (c[i].tagName) {\n                    case \"skin\":\n                        break;\n                    case \"components\":\n                        c2 = c[i].childNodes;\n                        for (t = 0; t < c2.length; t++) {\n                            if (c2[t].nodeType == 1) {\n                                // component has source and lan\n                                c3 = c2[t].childNodes;\n                                for (k = 0; k < c3.length; k++) {\n                                    switch (c3[k].tagName) {\n                                        case \"src\":\n                                            Sfera.Components.setSource(c2[t].tagName, Sfera.Utils.getCDATA(c3[k]));\n                                            break;\n                                        case \"_lan\":\n                                            Sfera.Components.setLanguage(c2[t].tagName, Sfera.Utils.getCDATA(c3[k]));\n                                            break;\n                                    }\n                                }\n                            }\n                        }\n                        break;\n                }\n            }\n        }\n    };\n\n    this.compileHTML = function(source) {\n        source = source.replace(/\\$interface\\;/g, Sfera.client.name);\n\n        // ...\n\n        return source;\n    };\n\n    this.getMustacheData = function(source) {\n        if (!Sfera.Utils.isString(source) ||\n            source.indexOf(\"{\") == -1)\n            return null;\n\n        var data = {\n            vars: []\n        };\n        var MUSTACHE = /\\{\\{([^}]*)\\}\\}/g;\n        var m;\n        while (m = MUSTACHE.exec(source)) {\n            data.vars.push(m[1]);\n        }\n\n        // done\n        if (!data.vars.length)\n            return null;\n\n        return data;\n    };\n\n    /**\n     *\n     */\n    this.compileAttributeValue = function(attr, source) {\n        var str;\n        var MUSTACHE = /\\{\\{([^}]*)\\}\\}/g;\n\n        /*/\n        function myRep(match, capture) {\n            switch (capture) {\n                case \"one\":\n                    return \"1\";\n                    break;\n                case \"two\":\n                    return \"2\";\n                    break;\n            }\n\n            return \"\";\n        }\n        //str = '<div class=\"hr\"></div> <p class=\"tags hidden-mobile\"><a href=\"http://www.rockpapershotgun.com/tag/arkane-studios/\" rel=\"tag\">Arkane Studios</a>, <a href=\"http://www.rockpapershotgun.com/tag/bethesda/\" rel=\"tag\">Bethesda</a>, <a href=\"http://www.rockpapershotgun.com/tag/dishonored/\" rel=\"tag\">Dishonored</a>, <a href=\"http://www.rockpapershotgun.com/tag/dishonored-2/\" rel=\"tag\">Dishonored 2</a>.</p> <p class=\"comments\"><a href=\"http://www.rockpapershotgun.com/2015/09/17/dishonored-2-karnaca/#comments\" title=\"Comment on Southland Tales: Dishonored 2&#8217;s Sun-Scorched Bloodflies\">21 Comments &#187;</a></p> </footer> </div> </div> <div id=\"post-314999\" class=\"block featured-block\"> <p class=\"featured-block-title\"> <a class=\"featured-block__text featured-block__text--feature\" href=\"http://www.rockpapershotgun.com/category/featured-articles\">RPS Feature</a> It's a number one. </p> <div class=\"post-inner\"> <h2><a href=\"http://www.rockpapershotgun.com/2015/09/17/is-this-gamings-greatest-toilet-the-toilet-publishers-dont-want-you-to-see/\" rel=\"bookmark\" title=\"Permanent Link to Is This Gaming&#8217;s Greatest Toilet? The Toilet Publishers Don&#8217;t Want You To See\">Is This Gaming&#8217;s Greatest Toilet? The Toilet Publishers Don&#8217;t Want You To See</a></h2> <div class=\"entry\"> <div class=\"top-matter hidden-mobile\"> <aside class=\"byline\"> <p>By <a href=\"/cdn-cgi/l/email-protection#472d61647676767c2f61647676777c616471737c352861647e7e7c61647677707c61647676757c61647e707c61647676757c2261647676737c61647676727c616476X04;ot&#103;un.c&#111;&#109;\">John Walker</a> on September 17th, 2015 at 5:00 pm.</p> </aside> <div class=\"social-buttons\"> <h4>Share this:</h4> <ul class=\"social-icons\"> <li><a class=\"social-facebook icon-facebook\" href=\"http://www.facebook.com/sharer.php?u=http://www.rockpapershotgun.com/2015/09/17/is-this-gamings-greatest-toilet-the-toilet-publishers-dont-want-you-to-see//\"><span>Facebook</span></a></li> <li><a class=\"social-twitter icon-twitter\" href=\"http://twitter.com/intent/tweet?text=Is This Gaming&#8217;s Greatest Toilet? The Toilet Publishers Don&#8217;t Want You To See http://www.rockpapershotgun.com/2015/09/17/is-this-gamings-greatest-toilet-the-toilet-publishers-dont-want-you-to-see/\"><span>Twitter</span></a></li> <li><a class=\"social-reddit icon-reddit\" href=\"http://www.reddit.com/submit?url=http://www.rockpapershotgun.com/2015/09/17/is-this-gamings-greatest-toilet-the-toilet-publishers-dont-want-you-to-see//\"><span>Reddit</span></a></li> </ul> </div> </div> <p><a href=\"http://www.rockpapershotgun.com/images/15/sep/albt1b.jpg\" rel=\"lightbox[314999]\"><img src=\"http://www.rockpapershotgun.com/images/15/sep/albt1.jpg\" alt=\"\"/></a></p> <p><em>I&#8217;m really getting the hang of these headlines, I think. In <a href=\"http://www.rockpapershotgun.com/2015/09/15/albino-lullaby-review/\">my review of Albino Lullaby</a> this week, I included a throwaway line that I then didn&#8217;t justify in pictorial form. I wrote that it features, &#822#8220;the best toilet in gaming history.&#8221; You can&#8217;t just say a thing like that and expect not to be required to prove it. I think the image above has already done that, but there are more, just in case &#8211; click on them to appreciate them fully.</em></p> <p> <a href=\"http://www.rockpapershotgun.com/2015/09/17/is-this-gamings-greatest-toilet-the-toilet-publishers-dont-want-you-to-see/#more-314999\" class=\"more-link\">Read the rest of this entry &raquo;</a></p> </div> <footer class=\"article-footer\"> <div class=\"hr\"></div> <p class=\"tags hidden-mobile\"><a href=\"http://www.rockpapershotgun.com/tag/albino-lullaby/\" rel=\"tag\">Albino Lullaby</a>, <a href=\"http://www.rockpapershotgun.com/tag/ape-law/\" rel=\"tag\">Ape Law</a>, <a href=\"http://www.rockpapershotgun.com/tag/feature/\" rel=\"tag\">feature</a>, <a href=\"http://www.rockpapershotgun.com/tag/toilets-in-games/\" rel=\"tag\">toilets-in-games</a>.</p> <p class=\"comments\"><a href=\"http://www.rockpapershotgun.com/2015/09/17/is-this-gamings-greatest-toilet-the-toilet-publishers-dont-want-you-to-see/#comments\" title=\"Comment on Is This Gaming&#8217;s Greatest Toilet? The Toilet Publishers Don&#8217;t Want You To See\">20 Comments &#187;</a></p> </footer> </div> </div> <div id=\"post-315221\" class=\"block featured-block\"> <div class=\"post-inner\"> <h2><a href=\"http://www.rockpapershotgun.com/2015/09/17/warhammer-40k-deathwatch-pc/\" rel=\"bookmark\" title=\"Permanent Link to Warhammer 40,000: Deathwatch Crusading Onto PC\">Warhammer 40,000: Deathwatch Crusading Onto PC</a></h2> <div class=\"entry\"> <div class=\"top-matter hidden-mobile\"> <aside class=\"byline\"> <p>By <a href=\"/cdn-cgi/l/email-protection#e584c3c6d4d5ddde8cc3c6dcdcde80c3c6d3d1dec3c6d4d4d1dec3c6d4d4d4de86c3c6d4d5d2dec3c6d4d4d7de8495c3c6d4d5d4de97c3c6d4d4d0dec3c6d4d5d1deXo&#116;gu&#110;&#46;&#99;o&#109;\">Alice O'Connor</a> on September 17th, 2015 at 4:11 pm.</p> </aside> <div class=\"social-buttons\"> <h4>Share this:</h4> <ul class=\"social-icons\"> <li><a class=\"social-facebook icon-facebook\" href=\"http://www.facebook.com/sharer.php?u=http://www.rockpapershotgun.com/2015/09/17/warhammer-40k-deathwatch-pc//\"><span>Facebook</span></a></li> <li><a class=\"social-twitter icon-twitter\" href=\"http://twitter.com/intent/tweet?text=Warhammer 40,000: Deathwatch Crusading Onto PC http://www.rockpapershotgun.com/2015/09/17/warhammer-40k-deathwatch-pc/\"><span>Twitter</span></a></li> <li><a class=\"social-reddit icon-reddit\" href=\"http://www.reddit.com/submit?url=http://www.rockpapershotgun.com/2015/09/17/warhammer-40k-deathwatch-pc//\"><span>Reddit</span></a></li> </ul> </div> </div> <p><img src=\"http://www.rockpapershotgun.com/images/15/sep/17wh40kdeathwatch.jpg\" title=\"Aye, a can of Raid won't solve this one.\"/></p> <p>The Warhammer 40,000 game I&#8217;d really like is still <a href=\"http://www.rockpapershotgun.com/2015/07/14/dawn-of-war-3-rumours/\">Dawn of War 3</a>, but in the meantime I shall need to investigate other opportunities to wear a big ole skull on my crotch.</p> <p>Rodeo Games, the folks behind <a href=\"http://www.rockpapershotgun.com/tag/warhammer-quest/\">Warhammer Quest</a>, have announced that they&#8217;re bringing another mobile doodad over to PC a little fancied up, and this one has all the crotchskulls I demand &#8211; Warhammer 40,000: Deathwatch [<a href=\"http://rodeogames.co.uk/deathwatch\">official site</a>]. It&#8217;s a turn-based tactical affair about hunting down and squishing those naughty Tyranids, from cities to the guts of bio-ships, while expanding, levelling up, and equipping your Deathwatch Kill Team.</p> <p> <a href=\"http://www.rockpapershotgun.com/2015/09/17/warhammer-40k-deathwatch-pc/#more-315221\" class=\"more-link\">Read the rest of this entry &raquo;</a></p> </div> <footer class=\"article-footer\"> <div class=\"hr\"></div> <p class=\"tags hidden-mobile\"><a href=\"http://www.rockpapershotgun.com/tag/rodeo-games/\" rel=\"tag\">Rodeo Games</a>, <a href=\"http://www.rockpapershotgun.com/tag/warhammer-40000/\" rel=\"tag\">Warhammer 40000</a>, <a href=\"http://www.rockpapershotgun.com/tag/warhammer-40000-deathwatch/\" rel=\"tag\">Warhammer 40000: Deathwatch</a>, <a href=\"http://www.rockpapershotgun.com/tag/warhammer-40000-deathwatch-enhanced-edition/\" rel=\"tag\">Warhammer 40000: Deathwatch - Enhanced Edition</a>.</p> <p class=\"comments\"><a href=\"http://www.rockpapershotgun.{{that is}}com/2015/09/17/warhammer-40k-deathwatch-pc/#comments\" title=\"Comment on Warhammer 40,000: Deathwatch Crusading Onto PC\">10 Comments &#187;</a></p> </footer> </div> </div> <div id=\"post-299851\" class=\"block featured-block\"> <div class=\"post-inner\"> <h2><a href=\"http://www.rockpapershotgun.com/2015/09/17/have-you-played-kyrandia-2-hand-of-fate/\" rel=\"bookmark\" title=\"Permanent Link to Have You Played&#8230; Kyrandia 2: Hand Of Fate?\">Have You Played&#8230; Kyrandia 2: Hand Of Fate?</a></h2> <div class=\"entry\"> <div class=\"top-matter hidden-mobile\"> <aside class=\"byline\"> <p>By <a href=\"/cdn-cgi/l/email-protection#91b7b2a0a0a5aab7b2a0a1a4aab7b2a8a8aab7b2a0a1a5aaf0b7b2a0a0a5aaf5b7b2a7a5aae3feb7b2a8a8aafab7b2a0a0a3aaf0b7b2a0a0a3aab7b2a0a1a0aab7b2X114;&#115;hot&#103;un.&#99;&#111;&#109;\">Richard Cobbett</a> on September 17th, 2015 at 3:00 pm.</p> </aside> <div class=\"social-buttons\"> <h4>Share this:</h4> <ul class=\"social-icons\"> <li><a class=\"social-facebook icon-facebook\" href=\"http://www.facebook.com/sharer.php?u=http://www.rockpapershotgun.com/2015/09/17/have-you-played-kyrandia-2-hand-of-fate//\"><span>Facebook</span></a></li> <li><a class=\"social-twitter icon-twitter\" href=\"http://twitter.com/intent/tweet?text=Have You Played&#8230; Kyrandia 2: Hand Of Fate? http://www.rockpapershotgun.com/2015/09/17/have-you-played-kyrandia-2-hand-of-fate/\"><span>{{this is}}</span></a></li> <li><a class=\"social-reddit icon-reddit\" href=\"http://www.reddit.com/submit?url=http://www.rockpapershotgun.com/2015/09/17/have-you-played-kyrandia-2-hand-of-fate//\"><span>Reddit</span></a></li> </ul> </div> </div>';\n        //str = '<div><!--sfera><--!></div><p></p><br /><div>{{two}}</div>';\n        str = '<div>{{one}}</div><p></p><br /><div>{{two}}</div>';\n        str = str.replace(MUSTACHE, myRep); // return 'gold ' + capture + '|' + match; \"gold ring|string\"\n        /**/\n\n        var value = source || attr.source;\n\n        // mustache\n        if (attr.mustache) {\n            function rep(match, capture) {\n                return Sfera.client.getNodeValue(capture);\n            }\n            value = value.replace(MUSTACHE, rep);\n        }\n\n        // type\n        switch (attr.type) {\n            case \"integer\":\n                value = parseInt(value);\n                break;\n            case \"float\":\n                value = parseFloat(value);\n                break;\n            case \"color\":\n                value = value.toLowerCase();\n                names = ['aliceblue', 'antiquewhite', 'aqua', 'aquamarine', 'azure', 'beige', 'bisque', 'black', 'blanchedalmond', 'blue', 'blueviolet', 'brown', 'burlywood', 'cadetblue', 'chartreuse', 'chocolate', 'coral', 'cornflowerblue', 'cornsilk', 'crimson', 'cyan', 'darkblue', 'darkcyan', 'darkgoldenrod', 'darkgray', 'darkgreen', 'darkkhaki', 'darkmagenta', 'darkolivegreen', 'darkorange', 'darkorchid', 'darkred', 'darksalmon', 'darkseagreen', 'darkslateblue', 'darkslategray', 'darkturquoise', 'darkviolet', 'deeppink', 'deepskyblue', 'dimgray', 'dodgerblue', 'firebrick', 'floralwhite', 'forestgreen', 'fuchsia', 'gainsboro', 'ghostwhite', 'gold', 'goldenrod', 'gray', 'green', 'greenyellow', 'honeydew', 'hotpink', 'indianred', 'indigo', 'ivory', 'khaki', 'lavender', 'lavenderblush', 'lawngreen', 'lemonchiffon', 'lightblue', 'lightcoral', 'lightcyan', 'lightgoldenrodyellow', 'lightgreen', 'lightgrey', 'lightpink', 'lightsalmon', 'lightseagreen', 'lightskyblue', 'lightslategray', 'lightsteelblue', 'lightyellow', 'lime', 'limegreen', 'linen', 'magenta', 'maroon', 'mediumaquamarine', 'mediumblue', 'mediumorchid', 'mediumpurple', 'mediumseagreen', 'mediumslateblue', 'mediumspringgreen', 'mediumturquoise', 'mediumvioletred', 'midnightblue', 'mintcream', 'mistyrose', 'moccasin', 'navajowhite', 'navy', 'oldlace', 'olive', 'olivedrab', 'orange', 'orangered', 'orchid', 'palegoldenrod', 'palegreen', 'paleturquoise', 'palevioletred', 'papayawhip', 'peachpuff', 'peru', 'pink', 'plum', 'powderblue', 'purple', 'red', 'rosybrown', 'royalblue', 'saddlebrown', 'salmon', 'sandybrown', 'seagreen', 'seashell', 'sienna', 'silver', 'skyblue', 'slateblue', 'slategray', 'snow', 'springgreen', 'steelblue', 'tan', 'teal', 'thistle', 'tomato', 'turquoise', 'violet', 'wheat', 'white', 'whitesmoke', 'yellow', 'yellowgreen'];\n                /*\n                /^(#[a-f0-9]{6}|#[a-f0-9]{3}|rgb *\\( *[0-9]{1,3}%? *, *[0-9]{1,3}%? *, *[0-9]{1,3}%? *\\)|rgba *\\( *[0-9]{1,3}%? *, *[0-9]{1,3}%? *, *[0-9]{1,3}%? *, *[0-9]{1,3}%? *\\)|black|green|silver|gray|olive|white|yellow|maroon|navy|red|blue|purple|teal|fuchsia|aqua)$/i\n                if (names.indexOf(value) == -1) {\n                    if (!(/^#[a-f0-9]{6}$/i).test(value)) {\n                        if (/^[a-f0-9]{6}$/i).test(value) {\n                            value = '#'.value;\n                        } else {\n\n                        }\n                    }\n                }\n                */\n                break;\n            case \"string\":\n            case \"js\":\n                if (typeof(value) != \"string\" && value.toString) {\n                    var v = value.toString();\n                    if (v == \"[object Object]\")\n                        value = JSON.stringify(value);\n                    else\n                        value = v;\n                }\n                break;\n            case \"boolean\":\n                value = !(value === \"false\" || value === false || value === undefined || value === null);\n                break;\n            case \"regexp\":\n                try {\n                    value = new RegExp(value); // add begin and end, it has to match the whole string\n                } catch (err) {\n                    value = null;\n                }\n                break;\n            case \"list\":\n                value = value.split(\",\");\n                break;\n        }\n\n        // done\n        return value;\n    };\n\n})();\n\n\n/**\n * Sfera.Attribute Component attribute\n *\n * @namespace Sfera.Attribute\n */\nSfera.Attribute = function(component, config) {\n    // type\n    this.type = \"string\";\n    // needs to be compiled?\n    this.changed = false;\n    // default source value. if != null, it's applied after .init()\n    this.default = null;\n    // value source\n    this.source = null;\n    // compiled value\n    this.value = null;\n    // required\n    this.required = false;\n    // array of possible values\n    this.values = null;\n    // owner component\n    this.component = component;\n\n    for (var c in config) {\n        switch (c) {\n        case \"type\":\n        case \"source\":\n        case \"value\":\n        case \"default\":\n            this[c] = config[c];\n            break;\n        case \"set\":\n        case \"get\":\n        case \"compile\":\n        case \"update\":\n        case \"post\":\n            this[c] = config[c].bind(this);\n            break;\n        case \"values\":\n            if (Sfera.Utils.isFunction(config[c]))\n                this[c] = config[c].bind(this);\n            else\n                this[c] = config[c];\n            break;\n        }\n    }\n};\nSfera.Attribute.prototype = {\n    set: function(value, manualUpdate) {\n        if (this.source === value) return; // no changes\n\n        this.changed = true; // if true, we need to call compile\n        this.source = value;\n        var mustache = Sfera.Compiler.getMustacheData(value);\n        var eq = (this.mustache && mustache && this.mustache.vars.equals(mustache.vars)); // old and new mustache data variables are equal\n        // remove old observers\n        if (this.mustache && !eq) {\n            for (var i=0; i<this.mustache.vars.length; i++)\n                Sfera.client.removeAttrObserver(this.mustache.vars[i], this);\n        }\n        this.mustache = mustache;\n        // add new observers\n        if (this.mustache && !eq) {\n            for (var i=0; i<this.mustache.vars.length; i++)\n                Sfera.client.bindAttrObserver(this.mustache.vars[i], this);\n        }\n        if (!manualUpdate)\n            this.compile();\n    },\n\n    get: function() {\n        return this.value;\n    },\n\n    compile: function () {\n        var value = Sfera.Compiler.compileAttributeValue(this);\n\n        // check if value list\n        if (this.values) {\n            if (Sfera.Utils.isFunction(this.values))\n                arr = this.values();\n            else\n                arr = this.values;\n\n            if (Sfera.Utils.isArray(arr)) {\n                if (arr.indexOf(value) == -1)\n                    return; // can't update it\n            }\n        }\n\n        // update only if changed. TODO: same source compiles to different values???????????????????\n        if (value !== this.value) {\n            this.changed = false;\n            this.value = value;\n            this.update();\n        }\n    },\n\n    update: function () {\n        // do something with the value\n        // ...\n        // call post update\n        this.post();\n    },\n\n    post: function () {\n\n    }\n\n\n};\n\n\n/**\n* Sfera.ComponentManager holds current client's components\n*\n* @class Sfera.ComponentManager\n* @constructor\n*/\nSfera.ComponentManager = function (client) {\n\n    this.client = client;\n\n\tvar all = [];\n\n\t// sets of component pointers {id:[ ... ], ...}\n\tvar byId = {};\n\tvar byGroup = {};\n\tvar byType = {};\n\n\t// generic add by function. component, which set (byId, byAddress..), value (component.id, component.group..)\n\tfunction addBy(co,set,value) {\n\t\tif (!set[value]) // ex. byId[\"dummy.1\"]\n\t\t\tset[value] = [];\n\t\tset[value].push(co);\n\t}\n    function removeBy(co,set,value) {\n        for (var i=0; i<set[value].length; i++) {\n            if (set[value] == co) {\n                set[value] = null;\n                delete set[value];\n                return;\n            }\n        }\n    }\n\n\t// generic get by function\n\tfunction getBy(arr,value) {\n\t\treturn (arr[value]?arr[value]:[]); // if no array return an empty one\n\t}\n\n\t// index component\n\tthis.index = function (co) {\n\t\tall.push(co);\n\t\taddBy(co,byType,co.type);\n\t\tif (co.id)\t\taddBy(co,byId,co.id);\n\t\tif (co.group)\taddBy(co,byGroup,co.group);\n\t};\n\n    // live group indexing\n    // add to byGroup set\n    this.addByGroup = function (co, group) {\n        addBy(co,byGroup,group);\n    }\n    // remove component from byGroup set\n    this.removeByGroup = function (co, group) {\n        removeBy(co,byGroup,group);\n    }\n\n\t// get single object (first) by id\n\tthis.getFirstById = function (id) {\n\t\treturn this.getById(id)[0];\n\t};\n\n\t// get components by id\n\tthis.getById = function (id) {\n\t\treturn getBy(byId,id);\n\t};\n\n\t// get components by type\n\tthis.getByType = function (type) {\n\t\treturn getBy(byType,type);\n\t};\n\n    // get by group\n    this.getByGroup = function (group) {\n        return getBy(byGroup,group)\n    };\n\n\t// get value from single component (first) by id\n\tthis.getValue = function (id) {\n\t\tvar co = this.getFirstById(id);\n\t\treturn co ? co.getAttribute(\"value\") : null;\n\t};\n\n};\n\n\nSfera.ComponentPresets = {\n\n};\n\n/**\n * Visibility behavior.\n *\n * @mixin Sfera.ComponentPresets.Visibility\n * @property {boolean} visible - sets the visibility\n */\nSfera.ComponentPresets.Visibility = function() {\n    // extend attributes\n    this.attrDefs.visible = {\n        type: \"boolean\",\n        compile: function() {\n            var value = !(!this.source || this.source == \"false\");\n            if (value !== this.value) {\n                this.changed = false;\n                this.value = value;\n                this.update();\n            }\n        },\n        update: function() {\n            // trigger event. component, show/hide, is it a child? (also check if its visibility is changing before triggering)\n            function trigger(co, show, child) {\n                if (!child || co.getAttribute(\"visible\")) { // trigger?\n                    if (show && co.onShow) {\n                        co.onShow();\n                    } else if (!show && co.onHide) {\n                        co.onHide();\n                    }\n\n                    if (co.children) {\n                        for (var c = 0; c < co.children.length; c++)\n                            trigger(co.children[c], show);\n                    }\n                }\n            }\n\n            // trigger on hide before hiding\n            if (!this.value) {\n                trigger(this.component, false);\n            }\n\n            // change visibility\n            this.component.element.style.display = this.value ? \"inline\" : \"none\";\n\n            // trigger on show after\n            if (this.value) {\n                trigger(this.component, true);\n            }\n\n            // post update\n            this.post();\n        }\n    };\n};\n\n/**\n * Position behavior.\n *\n * @mixin Sfera.ComponentPresets.Position\n * @property {string} position - sets the position\n * @property {string} x - sets the x coordinate\n * @property {string} y - sets the y coordinate\n */\nSfera.ComponentPresets.Position = function() {\n    // extend attributes\n    this.attrDefs.position = {\n        type: \"string\",\n        update: function() {\n            this.component.element.style.position = this.value == \"static\" ? \"static\" : \"absolute\";\n            // post update\n            this.post();\n        }\n    };\n    this.attrDefs.x = {\n        type: \"integer\",\n        update: function() {\n            this.component.element.style.left = this.value + \"px\";\n            // post update\n            this.post();\n        }\n    };\n    this.attrDefs.y = {\n        type: \"integer\",\n        update: function() {\n            this.component.element.style.top = this.value + \"px\";\n            // post update\n            this.post();\n        }\n    };\n\n    this.attrDefs.rotation = {\n        type: \"integer\",\n        update: function() {\n            var s = this.component.element.style;\n            var r = \"rotate(\" + this.value + \"deg)\"\n            s.msTransform = /* IE 9 */\n                s.webkitTransform = /* Safari */\n                s.transform = r;\n\n            // post update\n            this.post();\n        }\n    }\n};\nSfera.ComponentPresets.Size = function() {\n    // extend attributes\n    this.attrDefs.width = {\n        type: \"integer\",\n        update: function() {\n            this.component.element.style.width = this.value == \"auto\" ? \"auto\" : this.value + \"px\";\n            // post update\n            this.post();\n        }\n    };\n    this.attrDefs.height = {\n        type: \"integer\",\n        update: function() {\n            this.component.element.style.height = this.value == \"auto\" ? \"auto\" : this.value + \"px\";\n            // post update\n            this.post();\n        }\n    };\n};\nSfera.ComponentPresets.Label = function() {\n    // extend attributes\n    this.attrDefs.label = {\n        type: \"string\",\n        update: function() {\n            this.component.element.innerHTML = this.value;\n            // post update\n            this.post();\n        }\n    };\n    this.attrDefs.color = {\n        type: \"string\",\n        update: function() {\n            this.component.element.style.color = this.value;\n            // post update\n            this.post();\n        }\n    };\n    this.attrDefs.fontSize = {\n        type: \"integer\",\n        update: function() {\n            this.component.element.style.fontSize = this.value + \"px\";\n            // post update\n            this.post();\n        }\n    };\n    this.attrDefs.textAlign = {\n        type: \"string\",\n        update: function() {\n            this.component.element.style.textAlign = this.value;\n            // post update\n            this.post();\n        }\n    };\n\n};\n\nSfera.ComponentPresets.Style = function() {\n    // extend attributes\n    this.attrDefs.style = {\n        type: \"string\",\n        default: \"default\",\n\n        values: function() {\n            var s = Sfera.client.skin.styles[this.component.type];\n            return s ? s : [\"default\"];\n        },\n        update: function() {\n            if (this.component.updateClass)\n                this.component.updateClass();\n            // post update\n            this.post();\n        }\n    };\n};\n\nSfera.ComponentPresets.Color = function() {\n    // extend attributes\n    this.attrDefs.color = {\n        type: \"string\",\n        default: \"default\",\n\n        values: function() {\n            var c = Sfera.client.skin.colors[this.component.type];\n            return c ? c : [\"default\"];\n        },\n\n        update: function() {\n            if (this.component.updateClass)\n                this.component.updateClass();\n            // post update\n            this.post();\n        }\n    }\n};\n\n\n/**\n * Sfera.Components singleton that handles components\n *\n * @namespace Sfera.Components\n * @class Sfera.Components\n */\nSfera.Components = new(function() {\n\n    // components need to be created in order depending on what component they're extending\n    this._createLater = {};\n\n    /**\n     * Set a component source code\n     *\n     * @method Sfera.Components#setSource\n     * @property {string} componentName - The name of the component.\n     * @property {string} source - The component source code.\n     */\n    this.setSource = function(componentName, source) {\n        var cc = this.getClass(componentName);\n        cc.prototype.source = source;\n    };\n\n    /**\n     * Bakes the source of a component into a DOM structure, so the component is ready to be instantiated\n     *\n     * @method Sfera.Components#bakeSource\n     * @property {string} componentName - The name of the component.\n     */\n    this.bakeSource = function(componentName) {\n        var cc = this.getClass(componentName);\n\n        // bake DOM\n        var d = document.createElement(\"div\");\n        d.innerHTML = Sfera.Compiler.compileHTML(cc.prototype.source);\n\n        var dom = Sfera.Utils.getFirstChildNodeOfType(d, 1);\n        dom.setAttribute(\"data-controller\", componentName);\n\n        // set dom, ready for cloning\n        cc.prototype.dom = dom;\n        cc.prototype.source = null; // clear source\n    };\n\n    /**\n     * Get the class name of a component starting from its name (capitalizes it)\n     *\n     * @method Sfera.Components#getClassName\n     * @property {string} componentName - The name of the component.\n     */\n    this.getClassName = function(componentName) {\n        return Sfera.Utils.capitalize(Sfera.Utils.dashToCamel(componentName));\n    };\n\n    /**\n     * Get the class of a component from its name\n     *\n     * @method Sfera.Components#getClass\n     */\n    this.getClass = function(componentName) {\n        return Sfera.Components[this.getClassName(componentName)];\n    };\n\n    /**\n     * Creates an instance of a component\n     *\n     * @method Sfera.Components#createInstance\n     * @property {string} componentName - The name of the component.\n     * @property {object} attributes - The attribute values.\n     */\n    this.createInstance = function(componentName, attributes) {\n        // component class\n        var cc = this.getClass(componentName);\n\n        // no component with that name\n        if (cc == null)\n            return null;\n\n        var component = new cc({\n            attributes: attributes\n        });\n\n        return component;\n    };\n\n    /**\n     * Creates a component class from its name and definition\n     *\n     * @method Sfera.Components#create\n     * @property {string} name - The name of the component.\n     * @property {string} def - The component's definition.\n     */\n    this.create = function(name, def) {\n        // extends an existing component?\n        if (def.extends && !Sfera.Components[def.extends]) {\n            if (!this._createLater[def.extends])\n                this._createLater[def.extends] = [];\n            this._createLater[def.extends].push({name:name, def:def});\n            return;\n        }\n\n        // constructor\n        Sfera.Components[name] = function Component(def) {\n            // children, if container\n            this.children = [];\n\n            // html element\n            if (def.element) {\n                this.element = element;\n            } else {\n                // DOM\n                if (this.source)\n                    Sfera.Components.bakeSource(name);\n\n                if (this.dom) {\n                    this.element = this.dom.cloneNode(true);\n                    this.element.controller = this;\n\n                    // subcomponents, if composed component\n                    this.subComponents = {};\n\n                    // replace sml comment nodes with compiled xml\n                    var nodes = Sfera.Utils.getAllCommentChildNodes(this.element);\n                    var xml;\n                    // we need the id now, will set it again later. TODO: find better way?\n                    this.id = def.attributes ? def.attributes.id : null;\n                    for (var i = 0; i < nodes.length; i++) {\n                        if (nodes[i].nodeValue.substr(0, 3) == \"sml\") {\n                            xml = Sfera.Utils.parseXML(nodes[i].nodeValue.substr(3));\n\n                            var root = Sfera.Compiler.compileXML(xml, {\n                                index: this.id ? true : false,\n                                idPrefix: this.id\n                            });\n\n                            // replace existing node\n                            if (root && root.element) {\n                                nodes[i].parentNode.replaceChild(root.element, nodes[i]);\n                                this.addSubComponent(root);\n                            }\n                        }\n                    }\n                }\n\n            }\n\n            // attributes\n            this.attributes = {};\n            for (var attr in this.attrDefs) {\n                this.attributes[attr] = new Sfera.Attribute(this, this.attrDefs[attr]);\n            }\n\n            // init\n            this.super(\"_Base\", \"init\");\n            this.init();\n\n            // attribute values\n            for (var attr in this.attributes) {\n                if (def.attributes && def.attributes[attr] != null)\n                    this.setAttribute(attr, def.attributes[attr]);\n                else if (this.attributes[attr].default != null)\n                    this.setAttribute(attr, this.attributes[attr].default);\n            }\n        };\n        var comp = Sfera.Components[name];\n\n        // non standard, allows developer tools to display object class names correctly\n        comp.displayName = \"Sfera.Component.\" + name;\n        /*\n        Object.defineProperty(Sfera.Components[name], 'name', {\n          value: \"Sfera.Component.\"+name\n        });\n        */\n\n        // extends\n        if (!def.extends)\n            def.extends = \"_Base\";\n\n        var sup = Sfera.Components[def.extends].prototype;\n\n        comp.prototype = Object.create(sup);\n        comp.prototype.constructor = comp;\n        comp.prototype.type = name;\n\n        // copy attributes\n        comp.prototype.attrDefs = {};\n        for (var a in sup.attrDefs) {\n            comp.prototype.attrDefs[a] = sup.attrDefs[a];\n        }\n\n        // presets\n        if (def.presets) {\n            var be;\n            for (var i = 0; i < def.presets.length; i++) {\n                be = Sfera.ComponentPresets[def.presets[i]];\n                be.call(comp.prototype); // extend prototype\n            }\n        }\n\n        // attributes\n        if (def.attributes) {\n            for (var attr in def.attributes) {\n                if (!comp.prototype.attrDefs[attr]) {\n                    comp.prototype.attrDefs[attr] = def.attributes[attr];\n                } else {\n                    // instance\n                    if (comp.prototype.attrDefs[attr] == sup.attrDefs[attr]) {\n                        comp.prototype.attrDefs[attr] = Object.create(sup.attrDefs[attr]);\n                    }\n                    // extend rather than replace (in case it was already defined by extend or preset)\n                    for (var i in def.attributes[attr]) {\n                        comp.prototype.attrDefs[attr][i] = def.attributes[attr][i];\n                    }\n                }\n            }\n        }\n\n        // the rest\n        for (var f in def) {\n            // skip, already done\n            if (f == \"presets\" || f == \"attributes\")\n                continue;\n\n            comp.prototype[f] = def[f];\n            if (typeof comp.prototype[f] === \"function\")\n                comp.prototype[f].displayName = \"Sfera.Components.\" + name + \".\" + f;\n        }\n\n        // components that extend this one, previously defined\n        if (this._createLater[name]) {\n            for (var i=0; i<this._createLater[name].length; i++) {\n                var c = this._createLater[name][i];\n                this.create(c.name, c.def);\n            }\n            delete this._createLater[name];\n        }\n    };\n\n})();\n\n\n/**\n * This is the main object of the interface.\n *\n * @class Sfera.Client\n * @constructor\n * @param {object} [config=null] - A configuration object containing parameters\n * @param {boolean} [config.debug=false] - Debug mode\n */\nSfera.Client = function(config) {\n    // main reference\n    Sfera.client = this;\n\n    if (!config)\n        config = {};\n\n    /**\n     * @property {string} name - interface name\n     * @readonly\n     */\n    this.name = \"\";\n\n    /**\n     * @property {boolean} isLogin - are we on the login page?\n     * @type {String}\n     */\n    this.isLogin = false;\n\n    /**\n     * @property {boolean} isBooted - Is the client booted?\n     * @readonly\n     */\n    this.isBooted = false;\n\n    /**\n     * @property {boolean} isRunning - Is the client running or paused?\n     * @readonly\n     */\n    this.isRunning = false;\n\n    /**\n     * @property {Sfera.ComponentManager} - Reference to the component manager.\n     */\n    this.components = null;\n\n    /**\n     * @property {Sfera.Input} input - Reference to the input manager\n     */\n    this.input = null;\n\n    /**\n     * @property {Sfera.Utils.Debug} debug - Debug utilities.\n     */\n    this.debug = null;\n\n    // Is the client paused?\n    var paused = false;\n\n    // currently visible page\n    this.cPage = null;\n\n    var manifestTimestamp = 0;\n\n    var self = this;\n\n    this.interface = \"\";\n    this.skin = null;\n\n    var interfaceC;\n    /**\n     * Initialize the client and start it.\n     *\n     * @method Sfera.Client#boot\n     * @protected\n     */\n    this.boot = function(url) {\n        if (this.isBooted)\n            return;\n\n        var location = Sfera.Browser.getLocation();\n\n        this.name = location.interface;\n        this.isLogin = location.login;\n\n        if (config.timestamp)\n            manifestTimestamp = config.timestamp;\n\n        Sfera.client = this;\n\n\n        this.isBooted = true;\n\n        this.components = new Sfera.ComponentManager(this);\n\n        // get name\n        this.name = config.interface;\n\n        if (true || this.config.enableDebug) {\n            this.debug = Sfera.Debug;\n            this.debug.boot();\n        } else {\n\n        }\n\n        if (window.focus) {\n            window.focus();\n        }\n\n        Sfera.Debug.showHeader();\n\n        // configure Sfera.Net\n        Sfera.Net.onReply.add(onReply);\n        Sfera.Net.onEvent.add(onEvent);\n        Sfera.Net.onUpdateDictionary.add(onUpdateDictionary);\n        Sfera.Net.onUpdateIndex.add(onUpdateIndex);\n        Sfera.Net.connect();\n\n        window.onresize = adjustLayout;\n        window.onkeydown = onKeyDown;\n\t\twindow.onkeyup = onKeyUp;\n\t\twindow.onkeypress = onKeyPress;\n\n        delete config;\n    };\n\n    /**\n     * Destroys the Client, he deserved it.\n     *\n     * @method Sfera.Client#destroy\n     */\n    this.destroy = function() {\n\n        this.input.destroy();\n\n        this.input = null;\n        this.isBooted = false;\n\n        Sfera.CLIENTS[this.id] = null;\n\n    };\n\n    /**\n     * Open an index, compile it and add it to the DOM\n     *\n     * @method Sfera.Client#openIndex\n     * @property {string} URL - The Index URL.\n     */\n    this.openIndex = function(url, onDone) {\n        // ???\n    };\n\n    this.openDictionary = function(url, onDone) {\n        // ???\n    };\n\n\n    // Net callbacks\n    function onReply(json) {\n        if (json.result && json.result.uiSet) {\n            for (var u in json.result.uiSet) {\n                var n = u.split(\".\");\n                var a = n.pop();\n                var c = self.components.getById(n.join(\".\"));\n                for (var i = 0; i < c.length; i++) {\n                    c[i].setAttribute(a, json.result.uiSet[u]);\n                }\n            }\n        }\n    }\n\n    function onUpdateDictionary(xmlDoc) {\n        var root = Sfera.Compiler.compileDictionary(xmlDoc);\n    };\n\n    function onUpdateIndex(xmlDoc) {\n        var root = Sfera.Compiler.compileXML(xmlDoc);\n        document.getElementById(\"sfera\").appendChild(root.element);\n\n        self.start();\n    };\n\n    this.start = function() {\n        Sfera.Browser.start();\n        interfaceC = this.components.getByType(\"Interface\")[0];\n\n        adjustLayout();\n\n        // register events\n\n    }\n\n    this.indexComponent = function(component) {\n        this.components.index(component);\n    };\n\n    this.setAttribute = function(id, name, value) {\n        var c = this.components.getById(id);\n        for (var i = 0; i < c.length; i++)\n            c[i].setAttribute(name, value);\n    };\n\n    this.getAttribute = function(id, name) {\n        var c = this.components.getFirstById(id); // get first onerror\n        return c.getAttribute(name);\n    };\n\n    this.showPage = function(id) {\n        if (id.indexOf(\":\") == -1)\n            id = \"page:\" + id;\n\n        if (this.cPage)\n            this.cPage.setAttribute(\"visible\", false);\n\n        var p = this.components.getFirstById(id);\n        if (p) {\n            p.setAttribute(\"visible\", true);\n            this.cPage = p;\n            Sfera.Browser.updateUrl(id, p.getAttribute(\"title\"));\n        } else {\n            console.log(\"page not found: \" + id);\n        }\n    };\n\n    var commandQueue = [];\n    this.sendCommand = function(command, callback) {\n        var tag = (new Date()).getTime();\n        var req = {\n            command: command,\n            tag: tag,\n            callback: callback\n        };\n        commandQueue.push(req);\n        Sfera.Net.sendCommand(req);\n\n        return tag;\n    };\n\n    var eventQueue = [];\n    this.sendEvent = function(id, value, callback) {\n        var tag = (new Date()).getTime(); // request id\n        var req = {\n            id: \"webapp.ui.\" + id,\n            value: value,\n            tag: tag,\n            callback: callback\n        };\n        eventQueue.push(req, callback);\n        Sfera.Net.sendEvent(req);\n\n        return tag;\n    };\n\n\n    var nodeValues = {};\n\n    this.getNodeValue = function(node) {\n        return nodeValues[node] ? nodeValues[node] : \"\";\n    }\n\n    function onEvent(json) {\n        // {\"type\":\"event\",\"events\":{\"remote.myvalue\":\"5\",\"system.plugins\":\"reload\",\"remote.\":\"undefined\",\"system.state\":\"ready\"}}\n        // {\"type\":\"event\",\"events\":{\"gui.button_link1.label\":\"changed\"}}\n        for (var e in json.nodes) {\n            var n = e.split(\".\");\n            switch (n[0]) {\n                case \"ui\":\n                    if (n[1] == \"set\") { // ui.set.<global | cid>\n                        n = n.slice(3); // remove ui, set, global | cid\n                        var a = n.pop();\n                        var c = self.components.getById(n.join(\".\"));\n                        for (var i = 0; i < c.length; i++) {\n                            c[i].setAttribute(a, json.nodes[e]);\n                        }\n                    }\n                    break;\n                case \"webapp\":\n                    //webapp.interface.new.update\":1446813798521\n                    if (n[1] == \"interface\" &&\n                        n[2] == self.name &&\n                        n[3] == \"update\") {\n                        if (json.nodes[e] != manifestTimestamp) {\n                            manifestTimestamp = json.nodes[e];\n                            Sfera.Browser.reload();\n                        }\n                    }\n                    break;\n            }\n\n            // update local node values\n            nodeValues[e] = json.nodes[e];\n\n            // attribute observer\n            if (attrObservers[e])\n                attrObservers[e].dispatch();\n        }\n    }\n\n    function adjustLayout() {\n        // not initialized yet\n        if (!interfaceC) return;\n\n        var width = parseInt(interfaceC.getAttribute(\"width\"));\n        var height = parseInt(interfaceC.getAttribute(\"height\"));\n\n        // center container within window size\n        var viewportWidth;\n        var viewportHeight;\n\n        if (window.innerWidth) {\n            viewportWidth = window.innerWidth;\n            viewportHeight = window.innerHeight;\n        } else if (document.documentElement && document.documentElement.clientWidth) {\n            viewportWidth = document.documentElement.clientWidth;\n            viewportHeight = document.documentElement.clientHeight;\n        } else if (document.body.clientWidth) {\n            viewportWidth = document.body.clientWidth;\n            viewportHeight = document.body.clientHeight;\n        } else {\n            viewportWidth = 0;\n            viewportHeight = 0;\n        }\n\n        if (viewportWidth > 0) {\n            var left = (viewportWidth > width) ? (viewportWidth - width) / 2 : 0;\n            var top = (viewportHeight > height) ? (viewportHeight - height) / 2 : 0;\n\n            interfaceC.element.style.display = \"none\";\n            interfaceC.element.style.left = left + \"px\";\n            interfaceC.element.style.top = top + \"px\";\n            interfaceC.element.style.display = \"block\";\n        } // viewportWidth>0\n    } // adjustLayout()\n\n\n    var attrObservers = {};\n    // attribute observers\n    this.bindAttrObserver = function(node, attribute) {\n        if (!attrObservers[node])\n            attrObservers[node] = new Sfera.Signal();\n        attrObservers[node].addOnce(attribute.compile, attribute);\n    }\n    this.removeAttrObserver = function(node, attribute) {\n        attrObservers[node].remove(attribute.compile, attribute);\n    }\n\n    // events\n    // on key down event\n\tfunction onKeyDown(event) {\n\t\tvar evt = event || window.event;\n\t\tvar code = evt.charCode || evt.keyCode;\n\n\t\tself.ctrlKey = evt.ctrlKey;\n\t\tself.shiftKey = evt.shiftKey;\n\n\t\t// keyboard listener?\n\t\tif (focusedCo && focusedCo.onKeyDown) {\n\t\t\tif (!focusedCo.onKeyDown(evt,code)) {\n\t\t\t\t// the event won't go through, prevent\n\t\t\t\tSfera.Browser.preventDefault(evt);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (code == 9) {\n\t\t\t\tif (self.cPage.children.length)\n\t\t\t\t\tfocusFirst(self.cPage,evt.shiftKey); // get first or last\n\t\t\t\t// the event won't go through, prevent\n\t\t\t\tSfera.Browser.preventDefault(evt);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t} // onKeyDown()\n\n\tfunction onKeyPress(event) {\n\t\tvar evt = event || window.event;\n\t\tvar code = evt.charCode || evt.keyCode;\n\n\t\tself.ctrlKey = evt.ctrlKey;\n\t\tself.shiftKey = evt.shiftKey;\n\n\t\t// keyboard listener?\n\t\tif (focusedCo && focusedCo.onKeyPress) {\n\t\t\tif (!focusedCo.onKeyPress(evt,code)) {\n\t\t\t\t// the event won't go through, prevent\n\t\t\t\tSfera.Browser.preventDefault(evt);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t// on key up event\n\tfunction onKeyUp(event) {\n\t\tvar evt = event || window.event;\n\t\tvar code = evt.charCode || evt.keyCode;\n\n\t\tself.ctrlKey = evt.ctrlKey;\n\t\tself.shiftKey = evt.shiftKey;\n\n\t\t// keyboard listener?\n\t\tif (focusedCo && focusedCo.onKeyUp) {\n\t\t\tif (focusedCo.onKeyUp(evt,code)) return true; // the event will go through\n\t\t}\n\n\t\t// the event won't go through, prevent\n\t\tSfera.Browser.preventDefault(evt);\n\t\treturn false;\n\t} // onKeyUp()\n\n\n    ////////////////////////// focus\n    var focusedCo;\n    var blurTimeoutId;\n\n    // set focused component, call onFocus\n    this.setFocused = function(co) {\n        if (focusedCo && focusedCo != co)\n            focusedCo.blur();\n        focusedCo = co;\n        if (blurTimeoutId)\n            clearTimeout(blurTimeoutId);\n        if (!co.noBlurTimeout) // if noBlurTimeout = true, won't start the blur timeout\n            blurTimeoutId = setTimeout(this.focus, 30000); // blur after a while\n    };\n    // clear focused component, call onBlur\n    this.clearFocused = function(co) {\n        if (focusedCo == co)\n            focusedCo = null;\n        if (blurTimeoutId)\n            clearTimeout(blurTimeoutId);\n    };\n\n    // focus client\n    this.focus = function() {\n        if (focusedCo)\n            focusedCo.blur();\n    }; // focusProject()\n\n    function canFocus(co) {\n        return (co != this && co.focus && co.isVisible() && co.isEnabled());\n    }\n\n    // focus first component in container (start from the first or the last)\n    function focusFirst(container, dir) {\n        var l = container.children.length;\n        var co = container.children[dir ? l - 1 : 0];\n        if (co.isVisible()) {\n            if (co.focus && co.isEnabled()) { // found\n                co.focus();\n                return co;\n            } else if (co.children && co.children.length) { // container? look inside\n                return focusFirst(co, dir);\n            }\n        }\n\n        // couldn't focus, keep looking\n        return focusNext(co);\n    } // focusFirstObj()\n\n    function focusNext(co,dir) {\n        var cos = co.parent.children;\n        var oi = -1;\n        var i;\n        var r; // result\n        // search this co index\n        for (i = 0; i < cos.length; i++) {\n            if (cos[i] == co) {\n                oi = i;\n                break;\n            }\n        }\n\n        if (oi == -1) return null; // is it even possible?\n        i = oi; // start from next\n        do {\n            if (dir) {\n                i--;\n                if (i < 0) {\n                    // in a container? check parent\n                    if (co.parent.parent) {\n                        r = focusNext(co.parent, dir);\n                        if (r) return r; // no need to focus again\n                    }\n                    i = cos.length - 1; // restart from last\n                }\n            } else {\n                i++;\n                if (i >= cos.length) {\n                    // in a container? check parent\n                    if (co.parent.parent) {\n                        r = focusNext(co.parent, dir);\n                        if (r) return r; // no need to focus again\n                    }\n                    i = 0; // restart from 0\n                }\n            }\n            // container? go inside\n            if (cos[i].children && cos[i].children.length) {\n                r = focusFirst(cos[i], dir); // get first or last\n                if (r) return r; // no need to focus again\n            }\n            // has focus function? can focus?\n            if (canFocus(cos[i])) {\n                cos[i].focus();\n                return cos[i];\n            }\n        } while (cos[i] != co); // go round once\n        return null; // no next coect found (co wasn't focusable?)\n    }\n\n    this.focusNext = function(dir) {\n        return focusNext(focusedCo,dir);\n    };\n\n};\n\n\n/**\n * Debug obj\n *\n * @class Sfera.Client\n * @constructor\n */\nSfera.Debug = new(function() {\n    var self = this;\n    var logE,\n        debugE;\n\n    // this needs to be done on Device?\n    //\n    document.addEventListener(\"keydown\", keyDown, false);\n\n    this.visible = false;\n\n    this.boot = function() {\n        logE = document.getElementById(\"debugLog\");\n        debugE = document.getElementById(\"debug\");\n        show(false);\n    };\n\n    this.toggle = function() {\n        this.visible = !this.visible;\n        show(this.visible);\n    };\n\n    function show(v) {\n        debugE.style.display = v ? \"block\" : \"none\";\n        if (v)\n            self.initPane();\n    };\n\n    function keyDown(e) {\n        var keyCode = e.keyCode;\n        if (keyCode == 13) {\n            // enter key\n        } else if (event.altKey && event.keyCode >= 65 && event.keyCode <= 90) { // if a letter pressed\n            switch (String.fromCharCode(event.keyCode)) {\n                case \"D\":\n                    self.toggle();\n                    break;\n            }\n        } else {\n\n        }\n        return true;\n    }\n\n    var logCounter = 0;\n    this.log = function(level, title, txt) {\n        if (!logE) return;\n        logCounter++;\n\n        var ds = Sfera.Utils.getDate();\n        title = ds + \" - \" + title;\n\n        var src =\n            '<label class=\"menu_label\" for=\"debugEntry' + logCounter + '\">' +\n            title +\n            '</label>' +\n            '<input type=\"checkbox\" id=\"debugEntry' + logCounter + '\" /><div class=\"arrow\"></div>' +\n            '<ol><li><textarea style=\"width:500px; height:200px\">' +\n            txt +\n            '</textarea></li></ol>';\n\n        var e = document.createElement(\"div\");\n        e.innerHTML = src;\n        logE.appendChild(e);\n    };\n\n    /**\n     * Displays a Sfera version debug header in the console.\n     *\n     * @method Sfera.Client#showDebugHeader\n     * @protected\n     */\n    this.showHeader = function() {\n\n        var v = Sfera.VERSION;\n\n        var c = 2;\n        var a = \"hello\";\n\n        if (Sfera.Device.chrome) {\n            var args = [\n                '%c %c %c Sfera v' + v + ' | ' + a + '  %c %c ' + '%c http://sfera.cc %c\\u2665%c\\u2665%c\\u2665',\n                'background: #9854d8',\n                'background: #6c2ca7',\n                'color: #ffffff; background: #450f78;',\n                'background: #6c2ca7',\n                'background: #9854d8',\n                'background: #ffffff'\n            ];\n\n            for (var i = 0; i < 3; i++) {\n                if (i < c) {\n                    args.push('color: #ff2424; background: #fff');\n                } else {\n                    args.push('color: #959595; background: #fff');\n                }\n            }\n\n            console.log.apply(console, args);\n        } else if (window.console) {\n            console.log('Sfera v' + v + ' | ' + a + ' | http://sferalabs.cc');\n        }\n\n    };\n\n\n\n})();\n\n\n\n\n/////////////////////\nSfera.Debug.initPane = function() {\n    /*\n     * @author https://twitter.com/blurspline / https://github.com/zz85\n     * See post @ http://www.lab4games.net/zz85/blog/2014/11/15/resizing-moving-snapping-windows-with-js-css/\n     */\n\n    // Minimum resizable area\n    var minWidth = 60;\n    var minHeight = 40;\n\n    // Thresholds\n    var FULLSCREEN_MARGINS = -10;\n    var MARGINS = 10;\n\n    // End of what's configurable.\n    var clicked = null;\n    var onRightEdge, onBottomEdge, onLeftEdge, onTopEdge;\n\n    var rightScreenEdge, bottomScreenEdge;\n\n    var preSnapped;\n\n    var b, x, y;\n\n    var redraw = false;\n\n    var pane = document.getElementById('debugPane');\n    var paneTitle = document.getElementById('debugTitle');\n    var ghostpane = document.getElementById('debugGhost');\n\n    paneTitle.style.width = pane.style.width;\n\n    function setBounds(element, x, y, w, h) {\n        element.style.left = x + 'px';\n        element.style.top = y + 'px';\n        element.style.width = w + 'px';\n        element.style.height = h + 'px';\n    }\n\n    function hintHide() {\n        setBounds(ghostpane, b.left, b.top, b.width, b.height);\n        ghostpane.style.opacity = 0;\n\n        // var b = ghostpane.getBoundingClientRect();\n        // ghostpane.style.top = b.top + b.height / 2;\n        // ghostpane.style.left = b.left + b.width / 2;\n        // ghostpane.style.width = 0;\n        // ghostpane.style.height = 0;\n    }\n\n\n    // Mouse events\n    pane.addEventListener('mousedown', onMouseDown);\n    document.addEventListener('mousemove', onMove);\n    document.addEventListener('mouseup', onUp);\n\n    // Touch events\n    pane.addEventListener('touchstart', onTouchDown);\n    document.addEventListener('touchmove', onTouchMove);\n    document.addEventListener('touchend', onTouchEnd);\n\n\n    function onTouchDown(e) {\n        onDown(e.touches[0]);\n        e.preventDefault();\n    }\n\n    function onTouchMove(e) {\n        onMove(e.touches[0]);\n    }\n\n    function onTouchEnd(e) {\n        if (e.touches.length == 0) onUp(e.changedTouches[0]);\n    }\n\n    function onMouseDown(e) {\n        onDown(e);\n        e.preventDefault();\n    }\n\n    function onDown(e) {\n        calc(e);\n\n        var isResizing = onRightEdge || onBottomEdge || onTopEdge || onLeftEdge;\n\n        clicked = {\n            x: x,\n            y: y,\n            cx: e.clientX,\n            cy: e.clientY,\n            w: b.width,\n            h: b.height,\n            isResizing: isResizing,\n            isMoving: !isResizing && canMove(),\n            onTopEdge: onTopEdge,\n            onLeftEdge: onLeftEdge,\n            onRightEdge: onRightEdge,\n            onBottomEdge: onBottomEdge\n        };\n    }\n\n    function canMove() {\n        return x > 0 && x < b.width && y > 0 && y < b.height && y < 30;\n    }\n\n    function calc(e) {\n        b = pane.getBoundingClientRect();\n        x = e.clientX - b.left;\n        y = e.clientY - b.top;\n\n        onTopEdge = y < MARGINS;\n        onLeftEdge = x < MARGINS;\n        onRightEdge = x >= b.width - MARGINS;\n        onBottomEdge = y >= b.height - MARGINS;\n\n        rightScreenEdge = window.innerWidth - MARGINS;\n        bottomScreenEdge = window.innerHeight - MARGINS;\n    }\n\n    var e;\n\n    function onMove(ee) {\n        calc(ee);\n\n        e = ee;\n\n        redraw = true;\n\n    }\n\n    function animate() {\n\n        requestAnimationFrame(animate);\n\n        if (!redraw) return;\n\n        redraw = false;\n\n        if (clicked && clicked.isResizing) {\n\n            if (clicked.onRightEdge) pane.style.width = Math.max(x, minWidth) + 'px';\n            if (clicked.onBottomEdge) pane.style.height = Math.max(y, minHeight) + 'px';\n\n            if (clicked.onLeftEdge) {\n                var currentWidth = Math.max(clicked.cx - e.clientX + clicked.w, minWidth);\n                if (currentWidth > minWidth) {\n                    pane.style.width = currentWidth + 'px';\n                    pane.style.left = e.clientX + 'px';\n                }\n            }\n\n            if (clicked.onTopEdge) {\n                var currentHeight = Math.max(clicked.cy - e.clientY + clicked.h, minHeight);\n                if (currentHeight > minHeight) {\n                    pane.style.height = currentHeight + 'px';\n                    pane.style.top = e.clientY + 'px';\n                }\n            }\n\n            hintHide();\n\n            paneTitle.style.width = pane.style.width;\n\n            return;\n        }\n\n        if (clicked && clicked.isMoving) {\n\n            if (b.top < FULLSCREEN_MARGINS || b.left < FULLSCREEN_MARGINS || b.right > window.innerWidth - FULLSCREEN_MARGINS || b.bottom > window.innerHeight - FULLSCREEN_MARGINS) {\n                // hintFull();\n                setBounds(ghostpane, 0, 0, window.innerWidth, window.innerHeight);\n                ghostpane.style.opacity = 0.2;\n            } else if (b.top < MARGINS) {\n                // hintTop();\n                setBounds(ghostpane, 0, 0, window.innerWidth, window.innerHeight / 2);\n                ghostpane.style.opacity = 0.2;\n            } else if (b.left < MARGINS) {\n                // hintLeft();\n                setBounds(ghostpane, 0, 0, window.innerWidth / 2, window.innerHeight);\n                ghostpane.style.opacity = 0.2;\n            } else if (b.right > rightScreenEdge) {\n                // hintRight();\n                setBounds(ghostpane, window.innerWidth / 2, 0, window.innerWidth / 2, window.innerHeight);\n                ghostpane.style.opacity = 0.2;\n            } else if (b.bottom > bottomScreenEdge) {\n                // hintBottom();\n                setBounds(ghostpane, 0, window.innerHeight / 2, window.innerWidth, window.innerWidth / 2);\n                ghostpane.style.opacity = 0.2;\n            } else {\n                hintHide();\n            }\n\n            if (preSnapped) {\n                setBounds(pane,\n                    e.clientX - preSnapped.width / 2,\n                    e.clientY - Math.min(clicked.y, preSnapped.height),\n                    preSnapped.width,\n                    preSnapped.height\n                );\n\n                paneTitle.style.width = pane.style.width;\n\n                return;\n            }\n\n            // moving\n            pane.style.top = (e.clientY - clicked.y) + 'px';\n            pane.style.left = (e.clientX - clicked.x) + 'px';\n\n            paneTitle.style.width = pane.style.width;\n\n            return;\n        }\n\n        // This code executes when mouse moves without clicking\n\n        // style cursor\n        if (onRightEdge && onBottomEdge || onLeftEdge && onTopEdge) {\n            pane.style.cursor = 'nwse-resize';\n        } else if (onRightEdge && onTopEdge || onBottomEdge && onLeftEdge) {\n            pane.style.cursor = 'nesw-resize';\n        } else if (onRightEdge || onLeftEdge) {\n            pane.style.cursor = 'ew-resize';\n        } else if (onBottomEdge || onTopEdge) {\n            pane.style.cursor = 'ns-resize';\n        } else if (canMove()) {\n            pane.style.cursor = 'move';\n        } else {\n            pane.style.cursor = 'default';\n        }\n    }\n\n    animate();\n\n    function onUp(e) {\n        calc(e);\n\n        if (clicked && clicked.isMoving) {\n            // Snap\n            var snapped = {\n                width: b.width,\n                height: b.height\n            };\n\n            if (b.top < FULLSCREEN_MARGINS || b.left < FULLSCREEN_MARGINS || b.right > window.innerWidth - FULLSCREEN_MARGINS || b.bottom > window.innerHeight - FULLSCREEN_MARGINS) {\n                // hintFull();\n                setBounds(pane, 0, 0, window.innerWidth, window.innerHeight);\n                preSnapped = snapped;\n            } else if (b.top < MARGINS) {\n                // hintTop();\n                setBounds(pane, 0, 0, window.innerWidth, window.innerHeight / 2);\n                preSnapped = snapped;\n            } else if (b.left < MARGINS) {\n                // hintLeft();\n                setBounds(pane, 0, 0, window.innerWidth / 2, window.innerHeight);\n                preSnapped = snapped;\n            } else if (b.right > rightScreenEdge) {\n                // hintRight();\n                setBounds(pane, window.innerWidth / 2, 0, window.innerWidth / 2, window.innerHeight);\n                preSnapped = snapped;\n            } else if (b.bottom > bottomScreenEdge) {\n                // hintBottom();\n                setBounds(pane, 0, window.innerHeight / 2, window.innerWidth, window.innerWidth / 2);\n                preSnapped = snapped;\n            } else {\n                preSnapped = null;\n            }\n\n            hintHide();\n\n        }\n\n        clicked = null;\n\n    }\n};\n\n\n/**\n * Log obj\n *\n * @class Sfera.Log\n * @constructor\n */\nSfera.Log = new(function() {\n\n    // logging levels\n    // ALL < DEBUG < INFO < WARN < ERROR < FATAL < OFF\n    this.ALL = 1;\n    this.DEBUG = 2;\n    this.INFO = 3;\n    this.WARN = 4;\n    this.ERROR = 5;\n    this.FATAL = 6;\n    this.OFF = 7;\n\n    var _level = this.WARN;\n\n    // set the level\n    this.setLevel = function (level) {\n        _level = level;\n    };\n\n})();\n\n\n/**\n * Login obj\n *\n * @class Sfera.Login\n * @constructor\n */\nSfera.Login = new(function() {\n\n    var checkTimeout = null;\n    var checkMs = 500;\n    var req;\n\n    var action = \"\";\n\n    this.login = function (user, password) {\n        if (!req)\n            initReq();\n\n        action = \"login\";\n\n        resetCheck();\n\n        user = user || Sfera.client.getAttribute(\"username\",\"value\");\n        password = password || Sfera.client.getAttribute(\"password\",\"value\");\n\n        req.open(\"/api/login?user=\" + user + \"&password=\" + password, 100);\n    };\n\n    this.logout = function () {\n        if (!req)\n            initReq();\n\n        action = \"logout\";\n\n        req.open(\"/api/logout\", 100);\n    };\n\n    function initReq() {\n        req = new Sfera.Net.Request();\n\n        req.onLoaded = function() {\n            clearTimeout(checkTimeout);\n\n            switch (action) {\n            case \"login\":\n            \twindow.location.replace(\"/\"+Sfera.client.name);\n            \tbreak;\n            case \"logout\":\n                window.location.replace(\"/\"+Sfera.client.name+\"/login\");\n                break;\n            }\n        }\n        req.onError = function() {\n            resetCheck();\n        }\n\n    }\n\n    function checkLogin() {\n        // req.open(\"/api/login\",100);\n    }\n\n    function resetCheck() {\n        clearTimeout(checkTimeout);\n        checkTimeout = setTimeout(checkLogin, checkMs);\n    }\n\n    window.onload = function() {\n        resetCheck(); // start now\n    }\n\n})();\n\n\n/**\n* A Signal is an event dispatch mechanism that supports broadcasting to multiple listeners.\n*\n* Event listeners are uniquely identified by the listener/callback function and the context.\n*\n* @class Sfera.Signal\n* @constructor\n*/\nSfera.Signal = function () {\n};\n\nSfera.Signal.prototype = {\n\n    /**\n    * @property {?Array.<Sfera.SignalBinding>} _bindings - Internal variable.\n    * @private\n    */\n    _bindings: null,\n\n    /**\n    * @property {any} _prevParams - Internal variable.\n    * @private\n    */\n    _prevParams: null,\n\n    /**\n    * Memorize the previously dispatched event?\n    *\n    * If an event has been memorized it is automatically dispatched when a new listener is added with {@link #add} or {@link #addOnce}.\n    * Use {@link #forget} to clear any currently memorized event.\n    *\n    * @property {boolean} memorize\n    */\n    memorize: false,\n\n    /**\n    * @property {boolean} _shouldPropagate\n    * @private\n    */\n    _shouldPropagate: true,\n\n    /**\n    * Is the Signal active? Only active signals will broadcast dispatched events.\n    *\n    * Setting this property during a dispatch will only affect the next dispatch. To stop the propagation of a signal from a listener use {@link #halt}.\n    *\n    * @property {boolean} active\n    * @default\n    */\n    active: true,\n\n    /**\n    * @property {function} _boundDispatch - The bound dispatch function, if any.\n    * @private\n    */\n    _boundDispatch: true,\n\n    /**\n    * @method Sfera.Signal#validateListener\n    * @param {function} listener - Signal handler function.\n    * @param {string} fnName - Function name.\n    * @private\n    */\n    validateListener: function (listener, fnName) {\n\n        if (typeof listener !== 'function')\n        {\n            throw new Error('Sfera.Signal: listener is a required param of {fn}() and should be a Function.'.replace('{fn}', fnName));\n        }\n\n    },\n\n    /**\n    * @method Sfera.Signal#_registerListener\n    * @private\n    * @param {function} listener - Signal handler function.\n    * @param {boolean} isOnce - Should the listener only be called once?\n    * @param {object} [listenerContext] - The context under which the listener is invoked.\n    * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added. (default = 0).\n    * @return {Sfera.SignalBinding} An Object representing the binding between the Signal and listener.\n    */\n    _registerListener: function (listener, isOnce, listenerContext, priority, args) {\n\n        var prevIndex = this._indexOfListener(listener, listenerContext);\n        var binding;\n\n        if (prevIndex !== -1)\n        {\n            binding = this._bindings[prevIndex];\n\n            if (binding.isOnce() !== isOnce)\n            {\n                throw new Error('You cannot add' + (isOnce ? '' : 'Once') + '() then add' + (!isOnce ? '' : 'Once') + '() the same listener without removing the relationship first.');\n            }\n        }\n        else\n        {\n            binding = new Sfera.SignalBinding(this, listener, isOnce, listenerContext, priority, args);\n            this._addBinding(binding);\n        }\n\n        if (this.memorize && this._prevParams)\n        {\n            binding.execute(this._prevParams);\n        }\n\n        return binding;\n\n    },\n\n    /**\n    * @method Sfera.Signal#_addBinding\n    * @private\n    * @param {Sfera.SignalBinding} binding - An Object representing the binding between the Signal and listener.\n    */\n    _addBinding: function (binding) {\n\n        if (!this._bindings)\n        {\n            this._bindings = [];\n        }\n\n        //  Simplified insertion sort\n        var n = this._bindings.length;\n\n        do {\n            n--;\n        }\n        while (this._bindings[n] && binding._priority <= this._bindings[n]._priority);\n\n        this._bindings.splice(n + 1, 0, binding);\n\n    },\n\n    /**\n    * @method Sfera.Signal#_indexOfListener\n    * @private\n    * @param {function} listener - Signal handler function.\n    * @param {object} [context=null] - Signal handler function.\n    * @return {number} The index of the listener within the private bindings array.\n    */\n    _indexOfListener: function (listener, context) {\n\n        if (!this._bindings)\n        {\n            return -1;\n        }\n\n        if (context === undefined) { context = null; }\n\n        var n = this._bindings.length;\n        var cur;\n\n        while (n--)\n        {\n            cur = this._bindings[n];\n\n            if (cur._listener === listener && cur.context === context)\n            {\n                return n;\n            }\n        }\n\n        return -1;\n\n    },\n\n    /**\n    * Check if a specific listener is attached.\n    *\n    * @method Sfera.Signal#has\n    * @param {function} listener - Signal handler function.\n    * @param {object} [context] - Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n    * @return {boolean} If Signal has the specified listener.\n    */\n    has: function (listener, context) {\n\n        return this._indexOfListener(listener, context) !== -1;\n\n    },\n\n    /**\n    * Add an event listener for this signal.\n    *\n    * An event listener is a callback with a related context and priority.\n    *\n    * You can optionally provide extra arguments which will be passed to the callback after any internal parameters.\n    *\n    * For example: `Sfera.Key.onDown` when dispatched will send the Sfera.Key object that caused the signal as the first parameter.\n    * Any arguments you've specified after `priority` will be sent as well:\n    *\n    * `fireButton.onDown.add(shoot, this, 0, 'lazer', 100);`\n    *\n    * When onDown dispatches it will call the `shoot` callback passing it: `Sfera.Key, 'lazer', 100`.\n    *\n    * Where the first parameter is the one that Key.onDown dispatches internally and 'lazer',\n    * and the value 100 were the custom arguments given in the call to 'add'.\n    *\n    * @method Sfera.Signal#add\n    * @param {function} listener - The function to call when this Signal is dispatched.\n    * @param {object} [listenerContext] - The context under which the listener will be executed (i.e. the object that should represent the `this` variable).\n    * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added (default = 0)\n    * @param {...any} [args=(none)] - Additional arguments to pass to the callback (listener) function. They will be appended after any arguments usually dispatched.\n    * @return {Sfera.SignalBinding} An Object representing the binding between the Signal and listener.\n    */\n    add: function (listener, listenerContext, priority) {\n\n        this.validateListener(listener, 'add');\n\n        var args = [];\n\n        if (arguments.length > 3)\n        {\n            for (var i = 3; i < arguments.length; i++)\n            {\n                args.push(arguments[i]);\n            }\n        }\n\n        return this._registerListener(listener, false, listenerContext, priority, args);\n\n    },\n\n    /**\n    * Add a one-time listener - the listener is automatically removed after the first execution.\n    *\n    * If there is as {@link Sfera.Signal#memorize memorized} event then it will be dispatched and\n    * the listener will be removed immediately.\n    *\n    * @method Sfera.Signal#addOnce\n    * @param {function} listener - The function to call when this Signal is dispatched.\n    * @param {object} [listenerContext] - The context under which the listener will be executed (i.e. the object that should represent the `this` variable).\n    * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added (default = 0)\n    * @param {...any} [args=(none)] - Additional arguments to pass to the callback (listener) function. They will be appended after any arguments usually dispatched.\n    * @return {Sfera.SignalBinding} An Object representing the binding between the Signal and listener.\n    */\n    addOnce: function (listener, listenerContext, priority) {\n\n        this.validateListener(listener, 'addOnce');\n\n        var args = [];\n\n        if (arguments.length > 3)\n        {\n            for (var i = 3; i < arguments.length; i++)\n            {\n                args.push(arguments[i]);\n            }\n        }\n\n        return this._registerListener(listener, true, listenerContext, priority, args);\n\n    },\n\n    /**\n    * Remove a single event listener.\n    *\n    * @method Sfera.Signal#remove\n    * @param {function} listener - Handler function that should be removed.\n    * @param {object} [context=null] - Execution context (since you can add the same handler multiple times if executing in a different context).\n    * @return {function} Listener handler function.\n    */\n    remove: function (listener, context) {\n\n        this.validateListener(listener, 'remove');\n\n        var i = this._indexOfListener(listener, context);\n\n        if (i !== -1)\n        {\n            this._bindings[i]._destroy(); //no reason to a Sfera.SignalBinding exist if it isn't attached to a signal\n            this._bindings.splice(i, 1);\n        }\n\n        return listener;\n\n    },\n\n    /**\n    * Remove all event listeners.\n    *\n    * @method Sfera.Signal#removeAll\n    * @param {object} [context=null] - If specified only listeners for the given context will be removed.\n    */\n    removeAll: function (context) {\n\n        if (context === undefined) { context = null; }\n\n        if (!this._bindings)\n        {\n            return;\n        }\n\n        var n = this._bindings.length;\n\n        while (n--)\n        {\n            if (context)\n            {\n                if (this._bindings[n].context === context)\n                {\n                    this._bindings[n]._destroy();\n                    this._bindings.splice(n, 1);\n                }\n            }\n            else\n            {\n                this._bindings[n]._destroy();\n            }\n        }\n\n        if (!context)\n        {\n            this._bindings.length = 0;\n        }\n\n    },\n\n    /**\n    * Gets the total number of listeners attached to this Signal.\n    *\n    * @method Sfera.Signal#getNumListeners\n    * @return {integer} Number of listeners attached to the Signal.\n    */\n    getNumListeners: function () {\n\n        return this._bindings ? this._bindings.length : 0;\n\n    },\n\n    /**\n    * Stop propagation of the event, blocking the dispatch to next listener on the queue.\n    *\n    * This should be called only during event dispatch as calling it before/after dispatch won't affect another broadcast.\n    * See {@link #active} to enable/disable the signal entirely.\n    *\n    * @method Sfera.Signal#halt\n    */\n    halt: function () {\n\n        this._shouldPropagate = false;\n\n    },\n\n    /**\n    * Dispatch / broadcast the event to all listeners.\n    *\n    * To create an instance-bound dispatch for this Signal, use {@link #boundDispatch}.\n    *\n    * @method Sfera.Signal#dispatch\n    * @param {any} [params] - Parameters that should be passed to each handler.\n    */\n    dispatch: function () {\n\n        if (!this.active || !this._bindings)\n        {\n            return;\n        }\n\n        var paramsArr = Array.prototype.slice.call(arguments);\n        var n = this._bindings.length;\n        var bindings;\n\n        if (this.memorize)\n        {\n            this._prevParams = paramsArr;\n        }\n\n        if (!n)\n        {\n            //  Should come after memorize\n            return;\n        }\n\n        bindings = this._bindings.slice(); //clone array in case add/remove items during dispatch\n        this._shouldPropagate = true; //in case `halt` was called before dispatch or during the previous dispatch.\n\n        //execute all callbacks until end of the list or until a callback returns `false` or stops propagation\n        //reverse loop since listeners with higher priority will be added at the end of the list\n        do {\n            n--;\n        }\n        while (bindings[n] && this._shouldPropagate && bindings[n].execute(paramsArr) !== false);\n\n    },\n\n    /**\n    * Forget the currently {@link Sfera.Signal#memorize memorized} event, if any.\n    *\n    * @method Sfera.Signal#forget\n    */\n    forget: function() {\n\n        if (this._prevParams)\n        {\n            this._prevParams = null;\n        }\n\n    },\n\n    /**\n    * Dispose the signal - no more events can be dispatched.\n    *\n    * This removes all event listeners and clears references to external objects.\n    * Calling methods on a disposed objects results in undefined behavior.\n    *\n    * @method Sfera.Signal#dispose\n    */\n    dispose: function () {\n\n        this.removeAll();\n\n        this._bindings = null;\n        if (this._prevParams)\n        {\n            this._prevParams = null;\n        }\n\n    },\n\n    /**\n    * A string representation of the object.\n    *\n    * @method Sfera.Signal#toString\n    * @return {string} String representation of the object.\n    */\n    toString: function () {\n\n        return '[Sfera.Signal active:'+ this.active +' numListeners:'+ this.getNumListeners() +']';\n\n    }\n\n};\n\n/**\n* Create a `dispatch` function that maintains a binding to the original Signal context.\n*\n* Use the resulting value if the dispatch function needs to be passed somewhere\n* or called independently of the Signal object.\n*\n* @memberof Sfera.Signal\n* @property {function} boundDispatch\n*/\nObject.defineProperty(Sfera.Signal.prototype, \"boundDispatch\", {\n\n    get: function () {\n        var _this = this;\n        return this._boundDispatch || (this._boundDispatch = function () {\n            return _this.dispatch.apply(_this, arguments);\n        });\n    }\n\n});\n\nSfera.Signal.prototype.constructor = Sfera.Signal;\n\n\n/**\n* Object that represents a binding between a Signal and a listener function.\n* This is an internal constructor and shouldn't be created directly.\n* Inspired by Joa Ebert AS3 SignalBinding and Robert Penner's Slot classes.\n*\n* @class Sfera.SignalBinding\n* @constructor\n* @param {Sfera.Signal} signal - Reference to Signal object that listener is currently bound to.\n* @param {function} listener - Handler function bound to the signal.\n* @param {boolean} isOnce - If binding should be executed just once.\n* @param {object} [listenerContext=null] - Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n* @param {number} [priority] - The priority level of the event listener. (default = 0).\n* @param {...any} [args=(none)] - Additional arguments to pass to the callback (listener) function. They will be appended after any arguments usually dispatched.\n*/\nSfera.SignalBinding = function (signal, listener, isOnce, listenerContext, priority, args) {\n\n    /**\n    * @property {Sfera.Game} _listener - Handler function bound to the signal.\n    * @private\n    */\n    this._listener = listener;\n\n    if (isOnce)\n    {\n        this._isOnce = true;\n    }\n\n    if (listenerContext != null) /* not null/undefined */\n    {\n        this.context = listenerContext;\n    }\n\n    /**\n    * @property {Sfera.Signal} _signal - Reference to Signal object that listener is currently bound to.\n    * @private\n    */\n    this._signal = signal;\n\n    if (priority)\n    {\n        this._priority = priority;\n    }\n\n    if (args && args.length)\n    {\n        this._args = args;\n    }\n\n};\n\nSfera.SignalBinding.prototype = {\n\n    /**\n    * @property {?object} context - Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n    */\n    context: null,\n\n    /**\n    * @property {boolean} _isOnce - If binding should be executed just once.\n    * @private\n    */\n    _isOnce: false,\n\n    /**\n    * @property {number} _priority - Listener priority.\n    * @private\n    */\n    _priority: 0,\n\n    /**\n    * @property {array} _args - Listener arguments.\n    * @private\n    */\n    _args: null,\n\n    /**\n    * @property {number} callCount - The number of times the handler function has been called.\n    */\n    callCount: 0,\n\n    /**\n    * If binding is active and should be executed.\n    * @property {boolean} active\n    * @default\n    */\n    active: true,\n\n    /**\n    * Default parameters passed to listener during `Signal.dispatch` and `SignalBinding.execute` (curried parameters).\n    * @property {array|null} params\n    * @default\n    */\n    params: null,\n\n    /**\n    * Call listener passing arbitrary parameters.\n    * If binding was added using `Signal.addOnce()` it will be automatically removed from signal dispatch queue, this method is used internally for the signal dispatch.\n    * @method Sfera.SignalBinding#execute\n    * @param {any[]} [paramsArr] - Array of parameters that should be passed to the listener.\n    * @return {any} Value returned by the listener.\n    */\n    execute: function(paramsArr) {\n\n        var handlerReturn, params;\n\n        if (this.active && !!this._listener)\n        {\n            params = this.params ? this.params.concat(paramsArr) : paramsArr;\n\n            if (this._args)\n            {\n                params = params.concat(this._args);\n            }\n\n            handlerReturn = this._listener.apply(this.context, params);\n\n            this.callCount++;\n\n            if (this._isOnce)\n            {\n                this.detach();\n            }\n        }\n\n        return handlerReturn;\n\n    },\n\n    /**\n    * Detach binding from signal.\n    * alias to: @see mySignal.remove(myBinding.getListener());\n    * @method Sfera.SignalBinding#detach\n    * @return {function|null} Handler function bound to the signal or `null` if binding was previously detached.\n    */\n    detach: function () {\n        return this.isBound() ? this._signal.remove(this._listener, this.context) : null;\n    },\n\n    /**\n    * @method Sfera.SignalBinding#isBound\n    * @return {boolean} True if binding is still bound to the signal and has a listener.\n    */\n    isBound: function () {\n        return (!!this._signal && !!this._listener);\n    },\n\n    /**\n    * @method Sfera.SignalBinding#isOnce\n    * @return {boolean} If SignalBinding will only be executed once.\n    */\n    isOnce: function () {\n        return this._isOnce;\n    },\n\n    /**\n    * @method Sfera.SignalBinding#getListener\n    * @return {function} Handler function bound to the signal.\n    */\n    getListener: function () {\n        return this._listener;\n    },\n\n    /**\n    * @method Sfera.SignalBinding#getSignal\n    * @return {Sfera.Signal} Signal that listener is currently bound to.\n    */\n    getSignal: function () {\n        return this._signal;\n    },\n\n    /**\n    * Delete instance properties\n    * @method Sfera.SignalBinding#_destroy\n    * @private\n    */\n    _destroy: function () {\n        delete this._signal;\n        delete this._listener;\n        delete this.context;\n    },\n\n    /**\n    * @method Sfera.SignalBinding#toString\n    * @return {string} String representation of the object.\n    */\n    toString: function () {\n        return '[Sfera.SignalBinding isOnce:' + this._isOnce +', isBound:'+ this.isBound() +', active:' + this.active + ']';\n    }\n\n};\n\nSfera.SignalBinding.prototype.constructor = Sfera.SignalBinding;\n\n\nvar mySingleton = (function () {\n\n  // Instance stores a reference to the Singleton\n  var instance;\n\n  function init() {\n\n    // Singleton\n\n    // Private methods and variables\n    function privateMethod(){\n        consolthis.element.log( \"I am private\" );\n    }\n\n    var privateVariable = \"Im also private\";\n\n    return {\n\n      // Public methods and variables\n      publicMethod: function () {\n        consolthis.element.log( \"The public can see me!\" );\n      },\n\n      publicProperty: \"I am also public\"\n    };\n\n  };\n\n  return {\n\n    // Get the Singleton instance if one exists\n    // or create one if it doesn't\n    getInstance: function () {\n\n      if ( !instance ) {\n        instance = init();\n      }\n\n      return instance;\n    }\n\n  };\n\n})();\n\n// Usage:\n\nvar singleA = mySingleton.getInstance();\n\n\nSfera.UI = new (function(){\n    var pressedBt;\n    var lastButton;\n\n    this.skipButtonEvents = false; // won't fire any button events (ex. while we're dragging)\n    this.overEnabled = true; // mouse over effect enabled?\n    this.buttonFeedbackEnabled = true;\n\n    this.setPressedButton = function(bt) {\n        pressedBt = bt;\n    };\n\n\t// get pressedBt button\n\tthis.getPressedButton = function () {\n\t\treturn pressedBt;\n\t}; // getTouchedButton()\n\n\t// update last button\n\tthis.updateLastButton = function () {\n\t\tlastButton = pressedBt;\n\t}; // getTouchedButton()\n\n    // get last clicked button\n\tthis.getLastButton = function () {\n\t\treturn lastButton;\n\t}; // getLastButton()\n\n    // lift pressed button. bt or currently pressed button if any\n\tthis.liftButton = function (bt) {\n\t\tif (pressedBt && (!bt || bt == pressedBt)) {\n\t\t\tif (pressedBt.data.state) {\n\t\t\t\tpressedBt.data.state = \"\";\n\t\t\t\tpressedBt.updateClass();\n\t\t\t}\n\t\t\t// on lift event?\n\t\t\tif (pressedBt.onLift)\n\t\t\t\tpressedBt.onLift();\n\t\t\tpressedBt = null;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}; // liftButton()\n\n\t// reset button: lifts and clear state (over)\n\tthis.resetButton = function (bt) {\n\t\t// bt is currently pressedBt? otherwise reset the class\n\t\tif (!this.liftButton(bt)) {\n\t\t\tbt.data.state = \"\";\n\t\t\tbt.updateClass();\n\t\t}\n\t};\n\n})();\n\nSfera.UI.Button = function (element, events) {\n    this.element = element;\n    this.element.btObj = this;\n\n    this.initData();\n    if (events)\n        this.initEvents(events);\n};\nSfera.UI.Button.prototype = {\n    // possible button style attributes\n    _attributes: {\n        \"disabled\":0,\n        \"selected\":1,\n        \"pressed\":2,\n        \"checked\":3,\n        \"focused\":4,\n        \"error\":5\n    },\n\n    // linked buttons\n    _linked: null,\n\n    initData: function () {\n        var colors = [\n            \"light\",\n            \"stable\",\n            \"positive\",\n            \"calm\",\n            \"balanced\",\n            \"energized\",\n            \"assertive\",\n            \"royal\",\n            \"dark\"\n        ];\n\n        var cs = this.element.className;\n        var ss = \"(.*\\\\s)?([mc][^\\\\s]*Button)(\\\\s(\"+colors.join(\"|\")+\"))?(\\\\s.*)?(\\\\sover|\\\\sdown)?\"; // search string (button color regexp in includthis.element.js)\n        var rx = new RegExp(ss);\n        var matches = rx.exec(cs);\n\n        // build obj. pre, button class, attributes (binary string based on\n        if (!matches || !matches[2]) // should this happen?\n            var obj = {pre:cs, bc:\"\", color:\"\", attrs:[], state:\"\"};\n        else\n            var obj = {pre:matches[1]?matches[1]:\"\",\n                        bc:matches[2],\n                        color:matches[4]?matches[4]:\"\", // r,g,b..\n                        attrs:[],\n                        state:matches[6]?matches[6].substr(1):\"\"}; // ,over,down\n        // attributes\n        for (var a in this._attributes)\n            obj.attrs[this._attributes[a]] = (matches && matches[5])?matches[5].indexOf(\" \"+a)!=-1:false;\n\n        this.data = obj;\n        this.onLift = null;\n        this.dontLiftOnMove = false;\n    },\n\n    // button class:\n\t//  [...] [cm][...]Button [color]? [any button attribute] [state] [...]\n\n\t// init button events. f is an object containing all events, options?\n\tinitEvents: function (f) {\n\t\tif (f.onclick) // default action is on up\n\t\t\tf.onup = f.onclick;\n\n\t\tif (Sfera.Device.touch) {\n            this.element.ontouchstart = this.onEvent.bind(this,'touchstart',f.ondown,null);\n            this.element.ontouchmove = this.onEvent.bind(this,'touchmove',f.onmove,f.onout);\n            this.element.ontouchend = this.onEvent.bind(this,'touchend',f.onup,null);\n\t\t} else {\n            this.element.onmouseover = this.onEvent.bind(this,'mouseover',f.onover,null);\n\t\t\tthis.element.onmouseout = this.onEvent.bind(this,'mouseout',f.onout,null);\n\t\t\tif (f.onmove)\n\t\t\t\tthis.element.onmousemove = this.onEvent.bind(this,'mousemove',f.onmove,null);\n\t\t\tthis.element.onmousedown = this.onEvent.bind(this,'mousedown',f.ondown,null);\n\t\t\tthis.element.onmouseup = this.onEvent.bind(this,'mouseup',f.onup,null);\n\t\t}\n\n\t\t// on lift? when button is lifted with liftButton() (ex. when scrolling)\n\t\tif (f.onlift)\n\t\t\tthis.onLift = f.onlift;\n\t\t// temporary (???) solution for divs that require drag for more than n pixels\n\t\tif (f.dontLiftOnMove)\n\t\t\tthis.dontLiftOnMove = true;\n\t\tvar d;\n\t\t//for (var i = 0; (d = this.element.getElementsByTagName(\"img\")[i]); i++) initImg(d);\n\t}, // initButtonEvents()\n\n\t// clear button events\n\tclearEvents: function () {\n\t\tif (Sfera.Device.touch) {\n\t\t\tdelete this.element.ontouchstart;\n\t\t\tdelete this.element.ontouchmove;\n\t\t\tdelete this.element.ontouchend;\n\t\t} else {\n\t\t\tdelete this.element.onmouseover;\n\t\t\tdelete this.element.onmouseout;\n\t\t\tdelete this.element.onmousedown;\n\t\t\tdelete this.element.onmouseup;\n\t\t}\n\t}, // clearButtonEvents()\n\n    // link other buttons, so events are shared. call only on one button\n    link: function (button) {\n        if (!this._linked)\n            this._linked = [];\n        if (!button._linked)\n            button._linked = [];\n\n        this._linked.push(button);\n        button._linked.push(this);\n    },\n\n\t// set button color\n\tsetColor: function (c) {\n\t\tthis.data.color = c;\n\t\tthis.updateClass(); // update class based on this.data\n\t}, // setButtonColor()\n\n\t// enabled/disabled button\n\tenable: function (enable) {\n\t\tthis.setAttribute(this.element, \"disabled\", !enable);\n\t}, // enableButton()\n\n\t// select/deselect button\n\tselect: function (select) {\n\t\tthis.setAttribute(this.element, \"selected\", select);\n\t}, // selectButton()\n\n\t// set mini mode\n\tmini: function (mini) {\n\t\tthis.setAttribute(this.element, \"mini\", mini);\n\t}, // miniButton()\n\n\t// get button style attribute\n\tgetAttribute: function (attrName) {\n\t\tif (!this.data)\n            this.initData(); // can happen when events are assigned manually\n\t\treturn this.data.attrs[this._attributes[attrName]];\n\t}, // getButtonAttribute()\n\n\t// set button style attributthis.element. name and value (true or false)\n    setAttribute: function (attrName,attrValue) {\n\t\tif (this.getAttribute(attrName) != attrValue) {\n\t\t\tthis.data.attrs[this._attributes[attrName]] = attrValue;\n\t\t\tthis.updateClass(); // update class based on this.data\n\t\t}\n\t}, // setButtonAttribute()\n\n\t// update button class from its btObj\n\tupdateClass: function () {\n\t\tvar d = this.data;\n\t\tvar c = d.pre+d.bc\n\t\tif (d.color)\n\t\t\tc += \" \"+d.color;\n\t\tfor (var a in this._attributes)\n\t\t\tif (d.attrs[this._attributes[a]])\n\t\t\t\tc += \" \"+a;\n\t\tif (Sfera.UI.buttonFeedbackEnabled && d.state)\n\t\t\tc += \" \"+d.state;\n\t\tthis.element.className = c;\n\t},\n\n    // set class name, used when base class name changes\n    setClassName: function (name) {\n        this.data.pre = name;\n        this.updateClass();\n    },\n\n\tdisableAndroidLongPress: function (evt,e) {\n\t\tif (Sfera.Device.android) {\n\t\t\tvar d = e;\n\t\t\twhile (d) {\n\t\t\t\tif (d.getAttribute && d.getAttribute(\"data-scrollmode\")) return; // scrollable, don't disable the long press\n\t\t\t\td = d.parentNode;\n\t\t\t}\n\t\t\tevt.preventDefault && evt.preventDefault();\n\t\t\tevt.stopPropagation && evt.stopPropagation();\n\t\t\tevt.cancelBubble = true;\n\t\t\tevt.returnValue = false;\n\t\t}\n\t},\n\n    // prevent default event\n    preventDefault: function (evt) {\n        if (evt.returnValue)\n            evt.returnValue = false;\n        if (evt.preventDefault)\n            evt.preventDefault();\n    },\n\n\t// generic button event. graphic feedback and function associated to the event. f can be a string or a function(event,e). of is an additional optional function (user on touchmove for onout). clt: cancel long touch on android devices when clicking on an image\n\tonEvent: function (w,f,of,event) {\n        if (Sfera.UI.skipButtonEvents) return;\n\n\t\t// event\n\t\tvar evt = window.event || event;\n\n\t\t// touchevents or not?\n\t\tif (w == \"touchstart\" || w == \"touchend\" || w == \"touchmove\") {\n\t\t\tif (!Sfera.Device.touch) return false;\n\t\t} else {\n\t\t\tif (evt)\n\t\t\t\tthis.preventDefault(evt);\n\t\t\tif (Sfera.Device.touch) return false;\n\t\t}\n\n        // can happen when events are assigned manually\n\t\tif (!this.data)\n            this.initData();\n\n\t\tvar swi = this.data.attrs[this._attributes[\"switch\"]]; // behave like a switch?\n\t\tvar swip = swi?this.data.attrs[this._attributes[\"pressed\"]]:false; // switch pressed\n\t\tvar nswip = swip; // new switch pressed value, to notice if it changes\n\n\t\tvar s = \"\"; // class to add, down/over (only if not disabled)\n\t\tif (!this.data.attrs[this._attributes[\"disabled\"]]) switch (w) {\n\t\tcase \"touchstart\":\n\t\t\tSfera.UI.setPressedButton(this);\n\t\t\tlastButton = null;\n\t\t\ttouchStartX = evt.touches[0].clientX;\n\t\t\ttouchStartY = evt.touches[0].clientY;\n\t\t\ts = \"down\";\n\t\t\tif (swi) nswip = !swip;\n\t\t\tthis.disableAndroidLongPress(evt,this.element);\n\t\t\tbreak;\n\t\tcase \"touchmove\":\n\t\t\tif (Sfera.UI.getPressedButton() == this) {\n\t\t\t\ts = \"down\";\n\t\t\t\tif (!this.dontLiftOnMove && // temporary (?) solution for divs that require drag for more than 40px\n\t\t\t\t\t(Math.abs(evt.touches[0].clientX - touchStartX) > 30 ||\n\t\t\t\t\t Math.abs(evt.touches[0].clientY - touchStartY) > 30)) {\n\t\t\t\t\t  Sfera.UI.setPressedButton(null);\n\t\t\t\t\t  f = of; // execute optional function if any\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.disableAndroidLongPress(evt,this.element);\n\t\t\tbreak;\n\t\tcase \"touchend\":\n\t\t\tif (Sfera.UI.getPressedButton() != this) {\n\t\t\t\tf = null; // won't execute the function\n\t\t\t} else {\n\t\t\t\tSfera.UI.updateLastButton(); // store it\n\t\t\t\tthis.preventDefault(evt);\n\t\t\t}\n\t\t\tSfera.UI.setPressedButton(null);\n\t\t\tthis.disableAndroidLongPress(evt,this.element);\n\t\t\tbreak;\n\t\tcase \"mouseover\":\n            var pressedBt = Sfera.UI.getPressedButton();\n\t\t\tif (pressedBt) {\n\t\t\t\tif (pressedBt == this.element)\n\t\t\t\t\ts = \"down\";\n\t\t\t} else if (Sfera.UI.overEnabled) s = \"over\"; // over only on manager\n\t\t\tbreak;\n\t\tcase \"mousemove\":\n            if (Sfera.UI.overEnabled) s = \"over\";\n\t\t\tbreak;\n\t\tcase \"mouseout\":\n\t\t\t// if we're still on the same div, do nothing\n\t\t\tvar reltg;\n\t\t\tif (evt) // no evt if we're calling onEvent from code (like Login, on keydown)\n\t\t\t\treltg = (evt.relatedTarget) ? evt.relatedTarget : evt.toElement;\n\t\t\tif (reltg) {\n\t\t\t\twhile (reltg && reltg != this.element && reltg.nodeName != 'BODY')\n\t\t\t\t\treltg = reltg.parentNode;\n\t\t\t\tif (reltg == this.element) return;\n\t\t\t}\n\t\t\tSfera.UI.setPressedButton(null);\n\t\t\tbreak;\n\t\tcase \"mousedown\":\n\t\t\tSfera.UI.setPressedButton(this);\n\t\t\tlastButton = null;\n\t\t\ts = \"down\";\n\t\t\tif (swi) nswip = !swip;\n\t\t\tbreak;\n\t\tcase \"mouseup\":\n\t\t\tif (Sfera.UI.getPressedButton() != this) {\n\t\t\t\tf = null; // won't execute the function\n\t\t\t} else {\n                Sfera.UI.updateLastButton()\n\t\t\t}\n            Sfera.UI.setPressedButton(null);\n\t\t\tif (Sfera.UI.overEnabled)\n\t\t\t\ts = \"over\"; // over only on manager\n\t\t\tbreak;\n\t\t}\n\n\t\t// update class based on this.data\n\t\tif (s != this.data.state || nswip != swip) {\n\t\t\tthis.data.state = s;\n\t\t\tif (swi)\n\t\t\t\tthis.data.attrs[this._attributes[\"pressed\"]] = nswip;\n\t\t\tthis.updateClass();\n\n            if (this._linked) {\n                for (var i=0; i<this._linked.length; i++) {\n                    if (s != this._linked[i].data.state) {\n                        this._linked[i].data.state = s;\n                        this._linked[i].updateClass();\n                    }\n                }\n            }\n\t\t}\n\n\t\t// function\n\t\tif (f && f!=\"null\" && !this.data.attrs[this._attributes[\"disabled\"]]) {\n\t\t\t// if f is a string, create a new function, otherwise just call it with (event,this.element)\n\t\t\tvar func = (typeof(f) == \"string\")?new Function(\"event\",\"element\",f):f;\n\t\t\tfunc(event,this.element);\n\t\t}\n\n\t\t// don't prevent default to allow scrolling\n\t\treturn false;\n\t} // onEvent()\n};\n\n\n/**\n * Sfera.Net handles browser URL related tasks such as checking host names, domain names and query string manipulation.\n *\n * @class Sfera.Net\n * @constructor\n */\nSfera.Net = new (function() {\n    // getURL function\n    this.getURL = function(name) {\n    \tswitch (name) {\n    \tcase \"dictionary\":  return Sfera.client.name+(Sfera.client.isLogin?\"/login\":\"\")+\"/dictionary.xml\";\n    \tcase \"index\" :      return Sfera.client.name+(Sfera.client.isLogin?\"/login\":\"\")+\"/index.xml\";\n    \tcase \"subscribe\" :  return \"subscribe?id=\"+(Sfera.Net.subscribeId?Sfera.Net.subscribeId:\"\");\n    \tcase \"state\" :      return \"state/\"+Sfera.Net.subscribeId+\"?ts=\"+Sfera.client.stateTs;\n        case \"command\":     return \"command\";\n        case \"event\":       return \"event\";\n        case \"websocket\":   return (Sfera.Browser.getLocation().protocol == \"https:\" ? \"wss:\" : \"ws:\")+\n                                    \"//\"+Sfera.Browser.getLocation().host+\"/api/websocket\";\n        }\n\t};\n\n    var _defaultConfig = {\n        //name: Sfera.Browser.getLocation().interface,\n\n        /** Whether this instance should log debug messages. */\n        enableDebug: true,\n\n        /** Whether or not the websocket should attempt to connect immediately upon instantiation. */\n        automaticOpen: true,\n\n        /** The number of milliseconds to delay before attempting to reconnect. */\n        reconnectInterval: 1000,\n        /** The maximum number of milliseconds to delay a reconnection attempt. */\n        maxReconnectInterval: 30000,\n        /** The rate of increase of the reconnect delay. Allows reconnect attempts to back off when problems persist. */\n        reconnectDecay: 1.5,\n\n        /** The maximum time in milliseconds to wait for a connection to succeed before closing and retrying. */\n        timeoutInterval: 2000,\n\n        /** The maximum number of reconnection attempts to make. Unlimited if null. */\n        maxReconnectAttempts: null\n    };\n\n\n    var req;\n\n    var webSocket;\n    var wsConnected = false;\n\n    var self = this;\n    var httpBaseUrl = \"/\";\n\n    var connectionId;\n    var pingInterval;\n    var responseTimeout;\n    var connCheckTimeoutId;\n\n    var cSync = \"\"; // currently synchronizing resource\n\n    var self = this;\n\n    this.stateTs = -1;\n    this.subscribed = false; // change this\n\n    // local timestamps, to check required updates\n    this.localTs = {\n        \"dictionary\": -1,\n        \"index\": -1\n    };\n\n    this.remoteTs = {\n        \"dictionary\": -1,\n        \"index\": -1\n    };\n\n    // signals\n    this.onMessage = new Sfera.Signal();\n    this.onEvent = new Sfera.Signal();\n    this.onReply = new Sfera.Signal();\n    this.onUpdateDictionary = new Sfera.Signal();\n    this.onUpdateIndex = new Sfera.Signal();\n\n    function onWsOpen(event) {\n        // For reasons I can't determine, onopen gets called twice\n        // and the first time event.data is undefined.\n        // Leave a comment if you know the answer.\n        if (event.data === undefined)\n            return;\n\n        Sfera.Debug.log(Sfera.Utils.getDate(\"hisu\") + \" - websocket: open, sending subscribe\", event.data);\n\n        //self.wsSend(\"hello\");\n        self.wsSend(self.getURL(\"subscribe\")+\"&nodes=*\");\n    }\n\n    function onWsMessage(event) {\n        console.log(Sfera.Utils.getDate(\"hisu\") + \" - received: \" + event.data);\n\n        // ping\n        if (event.data == \"&\") {\n            resetConnCheckTimeout();\n            self.wsSend(\"&\");\n        } else {\n            self.onMessage.dispatch(event.data);\n            Sfera.Debug.log(\"websocket: onmessage\", event.data);\n            json = JSON.parse(event.data);\n\n            // {\"type\":\"event\",\"events\":{\"remote.myvalue\":\"5\",\"system.plugins\":\"reload\",\"remote.\":\"undefined\",\"system.state\":\"ready\"}}\n            switch (json.type) {\n                case \"reply\":\n                    self.onReply.dispatch(json);\n                    break;\n                case \"connection\":\n                    connectionId = json.connectionId;\n                    pingInterval = parseInt(json.pingInterval);\n                    responseTimeout = parseInt(json.responseTimeout);\n\n                    resetConnCheckTimeout();\n                    var tag = (new Date()).getTime(); // request id\n                    var r = {\n                        action: \"subscribe\",\n                        nodes: \"*\",\n                        tag: tag\n                    };\n\n                    self.wsSend(JSON.stringify(r));\n                    wsConnected = true;\n                    break;\n                case \"event\":\n                    self.onEvent.dispatch(json);\n                    break;\n            }\n        }\n    }\n\n    function onWsError(event) {\n        console.log(\"here\", event);\n        self.wsOpen (); // reopen\n    }\n\n    function getWsCloseReason(code) {\n        // See http://tools.ietf.org/html/rfc6455#section-7.4.1\n        switch (code) {\n            case 1000:\n                return  \"Normal closure, meaning that the purpose for which the connection was established has been fulfilled.\";\n            case 1001:\n                return  \"An endpoint is \\\"going away\\\", such as a server going down or a browser having navigated away from a page.\";\n            case 1002:\n                return  \"An endpoint is terminating the connection due to a protocol error\";\n            case 1003:\n                return  \"An endpoint is terminating the connection because it has received a type of data it cannot accept (e.g., an endpoint that understands only text data MAY send this if it receives a binary message).\";\n            case 1004:\n                return  \"Reserved. The specific meaning might be defined in the future.\";\n            case 1005:\n                return  \"No status code was actually present.\";\n            case 1006:\n                return  \"The connection was closed abnormally, e.g., without sending or receiving a Close control frame\";\n            case 1007:\n                return  \"An endpoint is terminating the connection because it has received data within a message that was not consistent with the type of the message (e.g., non-UTF-8 [http://tools.ietf.org/html/rfc3629] data within a text message).\";\n            case 1008:\n                return  \"An endpoint is terminating the connection because it has received a message that \\\"violates its policy\\\". This reason is given either if there is no other sutible reason, or if there is a need to hide specific details about the policy.\";\n            case 1009:\n                return  \"An endpoint is terminating the connection because it has received a message that is too big for it to process.\";\n            case 1010:  // Note that this status code is not used by the server, because it can fail the WebSocket handshake instead.\n                return  \"An endpoint (client) is terminating the connection because it has expected the server to negotiate one or more extension, but the server didn't return them in the response message of the WebSocket handshake. <br /> Specifically, the extensions that are needed are: \" + event.reason;\n            case 1011:\n                return  \"A server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request.\";\n            case 1015:\n                return  \"The connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified).\";\n        }\n        return  \"Unknown reason\";\n    }\n\n    function onWsClose(event) {\n        var reason;\n\n        wsConnected = false;\n        self.wsOpen (); // reopen\n\n        reason = event.code + \" - \" + getWsCloseReason(event.code);\n        Sfera.Debug.log(Sfera.Utils.getDate(\"hisu\") + \" - web socket: connection closed\", reason);\n    }\n\n    // public methods\n    this.wsOpen  = function() {\n        var url = self.getURL(\"websocket\");\n\n        console.log(Sfera.Utils.getDate(\"hisu\") + \" - opening socket on \" + url);\n        // ensure only one connection is open at a time\n        if (webSocket !== undefined && webSocket.readyState !== WebSocket.CLOSED) {\n            Sfera.Debug.log(Sfera.Utils.getDate() + \" - websocket: is already opened.\");\n            return;\n        }\n        // create a new instance of the websocket\n        if (connectionId != null)\n            url += \"?cid=\"+connectionId;\n        webSocket = new WebSocket(url);\n\n        // associate events\n        webSocket.onopen = onWsOpen;\n        webSocket.onmessage = onWsMessage;\n        webSocket.onclose = onWsClose;\n        webSocket.onerror = onWsError;\n    }\n    this.wsSend = function(txt) {\n        console.log(Sfera.Utils.getDate(\"hisu\") + \" - sending:  \" + txt);\n        webSocket.send(txt);\n    }\n    this.wsClose = function() {\n        webSocket.close();\n    }\n\n\n    function resetConnCheckTimeout() {\n        clearTimeout(connCheckTimeoutId);\n        setTimeout(this.wsClose, pingInterval + responseTimeout);\n    }\n    // get current timestamp\n    function getTimestamp() {\n        return (new Date()).getTime();\n    }\n\n    // connect\n    this.connect = function() {\n        if (!req) {\n            req = new Sfera.Net.Request()\n            req.onLoaded = onReqLoaded;\n            req.onError = onReqError;\n        }\n\n        this.sync();\n    }; // connect()\n\n    // sync, if necessary\n    this.sync = function() {\n        for (var s in this.localTs) {\n            if (this.localTs[s] == -1) { // || this.localTs[s] < this.remoteTs[s]) {\n                cSync = s;\n                req.open(httpBaseUrl + self.getURL(s), 20);\n                return; // one resource per time\n            }\n        }\n\n        // use websockets?\n        if (true) {\n            self.wsOpen ();\n            return;\n        }\n\n        if (!this.subscribed) {\n            cSync = \"subscribe\";\n\n            req.open(urls.get(\"subscribe\"));\n            return;\n        }\n\n        cSync = \"state\";\n        req.open(httpBaseUrl + urls.get(\"state\"));\n    };\n\n    function onReqLoaded() {\n        console.log(cSync + \" loaded\");\n        Sfera.Debug.log(\"xmlreq: loaded\", req.getResponseText());\n\n        if (self.localTs[cSync] != null)\n            self.localTs[cSync] = getTimestamp();\n\n        var state;\n\n        switch (cSync) {\n            case \"dictionary\":\n                console.log(\"loaded dictionary\");\n                self.onUpdateDictionary.dispatch(req.getResponseXML())\n                break;\n            case \"index\":\n                console.log(\"loaded index\");\n                self.onUpdateIndex.dispatch(req.getResponseXML());\n                break;\n\n            case \"subscribe\":\n                self.subscribed = true;\n\n            case \"state\":\n                state = JSON.parse(req.getResponseText());\n                if (state.timestamp)\n                    self.stateTs = state.timestamp;\n                break;\n        }\n\n        self.sync();\n    }\n\n    function onReqError() {\n        console.log(\"error\");\n        //var e = document.getElementById(\"output\");\n        //e.innerHTML += \"<br><br>Error.<br><br>\";\n    }\n\n    /**\n     * Returns the hostname given by the browser.\n     *\n     * @method Sfera.Net#getHostName\n     * @return {string}\n     */\n    this.getHostName = function() {\n\n        if (window.location && window.location.hostname) {\n            return window.location.hostname;\n        }\n\n        return null;\n    };\n\n    this.sendCommand = function(req) {\n        //this.wsSend(self.getURL(\"command\")+\"?id=\"+id+\"&\"+command);\n\n        var r = {\n            action: \"command\",\n            cmd: req.command,\n            tag: req.tag\n        };\n        this.wsSend(JSON.stringify(r));\n    };\n\n    this.sendEvent = function(req) {\n        //    this.wsSend(self.getURL(\"event\")+\"?id=\"+id+\"&\"+event);\n\n        var r = {\n            action: \"event\",\n            id: req.id,\n            value: req.value,\n            tag: req.tag\n        };\n        this.wsSend(JSON.stringify(r));\n\n    };\n\n})();\n\n\nSfera.Net = Sfera.Net || {};\n/**\n * Request class\n * @constructor\n */\nSfera.Net.Request = function () {\n\tvar req = null; // request\n\n\tvar status; // -1: aborted, 0: ready, 1:loading, 2:loaded\n\n\tvar reqTimeout = null; // trigger timeout\n\tthis.url = \"\";\n\n\t// custom event handlers\n\tthis.onLoaded = null; // needed\n\tthis.onStop = null; // when request is stopped. called with true if loading, false if reqTimeout\n\tthis.onRetry = null; // before retrying on error\n\tthis.onError = null; // any error not captured by custom error handlers\n\tthis.onRequest = null; // when sending request\n\n\t// custom error handlers\n\tthis.onConnectionError = null; // connection error\n\tthis.onUnauthorized = null; //\n\n\tthis.maxWaitingTime = 0; // 0 nothing, msec to wait for an answer, else abort\n\tvar waitTimeout = null; // abort after maxWaitingTime\n\n\tthis.retryOnErrorDelay = 0; // retry delay msec (on any error), 0 does not retry\n\tthis.maxRetries = 0; // max n of retries. after that, stops and fires onError event(s). if maxRetries is 0, custom onError event is never fired\n\tthis.retries = 0; // current retry attempt\n\n\tvar foo = this; // variable scope\n\n\t// errors\n\tthis.ERROR_GENERAL = 0;\n\tthis.ERROR_CONNECTION = 1;\n\tthis.ERROR_MAXWAITTIME = 2;\n\tthis.ERROR_UNAUTHORIZED = 401;\n\tthis.ERROR_FORBIDDEN = 403;\n\tthis.ERROR_NOT_FOUND = 404;\n\n\tthis.init = function () {\n\t\tstatus = 0; // ready\n\t\t// init req\n\t\tif (window.XMLHttpRequest) {\n\t\t\treq = new XMLHttpRequest();\n\t\t\treq.onreadystatechange = onReadyStateChange;\n\t\t\t// branch for IE/Windows ActiveX version\n\t\t} else if (window.ActiveXObject) {\n\t\t\treq = new ActiveXObject(\"Microsoft.XMLHTTP\");\n\t\t\tif (req) {\n\t\t\t\treq.onreadystatechange = onReadyStateChange;\n\t\t\t}\n\t\t}\n\t}\n\n\t// open url. url optional (no url:repeat). ms optional (ms:delay request)\n\tthis.open = function (url, ms) {\n\t\tif (status == 1) // loading?\n\t\t\tfoo.stop();\n\t\tstatus = 0; // ready\n\t\tif (url) { // no url? repeat last one stored\n\t\t\tfoo.url = url;\n\t\t\tfoo.retries = 0; // reset retries\n\t\t}\n\t\tif (reqTimeout) {\n\t\t\tclearTimeout(reqTimeout);\n\t\t\treqTimeout = null;\n\t\t}\n\t\tif (waitTimeout) {\n\t\t\tclearTimeout(waitTimeout);\n\t\t\twaitTimeout = null;\n\t\t}\n\t\tif (ms) {\n\t\t\treqTimeout = setTimeout(foo.open, ms);\n\t\t\treturn;\n\t\t}\n\t\tif (!req) foo.init();\n\t\tstatus = 1; // loading\n\t\tif (foo.onRequest)\n\t\t\tfoo.onRequest();\n\t\ttry {\n\t\t\treq.open(\"GET\", foo.url, true);\n\t\t} catch (err) {\n\t\t\t// If document is not fully active, throw an \"InvalidStateError\" exception and terminate the overall set of steps.\n\t\t\t// URL relative to base. If the algorithm returns an error, throw a \"SyntaxError\" exception and terminate these steps.\n\t\t\tonError(foo.ERROR_GENERAL);\n\t\t\treturn;\n\t\t}\n\t\treq.send();\n\n\t\t// wait timeout\n\t\tif (foo.maxWaitingTime) {\n\t\t\twaitTimeout = setTimeout(onWaitTimeout, foo.maxWaitingTime);\n\t\t}\n\t}\n\n\tthis.stop = function () {\n\t\t// on stop handler if loading, or about to load\n\t\tif (status == 1 || reqTimeout) {\n\t\t\tif (this.onStop)\n\t\t\t\tthis.onStop(status == 1);\n\t\t}\n\t\tif (status == 1) { // loading\n\t\t\tstatus = -1; // stopped\n\t\t\treq.abort(); // will fire onReadyStateChange, status != 1, returns\n\t\t\tthis.init(); // reinitialize req every time we abort\n\t\t}\n\t\tif (reqTimeout) {\n\t\t\tclearTimeout(reqTimeout);\n\t\t\treqTimeout = null;\n\t\t}\n\t\tif (waitTimeout) {\n\t\t\tclearTimeout(waitTimeout);\n\t\t\twaitTimeout = null;\n\t\t}\n\t\tstatus = 0; // ready\n\t}\n\n\t// repeat. ms delay before repeating\n\tthis.repeat = function (ms) {\n\t\tthis.open(null, ms);\n\t}\n\n\tfunction onWaitTimeout() {\n\t\tif (waitTimeout) {\n\t\t\tclearTimeout(waitTimeout);\n\t\t\twaitTimeout = null;\n\t\t}\n\t\tstatus = -1; // aborted\n\t\treq.abort(); // will fire onReadyStateChange, status != 1, returns\n\t\tonError(foo.ERROR_MAXWAITTIME);\n\t\tfoo.init(); // reinitialize req every time we abort\n\t}\n\n\tfunction onReadyStateChange() {\n\t\t// check readyState\n\t\tif (req.readyState == null) return; // does it ever happen?\n\t\tswitch (req.readyState) {\n\t\tcase 0: // unsent\n\t\tcase 1: // open called, send not called\n\t\t\t//foo.open(); // retry?\n\t\t\treturn;\n\t\tcase 2: // headers received, still receiving\n\t\tcase 3: // loading\n\t\t\treturn; // not ready\n\t\tcase 4: // done, completed or error\n\t\t\t// continue\n\t\t}\n\n\t\tif (waitTimeout) {\n\t\t\tclearTimeout(waitTimeout);\n\t\t\twaitTimeout = null;\n\t\t}\n\n\t\t// loading? (if aborted it's -1)\n\t\tif (status != 1) return;\n\t\tstatus = 2;\n\n\t\t// not \"OK\"\n\t\tif (req.status != 200) {\n\t\t\tonError(req.status);\n\t\t\treturn;\n\t\t}\n\n\t\t// get response text\n\t\tvar res = \"\";\n\t\ttry {\n\t\t\tres = req.responseText;\n\t\t} catch (err) {\n\t\t\t// If responseType is not the empty string or \"text\", throw an \"InvalidStateError\" exception.\n\t\t\tonError(foo.ERROR_GENERAL);\n\t\t\treturn;\n\t\t}\n\n\t\tif (foo.onLoaded) foo.onLoaded(foo);\n\t}\n\n\t// on error. called for every error (but not on stop > abort)\n\tfunction onError(errCode) {\n\t\t// specific errors, if there's a custom handler it won't repeat automatically\n\t\tswitch (errCode) {\n\t\tcase foo.ERROR_UNAUTHORIZED:\n\t\t\tif (foo.onUnauthorized) {\n\t\t\t\tfoo.onUnauthorized();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tif (errCode >= 400 && foo.onConnectionError) {\n\t\t\tfoo.onConnectionError();\n\t\t\treturn;\n\t\t}\n\t\t// repeat?\n\t\tif (foo.retryOnErrorDelay) {\n\t\t\tif (!foo.maxRetries || foo.retries < foo.maxRetries) {\n\t\t\t\tfoo.retries++;\n\t\t\t\tif (foo.onRetry) // before repeating, so we can change the retryOnErrorDelay\n\t\t\t\t\tfoo.onRetry();\n\t\t\t\tif (foo.retryOnErrorDelay) {// could be changed by onRetry\n\t\t\t\t\tfoo.repeat(foo.retryOnErrorDelay);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// no custom handlers, no (more) retries. generic error callback\n\t\tif (foo.onError)\n\t\t\tfoo.onError(errCode);\n\t}\n\n\t// json getter\n\tthis.getResponseJSON = function () {\n\t\tvar res = this.getResponseText();\n\t\tif (res)\n\t\t\treturn JSON.parse(res);\n\t\telse\n\t\t\treturn null;\n\t}\n\n\t// text getter\n\tthis.getResponseText = function () {\n\t\tvar res = \"\";\n\t\ttry {\n\t\t\tres = req.responseText;\n\t\t\treturn res;\n\t\t} catch (err) { // If responseType is not the empty string or \"text\", throw an \"InvalidStateError\" exception.\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t// xml getter\n\tthis.getResponseXML = function () {\n\t\tvar res = \"\";\n\t\ttry {\n\t\t\tres = req.responseXML;\n\t\t\treturn res;\n\t\t} catch (err) { // If responseType is not the empty string or \"document\", throw an \"InvalidStateError\" exception.\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t// is loading?\n\tthis.isReady = function () {\n\t\treturn status != 1;\n\t}\n};\n\n\n/**\n* Sfera.Skins contains and handles skins\n*\n* @class Sfera.Skins\n* @constructor\n* @param {Sfera.Client} client - A reference to the current client.\n*/\nSfera.Skins = function (client) {\n\n    this.client = client;\n\n};\n\n\n/**\n * Browser singleton\n */\nSfera.Browser = new (function() {\n    var location;\n\n    this.reload = function() {\n        window.location.reload();\n    };\n    \n    // prevent default event\n\tthis.preventDefault = function (evt) {\n\t\tif (evt.returnValue)\n\t\t\tevt.returnValue = false;\n\t\tif (evt.preventDefault)\n\t\t\tevt.preventDefault();\n\t}\n\n    /**\n     * Change the browser tab URL without reloading (if supported)\n     * @param  {string} title - Title of the page\n     * @param  {string} url   - URL of the page\n     * @return {boolean}      - true if successful, false otherwise\n     */\n    this.changeUrl = function(title, url) {\n        if (typeof(history.pushState) != \"undefined\") {\n            var obj = {\n                Title: title,\n                Url: url\n            };\n            history.pushState(obj, obj.Title, obj.Url);\n            return true;\n        }\n        return false;\n    };\n\n    this.updateUrl = function(pageId, pageTitle) {\n        var location = this.getLocation();\n        hash = pageId == \"page:homepage\"?\"\":pageId;\n        document.title = pageTitle;\n        if (location.hash != hash) {\n            lastHash = hash; // so the interval won't detect the change\n            var url = location.pathname + \"#\" + pageId;\n            if (pageId && location.search)\n                url += \"?\" + location.search\n            this.changeUrl(pageTitle, url);\n        }\n    };\n\n    this.getLocation = function() {\n        var url = window.location.href; // \"http://localhost:8080/new/index.html#page1?a=2\"\n\n        if (!location || location.url != url) {\n            var hash = window.location.hash, // #page1\n                search = window.location.search, // ?a=2\n                a;\n\n            if (hash) {\n                if (hash[0] == '#')\n                    hash = hash.substr(1); // remove #\n                if (hash.indexOf(\"?\") != -1) {\n                    a = hash.split(\"?\");\n                    hash = a[0];\n                    search = a[1];\n                }\n            }\n            if (search) {\n                if (search[0] == '?')\n                    search = search.substr(1); // remove ?\n                if (search.indexOf(\"#\") != -1) {\n                    a = search.split(\"#\");\n                    search = a[0];\n                    hash = a[1];\n                }\n            }\n\n            var sp = window.location.pathname.split(\"/\");\n\n            location = {\n                url: url,\n                host: window.location.host, // \"localhost:8080\"\n                protocol: window.location.protocol, // http:\n                pathname: window.location.pathname, // /new/index.html\n                hash: hash, // #page1\n                search: search, // ?a=2\n                interface: sp[1], // new\n                login: sp[2] == \"login\" // login page?\n            };\n        }\n\n        return location;\n    }\n\n    var lastHash = null;\n    var self = this;\n\n    this.start = function() {\n        setInterval(function() {\n            var location = Sfera.Browser.getLocation();\n            var locHash = location.hash == \"page:homepage\"?\"\":location.hash\n            if (locHash !== lastHash) {\n                lastHash = locHash;\n                Sfera.client.showPage(location.hash ? location.hash : \"homepage\");\n                //alert(\"User went back or forward to application state represented by \" + hash);\n            }\n        }, 100);\n    };\n})();\n\n\n/**\n* @classdesc\n* Detects device support capabilities and is responsible for device intialization - see {@link Sfera.Device.whenReady whenReady}.\n*\n* This class represents a singleton object that can be accessed directly as `client.device`\n* (or, as a fallback, `Sfera.Device` when a client instance is not available) without the need to instantiate it.\n*\n* Unless otherwise noted the device capabilities are only guaranteed after initialization. Initialization\n* occurs automatically and is guaranteed complete before {@link Sfera.client} begins its \"boot\" phase.\n* Feature detection can be modified in the {@link Sfera.Device.onInitialized onInitialized} signal.\n*\n* When checking features using the exposed properties only the *truth-iness* of the value should be relied upon\n* unless the documentation states otherwise: properties may return `false`, `''`, `null`, or even `undefined`\n* when indicating the lack of a feature.\n*\n* Uses elements from System.js by MrDoob and Modernizr\n*\n* @description\n* It is not possible to instantiate the Device class manually.\n*\n* @class\n* @protected\n*/\nSfera.Device = function () {\n\n    /**\n    * The time the device became ready.\n    * @property {integer} deviceReadyAt\n    * @protected\n    */\n    this.deviceReadyAt = 0;\n\n    /**\n    * The time as which initialization has completed.\n    * @property {boolean} initialized\n    * @protected\n    */\n    this.initialized = false;\n\n    //  Browser / Host / Operating System\n\n    /**\n    * @property {boolean} desktop - Is running on a desktop?\n    * @default\n    */\n    this.desktop = false;\n\n    /**\n    * @property {boolean} iOS - Is running on iOS?\n    * @default\n    */\n    this.iOS = false;\n\n    /**\n    * @property {boolean} cocoonJS - Is the client running under CocoonJS?\n    * @default\n    */\n    this.cocoonJS = false;\n\n    /**\n    * @property {boolean} cocoonJSApp - Is this client running with CocoonJS.App?\n    * @default\n    */\n    this.cocoonJSApp = false;\n\n    /**\n    * @property {boolean} cordova - Is the client running under Apache Cordova?\n    * @default\n    */\n    this.cordova = false;\n\n    /**\n    * @property {boolean} node - Is the client running under Node.js?\n    * @default\n    */\n    this.node = false;\n\n    /**\n    * @property {boolean} nodeWebkit - Is the client running under Node-Webkit?\n    * @default\n    */\n    this.nodeWebkit = false;\n\n    /**\n    * @property {boolean} electron - Is the client running under GitHub Electron?\n    * @default\n    */\n    this.electron = false;\n\n    /**\n    * @property {boolean} ejecta - Is the client running under Ejecta?\n    * @default\n    */\n    this.ejecta = false;\n\n    /**\n    * @property {boolean} crosswalk - Is the client running under the Intel Crosswalk XDK?\n    * @default\n    */\n    this.crosswalk = false;\n\n    /**\n    * @property {boolean} android - Is running on android?\n    * @default\n    */\n    this.android = false;\n\n    /**\n    * @property {boolean} chromeOS - Is running on chromeOS?\n    * @default\n    */\n    this.chromeOS = false;\n\n    /**\n    * @property {boolean} linux - Is running on linux?\n    * @default\n    */\n    this.linux = false;\n\n    /**\n    * @property {boolean} macOS - Is running on macOS?\n    * @default\n    */\n    this.macOS = false;\n\n    /**\n    * @property {boolean} windows - Is running on windows?\n    * @default\n    */\n    this.windows = false;\n\n    /**\n    * @property {boolean} windowsPhone - Is running on a Windows Phone?\n    * @default\n    */\n    this.windowsPhone = false;\n\n    //  Features\n\n    /**\n    * @property {boolean} canvas - Is canvas available?\n    * @default\n    */\n    this.canvas = false;\n\n    /**\n    * @property {?boolean} canvasBitBltShift - True if canvas supports a 'copy' bitblt onto itself when the source and destination regions overlap.\n    * @default\n    */\n    this.canvasBitBltShift = null;\n\n    /**\n    * @property {boolean} webGL - Is webGL available?\n    * @default\n    */\n    this.webGL = false;\n\n    /**\n    * @property {boolean} file - Is file available?\n    * @default\n    */\n    this.file = false;\n\n    /**\n    * @property {boolean} fileSystem - Is fileSystem available?\n    * @default\n    */\n    this.fileSystem = false;\n\n    /**\n    * @property {boolean} localStorage - Is localStorage available?\n    * @default\n    */\n    this.localStorage = false;\n\n    /**\n    * @property {boolean} worker - Is worker available?\n    * @default\n    */\n    this.worker = false;\n\n    /**\n    * @property {boolean} css3D - Is css3D available?\n    * @default\n    */\n    this.css3D = false;\n\n    /**\n    * @property {boolean} pointerLock - Is Pointer Lock available?\n    * @default\n    */\n    this.pointerLock = false;\n\n    /**\n    * @property {boolean} typedArray - Does the browser support TypedArrays?\n    * @default\n    */\n    this.typedArray = false;\n\n    /**\n    * @property {boolean} vibration - Does the device support the Vibration API?\n    * @default\n    */\n    this.vibration = false;\n\n    /**\n    * @property {boolean} getUserMedia - Does the device support the getUserMedia API?\n    * @default\n    */\n    this.getUserMedia = true;\n\n    /**\n    * @property {boolean} quirksMode - Is the browser running in strict mode (false) or quirks mode? (true)\n    * @default\n    */\n    this.quirksMode = false;\n\n    //  Input\n\n    /**\n    * @property {boolean} touch - Is touch available?\n    * @default\n    */\n    this.touch = false;\n\n    /**\n    * @property {boolean} mspointer - Is mspointer available?\n    * @default\n    */\n    this.mspointer = false;\n\n    /**\n    * @property {?string} wheelType - The newest type of Wheel/Scroll event supported: 'wheel', 'mousewheel', 'DOMMouseScroll'\n    * @default\n    * @protected\n    */\n    this.wheelEvent = null;\n\n    //  Browser\n\n    /**\n    * @property {boolean} arora - Set to true if running in Arora.\n    * @default\n    */\n    this.arora = false;\n\n    /**\n    * @property {boolean} chrome - Set to true if running in Chrome.\n    * @default\n    */\n    this.chrome = false;\n\n    /**\n    * @property {number} chromeVersion - If running in Chrome this will contain the major version number.\n    * @default\n    */\n    this.chromeVersion = 0;\n\n    /**\n    * @property {boolean} epiphany - Set to true if running in Epiphany.\n    * @default\n    */\n    this.epiphany = false;\n\n    /**\n    * @property {boolean} firefox - Set to true if running in Firefox.\n    * @default\n    */\n    this.firefox = false;\n\n    /**\n    * @property {number} firefoxVersion - If running in Firefox this will contain the major version number.\n    * @default\n    */\n    this.firefoxVersion = 0;\n\n    /**\n    * @property {boolean} ie - Set to true if running in Internet Explorer.\n    * @default\n    */\n    this.ie = false;\n\n    /**\n    * @property {number} ieVersion - If running in Internet Explorer this will contain the major version number. Beyond IE10 you should use Device.trident and Device.tridentVersion.\n    * @default\n    */\n    this.ieVersion = 0;\n\n    /**\n    * @property {boolean} trident - Set to true if running a Trident version of Internet Explorer (IE11+)\n    * @default\n    */\n    this.trident = false;\n\n    /**\n    * @property {number} tridentVersion - If running in Internet Explorer 11 this will contain the major version number. See {@link http://msdn.microsoft.com/en-us/library/ie/ms537503(v=vs.85).aspx}\n    * @default\n    */\n    this.tridentVersion = 0;\n\n    /**\n    * @property {boolean} mobileSafari - Set to true if running in Mobile Safari.\n    * @default\n    */\n    this.mobileSafari = false;\n\n    /**\n    * @property {boolean} midori - Set to true if running in Midori.\n    * @default\n    */\n    this.midori = false;\n\n    /**\n    * @property {boolean} opera - Set to true if running in Opera.\n    * @default\n    */\n    this.opera = false;\n\n    /**\n    * @property {boolean} safari - Set to true if running in Safari.\n    * @default\n    */\n    this.safari = false;\n\n    /**\n    * @property {boolean} webApp - Set to true if running as a WebApp, i.e. within a WebView\n    * @default\n    */\n    this.webApp = false;\n\n    /**\n    * @property {boolean} silk - Set to true if running in the Silk browser (as used on the Amazon Kindle)\n    * @default\n    */\n    this.silk = false;\n\n    //  Audio\n\n    /**\n    * @property {boolean} audioData - Are Audio tags available?\n    * @default\n    */\n    this.audioData = false;\n\n    /**\n    * @property {boolean} webAudio - Is the WebAudio API available?\n    * @default\n    */\n    this.webAudio = false;\n\n    /**\n    * @property {boolean} ogg - Can this device play ogg files?\n    * @default\n    */\n    this.ogg = false;\n\n    /**\n    * @property {boolean} opus - Can this device play opus files?\n    * @default\n    */\n    this.opus = false;\n\n    /**\n    * @property {boolean} mp3 - Can this device play mp3 files?\n    * @default\n    */\n    this.mp3 = false;\n\n    /**\n    * @property {boolean} wav - Can this device play wav files?\n    * @default\n    */\n    this.wav = false;\n\n    /**\n    * Can this device play m4a files?\n    * @property {boolean} m4a - True if this device can play m4a files.\n    * @default\n    */\n    this.m4a = false;\n\n    /**\n    * @property {boolean} webm - Can this device play webm files?\n    * @default\n    */\n    this.webm = false;\n\n    //  Video\n\n    /**\n    * @property {boolean} oggVideo - Can this device play ogg video files?\n    * @default\n    */\n    this.oggVideo = false;\n\n    /**\n    * @property {boolean} h264Video - Can this device play h264 mp4 video files?\n    * @default\n    */\n    this.h264Video = false;\n\n    /**\n    * @property {boolean} mp4Video - Can this device play h264 mp4 video files?\n    * @default\n    */\n    this.mp4Video = false;\n\n    /**\n    * @property {boolean} webmVideo - Can this device play webm video files?\n    * @default\n    */\n    this.webmVideo = false;\n\n    /**\n    * @property {boolean} vp9Video - Can this device play vp9 video files?\n    * @default\n    */\n    this.vp9Video = false;\n\n    /**\n    * @property {boolean} hlsVideo - Can this device play hls video files?\n    * @default\n    */\n    this.hlsVideo = false;\n\n    //  Device\n\n    /**\n    * @property {boolean} iPhone - Is running on iPhone?\n    * @default\n    */\n    this.iPhone = false;\n\n    /**\n    * @property {boolean} iPhone4 - Is running on iPhone4?\n    * @default\n    */\n    this.iPhone4 = false;\n\n    /**\n    * @property {boolean} iPad - Is running on iPad?\n    * @default\n    */\n    this.iPad = false;\n\n    // Device features\n\n    /**\n    * @property {number} pixelRatio - PixelRatio of the host device?\n    * @default\n    */\n    this.pixelRatio = 0;\n\n    /**\n    * @property {boolean} littleEndian - Is the device big or little endian? (only detected if the browser supports TypedArrays)\n    * @default\n    */\n    this.littleEndian = false;\n\n    /**\n    * @property {boolean} LITTLE_ENDIAN - Same value as `littleEndian`.\n    * @default\n    */\n    this.LITTLE_ENDIAN = false;\n\n    /**\n    * @property {boolean} support32bit - Does the device context support 32bit pixel manipulation using array buffer views?\n    * @default\n    */\n    this.support32bit = false;\n\n    /**\n    * @property {boolean} fullscreen - Does the browser support the Full Screen API?\n    * @default\n    */\n    this.fullscreen = false;\n\n    /**\n    * @property {string} requestFullscreen - If the browser supports the Full Screen API this holds the call you need to use to activate it.\n    * @default\n    */\n    this.requestFullscreen = '';\n\n    /**\n    * @property {string} cancelFullscreen - If the browser supports the Full Screen API this holds the call you need to use to cancel it.\n    * @default\n    */\n    this.cancelFullscreen = '';\n\n    /**\n    * @property {boolean} fullscreenKeyboard - Does the browser support access to the Keyboard during Full Screen mode?\n    * @default\n    */\n    this.fullscreenKeyboard = false;\n\n};\n\n// Device is a singleton/static entity; instantiate it\n// and add new methods directly sans-prototype.\nSfera.Device = new Sfera.Device();\n\n/**\n* This signal is dispatched after device initialization occurs but before any of the ready\n* callbacks (see {@link Sfera.Device.whenReady whenReady}) have been invoked.\n*\n* Local \"patching\" for a particular device can/should be done in this event.\n*\n* _Note_: This signal is removed after the device has been readied; if a handler has not been\n* added _before_ `new Sfera.client(..)` it is probably too late.\n*\n* @type {?Sfera.Signal}\n* @static\n*/\nSfera.Device.onInitialized = new Sfera.Signal();\n\n/**\n* Add a device-ready handler and ensure the device ready sequence is started.\n*\n* Sfera.Device will _not_ activate or initialize until at least one `whenReady` handler is added,\n* which is normally done automatically be calling `new Sfera.client(..)`.\n*\n* The handler is invoked when the device is considered \"ready\", which may be immediately\n* if the device is already \"ready\". See {@link Sfera.Device#deviceReadyAt deviceReadyAt}.\n*\n* @method\n* @param {function} handler - Callback to invoke when the device is ready. It is invoked with the given context the Sfera.Device object is supplied as the first argument.\n* @param {object} [context] - Context in which to invoke the handler\n* @param {boolean} [nonPrimer=false] - If true the device ready check will not be started.\n*/\nSfera.Device.whenReady = function (callback, context, nonPrimer) {\n\n    var readyCheck = this._readyCheck;\n\n    if (this.deviceReadyAt || !readyCheck)\n    {\n        callback.call(context, this);\n    }\n    else if (readyCheck._monitor || nonPrimer)\n    {\n        readyCheck._queue = readyCheck._queue || [];\n        readyCheck._queue.push([callback, context]);\n    }\n    else\n    {\n        readyCheck._monitor = readyCheck.bind(this);\n        readyCheck._queue = readyCheck._queue || [];\n        readyCheck._queue.push([callback, context]);\n\n        var cordova = typeof window.cordova !== 'undefined';\n        var cocoonJS = navigator['isCocoonJS'];\n\n        if (document.readyState === 'complete' || document.readyState === 'interactive')\n        {\n            // Why is there an additional timeout here?\n            window.setTimeout(readyCheck._monitor, 0);\n        }\n        else if (cordova && !cocoonJS)\n        {\n            // Ref. http://docs.phonegap.com/en/3.5.0/cordova_events_events.md.html#deviceready\n            //  Cordova, but NOT Cocoon?\n            document.addEventListener('deviceready', readyCheck._monitor, false);\n        }\n        else\n        {\n            document.addEventListener('DOMContentLoaded', readyCheck._monitor, false);\n            window.addEventListener('load', readyCheck._monitor, false);\n        }\n    }\n\n};\n\n/**\n* Internal method used for checking when the device is ready.\n* This function is removed from Sfera.Device when the device becomes ready.\n*\n* @method\n* @private\n*/\nSfera.Device._readyCheck = function () {\n\n    var readyCheck = this._readyCheck;\n\n    if (!document.body)\n    {\n        window.setTimeout(readyCheck._monitor, 20);\n    }\n    else if (!this.deviceReadyAt)\n    {\n        this.deviceReadyAt = Date.now();\n\n        document.removeEventListener('deviceready', readyCheck._monitor);\n        document.removeEventListener('DOMContentLoaded', readyCheck._monitor);\n        window.removeEventListener('load', readyCheck._monitor);\n\n        this._initialize();\n        this.initialized = true;\n\n        this.onInitialized.dispatch(this);\n\n        var item;\n        while ((item = readyCheck._queue.shift()))\n        {\n            var callback = item[0];\n            var context = item[1];\n            callback.call(context, this);\n        }\n\n        // Remove no longer useful methods and properties.\n        this._readyCheck = null;\n        this._initialize = null;\n        this.onInitialized = null;\n    }\n\n};\n\n/**\n* Internal method to initialize the capability checks.\n* This function is removed from Sfera.Device once the device is initialized.\n*\n* @method\n* @private\n*/\nSfera.Device._initialize = function () {\n\n    var device = this;\n\n    /**\n    * Check which OS is client running on.\n    */\n    function _checkOS () {\n\n        var ua = navigator.userAgent;\n\n        if (/Playstation Vita/.test(ua))\n        {\n            device.vita = true;\n        }\n        else if (/Kindle/.test(ua) || /\\bKF[A-Z][A-Z]+/.test(ua) || /Silk.*Mobile Safari/.test(ua))\n        {\n            device.kindle = true;\n            // This will NOT detect early generations of Kindle Fire, I think there is no reliable way...\n            // E.g. \"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-us; Silk/1.1.0-80) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16 Silk-Accelerated=true\"\n        }\n        else if (/Android/.test(ua))\n        {\n            device.android = true;\n        }\n        else if (/CrOS/.test(ua))\n        {\n            device.chromeOS = true;\n        }\n        else if (/iP[ao]d|iPhone/i.test(ua))\n        {\n            device.iOS = true;\n        }\n        else if (/Linux/.test(ua))\n        {\n            device.linux = true;\n        }\n        else if (/Mac OS/.test(ua))\n        {\n            device.macOS = true;\n        }\n        else if (/Windows/.test(ua))\n        {\n            device.windows = true;\n        }\n\n        if (/Windows Phone/i.test(ua) || /IEMobile/i.test(ua))\n        {\n            device.android = false;\n            device.iOS = false;\n            device.macOS = false;\n            device.windows = true;\n            device.windowsPhone = true;\n        }\n\n        var silk = /Silk/.test(ua); // detected in browsers\n\n        if (device.windows || device.macOS || (device.linux && !silk) || device.chromeOS)\n        {\n            device.desktop = true;\n        }\n\n        //  Windows Phone / Table reset\n        if (device.windowsPhone || ((/Windows NT/i.test(ua)) && (/Touch/i.test(ua))))\n        {\n            device.desktop = false;\n        }\n\n    }\n\n    /**\n    * Check HTML5 features of the host environment.\n    */\n    function _checkFeatures () {\n\n        device.canvas = !!window['CanvasRenderingContext2D'] || device.cocoonJS;\n\n        try {\n            device.localStorage = !!localStorage.getItem;\n        } catch (error) {\n            device.localStorage = false;\n        }\n\n        device.file = !!window['File'] && !!window['FileReader'] && !!window['FileList'] && !!window['Blob'];\n        device.fileSystem = !!window['requestFileSystem'];\n\n        device.webGL = ( function () { try { var canvas = document.createElement( 'canvas' ); /*Force screencanvas to false*/ canvas.screencanvas = false; return !! window.WebGLRenderingContext && ( canvas.getContext( 'webgl' ) || canvas.getContext( 'experimental-webgl' ) ); } catch( e ) { return false; } } )();\n        device.webGL = !!device.webGL;\n\n        device.worker = !!window['Worker'];\n\n        device.pointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\n\n        device.quirksMode = (document.compatMode === 'CSS1Compat') ? false : true;\n\n        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;\n\n        window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n        device.getUserMedia = device.getUserMedia && !!navigator.getUserMedia && !!window.URL;\n\n        // Older versions of firefox (< 21) apparently claim support but user media does not actually work\n        if (device.firefox && device.firefoxVersion < 21)\n        {\n            device.getUserMedia = false;\n        }\n\n    }\n\n    /**\n    * Checks/configures various input.\n    */\n    function _checkInput () {\n\n        if ('ontouchstart' in document.documentElement || (window.navigator.maxTouchPoints && window.navigator.maxTouchPoints >= 1))\n        {\n            device.touch = true;\n        }\n\n        if (window.navigator.msPointerEnabled || window.navigator.pointerEnabled)\n        {\n            device.mspointer = true;\n        }\n\n        if (!device.cocoonJS)\n        {\n            // See https://developer.mozilla.org/en-US/docs/Web/Events/wheel\n            if ('onwheel' in window || (device.ie && 'WheelEvent' in window))\n            {\n                // DOM3 Wheel Event: FF 17+, IE 9+, Chrome 31+, Safari 7+\n                device.wheelEvent = 'wheel';\n            }\n            else if ('onmousewheel' in window)\n            {\n                // Non-FF legacy: IE 6-9, Chrome 1-31, Safari 5-7.\n                device.wheelEvent = 'mousewheel';\n            }\n            else if (device.firefox && 'MouseScrollEvent' in window)\n            {\n                // FF prior to 17. This should probably be scrubbed.\n                device.wheelEvent = 'DOMMouseScroll';\n            }\n        }\n\n    }\n\n    /**\n    * Checks for support of the Full Screen API.\n    */\n    function _checkFullScreenSupport () {\n\n        var fs = [\n            'requestFullscreen',\n            'requestFullScreen',\n            'webkitRequestFullscreen',\n            'webkitRequestFullScreen',\n            'msRequestFullscreen',\n            'msRequestFullScreen',\n            'mozRequestFullScreen',\n            'mozRequestFullscreen'\n        ];\n\n        var element = document.createElement('div');\n\n        for (var i = 0; i < fs.length; i++)\n        {\n            if (element[fs[i]])\n            {\n                device.fullscreen = true;\n                device.requestFullscreen = fs[i];\n                break;\n            }\n        }\n\n        var cfs = [\n            'cancelFullScreen',\n            'exitFullscreen',\n            'webkitCancelFullScreen',\n            'webkitExitFullscreen',\n            'msCancelFullScreen',\n            'msExitFullscreen',\n            'mozCancelFullScreen',\n            'mozExitFullscreen'\n        ];\n\n        if (device.fullscreen)\n        {\n            for (var i = 0; i < cfs.length; i++)\n            {\n                if (document[cfs[i]])\n                {\n                    device.cancelFullscreen = cfs[i];\n                    break;\n                }\n            }\n        }\n\n        //  Keyboard Input?\n        if (window['Element'] && Element['ALLOW_KEYBOARD_INPUT'])\n        {\n            device.fullscreenKeyboard = true;\n        }\n\n    }\n\n    /**\n    * Check what browser is client running in.\n    */\n    function _checkBrowser () {\n\n        var ua = navigator.userAgent;\n\n        if (/Arora/.test(ua))\n        {\n            device.arora = true;\n        }\n        else if (/Chrome\\/(\\d+)/.test(ua) && !device.windowsPhone)\n        {\n            device.chrome = true;\n            device.chromeVersion = parseInt(RegExp.$1, 10);\n        }\n        else if (/Epiphany/.test(ua))\n        {\n            device.epiphany = true;\n        }\n        else if (/Firefox\\D+(\\d+)/.test(ua))\n        {\n            device.firefox = true;\n            device.firefoxVersion = parseInt(RegExp.$1, 10);\n        }\n        else if (/AppleWebKit/.test(ua) && device.iOS)\n        {\n            device.mobileSafari = true;\n        }\n        else if (/MSIE (\\d+\\.\\d+);/.test(ua))\n        {\n            device.ie = true;\n            device.ieVersion = parseInt(RegExp.$1, 10);\n        }\n        else if (/Midori/.test(ua))\n        {\n            device.midori = true;\n        }\n        else if (/Opera/.test(ua))\n        {\n            device.opera = true;\n        }\n        else if (/Safari/.test(ua) && !device.windowsPhone)\n        {\n            device.safari = true;\n        }\n        else if (/Trident\\/(\\d+\\.\\d+)(.*)rv:(\\d+\\.\\d+)/.test(ua))\n        {\n            device.ie = true;\n            device.trident = true;\n            device.tridentVersion = parseInt(RegExp.$1, 10);\n            device.ieVersion = parseInt(RegExp.$3, 10);\n        }\n\n        //  Silk gets its own if clause because its ua also contains 'Safari'\n        if (/Silk/.test(ua))\n        {\n            device.silk = true;\n        }\n\n        //  WebApp mode in iOS\n        if (navigator['standalone'])\n        {\n            device.webApp = true;\n        }\n\n        if (typeof window.cordova !== \"undefined\")\n        {\n            device.cordova = true;\n        }\n\n        if (typeof process !== \"undefined\" && typeof require !== \"undefined\")\n        {\n            device.node = true;\n        }\n\n        if (device.node && typeof process.versions === 'object')\n        {\n            device.nodeWebkit = !!process.versions['node-webkit'];\n\n            device.electron = !!process.versions.electron;\n        }\n\n        if (navigator['isCocoonJS'])\n        {\n            device.cocoonJS = true;\n        }\n\n        if (device.cocoonJS)\n        {\n            try {\n                device.cocoonJSApp = (typeof CocoonJS !== \"undefined\");\n            }\n            catch(error)\n            {\n                device.cocoonJSApp = false;\n            }\n        }\n\n        if (typeof window.ejecta !== \"undefined\")\n        {\n            device.ejecta = true;\n        }\n\n        if (/Crosswalk/.test(ua))\n        {\n            device.crosswalk = true;\n        }\n\n    }\n\n    /**\n    * Check video support.\n    */\n    function _checkVideo () {\n\n        var videoElement = document.createElement(\"video\");\n        var result = false;\n\n        try {\n            if (result = !!videoElement.canPlayType)\n            {\n                if (videoElement.canPlayType('video/ogg; codecs=\"theora\"').replace(/^no$/, ''))\n                {\n                    device.oggVideo = true;\n                }\n\n                if (videoElement.canPlayType('video/mp4; codecs=\"avc1.42E01E\"').replace(/^no$/, ''))\n                {\n                    // Without QuickTime, this value will be `undefined`. github.com/Modernizr/Modernizr/issues/546\n                    device.h264Video = true;\n                    device.mp4Video = true;\n                }\n\n                if (videoElement.canPlayType('video/webm; codecs=\"vp8, vorbis\"').replace(/^no$/, ''))\n                {\n                    device.webmVideo = true;\n                }\n\n                if (videoElement.canPlayType('video/webm; codecs=\"vp9\"').replace(/^no$/, ''))\n                {\n                    device.vp9Video = true;\n                }\n\n                if (videoElement.canPlayType('application/x-mpegURL; codecs=\"avc1.42E01E\"').replace(/^no$/, ''))\n                {\n                    device.hlsVideo = true;\n                }\n            }\n        } catch (e) {}\n    }\n\n    /**\n    * Check audio support.\n    */\n    function _checkAudio () {\n\n        device.audioData = !!(window['Audio']);\n        device.webAudio = !!(window['AudioContext'] || window['webkitAudioContext']);\n        var audioElement = document.createElement('audio');\n        var result = false;\n\n        try {\n            if (result = !!audioElement.canPlayType)\n            {\n                if (audioElement.canPlayType('audio/ogg; codecs=\"vorbis\"').replace(/^no$/, ''))\n                {\n                    device.ogg = true;\n                }\n\n                if (audioElement.canPlayType('audio/ogg; codecs=\"opus\"').replace(/^no$/, '') || audioElement.canPlayType('audio/opus;').replace(/^no$/, ''))\n                {\n                    device.opus = true;\n                }\n\n                if (audioElement.canPlayType('audio/mpeg;').replace(/^no$/, ''))\n                {\n                    device.mp3 = true;\n                }\n\n                // Mimetypes accepted:\n                //   developer.mozilla.org/En/Media_formats_supported_by_the_audio_and_video_elements\n                //   bit.ly/iphoneoscodecs\n                if (audioElement.canPlayType('audio/wav; codecs=\"1\"').replace(/^no$/, ''))\n                {\n                    device.wav = true;\n                }\n\n                if (audioElement.canPlayType('audio/x-m4a;') || audioElement.canPlayType('audio/aac;').replace(/^no$/, ''))\n                {\n                    device.m4a = true;\n                }\n\n                if (audioElement.canPlayType('audio/webm; codecs=\"vorbis\"').replace(/^no$/, ''))\n                {\n                    device.webm = true;\n                }\n            }\n        } catch (e) {\n        }\n\n    }\n\n    /**\n    * Check PixelRatio, iOS device, Vibration API\n    */\n    function _checkDevice () {\n\n        device.pixelRatio = window['devicePixelRatio'] || 1;\n        device.iPhone = navigator.userAgent.toLowerCase().indexOf('iphone') != -1;\n        device.iPhone4 = (device.pixelRatio == 2 && device.iPhone);\n        device.iPad = navigator.userAgent.toLowerCase().indexOf('ipad') != -1;\n\n\n        navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate;\n\n        if (navigator.vibrate)\n        {\n            device.vibration = true;\n        }\n\n    }\n\n    //  Run the checks\n    _checkOS();\n    _checkAudio();\n    _checkVideo();\n    _checkBrowser();\n    _checkDevice();\n    _checkFeatures();\n    _checkFullScreenSupport();\n    _checkInput();\n\n};\n\n/**\n* Check whether the host environment can play audio.\n*\n* @method canPlayAudio\n* @memberof Sfera.Device.prototype\n* @param {string} type - One of 'mp3, 'ogg', 'm4a', 'wav', 'webm' or 'opus'.\n* @return {boolean} True if the given file type is supported by the browser, otherwise false.\n*/\nSfera.Device.canPlayAudio = function (type) {\n\n    if (type === 'mp3' && this.mp3)\n    {\n        return true;\n    }\n    else if (type === 'ogg' && (this.ogg || this.opus))\n    {\n        return true;\n    }\n    else if (type === 'm4a' && this.m4a)\n    {\n        return true;\n    }\n    else if (type === 'opus' && this.opus)\n    {\n        return true;\n    }\n    else if (type === 'wav' && this.wav)\n    {\n        return true;\n    }\n    else if (type === 'webm' && this.webm)\n    {\n        return true;\n    }\n\n    return false;\n\n};\n\n/**\n* Check whether the host environment can play video files.\n*\n* @method canPlayVideo\n* @memberof Sfera.Device.prototype\n* @param {string} type - One of 'mp4, 'ogg', 'webm' or 'mpeg'.\n* @return {boolean} True if the given file type is supported by the browser, otherwise false.\n*/\nSfera.Device.canPlayVideo = function (type) {\n\n    if (type === 'webm' && (this.webmVideo || this.vp9Video))\n    {\n        return true;\n    }\n    else if (type === 'mp4' && (this.mp4Video || this.h264Video))\n    {\n        return true;\n    }\n    else if ((type === 'ogg' || type === 'ogv') && this.oggVideo)\n    {\n        return true;\n    }\n    else if (type === 'mpeg' && this.hlsVideo)\n    {\n        return true;\n    }\n\n    return false;\n\n};\n\n\n\nwindow.man = function(what) {\n    // component\n    var c = Sfera.Utils.capitalize(what);\n    if (Sfera.Components[c]) {\n        var co = new Sfera.Components[c]({});\n\n        var hstr = \"* Component \" + co.type + \" *****************\";\n\n        console.log(hstr);\n        var sstr = \"\";\n        for (var sub in co.subComponents) {\n            var str = \" - \" + sub + \" \";\n            while (str.length < 20) str += \" \";\n            str += co.subComponents[sub].type;\n            sstr += str + \"\\n\";\n        }\n        if (str) {\n            console.log(\"* SubComponents:\");\n            console.log(sstr);\n        }\n\n        console.log(\"* Attributes:\");\n        for (var attr in co.attributes) {\n            var a = co.attributes[attr];\n            var str = \" - \" + attr;\n            while (str.length < 20) str += \" \";\n            str += a.type;\n\n            var av = co.attributes[attr].values;\n            if (av) {\n                if (Sfera.Utils.isFunction(av))\n                    av = av();\n                if (Sfera.Utils.isArray(av)) {\n                    while (str.length < 35) str += \" \";\n                    str += \"<\" + av.join(\"|\") + \">\";\n                }\n            }\n\n            console.log(str);\n        }\n\n        console.log(hstr);\n    }\n};\n\n\nwindow.help = function () {\n    var hstr = \"* Help *************************\\n\";\n    hstr += \"* man(\\\"<component name>\\\")\\n\";\n    hstr += \"* client.setAttribute(\\\"<component id>\\\",\\\"<attribute name>\\\",\\\"<value>\\\")\\n\";\n    //hstr += \"* client.event(\\\"\\\")\";\n    hstr += \"* Help *************************\\n\";\n\n    console.log(hstr);\n}\n\n\n/**\n * Sfera.Utils singleton\n *\n * @class Sfera.Utils\n * @constructor\n */\nSfera.Utils = function() {\n    this.mixin = function(a, b) {\n\n    };\n\n    this.extend = function(c, e) {\n        c.prototype = Object.create(e.prototype);\n        c.prototype.constructor = c;\n        c.prototype.ancestor = e.prototype;\n\n    };\n\n\n    this.initClass = function(c) {\n        c.prototype.constructor = c;\n    };\n\n    function filterNone() {\n        return NodeFilter.FILTER_ACCEPT;\n    }\n\n    this.getAllCommentChildNodes = function(rootNode) {\n        var comments = [];\n        // Fourth argument, which is actually obsolete according to the DOM4 standard, is required in IE 11\n        var iterator = document.createNodeIterator(rootNode, NodeFilter.SHOW_COMMENT, filterNone, false);\n        var curNode;\n        while (curNode = iterator.nextNode()) {\n            comments.push(curNode);\n        }\n        return comments;\n    };\n\n    this.getFirstChildNodeOfType = function(rootNode, type, recursive) {\n        for (var i = 0; i < rootNode.childNodes.length; i++) {\n            if (rootNode.childNodes[i].nodeType == type) {\n                return rootNode.childNodes[i];\n            }\n            if (recursive && rootNode.childNodes[i].childNodes) {\n                var r = this.getFirstChildNodeOfType(rootNode.childNodes[i], type, recursive);\n                if (r != null)\n                    return r;\n            }\n        }\n        return null;\n    };\n\n    this.getFirstChildNodeWithName = function(rootNode, name, recursive) {\n        var i, r;\n        for (i = 0; i < rootNode.childNodes.length; i++) {\n            if (rootNode.childNodes[i].getAttribute && rootNode.childNodes[i].getAttribute(\"name\") == name) {\n                return rootNode.childNodes[i];\n            }\n            if (recursive && rootNode.childNodes[i].childNodes) {\n                r = this.getFirstChildNodeWithName(rootNode.childNodes[i], name, recursive);\n                if (r != null)\n                    return r;\n            }\n        }\n        return null;\n    };\n\n    this.getComponentElements = function(rootNode, recursive, obj) {\n        // object containing all nodes by name\n        var obj = obj || {},\n            name, i, r;\n        for (var i = 0; i < rootNode.childNodes.length; i++) {\n            if (rootNode.childNodes[i].getAttribute) {\n                name = rootNode.childNodes[i].getAttribute(\"name\");\n                if (name)\n                    obj[name] = rootNode.childNodes[i];\n            }\n            if (recursive && rootNode.childNodes[i].childNodes && rootNode.childNodes[i].childNodes.length &&\n                !rootNode.childNodes[i].getAttribute(\"data-controller\")) { // skip subComponents\n                obj = this.getComponentElements(rootNode.childNodes[i], recursive, obj);\n            }\n        }\n        return obj;\n    };\n\n    this.getCDATA = function(rootNode) {\n        var node = this.getFirstChildNodeOfType(rootNode, 4);\n        return node ? node.nodeValue : \"\";\n    };\n\n\n    this.isString = function(v) {\n        return (typeof v === 'string' || v instanceof String);\n    };\n\n    this.isFunction = function(obj) {\n        return !!(obj && obj.constructor && obj.call && obj.apply);\n    };\n\n    this.isArray = function(obj) {\n        return obj && Object.prototype.toString.call(obj) === '[object Array]';\n    };\n\n    this.capitalize = function(str) {\n        return str[0].toUpperCase() + str.substr(1);\n    };\n\n    this.camelToDash = function(str) {\n        return str.replace(/\\W+/g, '-')\n            .replace(/([a-z\\d])([A-Z])/g, '$1-$2')\n            .toLowerCase();\n    };\n\n    this.dashToCamel = function(str) {\n        return str.toLowerCase().replace(/\\W+(.)/g, function(x, chr) {\n            return chr.toUpperCase();\n        })\n    };\n\n    // get key function from keycode\n    this.getKeyFromCode = function(code) {\n        switch (code) {\n            case 8:\n                return \"del\";\n            case 9:\n                return \"tab\";\n            case 13:\n                return \"enter\";\n            case 32:\n                return \"space\";\n\n            case 37:\n                return \"left\";\n            case 38:\n                return \"up\";\n            case 39:\n                return \"right\";\n            case 40:\n                return \"down\";\n\n            default:\n                var c = String.fromCharCode(code);\n                return c ? c.toLowerCase() : null;\n        }\n    };\n\n    this.getDate = function(format) {\n        function pan(str, len) {\n            str = str + \"\";\n            if (!len) len = 2;\n            while (str.length < len)\n                str = \"0\" + str;\n            return str;\n        }\n\n        var date = new Date();\n        if (!format) {\n            format = \"dmyhisu\";\n        }\n        var f = {};\n        for (var i = 0; i < format.length; i++)\n            f[format[i]] = true;\n        var str = \"\";\n        if (f.d) {\n            str += pan(date.getDate());\n        }\n        if (f.m) {\n            str += (str ? \"/\" : \"\") + pan(date.getMonth() + 1);\n        }\n        if (f.y) {\n            str += (str ? \"/\" : \"\") + date.getFullYear();\n        }\n        if (f.h) {\n            str += (str ? \" \" : \"\") + pan(date.getHours());\n        }\n        if (f.i) {\n            str += (str ? \":\" : \"\") + pan(date.getMinutes());\n        }\n        if (f.s) {\n            str += (str ? \":\" : \"\") + pan(date.getSeconds());\n        }\n        if (f.u) {\n            str += (str ? \":\" : \"\") + pan(date.getMilliseconds(), 3);\n        }\n        return str;\n    };\n\n    // get mouse relative position\n\tthis.getMouseRelativePosition = function (evt,target) {\n\t\tvar ep = this.getElementAbsolutePosition(target);\n\t\tvar p = this.getMouseAbsolutePosition(evt,target);\n\t\treturn {x:p.x-ep.x,y:p.y-ep.y};\n\t} // getMouseRelativePosition()\n\n\t// get absolute mouse position, if touch, first touch. target if != evt.target\n\tthis.getMouseAbsolutePosition = function (evt,target) {\n\t\tvar x,y;\n\t\tif (Sfera.Device.touch && evt.touches && evt.touches[0]) {\n\t\t\tx = evt.touches[0].pageX;\n\t\t\ty = evt.touches[0].pageY;\n\t\t} else if (evt.pageX != null && evt.pageY != null) {\n\t\t\tx = evt.pageX;\n\t\t\ty = evt.pageY;\n\t\t} else {\n\t\t\tx = (evt.layerX != null)?evt.layerX:evt.offsetX;\n\t\t\ty = (evt.layerY != null)?evt.layerY:evt.offsetY;\n\t\t\tvar c = target || evt.target || evt.srcElement;\n\t\t\tvar p = this.getElementAbsolutePosition(c);\n\t\t\tx += p.x;\n\t\t\ty += p.y;\n\t\t}\n\n\t\t// scale?\n\t\tif (this.scaleDelta && this.scaleDelta != 1) {\n\t\t\tx *= this.scaleDelta;\n\t\t\ty *= this.scaleDelta;\n\t\t}\n\n\t\treturn {x:x, y:y};\n\t} // getMouseAbsolutePosition()\n\n\t// get element absolute position\n\tthis.getElementAbsolutePosition = function (c) {\n\t\tvar x = 0;\n\t\tvar y = 0;\n\t\twhile (c && c.offsetLeft != null && c.offsetTop != null) {\n\t\t\tx += c.offsetLeft;\n\t\t\ty += c.offsetTop;\n\t\t\tc = c.offsetParent || c.parentNode;\n\t\t}\n\n\t\treturn {x:x, y:y};\n\t} // getElementAbsolutePosition()\n\n    // mouse wheel event\n\tthis.initMouseWheelEvent = function (e,f) {\n\t\tif (!Sfera.Device.touch)\n\t\t\twindow.addEvent(browser.browser == \"Firefox\"?\"DOMMouseScroll\":\"mousewheel\", e, f);\n\t}\n\n    if (typeof window.DOMParser != \"undefined\") {\n        this.parseXML = function(xmlStr) {\n            return (new window.DOMParser()).parseFromString(xmlStr, \"text/xml\");\n        };\n    } else if (typeof window.ActiveXObject != \"undefined\" &&\n        new window.ActiveXObject(\"Microsoft.XMLDOM\")) {\n        this.parseXML = function(xmlStr) {\n            var xmlDoc = new window.ActiveXObject(\"Microsoft.XMLDOM\");\n            xmlDoc.async = \"false\";\n            xmlDoc.loadXML(xmlStr);\n            return xmlDoc;\n        };\n    } else {\n        throw new Error(\"No XML parser found\");\n    }\n\n};\n\nSfera.Utils = new Sfera.Utils();\n\nArray.prototype.equals = function(array, strict) {\n    if (!array)\n        return false;\n\n    if (arguments.length == 1)\n        strict = true;\n\n    if (this.length != array.length)\n        return false;\n\n    for (var i = 0; i < this.length; i++) {\n        if (this[i] instanceof Array && array[i] instanceof Array) {\n            if (!this[i].equals(array[i], strict))\n                return false;\n        } else if (strict && this[i] != array[i]) {\n            return false;\n        } else if (!strict) {\n            return this.sort().equals(array.sort(), true);\n        }\n    }\n    return true;\n}\n\nfunction isNumeric(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\nString.prototype.trim = function () {\n    //return this.replace(/^\\s*/, \"\").replace(/\\s*$/, \"\");\n\tvar\tstr = this.replace(/^\\s\\s*/, ''),\n\t\tws = /\\s/,\n\t\ti = str.length;\n\twhile (ws.test(str.charAt(--i)));\n\treturn str.slice(0, i + 1);\n}\nif (typeof String.prototype.startsWith != \"function\") {\n\tString.prototype.startsWith = function (str){\n\t\treturn this.slice(0, str.length) == str;\n\t};\n}\nif (typeof String.prototype.endsWith != \"function\") {\n\tString.prototype.endsWith = function (str){\n\t\treturn this.slice(-str.length) == str;\n\t};\n}\nNumber.prototype.mod = function (n) { // useful for ciclying 0-->n\n\treturn ((this%n)+n)%n;\n}\nNumber.prototype.next = function (b) { // n: base\n\treturn (this+1).mod(b);\n}\nNumber.prototype.previous = function (b) {\n\treturn (this-1).mod(b);\n}\n// array is array is array.\nif (!Array.prototype.isArray) {\n\tArray.prototype.isArray = function (vArg) {\n\t    return Object.prototype.toString.call(vArg) === \"[object Array]\";\n\t}\n}\n// return an array with unique elements\nArray.prototype.unique = function () {\n\tvar a = [];\n\tvar l = this.length;\n\tfor (var i=0; i<l; i++) {\n\t  for (var j=i+1; j<l; j++) {\n\t    if (this[i] === this[j])\n\t      j = ++i; //skip\n\t  }\n\t  a.push(this[i]);\n\t}\n\treturn a;\n};\n// get last element\nArray.prototype.last = function () {\n\tif (!this.length) return null;\n\treturn this[this.length-1];\n}\n// clone array\nArray.prototype.clone = function () {\n\treturn this.slice(0);\n}\n// intersection of two arrays\nArray.prototype.intersect = function (arr) {\n\tvar a = [];\n\tvar l = this.length;\n\tfor (var i=0; i<l; i++) {\n\t\tif (arr.indexOf(this[i]) != -1) {\n\t\t\ta.push(this[i]);\n\t\t}\n\t}\n\treturn a;\n}\n// same\nArray.prototype.same = function (arr) {\n\tif (this.length != arr.length) return false;\n\tfor (var i=0; i<this.length; i++) {\n\t\tif (this[i] != null && arr[i] != null && // not null\n\t\t\ttypeof this[i] === \"object\" && typeof arr[i] === \"object\" && // both objs\n\t\t\tthis[i].isArray && arr[i].isArray) { // arrays\n\t\t\tif (!this[i].same(arr[i]))\n\t\t\t\treturn false;\n\t\t} else if (this[i] != arr[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n// search\nif (!Array.prototype.indexOf) {\n  Array.prototype.indexOf = function (searchElement, fromIndex) {\n    \"use strict\";\n    if (this == null) {\n      throw new TypeError();\n    }\n    var t = Object(this);\n    var len = t.length >>> 0;\n\n    if (len === 0) {\n      return -1;\n    }\n    var n = 0;\n    if (arguments.length > 1) {\n      n = Number(arguments[1]);\n      if (n != n) { // shortcut for verifying if it's NaN\n        n = 0;\n      } else if (n != 0 && n != Infinity && n != -Infinity) {\n        n = (n > 0 || -1) * Math.floor(Math.abs(n));\n      }\n    }\n    if (n >= len) {\n      return -1;\n    }\n    var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\n    for (; k < len; k++) {\n      if (k in t && t[k] === searchElement) {\n        return k;\n      }\n    }\n    return -1;\n  }\n}\n\n// remove empty elements\nArray.prototype.clean = function (deleteValue) {\n\tfor (var i = 0; i < this.length; i++) {\n\t\tif (this[i] == deleteValue) {\n\t\t\tthis.splice(i, 1);\n\t\t\ti--;\n\t\t}\n\t}\n\treturn this;\n}\n\n// add event cross browser\nwindow.addEvent = function (event, target, method) {\n\tif (target.addEventListener) {\n\t\ttarget.addEventListener(event, method, false);\n\t} else if (target.attachEvent) {\n\t\ttarget.attachEvent(\"on\" + event, method);\n\t} else {\n\t\ttarget[\"on\" + event] = method;\n\t}\n}\nwindow.removeEvent = function (event, target, method) {\n\tif (target.removeEventListener) {\n\t\ttarget.removeEventListener(event, method, false);\n\t} else if (target.attachEvent) {\n\t\ttarget.detachEvent(\"on\" + event, method);\n\t} else {\n\t\ttarget[\"on\" + event] = null;\n\t}\n}\n\n/*\n// JSON\nvar JSON = JSON || {};\nJSON.parse = JSON.parse || function (str) {\n\tif (str === \"\") str = '\"\"';\n\teval(\"var p=\" + str + \";\");\n\treturn p;\n};\n*/\n\n\n/**\n * Sfera._Base component base class\n *\n * @class Sfera._Base\n * @constructor\n */\nSfera.Components.create(\"_Base\", {\n    id: null,\n\n    // require update: null, true/ {}\n    requireUpdate: null,\n\n    attributes: {\n        id: {\n            type: \"string\",\n            set: function(value) {\n                this.value = value;\n                this.component.id = value;\n                this.component.element.setAttribute(\"data-id\", value);\n            },\n            get: function() {\n                return this.attributeValues.id;\n            }\n        }\n    },\n\n    init: function() {\n        this.elements = {};\n    },\n\n    // shared methods\n    getAttribute: function(name) {\n        if (this.attributes[name]) {\n            return this.attributes[name].get();\n        }\n    },\n\n    // shared methods\n    setAttribute: function(name, value, manualUpdate) {\n        if (this.attributes[name]) {\n            this.attributes[name].set(value, manualUpdate);\n        }\n    },\n\n    // update\n    update: function() {},\n\n    // super\n    super: function(superClassName, methodName) {\n        Sfera.Components[superClassName].prototype[methodName].call(this);\n    },\n\n    /**\n     * Set component's html source. Reset processed variable\n     * @param {string} src - html source\n     */\n    setSource: function(src) {\n        this.processed = false;\n    },\n\n    addChild: function(child) {\n        this.children.push(child);\n        child.parent = this;\n        if (this.element && child.element) {\n            this.element.appendChild(child.element);\n        }\n    },\n\n    addSubComponent: function(co) {\n        if (co.id === false) co.id = this.id+\".icon\";\n        var id = co.id;\n        // remove this.id. TODO: find a better way\n        if (this.id)\n            id = id.substr(this.id.length+1);\n        this.subComponents[id] = co;\n        co.parent = this;\n    },\n\n    //\n    isVisible: function() {\n        return true;\n    },\n\n    //\n    isEnabled: function() {\n        return true;\n    }\n\n});\n\n\n/**\n * Field virtual component\n *\n * @class Sfera.Components._Field\n * @constructor\n */\nSfera.Components.create(\"_Field\", {\n    presets: [\"Visibility\", \"Position\", \"Size\", \"Style\"],\n\n    attributes: {\n        value: {}\n    },\n\n    init: function() {\n        this.focused = false;\n    },\n\n    focus: function() {},\n\n    blur: function() {},\n\n    onFocus: function() {},\n\n    onBlur: function() {}\n\n});\n\n\nif (typeof exports !== 'undefined') {\n        if (typeof module !== 'undefined' && module.exports) {\n            exports = module.exports = Sfera;\n        }\n        exports.Sfera = Sfera;\n    } else if (typeof define !== 'undefined' && define.amd) {\n        define('Sfera', (function() { return root.Sfera = Sfera; }) ());\n    } else {\n        root.Sfera = Sfera;\n    }\n}).call(this);\n\n/*\n* \"\"\n*/\n\n//# sourceMappingURL=sfera-webapp.js.map","/**\n * @author       Gionatan Iasio <gionatan@sferalabs.cc>\n * @copyright    2015 SferaLabs\n * @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n * Default.js\n */\n\n/**\n * Sfera.Skins.Default contains and handles skins\n *\n * @class Sfera.Skins.Default\n * @constructor\n */\nSfera.Skins.Default = function() {\n\n    this.VERSION = \"1.0\";\n\n    this.styles = {\n        Input: [\"default\", \"clear\"],\n        Button: [\"default\", \"clear\", \"icon\"],\n        Checkbox: [\"default\", \"radio\", \"switch\", \"clear\"],\n        Radio: [\"default\"],\n    };\n\n    this.colors = {\n        Button: [\n            \"default\",\n            \"light\",\n            \"stable\",\n            \"positive\",\n            \"calm\",\n            \"balanced\",\n            \"energized\",\n            \"assertive\",\n            \"royal\",\n            \"dark\"\n        ]\n    }\n\n};\n","/**\n * @author       Gionatan Iasio <gionatan@sferalabs.cc>\n * @copyright    2015 SferaLabs\n * @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n */\n\n/**\n * Button component.\n *\n * @class Sfera.Components.Button\n * @constructor\n */\nSfera.Components.create(\"Button\", {\n    presets: [\"Visibility\", \"Position\", \"Size\", \"Style\", \"Color\"],\n\n    attributes: {\n        // command\n        command: {\n            type: \"string\"\n        },\n\n        label: {\n            update: function() {\n                var co = this.component;\n                var label = co.subComponents.label;\n                label.setAttribute(\"label\", this.value);\n                if (this.value) {\n                    co.elements.label.style.display = \"\";\n                    //label.setAttribute(\"visible\",true);\n                } else {\n                    co.elements.label.style.display = \"none\";\n                    //label.setAttribute(\"visible\",false);\n                }\n                //this.component.element.innerHTML = \"<div class='inner'>\" + this.value + \"</div>\";\n            }\n        },\n\n        icon: {\n            type: \"string\",\n            default: \"\",\n            update: function() {\n                var co = this.component;\n                var icon = co.subComponents.icon;\n                icon.setAttribute(\"source\", this.value);\n                if (this.value) {\n                    co.elements.icon.style.display = \"\";\n                    //icon.setAttribute(\"visible\",true);\n                } else {\n                    co.elements.icon.style.display = \"none\";\n                    //icon.setAttribute(\"visible\",false);\n                }\n            }\n        },\n\n        fontSize: {\n            update: function() {\n                var co = this.component;\n                var label = co.subComponents.label;\n                label.setAttribute(\"fontSize\", this.value);\n            }\n        },\n\n        onClick: {\n            type: \"js\"\n        },\n\n        onDown: {\n            type: \"js\"\n        },\n\n        onMove: {\n            type:\"js\"\n        }\n\n    },\n\n    init: function() {\n\n        // fill elements with all nodes that have a name\n        this.elements = Sfera.Utils.getComponentElements(this.element, true, this.elements);\n\n        this.button = new Sfera.UI.Button(this.elements.container, {\n            ondown: this.onDown.bind(this),\n            onup: this.onUp.bind(this),\n            onmove: this.onMove.bind(this)\n        });\n\n        this.updateClass();\n\n        //this.element.onclick = this.onClick.bind(this);\n    },\n\n    updateClass: function() {\n        var col = this.getAttribute(\"color\") || \"default\";\n        var sty = this.getAttribute(\"style\") || \"default\";\n        this.button.setClassName(\"container\" + (sty?\" style_\"+sty:\"\") + (col?\" color_\"+col:\"\"));\n    },\n\n    onDown: function() {\n        var f = this.getAttribute(\"onDown\");\n        Sfera.Custom.exec(f, this.id);\n    },\n\n    onMove: function() {\n        var f = this.getAttribute(\"onMove\");\n        Sfera.Custom.exec(f, this.id);\n    },\n\n    onUp: function() {\n        var f = this.getAttribute(\"onClick\");\n        Sfera.Custom.exec(f, this.id);\n    }\n\n\n});\n","/**\n * @author       Gionatan Iasio <gionatan@sferalabs.cc>\n * @copyright    2015 SferaLabs\n * @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n * Button.js\n */\n\n/**\n * Input component.\n *\n * @class Sfera.Components.Input\n * @extends Sfera.Components._Field\n * @property {string} type - type of the field\n * @property {string} icon - url of an icon\n */\nSfera.Components.create(\"Input\", {\n    extends: \"_Field\",\n\n    attributes: {\n        type: {\n            type: \"string\",\n            default: \"input\",\n            values: [\"input\",\"textarea\",\"color\",\"date\",\"datetime\",\"email\",\"number\",\"password\",\"tel\",\"time\",\"url\"],\n            update: function() {\n                this.component.redraw();\n            }\n        },\n\n        height: {\n            update: function() {\n                if (this.component.elements.field)\n                    this.component.elements.field.style.height = this.value + \"px\";\n            }\n        },\n\n        focus: {\n            type: \"boolean\",\n            update: function() {\n                if (this.value)\n                    this.component.focus();\n            }\n        },\n\n        icon: {\n            type: \"string\",\n            default: \"\",\n            update: function() {\n                var co = this.component;\n                var icon = co.subComponents.icon;\n                icon.setAttribute(\"source\", this.value);\n                if (this.value) {\n                    co.elements.icon.style.display = \"\";\n                    //icon.setAttribute(\"visible\",true);\n                } else {\n                    co.elements.icon.style.display = \"none\";\n                    //icon.setAttribute(\"visible\",false);\n                }\n            }\n        },\n\n        eraseButton: {\n            type: \"boolean\",\n            default: \"false\",\n            update: function() {\n                var co = this.component;\n                co.elements.erase.style.display = this.value ? \"\" : \"none\";\n            }\n        },\n\n        value: {\n            update: function() {\n                if (this.component.elements.field)\n                    this.component.elements.field.value = this.value;\n            }\n        },\n\n        changeDelay: {\n            type: \"integer\",\n            default: \"1000\" // msec to wait before noticing a change\n        },\n\n        // regular expression used to validate keydown\n        keyRegex: {\n            type: \"regexp\"\n        },\n\n        // regular expression used to validate value before submitting\n        valueRegex: {\n            type: \"regexp\",\n\n            compile: function() {\n                this.value = Sfera.Compiler.compileAttributeValue(this, \"^(\" + this.source + \")$\"); // add begin and end, it has to match the whole string\n                // do nothing else, since there's no update needed\n            }\n        },\n\n        fontSize: {\n            type: \"integer\",\n\n            update: function() {\n                if (this.component.elements.field)\n                    this.component.elements.field.style.fontSize = this.value + \"px\";\n                //this.component.subComponents.erase.setAttribute(\"width\")\n            }\n        },\n\n        fontColor: {\n            update: function() {\n                if (this.component.elements.field)\n                    this.component.elements.field.style.color = this.value;\n            }\n        },\n\n        maxLength: {\n            type: \"integer\"\n        },\n\n        onKeyUp: {\n            type: \"js\"\n        },\n        onChange: {\n            type: \"js\",\n            default: \"event(id,value)\"\n        },\n        onEnter: {\n            type: \"js\"\n        },\n        onFocus: {\n            type: \"js\"\n        },\n        onBlur: {\n            type: \"js\"\n        }\n    },\n\n    init: function() {\n        var self = this;\n\n        this.value = \"\"; // TODO: used?\n        this.changeTimeout = null;\n\n        // fill elements with all nodes that have a name\n        this.elements = Sfera.Utils.getComponentElements(this.element, true, this.elements);\n\n        this.eraseButton = new Sfera.UI.Button(this.elements.erase, {\n            onclick: this.onErase.bind(this)\n        });\n\n        /*\n        switch (this.getAttribute(\"type\")) {\n            case \"date\":\n                this.btObj = new Sfera.UI.Button(this.element, {\n                    onclick: this.onClick.bind(this)\n                });\n        }\n        */\n    },\n\n\n    focus: function() {\n        this.elements.field.focus(); // will fire onFocus\n    },\n\n    blur: function() {\n        this.elements.field.blur(); // will fire onBlur\n    },\n\n\n\n    // redraw\n    redraw: function() {\n        var value = \"\";\n\n        if (this.elements.field) {\n            this.elements.field.onfocus = null;\n            this.elements.field.onblur = null;\n            this.elements.field.onselectstart = null;\n            value = this.elements.field.value;\n            this.elements.field = null;\n        }\n        var type = this.getAttribute(\"type\");\n        var phText = this.getAttribute(\"placeHolder\");\n        phText = phText ? ' placeholder=\"' + phText + '\"' : '';\n        var style = \"\"; // TODO: styling the field\n        style = style ? ' style=\"' + style + '\"' : '';\n\n        if (type == \"textarea\")\n            this.elements.fieldC.innerHTML = '<textarea class=\"field\" ' + style + phText + ' /></textarea>';\n        else\n            this.elements.fieldC.innerHTML = '<input class=\"field\" type=\"' + type + '\"' + style + phText + ' />';\n\n        this.elements.field = this.elements.fieldC.childNodes[0];\n        this.elements.field.value = value;\n        this.attributes.height.update();\n\n        if (Sfera.Device.android == \"Android\") { // android: gets last click on a different page if in same position\n            this.elements.field.onfocus = function() {\n                return false;\n            };\n            this.elements.field.oninput = this.onUserChange;\n        } else {\n            this.elements.field.onfocus = this.onFocus; // skip this.elements.field.focus to avoid loop\n        }\n        this.elements.field.onblur = this.onBlur;\n        this.elements.field.onselectstart = this.onSelectStart;\n\n        this.elements.field.controller = this;\n    },\n\n\n    updateClass: function () {\n        this.element.className = \"component comp_input\" + (this.focused?\" focused\":\"\");\n        var sty = this.getAttribute(\"style\");\n        this.elements.container.className = \"container\" + (sty?\" style_\"+sty:\"\");\n    },\n\n    //\n    // events\n    //\n\n    // on erase button\n    onErase: function() {\n        this.setAttribute(\"value\", \"\");\n        this.onChangedTimeout();\n    },\n\n    onChanged: function() {\n        var v = this.elements.field.value;\n\n        if (v != this.attributes.value.source) {\n            this.attributes.value.source =\n                this.attributes.value.value = v;\n\n            this.clearChangeTimeout();\n            //if (foo.autoSend || foo.onUserChange) { // otherwise there's nothing to do\n\n            var changeDelay = this.getAttribute(\"changeDelay\");\n            var self = this;\n            if (changeDelay) // if 0, disabled\n                this.changeTimeout = setTimeout(function() {\n                self.onChangedTimeout()\n            }, changeDelay);\n        }\n    },\n\n    clearChangeTimeout: function() {\n        if (this.changeTimeout) {\n            clearTimeout(this.changeTimeout);\n            this.changeTimeout = null; // make sure?\n        }\n    },\n\n    // on changed after timeout\n    onChangedTimeout: function() {\n        this.clearChangeTimeout();\n\n        // custom change event\n        var f = this.getAttribute(\"onChange\");\n        var value = this.getAttribute(\"value\");\n        Sfera.Custom.exec(f, this.id, value);\n    },\n\n    onSelectStart: function(event) {\n\n    },\n\n    onKeyDown: function(event) {\n        //this.controller.setAttribute(\"error\", \"false\"); // make sure we're not showing an error\n        var code = event.keyCode;\n        var c = Sfera.Utils.getKeyFromCode(code);\n        var type = this.getAttribute(\"type\");\n\n        // trigger on enter event\n        if (c == \"enter\" && !this.onEnter()) {\n            c = \"\"; // onEnter prevented, don't focus next\n        }\n\n        if ((c == \"enter\" && type != \"textarea\") || c == \"tab\") {\n            this.onChangedTimeout(); // send now\n\n            Sfera.client.focusNext(event.shiftKey);\n            if (c == \"enter\" && type != \"textarea\")\n                this.blur(); // still focused? (no next object)\n\n            return false; // done, prevent\n        } else {\n            this.onChanged();\n\n            return true; // allow\n        }\n    },\n\n    onKeyPress: function(event) {\n        var code = event.keyCode;\n        var c = Sfera.Utils.getKeyFromCode(code);\n        var fieldE = this.elements.field;\n        var value = this.getAttribute(\"value\");\n        var keyRegex = this.getAttribute(\"keyRegex\");\n        var maxLength = this.getAttribute(\"maxLength\");\n\n        function getSelectedText() {\n            var text = \"\";\n            if (fieldE.selectionStart != fieldE.selectionEnd) {\n                text = value.substr(fieldE.selectionStart, fieldE.selectionEnd);\n            } else if (typeof window.getSelection != \"undefined\") {\n                text = window.getSelection().toString();\n            } else if (typeof document.selection != \"undefined\" && document.selection.type == \"Text\") {\n                text = document.selection.createRange().text;\n            }\n            return text;\n        }\n\n        // check max length\n        if (!c && value && maxLength && value.length >= maxLength && !getSelectedText()) {\n            return false; // prevent\n        }\n\n        // validate? (only if ctrl or meta are not pressed)\n        if (!c && keyRegex && !event.ctrlKey && !event.metaKey && !keyRegex.test(String.fromCharCode(code)))\n            return false; // key validation failed: prevent\n\n        this.onChanged();\n        return true; // allow\n    },\n\n    onKeyUp: function(event) {\n        var code = event.keyCode;\n        var c = Sfera.Utils.getKeyFromCode(code);\n\n        if (c != \"enter\" && c !== \"tab\") {\n            this.onChanged();\n            return false; // nothing to see here: prevent\n        }\n\n        return true;\n    },\n\n    onChange: function() {\n        this.onChanged();\n        /*\n        var f = this.getAttribute(\"onClick\");\n        Sfera.Custom.exec(f);\n        */\n    },\n\n    onEnter: function () {\n        var f = this.getAttribute(\"onEnter\");\n        if (f) {\n            return Sfera.Custom.exec(f);\n        } else {\n            return true; // don't block it\n        }\n    },\n\n    onFocus: function() {\n        var co = this.controller;\n        Sfera.client.setFocused(co);\n        co.focused = true;\n        co.updateClass();\n    },\n\n    onBlur: function() {\n        var co = this.controller;\n        co.onChanged();\n        Sfera.client.clearFocused(co);\n        co.focused = false;\n        co.updateClass();\n    },\n\n    onShow: function() {\n        if (this.getAttribute(\"focus\"))\n            this.focus();\n    },\n\n    onHide: function() {\n\n    }\n\n});\n","/**\n * @author       Gionatan Iasio <gionatan@sferalabs.cc>\n * @copyright    2015 SferaLabs\n * @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n * Image.js\n */\n\n/**\n * Image component.\n *\n * @class Sfera.Components.Image\n * @mixes Sfera.Behaviors.Visibility\n * @mixes Sfera.Behaviors.Position\n * @property {string} source - source url of the image\n */\nSfera.Components.create(\"Image\", {\n    presets: [\"Visibility\", \"Position\", \"Size\"],\n\n    attributes: {\n        source: {\n            type: \"string\",\n            update: function() {\n                var c = this.component;\n                var e = c.element;\n                // no source, hide it\n                if (!this.value) {\n                    e.innerHTML = \"\";\n                }\n                // svg\n                else if (this.value.indexOf(\".svg\") == this.value.length - 4) {\n                    var req = new Sfera.Net.Request();\n                    req.init();\n                    req.onLoaded = function() {\n                        var xml = req.getResponseXML();\n                        var svg = xml.getElementsByTagName(\"svg\")[0];\n                        e.innerHTML = \"\";\n                        if (svg) {\n                            e.appendChild(svg);\n                            svg.style.width = c.getAttribute(\"width\");\n                            svg.style.height = c.getAttribute(\"height\");\n                        }\n                        // done\n                        delete req;\n                    }\n                    req.open(this.value);\n                }\n                // normal img\n                else {\n                    e.innerHTML = \"<img src='\" + this.value + \"' width='100%' height='100%'>\";\n                }\n            }\n        }\n    },\n\n    init: function() {}\n\n});\n","/**\n * @author       Gionatan Iasio <gionatan@sferalabs.cc>\n * @copyright    2015 SferaLabs\n * @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n * Page.js\n */\n\n/**\n * Page component.\n *\n * @class Sfera.Components.Page\n * @constructor\n */\n Sfera.Components.create(\"Page\",{\n     presets:[\"Visibility\"],\n\n     attributes: {\n         title: {\n             type:\"string\"\n         },\n\n         visible: {\n             default:\"false\"\n         }\n     },\n\n     init: function(){\n     }\n });\n","/**\n * @author       Gionatan Iasio <gionatan@sferalabs.cc>\n * @copyright    2015 SferaLabs\n * @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n * Label.js\n */\n\n/**\n * Label component.\n *\n * @class Sfera.Components.Label\n * @constructor\n */\nSfera.Components.create(\"Label\", {\n    presets: [\"Visibility\", \"Position\", \"Size\", \"Label\"],\n\n    attributes: {\n        // change label to text\n        label: null,\n\n        text: {\n            type: \"string\",\n            update: function() {\n                this.component.element.innerHTML = this.value;\n            }\n        }\n    }\n});\n","/**\n * @author       Gionatan Iasio <gionatan@sferalabs.cc>\n * @copyright    2015 SferaLabs\n * @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n * Interface.js\n */\n\n/**\n * Interface component.\n *\n * @class Sfera.Components.Interface\n * @constructor\n */\n Sfera.Components.create(\"Interface\",{\n     presets:[\"Visibility\",\"Size\"],\n\n     attributes: {\n\n         skin: {\n            default:\"default\",\n            update: function () {\n                Sfera.client.skin = new Sfera.Skins[Sfera.Utils.capitalize(this.value)]();\n            }\n         },\n\n         zoom: {\n             type:\"float\",\n             update: function () {\n         \t\tif (this.value != 1) {\n         \t\t\tvar bodyE = document.getElementsByTagName(\"BODY\")[0];\n         \t\t\tvar v = \"scale(\"+this.value+\",\"+this.value+\")\";\n         \t\t\tif (Sfera.Device.browser == \"IE\") {\n         \t\t\t\tbodyE.style.msTransform = v;\n         \t\t\t\tbodyE.style.msTransformOrigin = \"0% 0%\";\n         \t\t\t} else {\n         \t\t\t\tbodyE.style.zoom = (this.value*100)+\"%\";\n         \t\t\t\tbodyE.style.OTransform = v;\n         \t\t\t\tbodyE.style.MozTransform = v;\n         \t\t\t\tbodyE.style.WebkitTransformOrigin = \"0 0\";\n         \t\t\t\tbodyE.style.transformOrigin = \"0% 0%\";\n         \t\t\t}\n         \t\t\t// prevent artifacts\n         \t\t\tbodyE.style.width = \"0px\";\n         \t\t\tbodyE.style.height = \"0px\";\n         \t\t}\n\n             }\n         }\n     }\n });\n","/**\n* @author       Gionatan Iasio <gionatan@sferalabs.cc>\n* @copyright    2015 SferaLabs\n* @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n* Custom_Intro.js\n*/\n\nSfera.Custom = new (function(){\n\n    var root = this;\n/**\n* @author       Gionatan Iasio <gionatan@sferalabs.cc>\n* @copyright    2015 SferaLabs\n* @license      {@link https://github.com/sfera-labs/sfera-webapp/license.txt|MIT License}\n* Custom.Outro.js\n*/\n\n    // bridge functions\n    this.startupEvent = (typeof(StartupEvent) === 'function') ? function () {StartupEvent();} : null;\n    this.commandEvent = (typeof(commandEvent) === 'function') ? function (id, value) {return commandEvent(id, value);} : null;\n    this.uiEvent = (typeof(uiEvent) === 'function') ? function (id, attr, value) {return uiEvent(id, attr, value);} : null;\n    this.pageOpenEvent = (typeof(pageOpenEvent) === 'function') ? function (name) {return pageOpenEvent(name);} : null;\n    this.pageCloseEvent = (typeof(pageCloseEvent) === 'function') ? function (name) {return pageCloseEvent(name);} : null;\n    this.pageBackEvent = (typeof(pageBackEvent) === 'function') ? function (name) {return pageBackEvent(name);} : null;\n\n    // context functions\n    function page(id) {\n        Sfera.client.showPage(id);\n    }\n\n    function event(id, value) {\n        Sfera.client.sendEvent(id, value, this);\n    }\n\n    function command(command, callback)  {\n        Sfera.client.sendCommand(command, this);\n    }\n\n    function logout() {\n        Sfera.Login.logout();\n    }\n\n    function login(username, password) {\n        Sfera.Login.login(username, password);\n    }\n\n    // exec custom code. optional: id of the component calling, value to be sent\n    this.exec = function (f, id, value) {\n        // eval button js\n        try {\n            var result = eval(f);\n        } catch (e) {\n            if (e instanceof SyntaxError) {\n                alert(e.message);\n            } else {\n                throw (e);\n            }\n        }\n        return (result === false ? false : true); // return false (block event?) only if eval results in false\n    };\n\n})();\n"]}