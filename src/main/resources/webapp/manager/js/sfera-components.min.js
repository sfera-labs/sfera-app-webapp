/*! sfera-webapp - v0.0.2 - 15-04-2016 */
Sfera.Components.create("Button",{presets:["Visibility","Position","Size","Style","Color"],attributes:{command:{type:"string"},label:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},fontSize:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("fontSize",this.value)}},onClick:{type:"js"},onDown:{type:"js"},onMove:{type:"js"}},init:function(){this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.button=new Sfera.UI.Button(this.elements.container,{ondown:this.onDown.bind(this),onup:this.onUp.bind(this),onmove:this.onMove.bind(this)}),this.updateClass()},updateClass:function(){var a=this.getAttribute("color")||"default",b=this.getAttribute("style")||"default";this.button.setClassName("container"+(b?" style_"+b:"")+(a?" color_"+a:""))},onDown:function(){var a=this.getAttribute("onDown");Sfera.Custom.exec(a,this.id)},onMove:function(){var a=this.getAttribute("onMove");Sfera.Custom.exec(a,this.id)},onUp:function(){var a=this.getAttribute("onClick");Sfera.Custom.exec(a,this.id)}}),Sfera.Components.create("Checkbox",{"extends":"_Field",attributes:{type:{type:"string","default":"input",update:function(){this.component.redraw()}},width:{update:function(){this.component.elements.button&&(this.component.elements.button.style.width=this.value+"px")}},height:{update:function(){this.component.elements.button&&(this.component.elements.button.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},label:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},value:{type:"boolean",update:function(){this.component.redraw()}},changeDelay:{type:"integer","default":"200"},fontSize:{type:"integer",update:function(){this.component.subComponents.label.setAttribute("fontSize",this.value)}},fontColor:{update:function(){this.component.subComponents.label.setAttribute("fontColor",this.value)}},style:{update:function(){var a=this.component;a.redraw()}},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.btObj=new Sfera.UI.Button(this.element,{onclick:this.onClick.bind(this)})},focus:function(){this.onFocus()},blur:function(){this.onBlur()},redraw:function(){var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")+" "+(this.getAttribute("value")?"on":"off")},updateClass:function(){this.btObj.setAttribute("focused",this.focused)},onChanged:function(){this.clearChangeTimeout();var a=this.getAttribute("changeDelay"),b=this;a&&(this.changeTimeout=setTimeout(function(){b.onChangedTimeout()},a))},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},flip:function(){this.setAttribute("value",!this.getAttribute("value")),this.onChange()},onClick:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}b!==!1&&(this.focus(),this.flip())},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):("space"==c&&this.flip(),this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;Sfera.Utils.getKeyFromCode(b);return this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!=c?(this.onChanged(),!1):!0},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Container",{presets:["Visibility","Position","Size"],attributes:{width:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}},height:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}}}}),Sfera.Components.create("Image",{presets:["Visibility","Position","Size"],attributes:{source:{type:"string",update:function(){var a=this.component,b=a.element;if(this.value)if(this.value.indexOf(".svg")==this.value.length-4){var c=new Sfera.Net.Request;c.init(),c.onLoaded=function(){var d=c.getResponseXML(),e=d.getElementsByTagName("svg")[0];b.innerHTML="",e&&(b.appendChild(e),e.style.width=a.getAttribute("width"),e.style.height=a.getAttribute("height")),delete c},c.open(this.value)}else b.innerHTML="<img src='"+this.value+"' width='100%' height='100%'>";else b.innerHTML=""}}},init:function(){}}),Sfera.Components.create("Input",{"extends":"_Field",attributes:{type:{type:"string","default":"input",values:["input","textarea","color","date","datetime","email","number","password","tel","time","url"],update:function(){this.component.redraw()}},height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},eraseButton:{type:"boolean","default":"false",update:function(){var a=this.component;a.elements.erase.style.display=this.value?"":"none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.eraseButton=new Sfera.UI.Button(this.elements.erase,{onclick:this.onErase.bind(this)})},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=this.getAttribute("type"),c=this.getAttribute("placeHolder");c=c?' placeholder="'+c+'"':"";var d="";d=d?' style="'+d+'"':"","textarea"==b?this.elements.fieldC.innerHTML='<textarea class="field" '+d+c+" /></textarea>":this.elements.fieldC.innerHTML='<input class="field" type="'+b+'"'+d+c+" />",this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onselectstart=this.onSelectStart,this.elements.field.controller=this},updateClass:function(){this.element.className="component comp_input"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container"+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Interface",{presets:["Visibility","Size"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},skin:{"default":"default",update:function(){Sfera.client.skin=new(Sfera.Skins[Sfera.Utils.capitalize(this.value)])}},zoom:{type:"float",update:function(){if(1!=this.value){var a=document.getElementsByTagName("BODY")[0],b="scale("+this.value+","+this.value+")";"IE"==Sfera.Device.browser?(a.style.msTransform=b,a.style.msTransformOrigin="0% 0%"):(a.style.zoom=100*this.value+"%",a.style.OTransform=b,a.style.MozTransform=b,a.style.WebkitTransformOrigin="0 0",a.style.transformOrigin="0% 0%"),a.style.width="0px",a.style.height="0px"}}}}}),Sfera.Components.create("Label",{presets:["Visibility","Position","Size","Label"],attributes:{label:null,text:{type:"string",update:function(){this.component.element.innerHTML=this.value}}}}),Sfera.Components.create("Page",{presets:["Visibility"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},visible:{"default":"false"}},init:function(){}}),Sfera.Components.create("Radio",{"extends":"Checkbox",attributes:{group:{type:"string",update:function(){var a=this.component;a.group&&Sfera.client.components.removeByGroup(a,a.group),a.group=this.value,a.group&&Sfera.client.components.addByGroup(a,a.group)}}},init:function(){this["super"]("Checkbox","init")},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}if(b!==!1){var d=this.getAttribute("group");if(d&&this.getAttribute("value"))for(var e=Sfera.client.components.getByGroup(d),f=0;f<e.length;f++)e[f]!=this&&e[f].setAttribute("value",!1);this.onChanged()}}}),Sfera.Components.create("Select",{"extends":"_Field",attributes:{height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},values:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},labels:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.redraw()},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=(this.getAttribute("type"),this.getAttribute("placeHolder"));b=b?' placeholder="'+b+'"':"";var c="";c=c?' style="'+c+'"':"";var d=this.getAttribute("values"),e=this.getAttribute("labels"),f='<select class="field" '+c+b+" />";if(d)for(var g=0;g<d.length;g++)v=d[g],l=e&&e[g]||v,f+='<option value="'+v+'">'+l+"</option>";f+="</select>",this.elements.fieldC.innerHTML=f,this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onchange=this.onChange,this.elements.field.controller=this},updateOptions:function(){this.redraw()},updateClass:function(){this.element.className="component comp_select"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.controller.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("SferaBg",{init:function(){function a(a){return document.getElementById(a)}function b(a){return Math.floor(Math.random()*a)}function c(a){var b=(new Date).getTime(),c=a.x,d=a.y;a.ls||(a.ls=b);var e=b-a.ls,f=e*a.s/100-a.p;return c+=Math.sin(f)*a.a,d+=Math.sin(f)*a.b,{x:c,y:d}}function d(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(f*f+e*e)}function e(){var e,g,i,j,k,l,m,n,o,p=window.innerWidth,q=window.innerHeight,r=200;try{n=a("c"),o=n.getContext("2d"),m="undefined"!=typeof n.style.opacity,m&&(n.style.opacity=.3)}catch(s){return}if(o.canvas.width=p,o.canvas.height=q,!f){for(f=[],e=-1;p/r>=e;e++)for(g=-1;q/r>=g;g++)l={x:r*e+b(r),y:r*g+b(r),r:b(10)+4,a:b(13),b:b(13),p:b(100),w:b(1e4),s:b(10)/100,l:[]},f.push(l),h++;for(l=0;h>l;l++)for(e=f[l].x,g=f[l].y,k=l+1;h>k;k++)i=f[k].x,j=f[k].y,d(e,g,i,j)<2*r&&f[l].l.push(f[k])}for(o.strokeStyle=o.fillStyle=m?"#fff":"#7194b8",l=0;h>l;l++){for(e=c(f[l]).x,g=c(f[l]).y,k=0;k<f[l].l.length;k++)i=c(f[l].l[k]).x,j=c(f[l].l[k]).y,o.moveTo(e,g),o.lineTo(i,j);o.stroke(),o.beginPath(),o.arc(e,g,f[l].r,0,2*Math.PI,!1),o.fill()}}var f,g=0,h=0;window.addEventListener("resize",function(){clearTimeout(g),g=setTimeout(e,100)}),a("bg").innerHTML="<canvas id='c'></canvas>",setInterval(e,50)}}),Sfera.Components.create("Slider",{presets:["Visibility","Position","Size","Style","Color"],attributes:{width:{post:function(){this.component.updateDirection()}},height:{post:function(){this.component.updateDirection()}},cursorSize:{type:"integer","default":"30",update:function(){this.component.updateDirection()}},barColor:{type:"color","default":"transparent",update:function(){this.component.elements.fill.style.backgroundColor=this.value}},min:{type:"integer","default":"0",update:function(){this.component.updateValue()}},max:{type:"integer","default":"100",update:function(){this.component.updateValue()}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},color:{values:function(){var a=Sfera.client.skin.colors.Button;return a?a:["default"]},post:function(){this.component.subComponents.cursor.setAttribute("color",this.value)}},value:{update:function(){this.component.updateValue()}},changeDelay:{type:"integer","default":"1000"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements);var a={};a.ondown=this.onDown.bind(this),Sfera.Device.touch||(a.onover=this.onOver.bind(this),a.onout=this.onOut.bind(this)),this.button=new Sfera.UI.Button(this.elements.over,a);var b=this.subComponents.cursor;b.button.link(this.button)},onOver:function(){},onOut:function(){},onDown:function(a){this.isDown=!0,this._onUp=this.onUp.bind(this),this._onMove=this.onMove.bind(this),Sfera.Device.touch?(window.addEvent("touchend",document.body,this._onUp),window.addEvent("touchmove",document.body,this._onMove)):(window.addEvent("mouseup",document.body,this._onUp),window.addEvent("mousemove",document.body,this._onMove)),this._bp=Sfera.Utils.getElementAbsolutePosition(this.elements.bar_in),this.onMove(a)},onUp:function(a){this.isDown=!1,Sfera.Device.touch?(window.removeEvent("touchend",document.body,this._onUp),window.removeEvent("touchmove",document.body,this._onMove)):(window.removeEvent("mouseup",document.body,this._onUp),window.removeEvent("mousemove",document.body,this._onMove))},onMove:function(a){var b=Sfera.Utils.getMouseAbsolutePosition(a,this.elements.bar_in);if(this.isDown){var c=this.getAttribute("width"),d=this.getAttribute("height"),e=d>c,f=this.getAttribute("cursorSize"),g=e?(b.y-this._bp.y-f/2)/(d-f):(b.x-this._bp.x-f/2)/(c-f);e&&(g=1-g);var h=this.getAttribute("min"),i=this.getAttribute("max"),g=g*(i-h)+h;g=h>g?h:g>i?i:g,this.setAttribute("value",g),this.onChange()}},focus:function(){this.onFocus()},blur:function(){this.onBlur()},updateValue:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=b>a,d=this.getAttribute("value"),e=this.getAttribute("cursorSize"),f=this.getAttribute("min"),g=this.getAttribute("max"),h=(d-f)/(g-f),i=1-h;c?(this.elements.fill.style.height=h*b+"px",this.elements.fill.style.width="",this.elements.fill.style.marginTop=i*b+"px",this.elements.fill.style.marginLeft=""):(this.elements.fill.style.width=h*a+"px",this.elements.fill.style.height="",this.elements.fill.style.marginTop=""),this.subComponents.cursor.setAttribute(c?"y":"x",(c?i:h)*(c?b-e:a-e)),this.subComponents.cursor.setAttribute(c?"x":"y","0")},updateDirection:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=this.getAttribute("cursorSize");if(a&&b&&c){var d=b>a;this.vertical=d,this.updateClass(),this.subComponents.cursor.setAttribute("width",d?a:c),this.subComponents.cursor.setAttribute("height",d?c:b),this.updateValue()}},updateClass:function(){this.element.className="component comp_slider "+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(this.vertical?"vertical":"horizontal")+(a?" style_"+a:"")},onChanged:function(){var a=this.getAttribute("value");if(a!=this.sentValue){this.sentValue=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;Sfera.Utils.getKeyFromCode(b),this.getAttribute("value");return this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Button",{presets:["Visibility","Position","Size","Style","Color"],attributes:{command:{type:"string"},label:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},fontSize:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("fontSize",this.value)}},onClick:{type:"js"},onDown:{type:"js"},onMove:{type:"js"}},init:function(){this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.button=new Sfera.UI.Button(this.elements.container,{ondown:this.onDown.bind(this),onup:this.onUp.bind(this),onmove:this.onMove.bind(this)}),this.updateClass()},updateClass:function(){var a=this.getAttribute("color")||"default",b=this.getAttribute("style")||"default";this.button.setClassName("container"+(b?" style_"+b:"")+(a?" color_"+a:""))},onDown:function(){var a=this.getAttribute("onDown");Sfera.Custom.exec(a,this.id)},onMove:function(){var a=this.getAttribute("onMove");Sfera.Custom.exec(a,this.id)},onUp:function(){var a=this.getAttribute("onClick");Sfera.Custom.exec(a,this.id)}}),Sfera.Components.create("Checkbox",{"extends":"_Field",attributes:{type:{type:"string","default":"input",update:function(){this.component.redraw()}},width:{update:function(){this.component.elements.button&&(this.component.elements.button.style.width=this.value+"px")}},height:{update:function(){this.component.elements.button&&(this.component.elements.button.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},label:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},value:{type:"boolean",update:function(){this.component.redraw()}},changeDelay:{type:"integer","default":"200"},fontSize:{type:"integer",update:function(){this.component.subComponents.label.setAttribute("fontSize",this.value)}},fontColor:{update:function(){this.component.subComponents.label.setAttribute("fontColor",this.value)}},style:{update:function(){var a=this.component;a.redraw()}},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.btObj=new Sfera.UI.Button(this.element,{onclick:this.onClick.bind(this)})},focus:function(){this.onFocus()},blur:function(){this.onBlur()},redraw:function(){var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")+" "+(this.getAttribute("value")?"on":"off")},updateClass:function(){this.btObj.setAttribute("focused",this.focused)},onChanged:function(){this.clearChangeTimeout();var a=this.getAttribute("changeDelay"),b=this;a&&(this.changeTimeout=setTimeout(function(){b.onChangedTimeout()},a))},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},flip:function(){this.setAttribute("value",!this.getAttribute("value")),this.onChange()},onClick:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}b!==!1&&(this.focus(),this.flip())},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):("space"==c&&this.flip(),this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;return Sfera.Utils.getKeyFromCode(b),this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!=c?(this.onChanged(),!1):!0},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Container",{presets:["Visibility","Position","Size"],attributes:{width:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}},height:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}}}}),Sfera.Components.create("Image",{presets:["Visibility","Position","Size"],attributes:{source:{type:"string",update:function(){var a=this.component,b=a.element;if(this.value)if(this.value.indexOf(".svg")==this.value.length-4){var c=new Sfera.Net.Request;c.init(),c.onLoaded=function(){var d=c.getResponseXML(),e=d.getElementsByTagName("svg")[0];b.innerHTML="",e&&(b.appendChild(e),e.style.width=a.getAttribute("width"),e.style.height=a.getAttribute("height")),delete c},c.open(this.value)}else b.innerHTML="<img src='"+this.value+"' width='100%' height='100%'>";else b.innerHTML=""}}},init:function(){}}),Sfera.Components.create("Input",{"extends":"_Field",attributes:{type:{type:"string","default":"input",values:["input","textarea","color","date","datetime","email","number","password","tel","time","url"],update:function(){this.component.redraw()}},height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},eraseButton:{type:"boolean","default":"false",update:function(){var a=this.component;a.elements.erase.style.display=this.value?"":"none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.eraseButton=new Sfera.UI.Button(this.elements.erase,{onclick:this.onErase.bind(this)})},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=this.getAttribute("type"),c=this.getAttribute("placeHolder");c=c?' placeholder="'+c+'"':"";var d="";d=d?' style="'+d+'"':"","textarea"==b?this.elements.fieldC.innerHTML='<textarea class="field" '+d+c+" /></textarea>":this.elements.fieldC.innerHTML='<input class="field" type="'+b+'"'+d+c+" />",this.elements.field=this.elements.fieldC.childNodes[0],
this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onselectstart=this.onSelectStart,this.elements.field.controller=this},updateClass:function(){this.element.className="component comp_input"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container"+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Interface",{presets:["Visibility","Size"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},skin:{"default":"default",update:function(){Sfera.client.skin=new(Sfera.Skins[Sfera.Utils.capitalize(this.value)])}},zoom:{type:"float",update:function(){if(1!=this.value){var a=document.getElementsByTagName("BODY")[0],b="scale("+this.value+","+this.value+")";"IE"==Sfera.Device.browser?(a.style.msTransform=b,a.style.msTransformOrigin="0% 0%"):(a.style.zoom=100*this.value+"%",a.style.OTransform=b,a.style.MozTransform=b,a.style.WebkitTransformOrigin="0 0",a.style.transformOrigin="0% 0%"),a.style.width="0px",a.style.height="0px"}}}}}),Sfera.Components.create("Label",{presets:["Visibility","Position","Size","Label"],attributes:{label:null,text:{type:"string",update:function(){this.component.element.innerHTML=this.value}}}}),Sfera.Components.create("Page",{presets:["Visibility"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},visible:{"default":"false"}},init:function(){}}),Sfera.Components.create("Radio",{"extends":"Checkbox",attributes:{group:{type:"string",update:function(){var a=this.component;a.group&&Sfera.client.components.removeByGroup(a,a.group),a.group=this.value,a.group&&Sfera.client.components.addByGroup(a,a.group)}}},init:function(){this["super"]("Checkbox","init")},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}if(b!==!1){var d=this.getAttribute("group");if(d&&this.getAttribute("value"))for(var e=Sfera.client.components.getByGroup(d),f=0;f<e.length;f++)e[f]!=this&&e[f].setAttribute("value",!1);this.onChanged()}}}),Sfera.Components.create("Select",{"extends":"_Field",attributes:{height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},values:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},labels:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.redraw()},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=(this.getAttribute("type"),this.getAttribute("placeHolder"));b=b?' placeholder="'+b+'"':"";var c="";c=c?' style="'+c+'"':"";var d=this.getAttribute("values"),e=this.getAttribute("labels"),f='<select class="field" '+c+b+" />";if(d)for(var g=0;g<d.length;g++)v=d[g],l=e&&e[g]||v,f+='<option value="'+v+'">'+l+"</option>";f+="</select>",this.elements.fieldC.innerHTML=f,this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onchange=this.onChange,this.elements.field.controller=this},updateOptions:function(){this.redraw()},updateClass:function(){this.element.className="component comp_select"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.controller.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("SferaBg",{init:function(){function a(a){return document.getElementById(a)}function b(a){return Math.floor(Math.random()*a)}function c(a){var b=(new Date).getTime(),c=a.x,d=a.y;a.ls||(a.ls=b);var e=b-a.ls,f=e*a.s/100-a.p;return c+=Math.sin(f)*a.a,d+=Math.sin(f)*a.b,{x:c,y:d}}function d(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(f*f+e*e)}function e(){var e,g,i,j,k,l,m,n,o,p=window.innerWidth,q=window.innerHeight,r=200;try{n=a("c"),o=n.getContext("2d"),m="undefined"!=typeof n.style.opacity,m&&(n.style.opacity=.3)}catch(s){return}if(o.canvas.width=p,o.canvas.height=q,!f){for(f=[],e=-1;p/r>=e;e++)for(g=-1;q/r>=g;g++)l={x:r*e+b(r),y:r*g+b(r),r:b(10)+4,a:b(13),b:b(13),p:b(100),w:b(1e4),s:b(10)/100,l:[]},f.push(l),h++;for(l=0;h>l;l++)for(e=f[l].x,g=f[l].y,k=l+1;h>k;k++)i=f[k].x,j=f[k].y,d(e,g,i,j)<2*r&&f[l].l.push(f[k])}for(o.strokeStyle=o.fillStyle=m?"#fff":"#7194b8",l=0;h>l;l++){for(e=c(f[l]).x,g=c(f[l]).y,k=0;k<f[l].l.length;k++)i=c(f[l].l[k]).x,j=c(f[l].l[k]).y,o.moveTo(e,g),o.lineTo(i,j);o.stroke(),o.beginPath(),o.arc(e,g,f[l].r,0,2*Math.PI,!1),o.fill()}}var f,g=0,h=0;window.addEventListener("resize",function(){clearTimeout(g),g=setTimeout(e,100)}),a("bg").innerHTML="<canvas id='c'></canvas>",setInterval(e,50)}}),Sfera.Components.create("Slider",{presets:["Visibility","Position","Size","Style","Color"],attributes:{width:{post:function(){this.component.updateDirection()}},height:{post:function(){this.component.updateDirection()}},cursorSize:{type:"integer","default":"30",update:function(){this.component.updateDirection()}},barColor:{type:"color","default":"transparent",update:function(){this.component.elements.fill.style.backgroundColor=this.value}},min:{type:"integer","default":"0",update:function(){this.component.updateValue()}},max:{type:"integer","default":"100",update:function(){this.component.updateValue()}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},color:{values:function(){var a=Sfera.client.skin.colors.Button;return a?a:["default"]},post:function(){this.component.subComponents.cursor.setAttribute("color",this.value)}},value:{update:function(){this.component.updateValue()}},changeDelay:{type:"integer","default":"1000"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements);var a={};a.ondown=this.onDown.bind(this),Sfera.Device.touch||(a.onover=this.onOver.bind(this),a.onout=this.onOut.bind(this)),this.button=new Sfera.UI.Button(this.elements.over,a);var b=this.subComponents.cursor;b.button.link(this.button)},onOver:function(){},onOut:function(){},onDown:function(a){this.isDown=!0,this._onUp=this.onUp.bind(this),this._onMove=this.onMove.bind(this),Sfera.Device.touch?(window.addEvent("touchend",document.body,this._onUp),window.addEvent("touchmove",document.body,this._onMove)):(window.addEvent("mouseup",document.body,this._onUp),window.addEvent("mousemove",document.body,this._onMove)),this._bp=Sfera.Utils.getElementAbsolutePosition(this.elements.bar_in),this.onMove(a)},onUp:function(a){this.isDown=!1,Sfera.Device.touch?(window.removeEvent("touchend",document.body,this._onUp),window.removeEvent("touchmove",document.body,this._onMove)):(window.removeEvent("mouseup",document.body,this._onUp),window.removeEvent("mousemove",document.body,this._onMove))},onMove:function(a){var b=Sfera.Utils.getMouseAbsolutePosition(a,this.elements.bar_in);if(this.isDown){var c=this.getAttribute("width"),d=this.getAttribute("height"),e=d>c,f=this.getAttribute("cursorSize"),g=e?(b.y-this._bp.y-f/2)/(d-f):(b.x-this._bp.x-f/2)/(c-f);e&&(g=1-g);var h=this.getAttribute("min"),i=this.getAttribute("max"),g=g*(i-h)+h;g=h>g?h:g>i?i:g,this.setAttribute("value",g),this.onChange()}},focus:function(){this.onFocus()},blur:function(){this.onBlur()},updateValue:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=b>a,d=this.getAttribute("value"),e=this.getAttribute("cursorSize"),f=this.getAttribute("min"),g=this.getAttribute("max"),h=(d-f)/(g-f),i=1-h;c?(this.elements.fill.style.height=h*b+"px",this.elements.fill.style.width="",this.elements.fill.style.marginTop=i*b+"px",this.elements.fill.style.marginLeft=""):(this.elements.fill.style.width=h*a+"px",this.elements.fill.style.height="",this.elements.fill.style.marginTop=""),this.subComponents.cursor.setAttribute(c?"y":"x",(c?i:h)*(c?b-e:a-e)),this.subComponents.cursor.setAttribute(c?"x":"y","0")},updateDirection:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=this.getAttribute("cursorSize");if(a&&b&&c){var d=b>a;this.vertical=d,this.updateClass(),this.subComponents.cursor.setAttribute("width",d?a:c),this.subComponents.cursor.setAttribute("height",d?c:b),this.updateValue()}},updateClass:function(){this.element.className="component comp_slider "+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(this.vertical?"vertical":"horizontal")+(a?" style_"+a:"")},onChanged:function(){var a=this.getAttribute("value");if(a!=this.sentValue){this.sentValue=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return this.getAttribute("type"),"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;return Sfera.Utils.getKeyFromCode(b),this.getAttribute("value"),this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Button",{presets:["Visibility","Position","Size","Style","Color"],attributes:{command:{type:"string"},label:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},fontSize:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("fontSize",this.value)}},onClick:{type:"js"},onDown:{type:"js"},onMove:{type:"js"}},init:function(){this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.button=new Sfera.UI.Button(this.elements.container,{ondown:this.onDown.bind(this),onup:this.onUp.bind(this),onmove:this.onMove.bind(this)}),this.updateClass()},updateClass:function(){var a=this.getAttribute("color")||"default",b=this.getAttribute("style")||"default";this.button.setClassName("container"+(b?" style_"+b:"")+(a?" color_"+a:""))},onDown:function(){var a=this.getAttribute("onDown");Sfera.Custom.exec(a,this.id)},onMove:function(){var a=this.getAttribute("onMove");Sfera.Custom.exec(a,this.id)},onUp:function(){var a=this.getAttribute("onClick");Sfera.Custom.exec(a,this.id)}}),Sfera.Components.create("Checkbox",{"extends":"_Field",attributes:{type:{type:"string","default":"input",update:function(){this.component.redraw()}},width:{update:function(){this.component.elements.button&&(this.component.elements.button.style.width=this.value+"px")}},height:{update:function(){this.component.elements.button&&(this.component.elements.button.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},label:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},value:{type:"boolean",update:function(){this.component.redraw()}},changeDelay:{type:"integer","default":"200"},fontSize:{type:"integer",update:function(){this.component.subComponents.label.setAttribute("fontSize",this.value)}},fontColor:{update:function(){this.component.subComponents.label.setAttribute("fontColor",this.value)}},style:{update:function(){var a=this.component;a.redraw()}},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.btObj=new Sfera.UI.Button(this.element,{onclick:this.onClick.bind(this)})},focus:function(){this.onFocus()},blur:function(){this.onBlur()},redraw:function(){var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")+" "+(this.getAttribute("value")?"on":"off")},updateClass:function(){this.btObj.setAttribute("focused",this.focused)},onChanged:function(){this.clearChangeTimeout();var a=this.getAttribute("changeDelay"),b=this;a&&(this.changeTimeout=setTimeout(function(){b.onChangedTimeout()},a))},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},flip:function(){this.setAttribute("value",!this.getAttribute("value")),this.onChange()},onClick:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}b!==!1&&(this.focus(),this.flip())},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):("space"==c&&this.flip(),this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;return Sfera.Utils.getKeyFromCode(b),this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!=c?(this.onChanged(),!1):!0},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Container",{presets:["Visibility","Position","Size"],attributes:{width:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}},height:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}}}}),Sfera.Components.create("Image",{presets:["Visibility","Position","Size"],attributes:{source:{type:"string",update:function(){var a=this.component,b=a.element;if(this.value)if(this.value.indexOf(".svg")==this.value.length-4){var c=new Sfera.Net.Request;c.init(),c.onLoaded=function(){var d=c.getResponseXML(),e=d.getElementsByTagName("svg")[0];b.innerHTML="",e&&(b.appendChild(e),e.style.width=a.getAttribute("width"),e.style.height=a.getAttribute("height")),delete c},c.open(this.value)}else b.innerHTML="<img src='"+this.value+"' width='100%' height='100%'>";else b.innerHTML=""}}},init:function(){}}),Sfera.Components.create("Input",{"extends":"_Field",attributes:{type:{type:"string","default":"input",values:["input","textarea","color","date","datetime","email","number","password","tel","time","url"],update:function(){this.component.redraw()}},height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},eraseButton:{type:"boolean","default":"false",update:function(){var a=this.component;a.elements.erase.style.display=this.value?"":"none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.eraseButton=new Sfera.UI.Button(this.elements.erase,{onclick:this.onErase.bind(this)})},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=this.getAttribute("type"),c=this.getAttribute("placeHolder");c=c?' placeholder="'+c+'"':"";var d="";d=d?' style="'+d+'"':"","textarea"==b?this.elements.fieldC.innerHTML='<textarea class="field" '+d+c+" /></textarea>":this.elements.fieldC.innerHTML='<input class="field" type="'+b+'"'+d+c+" />",this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onselectstart=this.onSelectStart,this.elements.field.controller=this},updateClass:function(){this.element.className="component comp_input"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container"+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Interface",{presets:["Visibility","Size"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},skin:{"default":"default",update:function(){Sfera.client.skin=new(Sfera.Skins[Sfera.Utils.capitalize(this.value)])}},zoom:{type:"float",update:function(){if(1!=this.value){var a=document.getElementsByTagName("BODY")[0],b="scale("+this.value+","+this.value+")";"IE"==Sfera.Device.browser?(a.style.msTransform=b,a.style.msTransformOrigin="0% 0%"):(a.style.zoom=100*this.value+"%",a.style.OTransform=b,a.style.MozTransform=b,a.style.WebkitTransformOrigin="0 0",a.style.transformOrigin="0% 0%"),a.style.width="0px",a.style.height="0px"}}}}}),Sfera.Components.create("Label",{presets:["Visibility","Position","Size","Label"],attributes:{label:null,text:{type:"string",update:function(){this.component.element.innerHTML=this.value}}}}),Sfera.Components.create("Page",{presets:["Visibility"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},visible:{"default":"false"}},init:function(){}}),Sfera.Components.create("Radio",{"extends":"Checkbox",attributes:{group:{type:"string",update:function(){var a=this.component;a.group&&Sfera.client.components.removeByGroup(a,a.group),a.group=this.value,a.group&&Sfera.client.components.addByGroup(a,a.group)}}},init:function(){this["super"]("Checkbox","init")},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}if(b!==!1){var d=this.getAttribute("group");if(d&&this.getAttribute("value"))for(var e=Sfera.client.components.getByGroup(d),f=0;f<e.length;f++)e[f]!=this&&e[f].setAttribute("value",!1);this.onChanged()}}}),Sfera.Components.create("Select",{"extends":"_Field",attributes:{height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},values:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},labels:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.redraw()},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=(this.getAttribute("type"),this.getAttribute("placeHolder"));b=b?' placeholder="'+b+'"':"";var c="";c=c?' style="'+c+'"':"";var d=this.getAttribute("values"),e=this.getAttribute("labels"),f='<select class="field" '+c+b+" />";if(d)for(var g=0;g<d.length;g++)v=d[g],l=e&&e[g]||v,f+='<option value="'+v+'">'+l+"</option>";f+="</select>",this.elements.fieldC.innerHTML=f,this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onchange=this.onChange,this.elements.field.controller=this},updateOptions:function(){this.redraw()},updateClass:function(){this.element.className="component comp_select"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),
Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.controller.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("SferaBg",{init:function(){function a(a){return document.getElementById(a)}function b(a){return Math.floor(Math.random()*a)}function c(a){var b=(new Date).getTime(),c=a.x,d=a.y;a.ls||(a.ls=b);var e=b-a.ls,f=e*a.s/100-a.p;return c+=Math.sin(f)*a.a,d+=Math.sin(f)*a.b,{x:c,y:d}}function d(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(f*f+e*e)}function e(){var e,g,i,j,k,l,m,n,o,p=window.innerWidth,q=window.innerHeight,r=200;try{n=a("c"),o=n.getContext("2d"),m="undefined"!=typeof n.style.opacity,m&&(n.style.opacity=.3)}catch(s){return}if(o.canvas.width=p,o.canvas.height=q,!f){for(f=[],e=-1;p/r>=e;e++)for(g=-1;q/r>=g;g++)l={x:r*e+b(r),y:r*g+b(r),r:b(10)+4,a:b(13),b:b(13),p:b(100),w:b(1e4),s:b(10)/100,l:[]},f.push(l),h++;for(l=0;h>l;l++)for(e=f[l].x,g=f[l].y,k=l+1;h>k;k++)i=f[k].x,j=f[k].y,d(e,g,i,j)<2*r&&f[l].l.push(f[k])}for(o.strokeStyle=o.fillStyle=m?"#fff":"#7194b8",l=0;h>l;l++){for(e=c(f[l]).x,g=c(f[l]).y,k=0;k<f[l].l.length;k++)i=c(f[l].l[k]).x,j=c(f[l].l[k]).y,o.moveTo(e,g),o.lineTo(i,j);o.stroke(),o.beginPath(),o.arc(e,g,f[l].r,0,2*Math.PI,!1),o.fill()}}var f,g=0,h=0;window.addEventListener("resize",function(){clearTimeout(g),g=setTimeout(e,100)}),a("bg").innerHTML="<canvas id='c'></canvas>",setInterval(e,50)}}),Sfera.Components.create("Slider",{presets:["Visibility","Position","Size","Style","Color"],attributes:{width:{post:function(){this.component.updateDirection()}},height:{post:function(){this.component.updateDirection()}},cursorSize:{type:"integer","default":"30",update:function(){this.component.updateDirection()}},barColor:{type:"color","default":"transparent",update:function(){this.component.elements.fill.style.backgroundColor=this.value}},min:{type:"integer","default":"0",update:function(){this.component.updateValue()}},max:{type:"integer","default":"100",update:function(){this.component.updateValue()}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},color:{values:function(){var a=Sfera.client.skin.colors.Button;return a?a:["default"]},post:function(){this.component.subComponents.cursor.setAttribute("color",this.value)}},value:{update:function(){this.component.updateValue()}},changeDelay:{type:"integer","default":"1000"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements);var a={};a.ondown=this.onDown.bind(this),Sfera.Device.touch||(a.onover=this.onOver.bind(this),a.onout=this.onOut.bind(this)),this.button=new Sfera.UI.Button(this.elements.over,a);var b=this.subComponents.cursor;b.button.link(this.button)},onOver:function(){},onOut:function(){},onDown:function(a){this.isDown=!0,this._onUp=this.onUp.bind(this),this._onMove=this.onMove.bind(this),Sfera.Device.touch?(window.addEvent("touchend",document.body,this._onUp),window.addEvent("touchmove",document.body,this._onMove)):(window.addEvent("mouseup",document.body,this._onUp),window.addEvent("mousemove",document.body,this._onMove)),this._bp=Sfera.Utils.getElementAbsolutePosition(this.elements.bar_in),this.onMove(a)},onUp:function(a){this.isDown=!1,Sfera.Device.touch?(window.removeEvent("touchend",document.body,this._onUp),window.removeEvent("touchmove",document.body,this._onMove)):(window.removeEvent("mouseup",document.body,this._onUp),window.removeEvent("mousemove",document.body,this._onMove))},onMove:function(a){var b=Sfera.Utils.getMouseAbsolutePosition(a,this.elements.bar_in);if(this.isDown){var c=this.getAttribute("width"),d=this.getAttribute("height"),e=d>c,f=this.getAttribute("cursorSize"),g=e?(b.y-this._bp.y-f/2)/(d-f):(b.x-this._bp.x-f/2)/(c-f);e&&(g=1-g);var h=this.getAttribute("min"),i=this.getAttribute("max"),g=g*(i-h)+h;g=h>g?h:g>i?i:g,this.setAttribute("value",g),this.onChange()}},focus:function(){this.onFocus()},blur:function(){this.onBlur()},updateValue:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=b>a,d=this.getAttribute("value"),e=this.getAttribute("cursorSize"),f=this.getAttribute("min"),g=this.getAttribute("max"),h=(d-f)/(g-f),i=1-h;c?(this.elements.fill.style.height=h*b+"px",this.elements.fill.style.width="",this.elements.fill.style.marginTop=i*b+"px",this.elements.fill.style.marginLeft=""):(this.elements.fill.style.width=h*a+"px",this.elements.fill.style.height="",this.elements.fill.style.marginTop=""),this.subComponents.cursor.setAttribute(c?"y":"x",(c?i:h)*(c?b-e:a-e)),this.subComponents.cursor.setAttribute(c?"x":"y","0")},updateDirection:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=this.getAttribute("cursorSize");if(a&&b&&c){var d=b>a;this.vertical=d,this.updateClass(),this.subComponents.cursor.setAttribute("width",d?a:c),this.subComponents.cursor.setAttribute("height",d?c:b),this.updateValue()}},updateClass:function(){this.element.className="component comp_slider "+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(this.vertical?"vertical":"horizontal")+(a?" style_"+a:"")},onChanged:function(){var a=this.getAttribute("value");if(a!=this.sentValue){this.sentValue=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return this.getAttribute("type"),"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;return Sfera.Utils.getKeyFromCode(b),this.getAttribute("value"),this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Button",{presets:["Visibility","Position","Size","Style","Color"],attributes:{command:{type:"string"},label:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},fontSize:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("fontSize",this.value)}},onClick:{type:"js"},onDown:{type:"js"},onMove:{type:"js"}},init:function(){this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.button=new Sfera.UI.Button(this.elements.container,{ondown:this.onDown.bind(this),onup:this.onUp.bind(this),onmove:this.onMove.bind(this)}),this.updateClass()},updateClass:function(){var a=this.getAttribute("color")||"default",b=this.getAttribute("style")||"default";this.button.setClassName("container"+(b?" style_"+b:"")+(a?" color_"+a:""))},onDown:function(){var a=this.getAttribute("onDown");Sfera.Custom.exec(a,this.id)},onMove:function(){var a=this.getAttribute("onMove");Sfera.Custom.exec(a,this.id)},onUp:function(){var a=this.getAttribute("onClick");Sfera.Custom.exec(a,this.id)}}),Sfera.Components.create("Checkbox",{"extends":"_Field",attributes:{type:{type:"string","default":"input",update:function(){this.component.redraw()}},width:{update:function(){this.component.elements.button&&(this.component.elements.button.style.width=this.value+"px")}},height:{update:function(){this.component.elements.button&&(this.component.elements.button.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},label:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},value:{type:"boolean",update:function(){this.component.redraw()}},changeDelay:{type:"integer","default":"200"},fontSize:{type:"integer",update:function(){this.component.subComponents.label.setAttribute("fontSize",this.value)}},fontColor:{update:function(){this.component.subComponents.label.setAttribute("fontColor",this.value)}},style:{update:function(){var a=this.component;a.redraw()}},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.btObj=new Sfera.UI.Button(this.element,{onclick:this.onClick.bind(this)})},focus:function(){this.onFocus()},blur:function(){this.onBlur()},redraw:function(){var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")+" "+(this.getAttribute("value")?"on":"off")},updateClass:function(){this.btObj.setAttribute("focused",this.focused)},onChanged:function(){this.clearChangeTimeout();var a=this.getAttribute("changeDelay"),b=this;a&&(this.changeTimeout=setTimeout(function(){b.onChangedTimeout()},a))},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},flip:function(){this.setAttribute("value",!this.getAttribute("value")),this.onChange()},onClick:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}b!==!1&&(this.focus(),this.flip())},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):("space"==c&&this.flip(),this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;return Sfera.Utils.getKeyFromCode(b),this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!=c?(this.onChanged(),!1):!0},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Container",{presets:["Visibility","Position","Size"],attributes:{width:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}},height:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}}}}),Sfera.Components.create("Image",{presets:["Visibility","Position","Size"],attributes:{source:{type:"string",update:function(){var a=this.component,b=a.element;if(this.value)if(this.value.indexOf(".svg")==this.value.length-4){var c=new Sfera.Net.Request;c.init(),c.onLoaded=function(){var d=c.getResponseXML(),e=d.getElementsByTagName("svg")[0];b.innerHTML="",e&&(b.appendChild(e),e.style.width=a.getAttribute("width"),e.style.height=a.getAttribute("height")),delete c},c.open(this.value)}else b.innerHTML="<img src='"+this.value+"' width='100%' height='100%'>";else b.innerHTML=""}}},init:function(){}}),Sfera.Components.create("Input",{"extends":"_Field",attributes:{type:{type:"string","default":"input",values:["input","textarea","color","date","datetime","email","number","password","tel","time","url"],update:function(){this.component.redraw()}},height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},eraseButton:{type:"boolean","default":"false",update:function(){var a=this.component;a.elements.erase.style.display=this.value?"":"none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.eraseButton=new Sfera.UI.Button(this.elements.erase,{onclick:this.onErase.bind(this)})},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=this.getAttribute("type"),c=this.getAttribute("placeHolder");c=c?' placeholder="'+c+'"':"";var d="";d=d?' style="'+d+'"':"","textarea"==b?this.elements.fieldC.innerHTML='<textarea class="field" '+d+c+" /></textarea>":this.elements.fieldC.innerHTML='<input class="field" type="'+b+'"'+d+c+" />",this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onselectstart=this.onSelectStart,this.elements.field.controller=this},updateClass:function(){this.element.className="component comp_input"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container"+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Interface",{presets:["Visibility","Size"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},skin:{"default":"default",update:function(){Sfera.client.skin=new(Sfera.Skins[Sfera.Utils.capitalize(this.value)])}},zoom:{type:"float",update:function(){if(1!=this.value){var a=document.getElementsByTagName("BODY")[0],b="scale("+this.value+","+this.value+")";"IE"==Sfera.Device.browser?(a.style.msTransform=b,a.style.msTransformOrigin="0% 0%"):(a.style.zoom=100*this.value+"%",a.style.OTransform=b,a.style.MozTransform=b,a.style.WebkitTransformOrigin="0 0",a.style.transformOrigin="0% 0%"),a.style.width="0px",a.style.height="0px"}}}}}),Sfera.Components.create("Label",{presets:["Visibility","Position","Size","Label"],attributes:{label:null,text:{type:"string",update:function(){this.component.element.innerHTML=this.value}}}}),Sfera.Components.create("Page",{presets:["Visibility"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},visible:{"default":"false"}},init:function(){}}),Sfera.Components.create("Radio",{"extends":"Checkbox",attributes:{group:{type:"string",update:function(){var a=this.component;a.group&&Sfera.client.components.removeByGroup(a,a.group),a.group=this.value,a.group&&Sfera.client.components.addByGroup(a,a.group)}}},init:function(){this["super"]("Checkbox","init")},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}if(b!==!1){var d=this.getAttribute("group");if(d&&this.getAttribute("value"))for(var e=Sfera.client.components.getByGroup(d),f=0;f<e.length;f++)e[f]!=this&&e[f].setAttribute("value",!1);this.onChanged()}}}),Sfera.Components.create("Select",{"extends":"_Field",attributes:{height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},values:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},labels:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.redraw()},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=(this.getAttribute("type"),this.getAttribute("placeHolder"));b=b?' placeholder="'+b+'"':"";var c="";c=c?' style="'+c+'"':"";var d=this.getAttribute("values"),e=this.getAttribute("labels"),f='<select class="field" '+c+b+" />";if(d)for(var g=0;g<d.length;g++)v=d[g],l=e&&e[g]||v,f+='<option value="'+v+'">'+l+"</option>";f+="</select>",this.elements.fieldC.innerHTML=f,this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onchange=this.onChange,this.elements.field.controller=this},updateOptions:function(){this.redraw()},updateClass:function(){this.element.className="component comp_select"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.controller.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("SferaBg",{init:function(){function a(a){return document.getElementById(a)}function b(a){return Math.floor(Math.random()*a)}function c(a){var b=(new Date).getTime(),c=a.x,d=a.y;a.ls||(a.ls=b);var e=b-a.ls,f=e*a.s/100-a.p;return c+=Math.sin(f)*a.a,d+=Math.sin(f)*a.b,{x:c,y:d}}function d(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(f*f+e*e)}function e(){var e,g,i,j,k,l,m,n,o,p=window.innerWidth,q=window.innerHeight,r=200;try{n=a("c"),o=n.getContext("2d"),m="undefined"!=typeof n.style.opacity,m&&(n.style.opacity=.3)}catch(s){return}if(o.canvas.width=p,o.canvas.height=q,!f){for(f=[],e=-1;p/r>=e;e++)for(g=-1;q/r>=g;g++)l={x:r*e+b(r),y:r*g+b(r),r:b(10)+4,a:b(13),b:b(13),p:b(100),w:b(1e4),s:b(10)/100,l:[]},f.push(l),h++;for(l=0;h>l;l++)for(e=f[l].x,g=f[l].y,k=l+1;h>k;k++)i=f[k].x,j=f[k].y,d(e,g,i,j)<2*r&&f[l].l.push(f[k])}for(o.strokeStyle=o.fillStyle=m?"#fff":"#7194b8",l=0;h>l;l++){for(e=c(f[l]).x,g=c(f[l]).y,k=0;k<f[l].l.length;k++)i=c(f[l].l[k]).x,j=c(f[l].l[k]).y,o.moveTo(e,g),o.lineTo(i,j);o.stroke(),o.beginPath(),o.arc(e,g,f[l].r,0,2*Math.PI,!1),o.fill()}}var f,g=0,h=0;window.addEventListener("resize",function(){clearTimeout(g),g=setTimeout(e,100)}),a("bg").innerHTML="<canvas id='c'></canvas>",setInterval(e,50)}}),Sfera.Components.create("Slider",{presets:["Visibility","Position","Size","Style","Color"],attributes:{width:{post:function(){this.component.updateDirection()}},height:{post:function(){this.component.updateDirection()}},cursorSize:{type:"integer","default":"30",update:function(){this.component.updateDirection()}},barColor:{type:"color","default":"transparent",update:function(){this.component.elements.fill.style.backgroundColor=this.value}},min:{type:"integer","default":"0",update:function(){this.component.updateValue()}},max:{type:"integer","default":"100",update:function(){this.component.updateValue()}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},color:{values:function(){var a=Sfera.client.skin.colors.Button;return a?a:["default"]},post:function(){this.component.subComponents.cursor.setAttribute("color",this.value)}},value:{update:function(){this.component.updateValue()}},changeDelay:{type:"integer","default":"1000"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements);var a={};a.ondown=this.onDown.bind(this),Sfera.Device.touch||(a.onover=this.onOver.bind(this),a.onout=this.onOut.bind(this)),this.button=new Sfera.UI.Button(this.elements.over,a);var b=this.subComponents.cursor;b.button.link(this.button)},onOver:function(){},onOut:function(){},onDown:function(a){this.isDown=!0,this._onUp=this.onUp.bind(this),this._onMove=this.onMove.bind(this),Sfera.Device.touch?(window.addEvent("touchend",document.body,this._onUp),window.addEvent("touchmove",document.body,this._onMove)):(window.addEvent("mouseup",document.body,this._onUp),window.addEvent("mousemove",document.body,this._onMove)),this._bp=Sfera.Utils.getElementAbsolutePosition(this.elements.bar_in),this.onMove(a)},onUp:function(a){this.isDown=!1,Sfera.Device.touch?(window.removeEvent("touchend",document.body,this._onUp),window.removeEvent("touchmove",document.body,this._onMove)):(window.removeEvent("mouseup",document.body,this._onUp),window.removeEvent("mousemove",document.body,this._onMove))},onMove:function(a){var b=Sfera.Utils.getMouseAbsolutePosition(a,this.elements.bar_in);if(this.isDown){var c=this.getAttribute("width"),d=this.getAttribute("height"),e=d>c,f=this.getAttribute("cursorSize"),g=e?(b.y-this._bp.y-f/2)/(d-f):(b.x-this._bp.x-f/2)/(c-f);e&&(g=1-g);var h=this.getAttribute("min"),i=this.getAttribute("max"),g=g*(i-h)+h;g=h>g?h:g>i?i:g,this.setAttribute("value",g),this.onChange()}},focus:function(){this.onFocus()},blur:function(){this.onBlur()},updateValue:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=b>a,d=this.getAttribute("value"),e=this.getAttribute("cursorSize"),f=this.getAttribute("min"),g=this.getAttribute("max"),h=(d-f)/(g-f),i=1-h;c?(this.elements.fill.style.height=h*b+"px",this.elements.fill.style.width="",this.elements.fill.style.marginTop=i*b+"px",this.elements.fill.style.marginLeft=""):(this.elements.fill.style.width=h*a+"px",this.elements.fill.style.height="",this.elements.fill.style.marginTop=""),this.subComponents.cursor.setAttribute(c?"y":"x",(c?i:h)*(c?b-e:a-e)),this.subComponents.cursor.setAttribute(c?"x":"y","0")},updateDirection:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=this.getAttribute("cursorSize");if(a&&b&&c){var d=b>a;this.vertical=d,this.updateClass(),this.subComponents.cursor.setAttribute("width",d?a:c),this.subComponents.cursor.setAttribute("height",d?c:b),this.updateValue()}},updateClass:function(){this.element.className="component comp_slider "+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(this.vertical?"vertical":"horizontal")+(a?" style_"+a:"")},onChanged:function(){var a=this.getAttribute("value");if(a!=this.sentValue){this.sentValue=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return this.getAttribute("type"),"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;return Sfera.Utils.getKeyFromCode(b),this.getAttribute("value"),this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Button",{presets:["Visibility","Position","Size","Style","Color"],attributes:{command:{type:"string"},label:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none";
}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},fontSize:{update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("fontSize",this.value)}},onClick:{type:"js"},onDown:{type:"js"},onMove:{type:"js"}},init:function(){this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.button=new Sfera.UI.Button(this.elements.container,{ondown:this.onDown.bind(this),onup:this.onUp.bind(this),onmove:this.onMove.bind(this)}),this.updateClass()},updateClass:function(){var a=this.getAttribute("color")||"default",b=this.getAttribute("style")||"default";this.button.setClassName("container"+(b?" style_"+b:"")+(a?" color_"+a:""))},onDown:function(){var a=this.getAttribute("onDown");Sfera.Custom.exec(a,this.id)},onMove:function(){var a=this.getAttribute("onMove");Sfera.Custom.exec(a,this.id)},onUp:function(){var a=this.getAttribute("onClick");Sfera.Custom.exec(a,this.id)}}),Sfera.Components.create("Checkbox",{"extends":"_Field",attributes:{type:{type:"string","default":"input",update:function(){this.component.redraw()}},width:{update:function(){this.component.elements.button&&(this.component.elements.button.style.width=this.value+"px")}},height:{update:function(){this.component.elements.button&&(this.component.elements.button.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},label:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.label;b.setAttribute("label",this.value),this.value?a.elements.label.style.display="":a.elements.label.style.display="none"}},value:{type:"boolean",update:function(){this.component.redraw()}},changeDelay:{type:"integer","default":"200"},fontSize:{type:"integer",update:function(){this.component.subComponents.label.setAttribute("fontSize",this.value)}},fontColor:{update:function(){this.component.subComponents.label.setAttribute("fontColor",this.value)}},style:{update:function(){var a=this.component;a.redraw()}},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.btObj=new Sfera.UI.Button(this.element,{onclick:this.onClick.bind(this)})},focus:function(){this.onFocus()},blur:function(){this.onBlur()},redraw:function(){var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")+" "+(this.getAttribute("value")?"on":"off")},updateClass:function(){this.btObj.setAttribute("focused",this.focused)},onChanged:function(){this.clearChangeTimeout();var a=this.getAttribute("changeDelay"),b=this;a&&(this.changeTimeout=setTimeout(function(){b.onChangedTimeout()},a))},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},flip:function(){this.setAttribute("value",!this.getAttribute("value")),this.onChange()},onClick:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}b!==!1&&(this.focus(),this.flip())},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):("space"==c&&this.flip(),this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;return Sfera.Utils.getKeyFromCode(b),this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!=c?(this.onChanged(),!1):!0},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Container",{presets:["Visibility","Position","Size"],attributes:{width:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}},height:{post:function(){this.component.element.style.overflow="auto"==this.value?"":"scroll"}}}}),Sfera.Components.create("Image",{presets:["Visibility","Position","Size"],attributes:{source:{type:"string",update:function(){var a=this.component,b=a.element;if(this.value)if(this.value.indexOf(".svg")==this.value.length-4){var c=new Sfera.Net.Request;c.init(),c.onLoaded=function(){var d=c.getResponseXML(),e=d.getElementsByTagName("svg")[0];b.innerHTML="",e&&(b.appendChild(e),e.style.width=a.getAttribute("width"),e.style.height=a.getAttribute("height")),delete c},c.open(this.value)}else b.innerHTML="<img src='"+this.value+"' width='100%' height='100%'>";else b.innerHTML=""}}},init:function(){}}),Sfera.Components.create("Input",{"extends":"_Field",attributes:{type:{type:"string","default":"input",values:["input","textarea","color","date","datetime","email","number","password","tel","time","url"],update:function(){this.component.redraw()}},height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},eraseButton:{type:"boolean","default":"false",update:function(){var a=this.component;a.elements.erase.style.display=this.value?"":"none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.eraseButton=new Sfera.UI.Button(this.elements.erase,{onclick:this.onErase.bind(this)})},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=this.getAttribute("type"),c=this.getAttribute("placeHolder");c=c?' placeholder="'+c+'"':"";var d="";d=d?' style="'+d+'"':"","textarea"==b?this.elements.fieldC.innerHTML='<textarea class="field" '+d+c+" /></textarea>":this.elements.fieldC.innerHTML='<input class="field" type="'+b+'"'+d+c+" />",this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onselectstart=this.onSelectStart,this.elements.field.controller=this},updateClass:function(){this.element.className="component comp_input"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container"+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("Interface",{presets:["Visibility","Size"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},skin:{"default":"default",update:function(){Sfera.client.skin=new(Sfera.Skins[Sfera.Utils.capitalize(this.value)])}},zoom:{type:"float",update:function(){if(1!=this.value){var a=document.getElementsByTagName("BODY")[0],b="scale("+this.value+","+this.value+")";"IE"==Sfera.Device.browser?(a.style.msTransform=b,a.style.msTransformOrigin="0% 0%"):(a.style.zoom=100*this.value+"%",a.style.OTransform=b,a.style.MozTransform=b,a.style.WebkitTransformOrigin="0 0",a.style.transformOrigin="0% 0%"),a.style.width="0px",a.style.height="0px"}}}}}),Sfera.Components.create("Label",{presets:["Visibility","Position","Size","Label"],attributes:{label:null,text:{type:"string",update:function(){this.component.element.innerHTML=this.value}}}}),Sfera.Components.create("Page",{presets:["Visibility"],attributes:{title:{type:"string",doc:"Title visible in the browser's title bar"},visible:{"default":"false"}},init:function(){}}),Sfera.Components.create("Radio",{"extends":"Checkbox",attributes:{group:{type:"string",update:function(){var a=this.component;a.group&&Sfera.client.components.removeByGroup(a,a.group),a.group=this.value,a.group&&Sfera.client.components.addByGroup(a,a.group)}}},init:function(){this["super"]("Checkbox","init")},onChange:function(){var a=this.getAttribute("onClick"),b=!0;if(a){var c=this.getAttribute("value");b=Sfera.Custom.exec(a,this.id,c)}if(b!==!1){var d=this.getAttribute("group");if(d&&this.getAttribute("value"))for(var e=Sfera.client.components.getByGroup(d),f=0;f<e.length;f++)e[f]!=this&&e[f].setAttribute("value",!1);this.onChanged()}}}),Sfera.Components.create("Select",{"extends":"_Field",attributes:{height:{update:function(){this.component.elements.field&&(this.component.elements.field.style.height=this.value+"px")}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},icon:{type:"string","default":"",update:function(){var a=this.component,b=a.subComponents.icon;b.setAttribute("source",this.value),this.value?a.elements.icon.style.display="":a.elements.icon.style.display="none"}},value:{update:function(){this.component.elements.field&&(this.component.elements.field.value=this.value)}},values:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},labels:{type:"list",update:function(){this.component.elements.field&&this.component.redraw()}},changeDelay:{type:"integer","default":"1000"},keyRegex:{type:"regexp"},valueRegex:{type:"regexp",compile:function(){this.value=Sfera.Compiler.compileAttributeValue(this,"^("+this.source+")$")}},fontSize:{type:"integer",update:function(){this.component.elements.field&&(this.component.elements.field.style.fontSize=this.value+"px")}},fontColor:{update:function(){this.component.elements.field&&(this.component.elements.field.style.color=this.value)}},maxLength:{type:"integer"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements),this.redraw()},focus:function(){this.elements.field.focus()},blur:function(){this.elements.field.blur()},redraw:function(){var a="";this.elements.field&&(this.elements.field.onfocus=null,this.elements.field.onblur=null,this.elements.field.onselectstart=null,a=this.elements.field.value,this.elements.field=null);var b=(this.getAttribute("type"),this.getAttribute("placeHolder"));b=b?' placeholder="'+b+'"':"";var c="";c=c?' style="'+c+'"':"";var d=this.getAttribute("values"),e=this.getAttribute("labels"),f='<select class="field" '+c+b+" />";if(d)for(var g=0;g<d.length;g++)v=d[g],l=e&&e[g]||v,f+='<option value="'+v+'">'+l+"</option>";f+="</select>",this.elements.fieldC.innerHTML=f,this.elements.field=this.elements.fieldC.childNodes[0],this.elements.field.value=a,this.attributes.height.update(),"Android"==Sfera.Device.android?(this.elements.field.onfocus=function(){return!1},this.elements.field.oninput=this.onUserChange):this.elements.field.onfocus=this.onFocus,this.elements.field.onblur=this.onBlur,this.elements.field.onchange=this.onChange,this.elements.field.controller=this},updateOptions:function(){this.redraw()},updateClass:function(){this.element.className="component comp_select"+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(a?" style_"+a:"")},onErase:function(){this.setAttribute("value",""),this.onChangedTimeout()},onChanged:function(){var a=this.elements.field.value;if(a!=this.attributes.value.source){this.attributes.value.source=this.attributes.value.value=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onSelectStart:function(a){},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b),d=this.getAttribute("type");return"enter"!=c||this.onEnter()||(c=""),"enter"==c&&"textarea"!=d||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&"textarea"!=d&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){function b(){var a="";return e.selectionStart!=e.selectionEnd?a=f.substr(e.selectionStart,e.selectionEnd):"undefined"!=typeof window.getSelection?a=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(a=document.selection.createRange().text),a}var c=a.keyCode,d=Sfera.Utils.getKeyFromCode(c),e=this.elements.field,f=this.getAttribute("value"),g=this.getAttribute("keyRegex"),h=this.getAttribute("maxLength");return!d&&f&&h&&f.length>=h&&!b()?!1:d||!g||a.ctrlKey||a.metaKey||g.test(String.fromCharCode(c))?(this.onChanged(),!0):!1},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.controller.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){var a=this.controller;Sfera.client.setFocused(a),a.focused=!0,a.updateClass()},onBlur:function(){var a=this.controller;a.onChanged(),Sfera.client.clearFocused(a),a.focused=!1,a.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}}),Sfera.Components.create("SferaBg",{init:function(){function a(a){return document.getElementById(a)}function b(a){return Math.floor(Math.random()*a)}function c(a){var b=(new Date).getTime(),c=a.x,d=a.y;a.ls||(a.ls=b);var e=b-a.ls,f=e*a.s/100-a.p;return c+=Math.sin(f)*a.a,d+=Math.sin(f)*a.b,{x:c,y:d}}function d(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(f*f+e*e)}function e(){var e,g,i,j,k,l,m,n,o,p=window.innerWidth,q=window.innerHeight,r=200;try{n=a("c"),o=n.getContext("2d"),m="undefined"!=typeof n.style.opacity,m&&(n.style.opacity=.3)}catch(s){return}if(o.canvas.width=p,o.canvas.height=q,!f){for(f=[],e=-1;p/r>=e;e++)for(g=-1;q/r>=g;g++)l={x:r*e+b(r),y:r*g+b(r),r:b(10)+4,a:b(13),b:b(13),p:b(100),w:b(1e4),s:b(10)/100,l:[]},f.push(l),h++;for(l=0;h>l;l++)for(e=f[l].x,g=f[l].y,k=l+1;h>k;k++)i=f[k].x,j=f[k].y,d(e,g,i,j)<2*r&&f[l].l.push(f[k])}for(o.strokeStyle=o.fillStyle=m?"#fff":"#7194b8",l=0;h>l;l++){for(e=c(f[l]).x,g=c(f[l]).y,k=0;k<f[l].l.length;k++)i=c(f[l].l[k]).x,j=c(f[l].l[k]).y,o.moveTo(e,g),o.lineTo(i,j);o.stroke(),o.beginPath(),o.arc(e,g,f[l].r,0,2*Math.PI,!1),o.fill()}}var f,g=0,h=0;window.addEventListener("resize",function(){clearTimeout(g),g=setTimeout(e,100)}),a("bg").innerHTML="<canvas id='c'></canvas>",setInterval(e,50)}}),Sfera.Components.create("Slider",{presets:["Visibility","Position","Size","Style","Color"],attributes:{width:{post:function(){this.component.updateDirection()}},height:{post:function(){this.component.updateDirection()}},cursorSize:{type:"integer","default":"30",update:function(){this.component.updateDirection()}},barColor:{type:"color","default":"transparent",update:function(){this.component.elements.fill.style.backgroundColor=this.value}},min:{type:"integer","default":"0",update:function(){this.component.updateValue()}},max:{type:"integer","default":"100",update:function(){this.component.updateValue()}},focus:{type:"boolean",update:function(){this.value&&this.component.focus()}},color:{values:function(){var a=Sfera.client.skin.colors.Button;return a?a:["default"]},post:function(){this.component.subComponents.cursor.setAttribute("color",this.value)}},value:{update:function(){this.component.updateValue()}},changeDelay:{type:"integer","default":"1000"},onKeyUp:{type:"js"},onChange:{type:"js","default":"event(id,value)"},onEnter:{type:"js"},onFocus:{type:"js"},onBlur:{type:"js"}},init:function(){this.value="",this.changeTimeout=null,this.elements=Sfera.Utils.getComponentElements(this.element,!0,this.elements);var a={};a.ondown=this.onDown.bind(this),Sfera.Device.touch||(a.onover=this.onOver.bind(this),a.onout=this.onOut.bind(this)),this.button=new Sfera.UI.Button(this.elements.over,a);var b=this.subComponents.cursor;b.button.link(this.button)},onOver:function(){},onOut:function(){},onDown:function(a){this.isDown=!0,this._onUp=this.onUp.bind(this),this._onMove=this.onMove.bind(this),Sfera.Device.touch?(window.addEvent("touchend",document.body,this._onUp),window.addEvent("touchmove",document.body,this._onMove)):(window.addEvent("mouseup",document.body,this._onUp),window.addEvent("mousemove",document.body,this._onMove)),this._bp=Sfera.Utils.getElementAbsolutePosition(this.elements.bar_in),this.onMove(a)},onUp:function(a){this.isDown=!1,Sfera.Device.touch?(window.removeEvent("touchend",document.body,this._onUp),window.removeEvent("touchmove",document.body,this._onMove)):(window.removeEvent("mouseup",document.body,this._onUp),window.removeEvent("mousemove",document.body,this._onMove))},onMove:function(a){var b=Sfera.Utils.getMouseAbsolutePosition(a,this.elements.bar_in);if(this.isDown){var c=this.getAttribute("width"),d=this.getAttribute("height"),e=d>c,f=this.getAttribute("cursorSize"),g=e?(b.y-this._bp.y-f/2)/(d-f):(b.x-this._bp.x-f/2)/(c-f);e&&(g=1-g);var h=this.getAttribute("min"),i=this.getAttribute("max"),g=g*(i-h)+h;g=h>g?h:g>i?i:g,this.setAttribute("value",g),this.onChange()}},focus:function(){this.onFocus()},blur:function(){this.onBlur()},updateValue:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=b>a,d=this.getAttribute("value"),e=this.getAttribute("cursorSize"),f=this.getAttribute("min"),g=this.getAttribute("max"),h=(d-f)/(g-f),i=1-h;c?(this.elements.fill.style.height=h*b+"px",this.elements.fill.style.width="",this.elements.fill.style.marginTop=i*b+"px",this.elements.fill.style.marginLeft=""):(this.elements.fill.style.width=h*a+"px",this.elements.fill.style.height="",this.elements.fill.style.marginTop=""),this.subComponents.cursor.setAttribute(c?"y":"x",(c?i:h)*(c?b-e:a-e)),this.subComponents.cursor.setAttribute(c?"x":"y","0")},updateDirection:function(){var a=this.getAttribute("width"),b=this.getAttribute("height"),c=this.getAttribute("cursorSize");if(a&&b&&c){var d=b>a;this.vertical=d,this.updateClass(),this.subComponents.cursor.setAttribute("width",d?a:c),this.subComponents.cursor.setAttribute("height",d?c:b),this.updateValue()}},updateClass:function(){this.element.className="component comp_slider "+(this.focused?" focused":"");var a=this.getAttribute("style");this.elements.container.className="container "+(this.vertical?"vertical":"horizontal")+(a?" style_"+a:"")},onChanged:function(){var a=this.getAttribute("value");if(a!=this.sentValue){this.sentValue=a,this.clearChangeTimeout();var b=this.getAttribute("changeDelay"),c=this;b&&(this.changeTimeout=setTimeout(function(){c.onChangedTimeout()},b))}},clearChangeTimeout:function(){this.changeTimeout&&(clearTimeout(this.changeTimeout),this.changeTimeout=null)},onChangedTimeout:function(){this.clearChangeTimeout();var a=this.getAttribute("onChange"),b=this.getAttribute("value");Sfera.Custom.exec(a,this.id,b)},onKeyDown:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return this.getAttribute("type"),"enter"!=c||this.onEnter()||(c=""),"enter"==c||"tab"==c?(this.onChangedTimeout(),Sfera.client.focusNext(a.shiftKey),"enter"==c&&this.blur(),!1):(this.onChanged(),!0)},onKeyPress:function(a){var b=a.keyCode;return Sfera.Utils.getKeyFromCode(b),this.getAttribute("value"),this.onChanged(),!0},onKeyUp:function(a){var b=a.keyCode,c=Sfera.Utils.getKeyFromCode(b);return"enter"!=c&&"tab"!==c?(this.onChanged(),!1):!0},onChange:function(){this.onChanged()},onEnter:function(){var a=this.getAttribute("onEnter");return a?Sfera.Custom.exec(a):!0},onFocus:function(){Sfera.client.setFocused(this),this.focused=!0,this.updateClass()},onBlur:function(){this.onChanged(),Sfera.client.clearFocused(this),this.focused=!1,this.updateClass()},onShow:function(){this.getAttribute("focus")&&this.focus()},onHide:function(){}});