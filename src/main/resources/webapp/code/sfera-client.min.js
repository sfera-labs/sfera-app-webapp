/*! sfera-webapp - v0.0.2 */


(function(){var t=this,e=e||{VERSION:"0.1.0",client:null};e.Compiler=new function(){this.createComponent=function(t,n){return e.Components.createInstance(t,n)},this.compileXMLNode=function(t,n){if(1==t.nodeType){(n=n||{}).index=n.index||!0;var i,o,s={};for(i=0;i<t.attributes.length;i++)o=t.attributes[i],s[e.Utils.dashToCamel(o.name)]=o.value;n.idPrefix&&s.id&&(s.id=n.idPrefix+"."+s.id);var r=this.createComponent(t.nodeName,s);if(r){n.index&&e.client.indexComponent(r);var a,l=t.childNodes;for(i=0;i<l.length;i++)(a=this.compileXMLNode(l[i]))&&r.addChild(a)}return r}return null},this.compileXML=function(t,e){return this.compileXMLNode(t.documentElement,e)},this.compileString=function(t){parser=new DOMParser,xmlDoc=parser.parseFromString(txt,"text/xml"),this.compileXML(xmlDoc)},this.compileDictionary=function(t){var n=t.documentElement;if(n&&1==n.nodeType){var i,o,s,r,a,l=n.childNodes;for(s=0;s<l.length;s++)if(1==l[s].nodeType)switch(l[s].tagName){case"skin":break;case"components":for(i=l[s].childNodes,r=0;r<i.length;r++)if(1==i[r].nodeType)for(o=i[r].childNodes,a=0;a<o.length;a++)switch(o[a].tagName){case"src":e.Components.setSource(i[r].tagName,e.Utils.getCDATA(o[a]));break;case"_lan":e.Components.setLanguage(i[r].tagName,e.Utils.getCDATA(o[a]))}}}},this.compileHTML=function(t){return t=t.replace(/\$interface\;/g,e.client.name)},this.getMustacheData=function(t){if(!e.Utils.isString(t)||-1==t.indexOf("{"))return null;for(var n,i={vars:[]},o=/\{\{([^}]*)\}\}/g;n=o.exec(t);)i.vars.push(n[1]);return i.vars.length?i:null},this.compileAttributeValue=function(t,n){var i=/\{\{([^}]*)\}\}/g,o=n||t.source;switch(t.mustache&&(o=o.replace(i,function(t,n){return e.client.getNodeValue(n)})),t.type){case"integer":o=parseInt(o);break;case"float":o=parseFloat(o);break;case"color":o=o.toLowerCase(),names=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];break;case"size":"string"==typeof o&&-1!=o.indexOf("%")?o=parseInt(o)+"%":"auto"!=o&&(o=parseInt(o));break;case"string":case"js":if("string"!=typeof o&&o.toString){var s=o.toString();o="[object Object]"==s?JSON.stringify(o):s}break;case"boolean":o=!("false"===o||!1===o||void 0===o||null===o);break;case"regexp":try{o=new RegExp(o)}catch(t){o=null}break;case"list":o=o.split(",")}return o}},e.Attribute=function(t,n){this.type="string",this.changed=!1,this.default=null,this.source=null,this.value=null,this.required=!1,this.values=null,this.component=t,this.restoreTimeout=0,this._restoreTimeoutId=null;for(var i in n)switch(i){case"type":case"source":case"value":case"default":case"doc":case"restoreTimeout":this[i]=n[i];break;case"set":case"get":case"compile":case"update":case"post":this[i]=n[i].bind(this);break;case"values":e.Utils.isFunction(n[i])?this[i]=n[i].bind(this):this[i]=n[i]}},e.Attribute.prototype={set:function(t,n){if(this.source!==t){this.changed=!0,this.source=t;var i,o=e.Compiler.getMustacheData(t),s=this.mustache&&o&&this.mustache.vars.equals(o.vars);if(this.mustache&&!s)for(i=0;i<this.mustache.vars.length;i++)e.client.removeAttrObserver(this.mustache.vars[i],this);if(this.mustache=o,this.mustache&&!s)for(i=0;i<this.mustache.vars.length;i++)e.client.bindAttrObserver(this.mustache.vars[i],this);n&&n.manualCompile||this.compile(n)}},get:function(){return this.value},compile:function(t){var n=e.Compiler.compileAttributeValue(this);this.values&&(e.Utils.isFunction(this.values)?arr=this.values():arr=this.values,e.Utils.isArray(arr)&&-1==arr.indexOf(n))||(this.updateRestore(),n!==this.value&&(this.changed=!1,this.value=n,t&&t.manualUpdate||this.update(t)))},update:function(t){this.post(t)},post:function(t){},updateRestore:function(){clearTimeout(this._restoreTimeoutId),this.restoreTimeout&&(this._restoreTimeoutId=setTimeout(function(){this.set(this.default)}.bind(this),this.restoreTimeout))}},e.ComponentManager=function(t){function e(t,e,n){e[n]||(e[n]=[]),e[n].push(t)}function n(t,e,n){for(var i=0;i<e[n].length;i++)if(e[n]==t)return e[n]=null,void delete e[n]}function i(t,e){return t[e]?t[e]:[]}this.client=t;var o=[],s={},r={},a={};this.index=function(t){o.push(t),e(t,a,t.type),t.id&&e(t,s,t.id),t.group&&e(t,r,t.group)},this.addByGroup=function(t,n){e(t,r,n)},this.removeByGroup=function(t,e){n(t,r,e)},this.getFirstById=function(t){return this.getById(t)[0]},this.getById=function(t){return i(s,t)},this.getByType=function(t){return i(a,t)},this.getByGroup=function(t){return i(r,t)},this.getValue=function(t){var e=this.getFirstById(t);return e?e.getAttribute("value"):null}},e.ComponentPresets={},e.Components=new function(){this._componentDefs={},this._createLater={},this.Classes={},this.setSource=function(t,e){this.getClass(t).prototype.source=e},this.bakeSource=function(t){var n=this.getClass(t),i=document.createElement("div");i.innerHTML=e.Compiler.compileHTML(n.prototype.source);var o=e.Utils.getFirstChildNodeOfType(i,1);o.setAttribute("data-controller",t),n.prototype.dom=o,n.prototype.source=null},this.getClassName=function(t){return e.Utils.capitalize(e.Utils.dashToCamel(t))},this.getClass=function(t){return e.Components.Classes[this.getClassName(t)]},this.createInstance=function(t,e){var n=this.getClass(t);return null==n?null:new n({attributes:e})},this.create=function(t,e){this._componentDefs[t]=e},this.boot=function(){for(var t in this._componentDefs)this.createClass(t,this._componentDefs[t]);this._componentDefs={}},this.createClass=function(t,n){if(n.extends&&!e.Components.Classes[n.extends])return this._createLater[n.extends]||(this._createLater[n.extends]=[]),void this._createLater[n.extends].push({name:t,def:n});e.Components.Classes[t]=function(n){if(this.children=[],n.element)this.element=element;else if(this.source&&e.Components.bakeSource(t),this.dom){this.element=this.dom.cloneNode(!0),this.element.controller=this,this.subComponents={};var i,o=e.Utils.getAllCommentChildNodes(this.element);this.id=n.attributes?n.attributes.id:null;for(var s=0;s<o.length;s++)if("sml"==o[s].nodeValue.substr(0,3)){i=e.Utils.parseXML(o[s].nodeValue.substr(3));var r=e.Compiler.compileXML(i,{index:!!this.id,idPrefix:this.id});r&&r.element&&(o[s].parentNode.replaceChild(r.element,o[s]),this.addSubComponent(r))}}this.attributes={};for(var a in this.attrDefs)this.attributes[a]=new e.Attribute(this,this.attrDefs[a]);if(this.super("_Base","init"),!n.doc){this.init();for(var a in this.attributes)n.attributes&&null!=n.attributes[a]?this.setAttribute(a,n.attributes[a]):null!=this.attributes[a].default&&this.setAttribute(a,this.attributes[a].default)}};var i=e.Components.Classes[t];i.displayName="Sfera.Component.Classes."+t,n.extends||"_Base"==t||(n.extends="_Base");var o;n.extends?(o=e.Components.Classes[n.extends].prototype,i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.type=t):o={attrDefs:{}};var s;e.Doc&&((s=e.Doc.get.component(t))&&s.doc&&(i.prototype.doc=s.doc),s&&s.doc||(s={doc:{}}),i.prototype.doc=s.doc),i.prototype.attrDefs={};var r;e.Doc&&(r=e.Doc.get.component(n.extends));for(var a in o.attrDefs)i.prototype.attrDefs[a]=o.attrDefs[a],r&&r.attr&&r.attr[a]&&!o.attrDefs[a].doc&&(i.prototype.attrDefs[a].doc=r.attr[a]);if(n.presets)for(u=0;u<n.presets.length;u++)if(e.ComponentPresets[n.presets[u]].call(i.prototype),e.Doc){var l=e.Doc.get.preset(n.presets[u]);if(l)for(var a in l)i.prototype.attrDefs[a]||(i.prototype.attrDefs[a]={}),i.prototype.attrDefs[a].doc=l[a]}if(n.attributes)for(var c in n.attributes)if(i.prototype.attrDefs[c]){if(i.prototype.attrDefs[c]==o.attrDefs[c]){i.prototype.attrDefs[c]={};for(var u in o.attrDefs[c])i.prototype.attrDefs[c][u]=o.attrDefs[c][u]}for(var u in n.attributes[c])i.prototype.attrDefs[c][u]=n.attributes[c][u]}else i.prototype.attrDefs[c]=n.attributes[c];if(s&&s.attr)for(var a in s.attr)i.prototype.attrDefs[a]&&(i.prototype.attrDefs[a].doc=s.attr[a]);for(var h in n)"presets"!=h&&"attributes"!=h&&(i.prototype[h]=n[h],"function"==typeof i.prototype[h]&&(i.prototype[h].displayName="Sfera.Components.Classes."+t+"."+h));if(this._createLater[t]){for(u=0;u<this._createLater[t].length;u++){var d=this._createLater[t][u];this.createClass(d.name,d.def)}delete this._createLater[t]}}},e.Client=function(t){function n(n){t.idleTimeout=n.idleTimeout,e.Login.resetIdleTimeout(),C.state.firstEventReceived=!1,C.isLogin?e.Login.gotoInterface():e.Net.nodeSubscribe("*")}function i(){C.isLogin||C.showLoading(!0)}function o(t){if(t.result&&t.result.uiSet)for(var e in t.result.uiSet)for(var n=e.split("."),i=n.pop(),o=C.components.getById(n.join(".")),s=0;s<o.length;s++)o[s].setAttribute(i,t.result.uiSet[e]);switch(t.action){case"command":D[t.tag]&&(D[t.tag].callback&&D[t.tag].callback(D[t.tag].cmd,t.result),delete D[t.tag]);break;case"event":E[t.tag]&&(E[t.tag].callback&&E[t.tag].callback(E[t.tag].id,E[t.tag].value,t.result),delete E[t.tag])}}function s(t){e.Compiler.compileDictionary(t)}function r(t){var n=e.Compiler.compileXML(t);S.sfera.appendChild(n.element),C.cInterface=C.components.getByType("Interface")[0],C.cInterface.setAttribute("visible","false"),C.state.indexUpdated=!0,C.state.started||!C.state.firstEventReceived&&!C.isLogin||C.start()}function a(n){for(var i in n.nodes)if(!e.Custom.onEvent||!1!==e.Custom.onEvent(i,n.nodes[i])){var o=i.split(".");switch(o[0]){case"ui":if("set"==o[1])for(var s=(o=o.slice(3)).pop(),r=C.components.getById(o.join(".")),a=0;a<r.length;a++)r[a].setAttribute(s,n.nodes[i]);break;case"webapp":"interface"==o[1]&&o[2]==C.name&&"update"==o[3]&&(y=n.nodes[i])!=t.timestamp&&C.reload()}_[i]=n.nodes[i],k[i]&&k[i].dispatch()}C.state.firstEventReceived=!0,!C.state.started&&C.state.indexUpdated?C.start():C.showLoading(!1)}function l(){function t(e){if(e.onAdjust&&e.onAdjust(),e.children)for(var n=0;n<e.children.length;n++)t(e.children[n])}if(C.cInterface){var e,n,i=C.cInterface.getAttribute("width"),o=C.cInterface.getAttribute("height");if(window.innerWidth?(e=window.innerWidth,n=window.innerHeight):document.documentElement&&document.documentElement.clientWidth?(e=document.documentElement.clientWidth,n=document.documentElement.clientHeight):document.body.clientWidth?(e=document.body.clientWidth,n=document.body.clientHeight):(e=0,n=0),e>0){var s=e>i?(e-i)/2:0,r=n>o?(n-o)/2:0;C.cInterface.element.style.display="none",C.cInterface.element.style.left=s+"px",C.cInterface.element.style.top=r+"px",C.cInterface.element.style.display="block"}if(C.cInterface.getAttribute("fit")){var a=window.innerWidth/C.cInterface.getAttribute("width"),l=window.innerHeight/C.cInterface.getAttribute("height"),c=Math.min(a,l),u="scale("+c+","+c+")",h=C.cInterface.element;h.style.transform=u,h.style.OTransform=u,h.style.MozTransform=u,a==c&&(h.style.left="0px",h.style.transformOrigin="0"),l==c&&(h.style.top="0px",h.style.transformOrigin="top")}C.cPage&&t(C.cPage)}}function c(t){var n=t||window.event,i=n.charCode||n.keyCode;if(C.ctrlKey=n.ctrlKey,C.shiftKey=n.shiftKey,A&&A.onKeyDown){if(!A.onKeyDown(n,i))return e.Browser.preventDefault(n),!1}else if(9==i)return C.cPage.children.length&&p(C.cPage,n.shiftKey),e.Browser.preventDefault(n),!1;return!0}function u(t){var n=t||window.event,i=n.charCode||n.keyCode;return C.ctrlKey=n.ctrlKey,C.shiftKey=n.shiftKey,!(A&&A.onKeyPress&&!A.onKeyPress(n,i))||(e.Browser.preventDefault(n),!1)}function h(t){var n=t||window.event,i=n.charCode||n.keyCode;return C.ctrlKey=n.ctrlKey,C.shiftKey=n.shiftKey,!!(A&&A.onKeyUp&&A.onKeyUp(n,i))||(e.Browser.preventDefault(n),!1)}function d(t){return t!=this&&t.focus&&t.isVisible()&&t.isEnabled()}function p(t,e){var n=t.children.length,i=t.children[e?n-1:0];if(i.isVisible()){if(i.focus&&i.isEnabled())return i.focus(),i;if(i.children&&i.children.length)return p(i,e)}return f(i)}function f(t,e){var n,i,o=t.parent.children,s=-1;for(n=0;n<o.length;n++)if(o[n]==t){s=n;break}if(-1==s)return null;n=s;do{if(e){if(--n<0){if(t.parent.parent&&(i=f(t.parent,e)))return i;n=o.length-1}}else if(++n>=o.length){if(t.parent.parent&&(i=f(t.parent,e)))return i;n=0}if(o[n].children&&o[n].children.length&&(i=p(o[n],e)))return i;if(d(o[n]))return o[n].focus(),o[n]}while(o[n]!=t);return null}function g(t){if(null!=t)try{totalFiles=Number(t.total),L+=1;var e=Math.round(L/totalFiles*100);C.showCachePercentage(e)}catch(t){}}function m(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY||window.applicationCache.status==window.applicationCache.IDLE){clearInterval(w);try{window.applicationCache.swapCache()}catch(t){console.log("Error on swapCache "+t.message)}C.cInterface.getAttribute("autoReload")?(client.stop(),e.Browser.reload(!0)):(t.timestamp=y,b=!1,statusIcon.set("cache",!1))}else window.applicationCache.status==window.applicationCache.OBSOLETE&&v()}function v(){clearInterval(w),b=!1,C.reload()}e.client=this,t||(t={}),this.name="",this.isLogin=!1,this.state={booted:!1,started:!1,indexUpdated:!1,firstEventReceived:!1},this.components=null,this.input=null,this.debug=null,this.cInterface=null,this.cPage=null;var w,b,y=0,C=this,D={},E={},S={},L=0;this.boot=function(d){if(!this.state.booted){var p=e.Browser.getLocation();this.name=p.interface,this.isLogin=p.login,t.timestamp&&(y=t.timestamp),e.client=this,this.state.booted=!0,e.Components.boot(),this.components=new e.ComponentManager(this),this.name=t.interface,this.debug=e.Debug,this.debug.boot(),window.focus&&window.focus();for(var f=["sfera","loading","cacheStatus","cachePerc"],g=0;g<f.length;g++)S[f[g]]=document.getElementById(f[g]);e.Debug.showHeader(),e.Net.boot(),e.Net.require(["dictionary","index"]),e.Net.onReply.add(o),e.Net.onEvent.add(a),e.Net.onUpdateDictionary.add(s),e.Net.onUpdateIndex.add(r),e.Net.onConnection.add(n),e.Net.onClose.add(i),e.Net.connect(),window.addEvent("resize",window,l),window.addEvent("keydown",window,c),window.addEvent("keyup",window,h),window.addEvent("keypress",window,u),S.loading.onmousedown=S.loading.onmouseup=S.loading.onmousemove=function(t){e.Browser.preventDefault(t)}}},this.destroy=function(){this.input.destroy(),this.input=null,this.isBooted=!1,e.CLIENTS[this.id]=null},this.openIndex=function(t,e){},this.openDictionary=function(t,e){},this.start=function(){e.Browser.start(),this.cInterface.setAttribute("visible","true"),l(),this.state.started=!0,this.showLoading(!1),e.Custom.onReady&&e.Custom.onReady()},this.stop=function(){},this.indexComponent=function(t){this.components.index(t)},this.setAttribute=function(t,e,n,i){for(var o=this.components.getById(t),s=0;s<o.length;s++)o[s].setAttribute(e,n,i)},this.getAttribute=function(t,e){return this.components.getFirstById(t).getAttribute(e)},this.showPage=function(t){if(-1==t.indexOf(":")&&(t="page:"+t),!e.Custom.onPage||!1!==e.Custom.onPage(t)){this.cPage&&this.cPage.setAttribute("visible",!1);var n=this.components.getFirstById(t);if(n){n.setAttribute("visible",!0),this.cPage=n;var i=this.cInterface.getAttribute("title"),o=n.getAttribute("title");e.Browser.updateUrl(t,(i||"Sfera")+(o?" - "+o:""))}else this.isLogin&&this.showPage("page:home"),console.log("page not found: "+t)}},this.sendCommand=function(t,n){var i=(new Date).getTime(),o={command:t,tag:i,callback:n};return D[i]=o,e.Net.sendCommand(o),i},this.sendEvent=function(t,n,i){if(t){var o=(new Date).getTime(),s={id:"webapp.ui."+t,value:n,tag:o,callback:i};return E[s]=s,e.Net.sendEvent(s),o}e.Debug.logError("sending event: id not valid")};var _={};this.getNodeValue=function(t){return _[t]?_[t]:""};var k={};this.bindAttrObserver=function(t,n){k[t]||(k[t]=new e.Signal),k[t].addOnce(n.compile,n)},this.removeAttrObserver=function(t,e){k[t].remove(e.compile,e)};var A,x;this.setFocused=function(t){A&&A!=t&&A.blur(),A=t,x&&clearTimeout(x),t.noBlurTimeout||(x=setTimeout(this.focus,3e4))},this.clearFocused=function(t){A==t&&(A=null),x&&clearTimeout(x)},this.focus=function(){A&&A.blur()},this.focusNext=function(t){return f(A,t)},this.showLoading=function(t){S.loading.style.display=t?"inline":"none"},this.showCachePercentage=function(t){S.cacheStatus.style.display=t?"inline":"none",S.cachePerc.innerHTML=t?t+"%":""},this.reload=function(n){b||(b=!0,!n&&window.applicationCache&&window.applicationCache.status!=window.applicationCache.UNCACHED?window.applicationCache.status==window.applicationCache.UPDATEREADY?m():(w=setInterval(m,500),window.addEvent("updateready",window.applicationCache,m,!1),window.addEvent("error",window.applicationCache,v,!1),window.addEvent("progress",applicationCache,g,!1),L=0,window.applicationCache.update()):this.cInterface.getAttribute("autoReload")?(client.stop(),e.Browser.reload()):(t.timestamp=y,b=!1))}},e.Debug=new function(){function t(t,n,i,o){var s=e.Utils.getDate("hisu")+" - ";if(e.Device.chrome){var r=[""];switch(r[0]+="%c"+s,r.push("color:#999"),r[0]+="%c"+n,t){case"msg":r.push("color:#000");break;case"err":r.push("color:#e11");break;case"not":r.push("color:#e8e")}i&&(r[0]+=" %c"+i,r.push("color:#5a5")),this.verbose&&(r[0]+=" %c"+o,r.push("color:#55a")),console.log.apply(console,r)}else console.log(s+n,i,o)}this.verbose=!1,this.boot=function(){},this.log=function(e,n,i){t("msg",e,n,i)},this.logError=function(e,n,i){t("err",e,n,i)},this.logNotice=function(e,n,i){this.verbose&&t("not",e,n,i)},this.showHeader=function(){var t=e.VERSION,n="https://sferalabs.cc/sfera";if(e.Device.chrome){var i=["%c %c %c Sfera v"+t+"  %c %c %c "+n,"background: #afc4dc","background: #6991bc","color: #ffffff; background: #26609f;","background: #6991bc","background: #afc4dc","background: #ffffff"];console.log.apply(console,i)}else window.console&&console.log("Sfera v"+t+" | "+n)}},e.Log=new function(){this.ALL=1,this.DEBUG=2,this.INFO=3,this.WARN=4,this.ERROR=5,this.FATAL=6,this.OFF=7;var t=this.WARN;this.setLevel=function(e){t=e}},e.Login=new function(){function t(){(c=new e.Net.Request).onLoaded=function(t){if(clearTimeout(d),200!=t)return e.Custom.onLoginError&&e.Custom.onLoginError(u,h),e.client.setAttribute("username","error","true"),void e.client.setAttribute("password","error","true");switch(f){case"login":var n;e.Custom.onLoginSuccess&&(n=e.Custom.onLoginSuccess(u,h)),!1!==n&&m.gotoInterface();break;case"logout":m.gotoLogin()}},c.onError=function(t){e.client.setAttribute("username","error","true"),e.client.setAttribute("password","error","true"),i()}}function n(){}function i(){clearTimeout(d),d=setTimeout(n,p)}function o(){a(!0),clearInterval(g)}function s(){var t=localStorage.getItem("idleTimestamp");(new Date).getTime()-t>=1e3*parseInt(config.idleTimeout)&&r()}function r(){o(),e.Login.logout()}function a(t){var n=(t?"remove":"add")+"Event",i=e.Device.touch;window[n](i?"touchstart":"mousedown",window,l),window[n](i?"touchend":"mouseup",window,l),window[n]("keydown",window,l)}function l(t){m.resetIdleTimeout()}var c,u,h,d=null,p=500,f="",g=null,m=this;this.login=function(n,o){c||t(),f="login",i(),u=n||e.client.getAttribute("username","value"),h=o||e.client.getAttribute("password","value"),c.open("/api/login?user="+u+"&password="+h+"&",100)},this.logout=function(){c||t(),f="logout",c.open("/api/logout",100)},this.gotoLogin=function(){e.Browser.setLocation("/"+e.Browser.getLocation().interface+"/login")},this.gotoInterface=function(){e.Browser.setLocation("/"+e.Browser.getLocation().interface)},window.onload=function(){i()},this.resetIdleTimeout=function(){o(),config.idleTimeout&&parseInt(config.idleTimeout)&&!m.isLogin&&(a(),g=setInterval(s,1e3),localStorage.setItem("idleTimestamp",(new Date).getTime()))}},e.Signal=function(){},e.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!0,validateListener:function(t,e){if("function"!=typeof t)throw new Error("Sfera.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(t,n,i,o,s){var r,a=this._indexOfListener(t,i);if(-1!==a){if((r=this._bindings[a]).isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else r=new e.SignalBinding(this,t,n,i,o,s),this._addBinding(r);return this.memorize&&this._prevParams&&r.execute(this._prevParams),r},_addBinding:function(t){this._bindings||(this._bindings=[]);var e=this._bindings.length;do{e--}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){if(!this._bindings)return-1;void 0===e&&(e=null);for(var n,i=this._bindings.length;i--;)if((n=this._bindings[i])._listener===t&&n.context===e)return i;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,n){this.validateListener(t,"add");var i=[];if(arguments.length>3)for(var o=3;o<arguments.length;o++)i.push(arguments[o]);return this._registerListener(t,!1,e,n,i)},addOnce:function(t,e,n){this.validateListener(t,"addOnce");var i=[];if(arguments.length>3)for(var o=3;o<arguments.length;o++)i.push(arguments[o]);return this._registerListener(t,!0,e,n,i)},remove:function(t,e){this.validateListener(t,"remove");var n=this._indexOfListener(t,e);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),t},removeAll:function(t){if(void 0===t&&(t=null),this._bindings){for(var e=this._bindings.length;e--;)t?this._bindings[e].context===t&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)):this._bindings[e]._destroy();t||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var t,e=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=e),n){t=this._bindings.slice(),this._shouldPropagate=!0;do{n--}while(t[n]&&this._shouldPropagate&&!1!==t[n].execute(e))}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Sfera.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(e.Signal.prototype,"boundDispatch",{get:function(){var t=this;return this._boundDispatch||(this._boundDispatch=function(){return t.dispatch.apply(t,arguments)})}}),e.Signal.prototype.constructor=e.Signal,e.SignalBinding=function(t,e,n,i,o,s){this._listener=e,n&&(this._isOnce=!0),null!=i&&(this.context=i),this._signal=t,o&&(this._priority=o),s&&s.length&&(this._args=s)},e.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(t){var e,n;return this.active&&this._listener&&(n=this.params?this.params.concat(t):t,this._args&&(n=n.concat(this._args)),e=this._listener.apply(this.context,n),this.callCount++,this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Sfera.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},e.SignalBinding.prototype.constructor=e.SignalBinding,e.UI=new function(){var t,e;this.skipButtonEvents=!1,this.overEnabled=!0,this.buttonFeedbackEnabled=!0,this.setPressedButton=function(e){t=e},this.getPressedButton=function(){return t},this.updateLastButton=function(){e=t},this.getLastButton=function(){return e},this.liftButton=function(e){return!(!t||e&&e!=t)&&(t.lift(),t=null,!0)},this.resetButton=function(t){this.liftButton(t)||(t.data.state="",t.updateClass())},this.destroyButtons=function(t){for(var e=0;e<t.length;e++)t[e].destroy();return t.length=0,t}},e.UI.Button=function(t,e){this.element=t,this.element.btObj=this,this.initData(),e&&this.initEvents(e)},e.UI.Button.prototype={_attributes:{disabled:0,selected:1,pressed:2,checked:3,focused:4,error:5},_linked:null,initData:function(){var t=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],e=this.element.className,n="(.*\\s)?([mc][^\\s]*Button)(\\s("+t.join("|")+"))?(\\s.*)?(\\sover|\\sdown)?",i=new RegExp(n).exec(e);if(i&&i[2])o={pre:i[1]?i[1]:"",bc:i[2],color:i[4]?i[4]:"",attrs:[],state:i[6]?i[6].substr(1):""};else var o={pre:e,bc:"",color:"",attrs:[],state:""};for(var s in this._attributes)o.attrs[this._attributes[s]]=!(!i||!i[5])&&-1!=i[5].indexOf(" "+s);this.data=o,this.onLift=null,this.dontLiftOnMove=!1},initEvents:function(t){t.onclick&&(t.onup=t.onclick),e.Device.touch?(this.element.ontouchstart=this.onEvent.bind(this,"touchstart",t.ondown,null),this.element.ontouchmove=this.onEvent.bind(this,"touchmove",t.onmove,t.onout),this.element.ontouchend=this.onEvent.bind(this,"touchend",t.onup,null)):(this.element.onmouseover=this.onEvent.bind(this,"mouseover",t.onover,null),this.element.onmouseout=this.onEvent.bind(this,"mouseout",t.onout,null),this.element.onmousemove=this.onEvent.bind(this,"mousemove",t.onmove,null),this.element.onmousedown=this.onEvent.bind(this,"mousedown",t.ondown,null),this.element.onmouseup=this.onEvent.bind(this,"mouseup",t.onup,null)),t.onlift&&(this.onLift=t.onlift),t.dontLiftOnMove&&(this.dontLiftOnMove=!0)},clearEvents:function(){e.Device.touch?(delete this.element.ontouchstart,delete this.element.ontouchmove,delete this.element.ontouchend):(delete this.element.onmouseover,delete this.element.onmouseout,delete this.element.onmousedown,delete this.element.onmouseup)},destroy:function(){var t=e.UI.getPressedButton();t&&t==this.element&&(e.UI.setPressedButton(null),e.UI.updateLastButton()),this.clearEvents()},link:function(t){this._linked||(this._linked=[]),t._linked||(t._linked=[]),this._linked.push(t),t._linked.push(this)},setColor:function(t){this.data.color=t,this.updateClass()},enable:function(t){this.setAttribute("disabled",!t)},select:function(t){this.setAttribute("selected",t)},focus:function(t){this.setAttribute("focused",t)},mini:function(t){this.setAttribute("mini",t)},lift:function(){this.data.state&&(this.data.state="",this.updateClass()),this.onLift&&this.onLift()},getAttribute:function(t){return this.data||this.initData(),this.data.attrs[this._attributes[t]]},setAttribute:function(t,e){this.getAttribute(t)!=e&&(this.data.attrs[this._attributes[t]]=e,this.updateClass())},updateClass:function(){var t=this.data,n=t.pre+t.bc;t.color&&(n+=" "+t.color);for(var i in this._attributes)t.attrs[this._attributes[i]]&&(n+=" "+i);e.UI.buttonFeedbackEnabled&&t.state&&(n+=" "+t.state),this.element.className=n},setClassName:function(t){this.data.pre=t,this.updateClass()},disableAndroidLongPress:function(t,n){if(e.Device.android){for(var i=n;i;){if(i.getAttribute&&i.getAttribute("data-scrollmode"))return;i=i.parentNode}t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1}},preventDefault:function(t){t.returnValue&&(t.returnValue=!1),t.preventDefault&&t.preventDefault()},onEvent:function(t,n,i,o){if(!e.UI.skipButtonEvents&&!this.getAttribute("disabled")){var s=window.event||o;if("touchstart"==t||"touchend"==t||"touchmove"==t){if(!e.Device.touch)return!1}else if(s&&this.preventDefault(s),e.Device.touch)return!1;this.data||this.initData();var r=this.data.attrs[this._attributes.switch],a=!!r&&this.data.attrs[this._attributes.pressed],l=a,c="";if(!this.data.attrs[this._attributes.disabled])switch(t){case"touchstart":e.UI.setPressedButton(this),lastButton=null,touchStartX=s.touches[0].clientX,touchStartY=s.touches[0].clientY,c="down",r&&(l=!a),this.disableAndroidLongPress(s,this.element);break;case"touchmove":e.UI.getPressedButton()==this&&(c="down",!this.dontLiftOnMove&&(Math.abs(s.touches[0].clientX-touchStartX)>30||Math.abs(s.touches[0].clientY-touchStartY)>30)&&(e.UI.setPressedButton(null),n=i)),this.disableAndroidLongPress(s,this.element);break;case"touchend":e.UI.getPressedButton()!=this?n=null:(e.UI.updateLastButton(),this.preventDefault(s)),e.UI.setPressedButton(null),this.disableAndroidLongPress(s,this.element);break;case"mouseover":var u=e.UI.getPressedButton();u?u==this.element&&(c="down"):e.UI.overEnabled&&(c="over");break;case"mousemove":e.UI.overEnabled&&(c="over");break;case"mouseout":var h;if(s&&(h=s.relatedTarget?s.relatedTarget:s.toElement),h){for(;h&&h!=this.element&&"BODY"!=h.nodeName;)h=h.parentNode;if(h==this.element)return}e.UI.setPressedButton(null);break;case"mousedown":e.UI.setPressedButton(this),lastButton=null,c="down",r&&(l=!a);break;case"mouseup":e.UI.getPressedButton()!=this?n=null:e.UI.updateLastButton(),e.UI.setPressedButton(null),e.UI.overEnabled&&(c="over")}if((c!=this.data.state||l!=a)&&(this.data.state=c,r&&(this.data.attrs[this._attributes.pressed]=l),this.updateClass(),this._linked))for(var d=0;d<this._linked.length;d++)c!=this._linked[d].data.state&&(this._linked[d].data.state=c,this._linked[d].updateClass());return n&&"null"!=n&&!this.data.attrs[this._attributes.disabled]&&("string"==typeof n?new Function("event","element",n):n)(o,this.element),!1}}},e.Net=new function(){function t(t){w.onOpen.dispatch(t.data),e.Debug.log("ws open",t.data)}function n(t){if("&"==t.data)e.Debug.logNotice("ws ping"),r(),w.wsSend("&");else{switch(e.Debug.log("ws msg",t.data),json=JSON.parse(t.data),json.type){case"reply":w.onReply.dispatch(json);break;case"connection":json.errors||(clearTimeout(g),m=null,w.connectionId=json.connectionId,d=parseInt(json.pingInterval),p=parseInt(json.responseTimeout),r(),v=!0,w.onConnection.dispatch(json));break;case"console":w.onConsole.dispatch(json);break;case"event":w.onEvent.dispatch(json)}w.onMessage.dispatch(t.data)}}function i(t){w.wsOpen(m)}function o(t){v=!1,1e3!=t.code?e.Debug.logError("ws closed",t.reason,t.code):e.Debug.log("ws closed",t.reason,t.code),w.onClose.dispatch(t.code,t.reason),"Unauthorized"==t.reason&&e.Login&&!D.login?(y="check",w.request(b+w.getURL(y))):w.wsOpen(m)}function s(){m?(m*=C.reconnectDecay)>C.maxReconnectInterval&&(m=C.maxReconnectInterval):m=C.reconnectInterval}function r(){clearTimeout(f),setTimeout(this.wsClose,d+p)}function a(){return(new Date).getTime()}function l(){e.Debug.log(y+" loaded","",u.getResponseText()),null!=w.localTs[y]&&(w.localTs[y]=a());var t;switch(y){case"dictionary":w.onUpdateDictionary.dispatch(u.getResponseXML());break;case"index":w.onUpdateIndex.dispatch(u.getResponseXML());break;case"connect":w.connectionId=u.getResponseJSON().cid;break;case"subscribe":w.subscribed=!0;case"state":(t=JSON.parse(u.getResponseText())).timestamp&&(w.stateTs=t.timestamp);break;case"check":e.Login.gotoLogin()}w.sync()}function c(t){e.Debug.logError("request error"),404==t&&u.repeat(100)}var u,h,d,p,f,g,m,v=!1,w=this,b="/",y="",C={reconnectInterval:50,maxReconnectInterval:5e3,reconnectDecay:1.25},D={};this.connectionId=null,this.stateTs=-1,this.subscribed=!1,this.localTs={},this.remoteTs={},this.onOpen=new e.Signal,this.onClose=new e.Signal,this.onConnection=new e.Signal,this.onMessage=new e.Signal,this.onEvent=new e.Signal,this.onReply=new e.Signal,this.onConsole=new e.Signal,this.onUpdateDictionary=new e.Signal,this.onUpdateIndex=new e.Signal,this.getURL=function(t,n){n||(n={});for(var i in D)null==n[i]&&(n[i]=D[i]);switch(n.connectionId=this.connectionId,n.stateTs=e.client?e.client.stateTs:null,t){case"dictionary":return n.interface+(n.login?"/login":"")+"/dictionary.xml";case"index":return n.interface+(n.login?"/login":"")+"/index.xml";case"connect":return"api/connect";case"subscribe":return"api/subscribe?cid="+(n.connectionId?n.connectionId:"");case"state":return"api/state/"+n.connectionId+"?ts="+n.stateTs;case"command":return"api/command";case"event":return"api/event";case"websocket":return("https:"==n.protocol?"wss:":"ws:")+"//"+n.host+"/api/websocket";case"check":return n.interface+"/login/index.xml"}},this.boot=function(){D=e.Browser?e.Browser.getLocation():{}},this.require=function(t){for(var e=0;e<t.length;e++)this.localTs[t[e]]=-1,this.remoteTs[t[e]]=-1},this.wsOpen=function(r){if(r)return clearTimeout(g),void(g=setTimeout(this.wsOpen.bind(this),r));var a=w.getURL("websocket");e.Debug.log("ws opening on "+a),void 0===h||h.readyState===WebSocket.CLOSED?(null!=this.connectionId&&(a+="?cid="+this.connectionId),(h=new WebSocket(a)).onopen=t,h.onmessage=n,h.onclose=o,h.onerror=i,s()):e.Debug.logError("websocket: is already opened")},this.wsSend=function(t){"&"==t?e.Debug.logNotice("ws pong"):e.Debug.log("ws send",t),h.send(t)},this.wsClose=function(){h.close()},this.request=function(t){u||((u=new e.Net.Request).onLoaded=l,u.onError=c),u.open(t,20)},this.connect=function(t){this.sync()},this.sync=function(){for(var t in this.localTs)if(-1==this.localTs[t])return y=t,void this.request(b+w.getURL(t));w.wsOpen()},this.nodeSubscribe=function(t){var e={action:"subscribe",nodes:t,tag:(new Date).getTime()};this.wsSend(JSON.stringify(e))},this.getHostName=function(){return window.location&&window.location.hostname?window.location.hostname:null},this.sendCommand=function(t){var e={action:"command",cmd:t.command,tag:t.tag||(new Date).getTime()};this.wsSend(JSON.stringify(e))},this.sendEvent=function(t){var e={action:"event",id:t.id,value:t.value,tag:t.tag||(new Date).getTime()};this.wsSend(JSON.stringify(e))},this.sendConsole=function(t){var e={action:"console",cmd:t.command,tag:t.tag||(new Date).getTime()};this.wsSend(JSON.stringify(e))}},e.Net=e.Net||{},e.Net.Request=function(t){function e(){l&&(clearTimeout(l),l=null),s=-1,r.abort(),o(c.ERROR_MAXWAITTIME),c.init()}function n(){if(null!=r.readyState){switch(r.readyState){case 0:case 1:return;case 2:case 3:return}if(l&&(clearTimeout(l),l=null),1==s)if(s=2,200==r.status){c.formData=null;try{r.responseText}catch(t){return void o(c.ERROR_GENERAL)}c.onLoaded&&c.onLoaded.call(c,r.status)}else o(r.status)}}function i(t){c.onProgress&&c.onProgress(t)}function o(t){switch(t){case c.ERROR_UNAUTHORIZED:if(c.onUnauthorized)return void c.onUnauthorized()}t>=400&&c.onConnectionError?c.onConnectionError():c.retryOnErrorDelay&&(!c.maxRetries||c.retries<c.maxRetries)&&(c.retries++,c.onRetry&&c.onRetry(),c.retryOnErrorDelay)?c.repeat(c.retryOnErrorDelay):(c.formData=null,c.onError&&c.onError(t))}t=t||{};var s,r=null,a=null;this.url="",this.method=t.method||"GET",this.formData=null,this.onLoaded=null,this.onStop=null,this.onRetry=null,this.onError=null,this.onRequest=null,this.onConnectionError=null,this.onUnauthorized=null,this.maxWaitingTime=0;var l=null;this.retryOnErrorDelay=0,this.maxRetries=0,this.retries=0;var c=this;this.ERROR_GENERAL=0,this.ERROR_CONNECTION=1,this.ERROR_MAXWAITTIME=2,this.ERROR_UNAUTHORIZED=401,this.ERROR_FORBIDDEN=403,this.ERROR_NOT_FOUND=404,this.init=function(){s=0,window.XMLHttpRequest?((r=new XMLHttpRequest).onreadystatechange=n,r.upload&&r.upload.addEventListener("progress",i)):window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLHTTP"))&&(r.onreadystatechange=n)},this.addData=function(t,e){this.formData||(this.formData=new FormData),this.formData.append(t,e)},this.open=function(t,n){if(1==s&&c.stop(),s=0,t&&(c.url=t,c.retries=0),a&&(clearTimeout(a),a=null),l&&(clearTimeout(l),l=null),n)a=setTimeout(c.open,n);else{r||c.init(),s=1,c.onRequest&&c.onRequest();try{r.open(c.method,c.url,!0)}catch(t){return void o(c.ERROR_GENERAL)}if("GET"==c.method)r.send();else{Math.random().toString().substr(2);r.send(c.formData)}c.maxWaitingTime&&(l=setTimeout(e,c.maxWaitingTime))}},this.stop=function(){(1==s||a)&&this.onStop&&this.onStop(1==s),1==s&&(s=-1,r.abort(),this.init()),a&&(clearTimeout(a),a=null),l&&(clearTimeout(l),l=null),s=0},this.repeat=function(t){this.open(null,t)},this.getResponseJSON=function(){var t=this.getResponseText();return t?JSON.parse(t):null},this.getResponseText=function(){try{return r.responseText}catch(t){return null}},this.getResponseXML=function(){try{return r.responseXML}catch(t){return null}},this.isReady=function(){return 1!=s}},e.Skins=function(t){this.client=t},e.Browser=new function(){var t;this.reload=function(){window.location.reload()},this.setLocation=function(t){window.location.replace(t)},this.preventDefault=function(t){t.stopPropagation&&t.stopPropagation(),t.returnValue&&(t.returnValue=!1),t.preventDefault&&t.preventDefault()},this.changeUrl=function(t,e){if(void 0!==history.pushState){var n={Title:t,Url:e};return history.pushState(n,n.Title,n.Url),!0}return!1},this.updateUrl=function(t,e){var i=this.getLocation();if(hash="page:home"==t?"":t,document.title=e,i.hash!=hash){n=hash;var o=i.pathname+"#"+t;t&&i.search&&(o+="?"+i.search),this.changeUrl(e,o)}},this.getLocation=function(){var e=window.location.href;if(!t||t.url!=e){var n,i=window.location.hash,o=window.location.search;i&&("#"==i[0]&&(i=i.substr(1)),-1!=i.indexOf("?")&&(i=(n=i.split("?"))[0],o=n[1])),o&&("?"==o[0]&&(o=o.substr(1)),-1!=o.indexOf("#")&&(o=(n=o.split("#"))[0],i=n[1]));var s=window.location.pathname.split("/");t={url:e,host:window.location.host,protocol:window.location.protocol,pathname:window.location.pathname,hash:i,search:o,interface:s[1],login:"login"==s[2]}}return t};var n=null;this.start=function(){setInterval(function(){var t=e.Browser.getLocation(),i="page:home"==t.hash?"":t.hash;i!==n&&(n=i,e.client.showPage(t.hash?t.hash:"home"))},100)}},e.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},e.Device=new e.Device,e.Device.onInitialized=new e.Signal,e.Device.whenReady=function(t,e,n){var i=this._readyCheck;if(this.deviceReadyAt||!i)t.call(e,this);else if(i._monitor||n)i._queue=i._queue||[],i._queue.push([t,e]);else{i._monitor=i.bind(this),i._queue=i._queue||[],i._queue.push([t,e]);var o=void 0!==window.cordova,s=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(i._monitor,0):o&&!s?document.addEventListener("deviceready",i._monitor,!1):(document.addEventListener("DOMContentLoaded",i._monitor,!1),window.addEventListener("load",i._monitor,!1))}},e.Device._readyCheck=function(){var t=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",t._monitor),document.removeEventListener("DOMContentLoaded",t._monitor),window.removeEventListener("load",t._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var e;e=t._queue.shift();){var n=e[0],i=e[1];n.call(i,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(t._monitor,20)},e.Device._initialize=function(){var t=this;!function(){var e=navigator.userAgent;/Playstation Vita/.test(e)?t.vita=!0:/Kindle/.test(e)||/\bKF[A-Z][A-Z]+/.test(e)||/Silk.*Mobile Safari/.test(e)?t.kindle=!0:/Android/.test(e)?t.android=!0:/CrOS/.test(e)?t.chromeOS=!0:/iP[ao]d|iPhone/i.test(e)?t.iOS=!0:/Linux/.test(e)?t.linux=!0:/Mac OS/.test(e)?t.macOS=!0:/Windows/.test(e)&&(t.windows=!0),(/Windows Phone/i.test(e)||/IEMobile/i.test(e))&&(t.android=!1,t.iOS=!1,t.macOS=!1,t.windows=!0,t.windowsPhone=!0);var n=/Silk/.test(e);(t.windows||t.macOS||t.linux&&!n||t.chromeOS)&&(t.desktop=!0),(t.windowsPhone||/Windows NT/i.test(e)&&/Touch/i.test(e))&&(t.desktop=!1)}(),function(){t.audioData=!!window.Audio,t.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var e=document.createElement("audio");try{!!e.canPlayType&&(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(t.ogg=!0),(e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||e.canPlayType("audio/opus;").replace(/^no$/,""))&&(t.opus=!0),e.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(t.mp3=!0),e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(t.wav=!0),(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,""))&&(t.m4a=!0),e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(t.webm=!0))}catch(t){}}(),function(){var e=document.createElement("video");try{!!e.canPlayType&&(e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(t.oggVideo=!0),e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(t.h264Video=!0,t.mp4Video=!0),e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(t.webmVideo=!0),e.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(t.vp9Video=!0),e.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(t.hlsVideo=!0))}catch(t){}}(),function(){var e=navigator.userAgent;if(/Arora/.test(e)?t.arora=!0:/Chrome\/(\d+)/.test(e)&&!t.windowsPhone?(t.chrome=!0,t.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(e)?t.epiphany=!0:/Firefox\D+(\d+)/.test(e)?(t.firefox=!0,t.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(e)&&t.iOS?t.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(e)?(t.ie=!0,t.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(e)?t.midori=!0:/Opera/.test(e)?t.opera=!0:/Safari/.test(e)&&!t.windowsPhone?t.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(e)&&(t.ie=!0,t.trident=!0,t.tridentVersion=parseInt(RegExp.$1,10),t.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(e)&&(t.silk=!0),navigator.standalone&&(t.webApp=!0),void 0!==window.cordova&&(t.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(t.node=!0),t.node&&"object"==typeof process.versions&&(t.nodeWebkit=!!process.versions["node-webkit"],t.electron=!!process.versions.electron),navigator.isCocoonJS&&(t.cocoonJS=!0),t.cocoonJS)try{t.cocoonJSApp="undefined"!=typeof CocoonJS}catch(e){t.cocoonJSApp=!1}void 0!==window.ejecta&&(t.ejecta=!0),/Crosswalk/.test(e)&&(t.crosswalk=!0)}(),t.pixelRatio=window.devicePixelRatio||1,t.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),t.iPhone4=2==t.pixelRatio&&t.iPhone,t.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(t.vibration=!0),function(){t.canvas=!!window.CanvasRenderingContext2D||t.cocoonJS;try{t.localStorage=!!localStorage.getItem}catch(e){t.localStorage=!1}t.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),t.fileSystem=!!window.requestFileSystem,t.webGL=function(){try{var t=document.createElement("canvas");return t.screencanvas=!1,!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return!1}}(),t.webGL=!!t.webGL,t.worker=!!window.Worker,t.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,t.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,t.getUserMedia=t.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,t.firefox&&t.firefoxVersion<21&&(t.getUserMedia=!1)}(),function(){for(var e=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],n=document.createElement("div"),i=0;i<e.length;i++)if(n[e[i]]){t.fullscreen=!0,t.requestFullscreen=e[i];break}var o=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(t.fullscreen)for(i=0;i<o.length;i++)if(document[o[i]]){t.cancelFullscreen=o[i];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(t.fullscreenKeyboard=!0)}(),!window.location.search.includes("notouch")&&("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(t.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(t.mspointer=!0),t.cocoonJS||("onwheel"in window||t.ie&&"WheelEvent"in window?t.wheelEvent="wheel":"onmousewheel"in window?t.wheelEvent="mousewheel":t.firefox&&"MouseScrollEvent"in window&&(t.wheelEvent="DOMMouseScroll"))},e.Device.canPlayAudio=function(t){return!("mp3"!==t||!this.mp3)||(!("ogg"!==t||!this.ogg&&!this.opus)||(!("m4a"!==t||!this.m4a)||(!("opus"!==t||!this.opus)||(!("wav"!==t||!this.wav)||!("webm"!==t||!this.webm)))))},e.Device.canPlayVideo=function(t){return!("webm"!==t||!this.webmVideo&&!this.vp9Video)||(!("mp4"!==t||!this.mp4Video&&!this.h264Video)||(!("ogg"!==t&&"ogv"!==t||!this.oggVideo)||!("mpeg"!==t||!this.hlsVideo)))},window.man=function(t){var n=e.Utils.capitalize(t),i=e.Components.getClass(n);if(i){var o=new i({doc:!0}),s="* Component "+o.type+" *****************";console.log(s),console.log(o.doc),console.log("***********************************");var r="";for(var a in o.subComponents){for(u=" - "+a+" ";u.length<20;)u+=" ";r+=(u+=o.subComponents[a].type)+"\n"}u&&(console.log("* SubComponents:"),console.log(r)),console.log("* Attributes:");for(var l in o.attributes){for(var c=o.attributes[l],u=" - "+l;u.length<20;)u+=" ";u+=c.type;var h=o.attributes[l].values;if(h){if(e.Utils.isFunction(h))try{h=h()}catch(t){}if(e.Utils.isArray(h)){for(;u.length<35;)u+=" ";u+="<"+h.join("|")+">"}}if(c.doc){for(;u.length<45;)u+=" ";u+=c.doc}console.log(u)}console.log(s)}},window.help=function(){var t="* Help *************************\n";t+='* man("<component name>")\n',t+='* client.setAttribute("<component id>","<attribute name>","<value>")\n',t+="* Help *************************\n",console.log(t)},e.Utils=function(){function t(){return NodeFilter.FILTER_ACCEPT}this.mixin=function(t,e){},this.extend=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.ancestor=e.prototype},this.initClass=function(t){t.prototype.constructor=t},this.getAllCommentChildNodes=function(e){for(var n,i=[],o=document.createNodeIterator(e,NodeFilter.SHOW_COMMENT,t,!1);n=o.nextNode();)i.push(n);return i},this.getFirstChildNodeOfType=function(t,e,n){for(var i=0;i<t.childNodes.length;i++){if(t.childNodes[i].nodeType==e)return t.childNodes[i];if(n&&t.childNodes[i].childNodes){var o=this.getFirstChildNodeOfType(t.childNodes[i],e,n);if(null!=o)return o}}return null},this.getFirstChildNodeWithName=function(t,e,n){var i,o;for(i=0;i<t.childNodes.length;i++){if(t.childNodes[i].getAttribute&&t.childNodes[i].getAttribute("name")==e)return t.childNodes[i];if(n&&t.childNodes[i].childNodes&&null!=(o=this.getFirstChildNodeWithName(t.childNodes[i],e,n)))return o}return null},this.getComponentElements=function(t,e,n){for(var i,n=n||{},o=0;o<t.childNodes.length;o++)t.childNodes[o].getAttribute&&(i=t.childNodes[o].getAttribute("name"))&&(n[i]=t.childNodes[o]),e&&t.childNodes[o].childNodes&&t.childNodes[o].childNodes.length&&!t.childNodes[o].getAttribute("data-controller")&&(n=this.getComponentElements(t.childNodes[o],e,n));return n},this.getCDATA=function(t){var e=this.getFirstChildNodeOfType(t,4);return e?e.nodeValue:""},this.isString=function(t){return"string"==typeof t||t instanceof String},this.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},this.isArray=function(t){return t&&"[object Array]"===Object.prototype.toString.call(t)},this.capitalize=function(t){return t[0].toUpperCase()+t.substr(1)},this.camelToDash=function(t){return t.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},this.dashToCamel=function(t){return t.toLowerCase().replace(/\W+(.)/g,function(t,e){return e.toUpperCase()})},this.getKeyFromCode=function(t){switch(t){case 8:return"del";case 9:return"tab";case 13:return"enter";case 32:return"space";case 37:return"left";case 38:return"up";case 39:return"right";case 40:return"down";default:var e=String.fromCharCode(t);return e?e.toLowerCase():null}},this.getDate=function(t){function e(t,e){for(t+="",e||(e=2);t.length<e;)t="0"+t;return t}var n=new Date;t||(t="dmyhisu");for(var i={},o=0;o<t.length;o++)i[t[o]]=!0;var s="";return i.d&&(s+=e(n.getDate())),i.m&&(s+=(s?"/":"")+e(n.getMonth()+1)),i.y&&(s+=(s?"/":"")+n.getFullYear()),i.h&&(s+=(s?" ":"")+e(n.getHours())),i.i&&(s+=(s?":":"")+e(n.getMinutes())),i.s&&(s+=(s?":":"")+e(n.getSeconds())),i.u&&(s+=(s?":":"")+e(n.getMilliseconds(),3)),s},this.rotatePoint=function(t,e,n,i,o){var s=Math.PI/180*o,r=Math.cos(s),a=Math.sin(s);return[r*(n-t)+a*(i-e)+t,r*(i-e)-a*(n-t)+e]},this.getMouseRelativePosition=function(t,e){var n=this.getElementAbsolutePosition(e),i=this.getMouseAbsolutePosition(t,e);return{x:i.x-n.x,y:i.y-n.y}},this.getMouseAbsolutePosition=function(t,n){var i,o;if(e.Device.touch&&t.touches&&t.touches[0])i=t.touches[0].pageX,o=t.touches[0].pageY;else if(null!=t.pageX&&null!=t.pageY)i=t.pageX,o=t.pageY;else{i=null!=t.layerX?t.layerX:t.offsetX,o=null!=t.layerY?t.layerY:t.offsetY;var s=n||t.target||t.srcElement,r=this.getElementAbsolutePosition(s);i+=r.x,o+=r.y}return this.scaleDelta&&1!=this.scaleDelta&&(i*=this.scaleDelta,o*=this.scaleDelta),{x:i,y:o}},this.getElementAbsolutePosition=function(t){for(var e=0,n=0;t&&null!=t.offsetLeft&&null!=t.offsetTop;)e+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent||t.parentNode;return{x:e,y:n}},this.initMouseWheelEvent=function(t,n){e.Device.touch||window.addEvent("Firefox"==browser.browser?"DOMMouseScroll":"mousewheel",t,n)},void 0!==window.DOMParser?this.parseXML=function(t){return(new window.DOMParser).parseFromString(t,"text/xml")}:void 0!==window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")&&(this.parseXML=function(t){var e=new window.ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e})},e.Utils=new e.Utils,Array.prototype.equals=function(t,e){if(!t)return!1;if(1==arguments.length&&(e=!0),this.length!=t.length)return!1;for(var n=0;n<this.length;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!this[n].equals(t[n],e))return!1}else{if(e&&this[n]!=t[n])return!1;if(!e)return this.sort().equals(t.sort(),!0)}return!0},window.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},String.prototype.trim=function(){for(var t=this.replace(/^\s\s*/,""),e=/\s/,n=t.length;e.test(t.charAt(--n)););return t.slice(0,n+1)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(t){return this.slice(0,t.length)==t}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return this.slice(-t.length)==t}),Number.prototype.mod=function(t){return(this%t+t)%t},Number.prototype.next=function(t){return(this+1).mod(t)},Number.prototype.previous=function(t){return(this-1).mod(t)},Array.prototype.isArray||(Array.prototype.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.unique=function(){for(var t=[],e=this.length,n=0;n<e;n++){for(var i=n+1;i<e;i++)this[n]===this[i]&&(i=++n);t.push(this[n])}return t},Array.prototype.last=function(){return this.length?this[this.length-1]:null},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.intersect=function(t){for(var e=[],n=this.length,i=0;i<n;i++)-1!=t.indexOf(this[i])&&e.push(this[i]);return e},Array.prototype.same=function(t){if(this.length!=t.length)return!1;for(var e=0;e<this.length;e++)if(null!=this[e]&&null!=t[e]&&"object"==typeof this[e]&&"object"==typeof t[e]&&this[e].isArray&&t[e].isArray){if(!this[e].same(t[e]))return!1}else if(this[e]!=t[e])return!1;return!0},Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){"use strict";if(null==this)throw new TypeError;var n=Object(this),i=n.length>>>0;if(0===i)return-1;var o=0;if(arguments.length>1&&((o=Number(arguments[1]))!=o?o=0:0!=o&&o!=1/0&&o!=-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=i)return-1;for(var s=o>=0?o:Math.max(i-Math.abs(o),0);s<i;s++)if(s in n&&n[s]===t)return s;return-1}),Array.prototype.clean=function(t){for(var e=0;e<this.length;e++)this[e]==t&&(this.splice(e,1),e--);return this},window.addEvent=function(t,e,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},window.removeEvent=function(t,e,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},e.ComponentPresets.Color=function(){this.attrDefs.color={type:"string",default:"default",values:function(){var t;return e.client&&e.client.skin&&(t=e.client.skin.colors[this.component.type]),t||["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},e.ComponentPresets.Enable=function(){this.attrDefs.enabled={type:"boolean",default:"true",update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},e.ComponentPresets.Label=function(){this.attrDefs.label={type:"string",update:function(){this.component.element.innerHTML=this.value,this.post()}},this.attrDefs.color={type:"string",update:function(){this.component.element.style.color=this.value,this.post()}},this.attrDefs.fontSize={type:"integer",update:function(){this.component.element.style.fontSize=this.value+"px",this.post()}},this.attrDefs.textAlign={type:"string",update:function(){this.component.element.style.textAlign=this.value,this.post()}}},e.ComponentPresets.Position=function(){this.attrDefs.position={type:"string",update:function(){this.component.element.style.position="static"==this.value?"static":"absolute",this.post()}},this.attrDefs.x={type:"integer",update:function(){this.component.element.style.left=this.value+"px",this.post()}},this.attrDefs.y={type:"integer",update:function(){this.component.element.style.top=this.value+"px",this.post()}},this.attrDefs.rotation={type:"integer",update:function(){var t=this.component.element.style,e="rotate("+this.value+"deg)";t.msTransform=t.webkitTransform=t.transform=e,this.post()}},this.attrDefs.opacity={type:"float",update:function(){this.component.element.style.opacity=this.value,this.post()}}},e.ComponentPresets.Size=function(){this.attrDefs.width={type:"size",update:function(){this.component.element.style.width=this.value+("string"!=typeof this.value?"px":""),this.post()},get:function(){return"string"==typeof this.value?this.component.element.offsetWidth:this.value}},this.attrDefs.height={type:"size",update:function(){this.component.element.style.height=this.value+("string"!=typeof this.value?"px":""),this.post()},get:function(){return"string"==typeof this.value?this.component.element.offsetHeight:this.value}}},e.ComponentPresets.Style=function(){this.attrDefs.style={type:"string",default:"default",values:function(){var t;return e.client&&e.client.skin&&(t=e.client.skin.styles[this.component.type]),t||["default"]},update:function(){this.component.updateClass&&this.component.updateClass(),this.post()}}},e.ComponentPresets.Visibility=function(){this.attrDefs.visible={type:"boolean",compile:function(){var t=!(!this.source||"false"==this.source);t!==this.value&&(this.changed=!1,this.value=t,this.update())},update:function(){function t(e,n,i){if((!i||e.getAttribute("visible"))&&(n&&e.onShow?e.onShow():!n&&e.onHide&&e.onHide(),e.children))for(var o=0;o<e.children.length;o++)t(e.children[o],n)}this.value||t(this.component,!1),this.component.element.style.display=this.value?"inline":"none",this.value&&t(this.component,!0),this.post()}}},e.Components.create("_Base",{id:null,requireUpdate:null,doc:{hidden:!0},attributes:{id:{type:"string",set:function(t){this.value=t,this.component.id=t,this.component.element.setAttribute("data-id",t)},get:function(){return this.attributeValues.id}},cssClass:{type:"string",update:function(){var t=this.component,e=this.value;t.dom&&t.dom.className&&(e=t.dom.className+" "+e),t.element.className=e}}},init:function(){this.elements={}},getAttribute:function(t){if(this.attributes[t])return this.attributes[t].get()},setAttribute:function(t,e,n){this.attributes[t]&&this.attributes[t].set(e,n)},update:function(){},super:function(t,n){e.Components.Classes[t].prototype[n].call(this)},setSource:function(t){this.processed=!1},addChild:function(t){this.children.push(t),t.parent=this,this.element&&t.element&&this.element.appendChild(t.element)},getChildren:function(t){if(!t||!this.children.length)return this.children;for(var e=this.children.clone(),n=0;n<this.children.length;n++)this.children[n].getChildren&&e.concat(this.children[n].getChildren(!0));return e},addSubComponent:function(t){!1===t.id&&(t.id=this.id+".icon");var e=t.id;this.id&&(e=e.substr(this.id.length+1)),this.subComponents[e]=t,t.parent=this},isVisible:function(){return!0},isEnabled:function(){return!0}}),e.Components.create("_Field",{presets:["Visibility","Position","Size","Style","Enable"],doc:{hidden:!0},attributes:{value:{}},init:function(){this.focused=!1},focus:function(){},blur:function(){},onFocus:function(){},onBlur:function(){}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Sfera=e):"undefined"!=typeof define&&define.amd?define("Sfera",t.Sfera=e):t.Sfera=e}).call(this);